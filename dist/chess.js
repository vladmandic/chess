/*
  Chess
  homepage: <https://github.com/vladmandic/chess>
  author: <https://github.com/vladmandic>'
*/

"use strict";var Sh=Object.create;var Jr=Object.defineProperty;var bh=Object.getOwnPropertyDescriptor;var Ah=Object.getOwnPropertyNames;var wh=Object.getPrototypeOf,Ih=Object.prototype.hasOwnProperty;var Nh=(e,t,r)=>t in e?Jr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var en=(e,t)=>()=>(e&&(t=e(e=0)),t);var v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ph=(e,t)=>{for(var r in t)Jr(e,r,{get:t[r],enumerable:!0})},Ch=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ah(t))!Ih.call(e,i)&&i!==r&&Jr(e,i,{get:()=>t[i],enumerable:!(n=bh(t,i))||n.enumerable});return e};var Ne=(e,t,r)=>(r=e!=null?Sh(wh(e)):{},Ch(t||!e||!e.__esModule?Jr(r,"default",{value:e,enumerable:!0}):r,e));var L=(e,t,r)=>(Nh(e,typeof t!="symbol"?t+"":t,r),r);var un=v((nv,wo)=>{"use strict";var Th=Object.create,on=Object.defineProperty,Rh=Object.getOwnPropertyDescriptor,_o=Object.getOwnPropertyNames,xh=Object.getPrototypeOf,Oh=Object.prototype.hasOwnProperty,kh=(e,t)=>function(){return t||(0,e[_o(e)[0]])((t={exports:{}}).exports,t),t.exports},Mh=(e,t)=>{for(var r in t)on(e,r,{get:t[r],enumerable:!0})},po=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of _o(t))!Oh.call(e,i)&&i!==r&&on(e,i,{get:()=>t[i],enumerable:!(n=Rh(t,i))||n.enumerable});return e},xt=(e,t,r)=>(r=e!=null?Th(xh(e)):{},po(t||!e||!e.__esModule?on(r,"default",{value:e,enumerable:!0}):r,e)),Lh=e=>po(on({},"__esModule",{value:!0}),e),Fh=kh({"node_modules/.pnpm/dayjs@1.11.4/node_modules/dayjs/dayjs.min.js"(e,t){(function(r,n){typeof e=="object"&&typeof t<"u"?t.exports=n():typeof define=="function"&&define.amd?define(n):(r=typeof globalThis<"u"?globalThis:r||self).dayjs=n()})(e,function(){"use strict";var r=1e3,n=6e4,i=36e5,s="millisecond",a="second",o="minute",u="hour",l="day",f="week",g="month",h="quarter",m="year",_="date",b="Invalid Date",P=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,C=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,B={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},V=function(I,w,c){var d=String(I);return!d||d.length>=w?I:""+Array(w+1-d.length).join(c)+I},se={s:V,z:function(I){var w=-I.utcOffset(),c=Math.abs(w),d=Math.floor(c/60),E=c%60;return(w<=0?"+":"-")+V(d,2,"0")+":"+V(E,2,"0")},m:function I(w,c){if(w.date()<c.date())return-I(c,w);var d=12*(c.year()-w.year())+(c.month()-w.month()),E=w.clone().add(d,g),A=c-E<0,N=w.clone().add(d+(A?-1:1),g);return+(-(d+(c-E)/(A?E-N:N-E))||0)},a:function(I){return I<0?Math.ceil(I)||0:Math.floor(I)},p:function(I){return{M:g,y:m,w:f,d:l,D:_,h:u,m:o,s:a,ms:s,Q:h}[I]||String(I||"").toLowerCase().replace(/s$/,"")},u:function(I){return I===void 0}},x="en",K={};K[x]=B;var F=function(I){return I instanceof p},T=function I(w,c,d){var E;if(!w)return x;if(typeof w=="string"){var A=w.toLowerCase();K[A]&&(E=A),c&&(K[A]=c,E=A);var N=w.split("-");if(!E&&N.length>1)return I(N[0])}else{var q=w.name;K[q]=w,E=q}return!d&&E&&(x=E),E||!d&&x},R=function(I,w){if(F(I))return I.clone();var c=typeof w=="object"?w:{};return c.date=I,c.args=arguments,new p(c)},O=se;O.l=T,O.i=F,O.w=function(I,w){return R(I,{locale:w.$L,utc:w.$u,x:w.$x,$offset:w.$offset})};var p=function(){function I(c){this.$L=T(c.locale,null,!0),this.parse(c)}var w=I.prototype;return w.parse=function(c){this.$d=function(d){var E=d.date,A=d.utc;if(E===null)return new Date(NaN);if(O.u(E))return new Date;if(E instanceof Date)return new Date(E);if(typeof E=="string"&&!/Z$/i.test(E)){var N=E.match(P);if(N){var q=N[2]-1||0,U=(N[7]||"0").substring(0,3);return A?new Date(Date.UTC(N[1],q,N[3]||1,N[4]||0,N[5]||0,N[6]||0,U)):new Date(N[1],q,N[3]||1,N[4]||0,N[5]||0,N[6]||0,U)}}return new Date(E)}(c),this.$x=c.x||{},this.init()},w.init=function(){var c=this.$d;this.$y=c.getFullYear(),this.$M=c.getMonth(),this.$D=c.getDate(),this.$W=c.getDay(),this.$H=c.getHours(),this.$m=c.getMinutes(),this.$s=c.getSeconds(),this.$ms=c.getMilliseconds()},w.$utils=function(){return O},w.isValid=function(){return this.$d.toString()!==b},w.isSame=function(c,d){var E=R(c);return this.startOf(d)<=E&&E<=this.endOf(d)},w.isAfter=function(c,d){return R(c)<this.startOf(d)},w.isBefore=function(c,d){return this.endOf(d)<R(c)},w.$g=function(c,d,E){return O.u(c)?this[d]:this.set(E,c)},w.unix=function(){return Math.floor(this.valueOf()/1e3)},w.valueOf=function(){return this.$d.getTime()},w.startOf=function(c,d){var E=this,A=!!O.u(d)||d,N=O.p(c),q=function(gt,y){var j=O.w(E.$u?Date.UTC(E.$y,y,gt):new Date(E.$y,y,gt),E);return A?j:j.endOf(l)},U=function(gt,y){return O.w(E.toDate()[gt].apply(E.toDate("s"),(A?[0,0,0,0]:[23,59,59,999]).slice(y)),E)},te=this.$W,he=this.$M,Re=this.$D,de="set"+(this.$u?"UTC":"");switch(N){case m:return A?q(1,0):q(31,11);case g:return A?q(1,he):q(0,he+1);case f:var D=this.$locale().weekStart||0,Xe=(te<D?te+7:te)-D;return q(A?Re-Xe:Re+(6-Xe),he);case l:case _:return U(de+"Hours",0);case u:return U(de+"Minutes",1);case o:return U(de+"Seconds",2);case a:return U(de+"Milliseconds",3);default:return this.clone()}},w.endOf=function(c){return this.startOf(c,!1)},w.$set=function(c,d){var E,A=O.p(c),N="set"+(this.$u?"UTC":""),q=(E={},E[l]=N+"Date",E[_]=N+"Date",E[g]=N+"Month",E[m]=N+"FullYear",E[u]=N+"Hours",E[o]=N+"Minutes",E[a]=N+"Seconds",E[s]=N+"Milliseconds",E)[A],U=A===l?this.$D+(d-this.$W):d;if(A===g||A===m){var te=this.clone().set(_,1);te.$d[q](U),te.init(),this.$d=te.set(_,Math.min(this.$D,te.daysInMonth())).$d}else q&&this.$d[q](U);return this.init(),this},w.set=function(c,d){return this.clone().$set(c,d)},w.get=function(c){return this[O.p(c)]()},w.add=function(c,d){var E,A=this;c=Number(c);var N=O.p(d),q=function(he){var Re=R(A);return O.w(Re.date(Re.date()+Math.round(he*c)),A)};if(N===g)return this.set(g,this.$M+c);if(N===m)return this.set(m,this.$y+c);if(N===l)return q(1);if(N===f)return q(7);var U=(E={},E[o]=n,E[u]=i,E[a]=r,E)[N]||1,te=this.$d.getTime()+c*U;return O.w(te,this)},w.subtract=function(c,d){return this.add(-1*c,d)},w.format=function(c){var d=this,E=this.$locale();if(!this.isValid())return E.invalidDate||b;var A=c||"YYYY-MM-DDTHH:mm:ssZ",N=O.z(this),q=this.$H,U=this.$m,te=this.$M,he=E.weekdays,Re=E.months,de=function(y,j,S,M){return y&&(y[j]||y(d,A))||S[j].slice(0,M)},D=function(y){return O.s(q%12||12,y,"0")},Xe=E.meridiem||function(y,j,S){var M=y<12?"AM":"PM";return S?M.toLowerCase():M},gt={YY:String(this.$y).slice(-2),YYYY:this.$y,M:te+1,MM:O.s(te+1,2,"0"),MMM:de(E.monthsShort,te,Re,3),MMMM:de(Re,te),D:this.$D,DD:O.s(this.$D,2,"0"),d:String(this.$W),dd:de(E.weekdaysMin,this.$W,he,2),ddd:de(E.weekdaysShort,this.$W,he,3),dddd:he[this.$W],H:String(q),HH:O.s(q,2,"0"),h:D(1),hh:D(2),a:Xe(q,U,!0),A:Xe(q,U,!1),m:String(U),mm:O.s(U,2,"0"),s:String(this.$s),ss:O.s(this.$s,2,"0"),SSS:O.s(this.$ms,3,"0"),Z:N};return A.replace(C,function(y,j){return j||gt[y]||N.replace(":","")})},w.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},w.diff=function(c,d,E){var A,N=O.p(d),q=R(c),U=(q.utcOffset()-this.utcOffset())*n,te=this-q,he=O.m(this,q);return he=(A={},A[m]=he/12,A[g]=he,A[h]=he/3,A[f]=(te-U)/6048e5,A[l]=(te-U)/864e5,A[u]=te/i,A[o]=te/n,A[a]=te/r,A)[N]||te,E?he:O.a(he)},w.daysInMonth=function(){return this.endOf(g).$D},w.$locale=function(){return K[this.$L]},w.locale=function(c,d){if(!c)return this.$L;var E=this.clone(),A=T(c,d,!0);return A&&(E.$L=A),E},w.clone=function(){return O.w(this.$d,this)},w.toDate=function(){return new Date(this.valueOf())},w.toJSON=function(){return this.isValid()?this.toISOString():null},w.toISOString=function(){return this.$d.toISOString()},w.toString=function(){return this.$d.toUTCString()},I}(),ee=p.prototype;return R.prototype=ee,[["$ms",s],["$s",a],["$m",o],["$H",u],["$W",l],["$M",g],["$y",m],["$D",_]].forEach(function(I){ee[I[1]]=function(w){return this.$g(w,I[0],I[1])}}),R.extend=function(I,w){return I.$i||(I(w,p,R),I.$i=!0),R},R.locale=T,R.isDayjs=F,R.unix=function(I){return R(1e3*I)},R.en=K[x],R.Ls=K,R.p={},R})}}),mo={};Mh(mo,{access:()=>td,accessFile:()=>bo,assert:()=>ed,blank:()=>ad,client:()=>rd,clientFile:()=>Ao,configure:()=>nd,console:()=>_d,data:()=>ld,debug:()=>gd,error:()=>fd,fatal:()=>hd,header:()=>id,headerJson:()=>sd,info:()=>od,logFile:()=>So,options:()=>W,print:()=>ze,ring:()=>tn,state:()=>ud,tags:()=>xe,timed:()=>Jh,verbose:()=>dd,warn:()=>cd});wo.exports=Lh(mo);var vo=xt(require("os")),Rt=xt(require("fs")),at=xt(require("path")),Rr=xt(Fh()),Ei=10,ao=(e=0)=>t=>`\x1B[${t+e}m`,oo=(e=0)=>t=>`\x1B[${38+e};5;${t}m`,uo=(e=0)=>(t,r,n)=>`\x1B[${38+e};2;${t};${r};${n}m`;function Dh(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(let[r,n]of Object.entries(t)){for(let[i,s]of Object.entries(n))t[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},n[i]=t[i],e.set(s[0],s[1]);Object.defineProperty(t,r,{value:n,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1B[39m",t.bgColor.close="\x1B[49m",t.color.ansi=ao(),t.color.ansi256=oo(),t.color.ansi16m=uo(),t.bgColor.ansi=ao(Ei),t.bgColor.ansi256=oo(Ei),t.bgColor.ansi16m=uo(Ei),Object.defineProperties(t,{rgbToAnsi256:{value:(r,n,i)=>r===n&&n===i?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:r=>{let n=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(r.toString(16));if(!n)return[0,0,0];let{colorString:i}=n.groups;i.length===3&&(i=[...i].map(a=>a+a).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:r=>t.rgbToAnsi256(...t.hexToRgb(r)),enumerable:!1},ansi256ToAnsi:{value:r=>{if(r<8)return 30+r;if(r<16)return 90+(r-8);let n,i,s;if(r>=232)n=((r-232)*10+8)/255,i=n,s=n;else{r-=16;let u=r%36;n=Math.floor(r/36)/5,i=Math.floor(u/6)/5,s=u%6/5}let a=Math.max(n,i,s)*2;if(a===0)return 30;let o=30+(Math.round(s)<<2|Math.round(i)<<1|Math.round(n));return a===2&&(o+=60),o},enumerable:!1},rgbToAnsi:{value:(r,n,i)=>t.ansi256ToAnsi(t.rgbToAnsi256(r,n,i)),enumerable:!1},hexToAnsi:{value:r=>t.ansi256ToAnsi(t.hexToAnsi256(r)),enumerable:!1}}),t}var $h=Dh(),Qe=$h,wi=xt(require("process"),1),qh=xt(require("os"),1),lo=xt(require("tty"),1);function Me(e,t=wi.default.argv){let r=e.startsWith("-")?"":e.length===1?"-":"--",n=t.indexOf(r+e),i=t.indexOf("--");return n!==-1&&(i===-1||n<i)}var{env:ue}=wi.default,nn;Me("no-color")||Me("no-colors")||Me("color=false")||Me("color=never")?nn=0:(Me("color")||Me("colors")||Me("color=true")||Me("color=always"))&&(nn=1);function Vh(){if("FORCE_COLOR"in ue)return ue.FORCE_COLOR==="true"?1:ue.FORCE_COLOR==="false"?0:ue.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(ue.FORCE_COLOR,10),3)}function Gh(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function Bh(e,{streamIsTTY:t,sniffFlags:r=!0}={}){let n=Vh();n!==void 0&&(nn=n);let i=r?nn:n;if(i===0)return 0;if(r){if(Me("color=16m")||Me("color=full")||Me("color=truecolor"))return 3;if(Me("color=256"))return 2}if(e&&!t&&i===void 0)return 0;let s=i||0;if(ue.TERM==="dumb")return s;if(wi.default.platform==="win32"){let a=qh.default.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in ue)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(a=>a in ue)||ue.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in ue)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ue.TEAMCITY_VERSION)?1:0;if("TF_BUILD"in ue&&"AGENT_NAME"in ue)return 1;if(ue.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in ue){let a=Number.parseInt((ue.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ue.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ue.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ue.TERM)||"COLORTERM"in ue?1:s}function co(e,t={}){let r=Bh(e,{streamIsTTY:e&&e.isTTY,...t});return Gh(r)}var Hh={stdout:co({isTTY:lo.default.isatty(1)}),stderr:co({isTTY:lo.default.isatty(2)})},Uh=Hh;function jh(e,t,r){let n=e.indexOf(t);if(n===-1)return e;let i=t.length,s=0,a="";do a+=e.substr(s,n-s)+t+r,s=n+i,n=e.indexOf(t,s);while(n!==-1);return a+=e.slice(s),a}function Wh(e,t,r,n){let i=0,s="";do{let a=e[n-1]==="\r";s+=e.substr(i,(a?n-1:n)-i)+t+(a?`\r
`:`
`)+r,i=n+1,n=e.indexOf(`
`,i)}while(n!==-1);return s+=e.slice(i),s}var{stdout:fo,stderr:ho}=Uh,Si=Symbol("GENERATOR"),zt=Symbol("STYLER"),Cr=Symbol("IS_EMPTY"),go=["ansi","ansi","ansi256","ansi16m"],Zt=Object.create(null),Kh=(e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let r=fo?fo.level:0;e.level=t.level===void 0?r:t.level},Yh=class{constructor(e){return yo(e)}},yo=e=>{let t=(...r)=>r.join(" ");return Kh(t,e),Object.setPrototypeOf(t,xr.prototype),t};function xr(e){return yo(e)}Object.setPrototypeOf(xr.prototype,Function.prototype);for(let[e,t]of Object.entries(Qe))Zt[e]={get(){let r=sn(this,Ai(t.open,t.close,this[zt]),this[Cr]);return Object.defineProperty(this,e,{value:r}),r}};Zt.visible={get(){let e=sn(this,this[zt],!0);return Object.defineProperty(this,"visible",{value:e}),e}};var bi=(e,t,r,...n)=>e==="rgb"?t==="ansi16m"?Qe[r].ansi16m(...n):t==="ansi256"?Qe[r].ansi256(Qe.rgbToAnsi256(...n)):Qe[r].ansi(Qe.rgbToAnsi(...n)):e==="hex"?bi("rgb",t,r,...Qe.hexToRgb(...n)):Qe[r][e](...n),Xh=["rgb","hex","ansi256"];for(let e of Xh){Zt[e]={get(){let{level:r}=this;return function(...n){let i=Ai(bi(e,go[r],"color",...n),Qe.color.close,this[zt]);return sn(this,i,this[Cr])}}};let t="bg"+e[0].toUpperCase()+e.slice(1);Zt[t]={get(){let{level:r}=this;return function(...n){let i=Ai(bi(e,go[r],"bgColor",...n),Qe.bgColor.close,this[zt]);return sn(this,i,this[Cr])}}}}var Qh=Object.defineProperties(()=>{},{...Zt,level:{enumerable:!0,get(){return this[Si].level},set(e){this[Si].level=e}}}),Ai=(e,t,r)=>{let n,i;return r===void 0?(n=e,i=t):(n=r.openAll+e,i=t+r.closeAll),{open:e,close:t,openAll:n,closeAll:i,parent:r}},sn=(e,t,r)=>{let n=(...i)=>zh(n,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(n,Qh),n[Si]=e,n[zt]=t,n[Cr]=r,n},zh=(e,t)=>{if(e.level<=0||!t)return e[Cr]?"":t;let r=e[zt];if(r===void 0)return t;let{openAll:n,closeAll:i}=r;if(t.includes("\x1B"))for(;r!==void 0;)t=jh(t,r.close,r.open),r=r.parent;let s=t.indexOf(`
`);return s!==-1&&(t=Wh(t,i,n,s)),n+t+i};Object.defineProperties(xr.prototype,Zt);var tv=xr(),rv=xr({level:ho?ho.level:0}),Eo=require("console"),He=new Yh({level:2}),tn=[],W={dateFormat:"YYYY-MM-DD HH:mm:ss",ringLength:100,console:!0,timeStamp:!0},Q={logFile:!1,accessFile:!1,clientFile:!1,logStream:void 0,accessStream:void 0,clientStream:void 0},xe={blank:"",continue:":     ",info:He.cyan("INFO: "),warn:He.yellow("WARN: "),data:He.green("DATA: "),error:He.red("ERROR:"),fatal:He.bold.red("FATAL:"),assert:He.italic.bold.red("ASSERT:"),timed:He.magentaBright("TIMED:"),state:He.magenta("STATE:"),verbose:He.bgGray.yellowBright("VERB: "),debug:He.bgGray.redBright("DEBUG:"),console:He.gray("CONSOLE:")},rn={showHidden:!1,depth:5,colors:!0,showProxy:!0,maxArrayLength:1024,maxStringLength:10240,breakLength:200,compact:64,sorted:!1,getters:!1},an=new Eo.Console({stdout:process.stdout,stderr:process.stderr,ignoreErrors:!0,inspectOptions:rn});function Zh(e){let t="";try{t=JSON.stringify(e)}catch{}return t}function Tr(...e){let t="";for(let r of e)t+=typeof r=="object"?Zh(r):r,t+=" ";return t}function ze(...e){let t=(0,Rr.default)(Date.now()).format(W.dateFormat);W.console&&(W.timeStamp?an.log(t,...e):an.log(...e))}function So(e){typeof e=="string"&&(W.logFile=e,Q.logFile=!0,Q.logStream=Rt.createWriteStream(at.resolve(W.logFile||""),{flags:"a"}),Q.logStream&&Q.logStream.on("error",t=>{ze(xe.error,"Cannot open application log",W.logFile,t),Q.logFile=!1}))}function bo(e){typeof e=="string"&&(W.accessFile=e,Q.accessFile=!0,Q.accessStream=Rt.createWriteStream(at.resolve(W.accessFile),{flags:"a"}),Q.accessStream&&Q.accessStream.on("error",t=>{ze(xe.error,"Cannot open application log",W.accessFile,t),Q.accessFile=!1}))}function Ao(e){typeof e=="string"&&(W.clientFile=e,Q.clientFile=!0,Q.clientStream=Rt.createWriteStream(at.resolve(W.clientFile),{flags:"a"}),Q.clientStream&&Q.clientStream.on("error",t=>{ze(xe.error,"Cannot open application log",W.clientFile,t),Q.clientFile=!1}))}async function Jh(e,...t){arguments.length<2&&(t=[e],e=process.hrtime.bigint());let r=process.hrtime.bigint(),n=0;try{n=parseInt((r-e).toString())}catch{}n=Math.round(n/1e6);let i=(0,Rr.default)(Date.now()).format(W.dateFormat);W.console&&an.log(i,xe.timed,`${n.toLocaleString()} ms`,...t),Q.logFile&&Q.logStream&&Q.logStream.write(`${xe.timed} ${i} ${n.toLocaleString()} ms ${Tr(...t)}
`)}async function Se(e,...t){let r=(0,Rr.default)(Date.now()).format(W.dateFormat);xe[e]?ze(xe[e],...t):ze(...t),Q.logFile&&Q.logStream&&Q.logStream.write(`${r} ${xe[e]} ${Tr(...t)}
`),tn.push({tag:e,time:r,msg:Tr(...t)}),tn.length>W.ringLength&&tn.shift()}async function ed(e,t,...r){e!==t&&Se("assert",...r,{res:e,exp:t})}async function td(...e){let t=(0,Rr.default)(Date.now()).format(W.dateFormat);Q.accessFile&&Q.accessStream&&Q.accessStream.write(`${t} ${Tr(...e)}
`)}async function rd(...e){let t=(0,Rr.default)(Date.now()).format(W.dateFormat);Q.clientFile&&Q.clientStream&&Q.clientStream.write(`${t} ${Tr(...e)}
`)}function nd(e){!e||(e.dateFormat&&(W.dateFormat=e.dateFormat),e.ringLength&&(W.ringLength=e.ringLength),e.logFile&&So(e.logFile),e.accessFile&&bo(e.accessFile),e.clientFile&&Ao(e.clientFile),e.inspect&&(rn={...rn,...e.inspect}),an=new Eo.Console({stdout:process.stdout,stderr:process.stderr,ignoreErrors:!0,inspectOptions:rn}))}function id(){let e="./package.json";if(!Rt.existsSync(e))return;let t=JSON.parse(Rt.readFileSync(e).toString());process.title=t.name,Se("info",t.name,"version",t.version),Se("info","User:",vo.userInfo().username,"Platform:",process.platform,"Arch:",process.arch,"Node:",process.version),W.logFile&&Q.logFile&&ze(xe.state,"Application log:",at.resolve(W.logFile)),W.accessFile&&Q.accessFile&&ze(xe.state,"Access log:",at.resolve(W.accessFile)),W.clientFile&&Q.clientFile&&ze(xe.state,"Client log:",at.resolve(W.clientFile))}function sd(){let e="./package.json";if(!Rt.existsSync(e))return;let t=JSON.parse(Rt.readFileSync(e).toString());process.title=t.name,Se("info",{application:t.name,version:t.version}),Se("info",{user:vo.userInfo().username,platform:process.platform,arch:process.arch,node:process.version}),(W.logFile||W.accessFile||W.clientFile)&&ze(xe.state,{log:at.resolve(W.logFile||""),access:at.resolve(W.accessFile||""),client:at.resolve(W.clientFile||"")})}var ad=(...e)=>Se("blank",...e),od=(...e)=>Se("info",...e),ud=(...e)=>Se("state",...e),ld=(...e)=>Se("data",...e),cd=(...e)=>Se("warn",...e),fd=(...e)=>Se("error",...e),hd=(...e)=>Se("fatal",...e),dd=(...e)=>Se("verbose",...e),gd=(...e)=>Se("debug",...e),_d=(...e)=>Se("console",...e)});var ot=v(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.i18n=void 0;var md;(function(e){e.WRONG_NUMBER_OF_FEN_FIELDS="A FEN string must contain exactly 6 space-separated fields.",e.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD="The 1st field of a FEN string must contain exactly 8 `/`-separated subfields.",e.UNEXPECTED_CHARACTER_IN_BOARD_FIELD="Unexpected character in the 1st field of the FEN string: `{0}`.",e.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD="Subfield {0} of the FEN string 1st field is unexpectedly short.",e.INVALID_TURN_FIELD="The 2nd field of a FEN string must be either `w` or `b`.",e.INVALID_CASTLING_FIELD="The 3rd field of a FEN string must be either `-` or a list of characters among `K`, `Q`, `k` and `q` (in this order).",e.INVALID_EN_PASSANT_FIELD="The 4th field of a FEN string must be either `-` or a square from the 3rd or 6th rank where en-passant is allowed.",e.WRONG_RANK_IN_EN_PASSANT_FIELD="The rank number indicated in the FEN string 4th field is inconsistent with respect to the 2nd field.",e.INEFFECTIVE_EN_PASSANT_FIELD="No en-passant capture can happen on file {0} in the position defined in the FEN string.",e.INVALID_HALF_MOVE_COUNT_FIELD="The 5th field of a FEN string must be a number, indicating the number of half-move since the last pawn move or capture.",e.INVALID_MOVE_NUMBER_FIELD="The 6th field of a FEN string must be a number, indicating the move number of the game.",e.INVALID_VARIANT_PREFIX="Invalid variant prefix: `{0}`.",e.INVALID_UCI_NOTATION_SYNTAX="The syntax of the UCI notation is invalid.",e.ILLEGAL_UCI_MOVE="The UCI move is not legal.",e.INVALID_MOVE_NOTATION_SYNTAX="The syntax of the move notation is invalid.",e.ILLEGAL_POSITION="The position is not legal.",e.ILLEGAL_NO_KING_CASTLING="Castling is not legal in the considered position as it has no king.",e.ILLEGAL_QUEEN_SIDE_CASTLING="Queen-side castling is not legal in the considered position.",e.ILLEGAL_KING_SIDE_CASTLING="King-side castling is not legal in the considered position.",e.NO_PIECE_CAN_MOVE_TO="No {0} can move to {1}.",e.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION="No {0} on the specified rank/file can move to {1}.",e.REQUIRE_DISAMBIGUATION="Cannot determine uniquely which {0} is supposed to move to {1}.",e.WRONG_DISAMBIGUATION_SYMBOL="Wrong disambiguation symbol (expected: `{0}`, observed: `{1}`).",e.CASTLING_MOVE_ENCODED_WITH_ZERO="Capital O must be used for castling moves (instead of digit 0).",e.TRYING_TO_CAPTURE_YOUR_OWN_PIECES="Capturing its own pieces is not legal.",e.CAPTURE_IS_MANDATORY="Capture is mandatory.",e.INVALID_PIECE_SYMBOL="Character `{0}` is not a valid piece symbol.",e.INVALID_PIECE_SYMBOL_COLOR="Invalid color for piece symbol `{0}`.",e.INVALID_CAPTURING_PAWN_MOVE="Invalid capturing pawn move.",e.INVALID_NON_CAPTURING_PAWN_MOVE="Invalid non-capturing pawn move.",e.NOT_SAFE_FOR_WHITE_KING="This move would let the white king in check.",e.NOT_SAFE_FOR_BLACK_KING="This move would let the black king in check.",e.MISSING_PROMOTION="A promoted piece must be specified for this move.",e.MISSING_PROMOTION_SYMBOL="Character `=` is required to specify a promoted piece.",e.INVALID_PROMOTED_PIECE="{0} cannot be specified as a promoted piece.",e.ILLEGAL_PROMOTION="Specifying a promoted piece is illegal for this move.",e.ILLEGAL_NULL_MOVE="Cannot play a null-move in this position.",e.MISSING_CAPTURE_SYMBOL="Capture symbol `x` is missing.",e.INVALID_CAPTURE_SYMBOL="This move is not a capture move.",e.WRONG_CHECK_CHECKMATE_SYMBOL="Wrong check/checkmate symbol (expected: `{0}`, observed: `{1}`).",e.INVALID_PGN_TOKEN="Unrecognized character or group of characters.",e.INVALID_MOVE_IN_PGN_TEXT="Invalid move ({0}). {1}",e.INVALID_FEN_IN_PGN_TEXT="Invalid FEN string in the initial position header. {0}",e.UNEXPECTED_PGN_HEADER="Unexpected PGN game header.",e.MISSING_PGN_HEADER_ID="Missing or invalid PGN game header ID.",e.MISSING_PGN_HEADER_VALUE="Missing or invalid PGN game header value.",e.MISSING_END_OF_PGN_HEADER="Missing or invalid end of PGN game header.",e.UNEXPECTED_BEGIN_OF_VARIATION="Unexpected begin of variation.",e.UNEXPECTED_END_OF_VARIATION="Unexpected end of variation.",e.UNEXPECTED_END_OF_GAME="Unexpected end of game: there are pending variations.",e.UNEXPECTED_END_OF_TEXT="Unexpected end of text: there is a pending game.",e.INVALID_GAME_INDEX="Game index {0} is invalid (only {1} game(s) found in the PGN data).",e.UNKNOWN_VARIANT="Unknown chess game variant ({0}).",e.VARIANT_WITHOUT_FEN="For game variant {0}, the FEN header is mandatory."})(md=kr.i18n||(kr.i18n={}))});var be=v(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.InvalidPGN=Ze.InvalidNotation=Ze.InvalidFEN=Ze.IllegalArgument=void 0;var Ii=class{constructor(t){this.functionName=t}toString(){return`Illegal argument in function ${this.functionName}`}};Ze.IllegalArgument=Ii;var Ni=class{constructor(t,r,...n){this.fen=t,this.message=Ti(r,n)}toString(){return Ri("InvalidFEN",this.message)}};Ze.InvalidFEN=Ni;var Pi=class{constructor(t,r,n,...i){this.fen=t,this.notation=r,this.message=Ti(n,i)}toString(){return Ri("InvalidNotation",this.message)}};Ze.InvalidNotation=Pi;var Ci=class{constructor(t,r,n,i,...s){this.pgn=t,this.index=r,this.lineNumber=n,this.message=Ti(i,s)}toString(){return Ri("InvalidPGN",`[character=${this.index} line=${this.lineNumber}] ${this.message}`)}};Ze.InvalidPGN=Ci;function Ti(e,t){return e.replace(/{(\d+)}/g,(r,n)=>{let i=Number(n);return i<t.length?t[i]:r})}function Ri(e,t){return e+" -> "+t}});var _t=v(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.coloredPieceFromString=G.coloredPieceToString=G.squareFromString=G.squareToString=G.variantFromString=G.resultFromString=G.fileFromString=G.rankFromString=G.figurineFromString=G.pieceFromString=G.colorFromString=G.variantToString=G.resultToString=G.fileToString=G.rankToString=G.figurineToString=G.pieceToString=G.colorToString=void 0;var fn=[..."wb"],hn=[..."kqrbnp"],No=[..."\u2654\u265A\u2655\u265B\u2656\u265C\u2657\u265D\u2658\u265E\u2659\u265F"],dn=[..."12345678"],gn=[..."abcdefgh"],Po=["1-0","0-1","1/2-1/2","*"],Co=["regular","chess960","no-king","white-king-only","black-king-only","antichess","horde"];function vd(e){return fn[e]}G.colorToString=vd;function yd(e){return hn[e]}G.pieceToString=yd;function Ed(e){return No[e]}G.figurineToString=Ed;function Sd(e){return dn[e]}G.rankToString=Sd;function bd(e){return gn[e]}G.fileToString=bd;function Ad(e){return Po[e]}G.resultToString=Ad;function wd(e){return Co[e]}G.variantToString=wd;function Id(e){return fn.indexOf(e)}G.colorFromString=Id;function Nd(e){return hn.indexOf(e)}G.pieceFromString=Nd;function Pd(e){return No.indexOf(e)}G.figurineFromString=Pd;function Cd(e){return dn.indexOf(e)}G.rankFromString=Cd;function Td(e){return gn.indexOf(e)}G.fileFromString=Td;function Rd(e){return Po.indexOf(e)}G.resultFromString=Rd;function xd(e){return Co.indexOf(e)}G.variantFromString=xd;function Od(e){return gn[e%16]+dn[Math.trunc(e/16)]}G.squareToString=Od;function kd(e){if(typeof e!="string"||!/^[a-h][1-8]$/.test(e))return-1;let t=gn.indexOf(e[0]);return dn.indexOf(e[1])*16+t}G.squareFromString=kd;function Md(e){return fn[e%2]+hn[Math.trunc(e/2)]}G.coloredPieceToString=Md;function Ld(e){if(typeof e!="string"||!/^[wb][kqrbnp]$/.test(e))return-1;let t=fn.indexOf(e[0]);return hn.indexOf(e[1])*2+t}G.coloredPieceFromString=Ld});var Mr=v(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.makeCopy=Le.make960FromScharnagl=Le.makeInitial=Le.makeEmpty=Le.hasCanonicalStartPosition=void 0;var Fd=[-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1],To=[4,8,6,2,0,6,8,4,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],Dd=[10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,10,10,-1,-1,10,10,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],Ro=[{board:To,castling:[129,129],king:[4,116]},null,null,null,null,{board:To,castling:[0,0],king:[-1,-1]},{board:Dd,castling:[0,129],king:[-1,116]}];function $d(e){return Ro[e]!==null}Le.hasCanonicalStartPosition=$d;function qd(e){return{board:Fd.slice(),turn:0,castling:[0,0],enPassant:-1,variant:e,legal:e===2,king:[-1,-1],effectiveCastling:[0,0],effectiveEnPassant:-1}}Le.makeEmpty=qd;function Vd(e){let t=Ro[e];return{board:t.board.slice(),turn:0,castling:t.castling.slice(),enPassant:-1,variant:e,legal:!0,king:t.king.slice(),effectiveCastling:t.castling.slice(),effectiveEnPassant:-1}}Le.makeInitial=Vd;function Gd(e){let t=Bd(e),r=t.pieceScheme.map(i=>i*2+0),n=t.pieceScheme.map(i=>i*2+1);return{board:[r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]],turn:0,castling:[t.castling,t.castling],enPassant:-1,variant:1,legal:!0,king:[0+t.kingFile,112+t.kingFile],effectiveCastling:[t.castling,t.castling],effectiveEnPassant:-1}}Le.make960FromScharnagl=Gd;function Bd(e){let t=[-1,-1,-1,-1,-1,-1,-1,-1],r=0,n=-1;function i(a){let o=0;for(let u=0;u<8;++u)t[u]>=0||(a(u,o),++o)}function s(a,o,u){i((l,f)=>{(f===o||f===u)&&(t[l]=a)})}switch(t[e%4*2+1]=3,e=Math.trunc(e/4),t[e%4*2]=3,e=Math.trunc(e/4),s(1,e%6,-1),e=Math.trunc(e/6),e){case 0:s(4,0,1);break;case 1:s(4,0,2);break;case 2:s(4,0,3);break;case 3:s(4,0,4);break;case 4:s(4,1,2);break;case 5:s(4,1,3);break;case 6:s(4,1,4);break;case 7:s(4,2,3);break;case 8:s(4,2,4);break;case 9:s(4,3,4);break}return i((a,o)=>{o===1?(t[a]=0,n=a):(t[a]=2,r|=1<<a)}),{pieceScheme:t,castling:r,kingFile:n}}function Hd(e){return{board:e.board.slice(),turn:e.turn,castling:e.castling.slice(),enPassant:e.enPassant,variant:e.variant,legal:e.legal,king:e.king.slice(),effectiveCastling:e.effectiveCastling===null?null:e.effectiveCastling.slice(),effectiveEnPassant:e.effectiveEnPassant}}Le.makeCopy=Hd});var Lr=v(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.nagSymbol=pe.variantWithCanonicalStartPosition=pe.oppositeColor=pe.coordinatesToSquare=pe.squareToCoordinates=pe.squareColor=pe.forEachSquare=void 0;var er=be(),pt=_t(),Ud=Mr();function jd(e){for(let t=0;t<8;++t)for(let r=0;r<8;++r)e((0,pt.squareToString)(t*16+r))}pe.forEachSquare=jd;function Wd(e){let t=(0,pt.squareFromString)(e);if(t<0)throw new er.IllegalArgument("squareColor()");return Math.trunc(t/16)%2===t%2?"b":"w"}pe.squareColor=Wd;function Kd(e){let t=(0,pt.squareFromString)(e);if(t<0)throw new er.IllegalArgument("squareToCoordinates()");return{rank:Math.trunc(t/16),file:t%16}}pe.squareToCoordinates=Kd;function Yd(e,t){let r=typeof e=="number"?e:e.file,n=typeof e=="number"?t:e.rank;if(!Number.isInteger(r)||!Number.isInteger(n)||r<0||r>=8||n<0||n>=8)throw new er.IllegalArgument("coordinatesToSquare()");return(0,pt.fileToString)(r)+(0,pt.rankToString)(n)}pe.coordinatesToSquare=Yd;function Xd(e){let t=(0,pt.colorFromString)(e);if(t<0)throw new er.IllegalArgument("oppositeColor()");return(0,pt.colorToString)(1-t)}pe.oppositeColor=Xd;function Qd(e){let t=(0,pt.variantFromString)(e);if(t<0)throw new er.IllegalArgument("variantWithCanonicalStartPosition()");return(0,Ud.hasCanonicalStartPosition)(t)}pe.variantWithCanonicalStartPosition=Qd;var z=new Map;z.set(1,"!");z.set(2,"?");z.set(3,"!!");z.set(4,"??");z.set(5,"!?");z.set(6,"?!");z.set(7,"\u25A1");z.set(8,"\u25A1");z.set(10,"=");z.set(11,"=");z.set(13,"\u221E");z.set(14,"\u2A72");z.set(15,"\u2A71");z.set(16,"\xB1");z.set(17,"\u2213");z.set(18,"+\u2212");z.set(19,"\u2212+");z.set(22,"\u2A00");z.set(32,"\u27F3");z.set(36,"\u2191");z.set(40,"\u2192");z.set(132,"\u21C6");z.set(138,"\u2A01");z.set(140,"\u2206");z.set(141,"\u2207");z.set(142,"\u2313");z.set(143,"\u2264");z.set(145,"RR");z.set(146,"N");function zd(e){if(!Number.isInteger(e)||e<0)throw new er.IllegalArgument("nagSymbol()");let t=z.get(e);return t===void 0?"$"+e:t}pe.nagSymbol=zd});var _n=v(vt=>{"use strict";var mt=vt&&vt.__classPrivateFieldSet||function(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r},re=vt&&vt.__classPrivateFieldGet||function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},tr,Ue,Fe,je;Object.defineProperty(vt,"__esModule",{value:!0});vt.DateValue=void 0;var xi=be(),ki=class{constructor(t,r,n){if(tr.set(this,void 0),Ue.set(this,void 0),Fe.set(this,void 0),je.set(this,void 0),t instanceof Date)mt(this,tr,"ymd","f"),mt(this,Ue,t.getFullYear(),"f"),mt(this,Fe,t.getMonth()+1,"f"),mt(this,je,t.getDate(),"f");else{let i=Oo(t,r,n);if(!i)throw new xi.IllegalArgument("DateValue()");mt(this,tr,i,"f"),mt(this,Ue,t,"f"),mt(this,Fe,r===null?void 0:r,"f"),mt(this,je,n===null?void 0:n,"f")}}type(){return re(this,tr,"f")}year(){return re(this,Ue,"f")}month(){if(re(this,Fe,"f")===void 0)throw new xi.IllegalArgument("DateValue.month()");return re(this,Fe,"f")}day(){if(re(this,je,"f")===void 0)throw new xi.IllegalArgument("DateValue.day()");return re(this,je,"f")}toDate(){let t=re(this,Fe,"f")===void 0?0:re(this,Fe,"f")-1,r=re(this,je,"f")===void 0?1:re(this,je,"f");return new Date(re(this,Ue,"f"),t,r)}toString(){return xo(re(this,Ue,"f"),re(this,Fe,"f"),re(this,je,"f"),"-","**")}toPGNString(){return xo(re(this,Ue,"f"),re(this,Fe,"f"),re(this,je,"f"),".","??")}toHumanReadableString(t){switch(re(this,tr,"f")){case"ymd":{let r=new Date(re(this,Ue,"f"),re(this,Fe,"f")-1,re(this,je,"f"));return new Intl.DateTimeFormat(t,{dateStyle:"long"}).format(r)}case"ym":{let r=new Date(re(this,Ue,"f"),re(this,Fe,"f")-1,1);return new Intl.DateTimeFormat(t,{month:"long",year:"numeric"}).format(r)}default:return String(re(this,Ue,"f"))}}static isValid(t,r,n){return Boolean(Oo(t,r,n))}};vt.DateValue=ki;tr=new WeakMap,Ue=new WeakMap,Fe=new WeakMap,je=new WeakMap;function xo(e,t,r,n,i){let s=String(e).padStart(4,"0"),a=t===void 0?i:String(t).padStart(2,"0"),o=r===void 0?i:String(r).padStart(2,"0");return s+n+a+n+o}function Oo(e,t,r){return r!=null?Oi(e)&&ko(t)&&Number.isInteger(r)&&r>=1&&r<=Zd(e,t)?"ymd":!1:t!=null?Oi(e)&&ko(t)?"ym":!1:Oi(e)?"y":!1}function Oi(e){return Number.isInteger(e)&&e>=0}function ko(e){return Number.isInteger(e)&&e>=1&&e<=12}function Zd(e,t){return new Date(e,t,0).getDate()}});var Mi=v(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.isMoveDescriptor=rr.MoveDescriptor=void 0;var pn=class{constructor(){}toString(){let t=this.from()+this.to();return this.isPromotion()?t+=this.promotion().toUpperCase():this.isCastling()&&(t+="O"),t}};rr.MoveDescriptor=pn;function Jd(e){return e instanceof pn}rr.isMoveDescriptor=Jd});var Fr=v(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.getAttacks=De.isAttacked=De.ATTACK_DIRECTIONS=void 0;De.ATTACK_DIRECTIONS=[[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-16,-1,1,16],[-16,-1,1,16],[-17,-15,15,17],[-17,-15,15,17],[-33,-31,-18,-14,14,18,31,33],[-33,-31,-18,-14,14,18,31,33],[15,17],[-17,-15]];function eg(e,t,r){return Li(e,t,0*2+r)||Li(e,t,4*2+r)||Li(e,t,5*2+r)||Mo(e,t,2*2+r,1*2+r)||Mo(e,t,3*2+r,1*2+r)}De.isAttacked=eg;function Li(e,t,r){let n=De.ATTACK_DIRECTIONS[r];for(let i=0;i<n.length;++i){let s=t-n[i];if((s&136)===0&&e.board[s]===r)return!0}return!1}function Mo(e,t,r,n){let i=De.ATTACK_DIRECTIONS[r];for(let s=0;s<i.length;++s){let a=t;for(;;){if(a-=i[s],(a&136)===0){let o=e.board[a];if(o===-1)continue;if(o===r||o===n)return!0}break}}return!1}function tg(e,t,r){let n=[];return Fi(e,t,n,0*2+r),Fi(e,t,n,4*2+r),Fi(e,t,n,5*2+r),Lo(e,t,n,2*2+r,1*2+r),Lo(e,t,n,3*2+r,1*2+r),n}De.getAttacks=tg;function Fi(e,t,r,n){let i=De.ATTACK_DIRECTIONS[n];for(let s=0;s<i.length;++s){let a=t-i[s];(a&136)===0&&e.board[a]===n&&r.push(a)}}function Lo(e,t,r,n,i){let s=De.ATTACK_DIRECTIONS[n];for(let a=0;a<s.length;++a){let o=t;for(;;){if(o-=s[a],(o&136)===0){let u=e.board[o];if(u===-1)continue;(u===n||u===i)&&r.push(o)}break}}}});var nr=v(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.isEqual=Pe.refreshEffectiveEnPassant=Pe.refreshEffectiveCastling=Pe.isKingSafeAfterMove=Pe.refreshLegalFlagAndKingSquares=Pe.isLegal=void 0;var Vo=Fr();function rg(e){return mn(e),e.legal}Pe.isLegal=rg;function mn(e){if(e.legal!==null)return;e.legal=!1;let t=Fo(e,0),r=Fo(e,1);if(!t||!r)return;if(e.variant===5){if(!Do(e,1-e.turn))return}else if(e.variant===6&&e.turn===1&&!Do(e,0))return;if(e.king[1-e.turn]>=0&&(0,Vo.isAttacked)(e,e.king[1-e.turn],e.turn))return;let n=e.variant===6?-2:10;for(let i=0;i<8;++i){let s=e.board[0+i],a=e.board[112+i];if(s===n||a===10||s===11||a===11)return}e.legal=!0}Pe.refreshLegalFlagAndKingSquares=mn;function Fo(e,t){let r=0+t;if(e.king[t]=-1,e.variant===5)return!0;if(e.variant===2||e.variant===4-t||e.variant===6&&t===0){for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]===r)return!1;return!0}else{for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]===r)if(e.king[t]<0)e.king[t]=n;else return e.king[t]=-1,!1;return e.king[t]>=0}}function Do(e,t){for(let r=0;r<120;r+=(r&7)===7?9:1)if(e.board[r]!==-1&&e.board[r]%2===t)return!0;return!1}function Di(e,t,r,n=-1){if(e.king[e.turn]<0)return!0;let i=e.board[t],s=e.board[r],a=Math.trunc(i/2);e.board[r]=i,e.board[t]=-1,n>=0&&(e.board[n]=-1);try{return!(0,Vo.isAttacked)(e,a===0?r:e.king[e.turn],1-e.turn)}finally{e.board[t]=i,e.board[r]=s,n>=0&&(e.board[n]=5*2+1-e.turn)}}Pe.isKingSafeAfterMove=Di;function $i(e){e.effectiveCastling===null&&(mn(e),e.effectiveCastling=e.variant===1?[qo(e,0),qo(e,1)]:[$o(e,0),$o(e,1)])}Pe.refreshEffectiveCastling=$i;function $o(e,t){let r=112*t;if(e.king[t]!==r+4||e.castling[t]===0)return 0;let n=2*2+t,i=0;return(e.castling[t]&1)!==0&&e.board[r]===n&&(i|=1),(e.castling[t]&128)!==0&&e.board[r+7]===n&&(i|=128),i}function qo(e,t){let r=112*t;if(e.king[t]<=r||e.king[t]>=r+7||e.castling[t]===0)return 0;let n=2*2+t,i=0,s=-1;for(let o=e.king[t]%16-1;o>=0;--o)if(!((e.castling[t]&1<<o)===0||e.board[r+o]!==n))if(s<0)s=o;else{s=-1;break}s>=0&&(i|=1<<s);let a=-1;for(let o=e.king[t]%16+1;o<8;++o)if(!((e.castling[t]&1<<o)===0||e.board[r+o]!==n))if(a<0)a=o;else{a=-1;break}return a>=0&&(i|=1<<a),i}function qi(e){if(e.effectiveEnPassant!==null||(e.effectiveEnPassant=-1,e.enPassant<0))return;let t=(6-e.turn*5)*16+e.enPassant,r=(5-e.turn*3)*16+e.enPassant,n=(4-e.turn)*16+e.enPassant,i=5*2+e.turn,s=5*2+1-e.turn;if(e.board[t]!==-1||e.board[r]!==-1||e.board[n]!==s)return;let a=(n-1&136)===0&&e.board[n-1]===i,o=(n+1&136)===0&&e.board[n+1]===i;!a&&!o||(mn(e),!(!(a&&Di(e,n-1,r,n))&&!(o&&Di(e,n+1,r,n)))&&(e.effectiveEnPassant=e.enPassant))}Pe.refreshEffectiveEnPassant=qi;function ng(e,t){if(e.turn!==t.turn||e.variant!==t.variant)return!1;for(let r=0;r<120;r+=(r&7)===7?9:1)if(e.board[r]!==t.board[r])return!1;return $i(e),$i(t),e.effectiveCastling[0]!==t.effectiveCastling[0]||e.effectiveCastling[1]!==t.effectiveCastling[1]?!1:(qi(e),qi(t),e.effectiveEnPassant===t.effectiveEnPassant)}Pe.isEqual=ng});var vn=v(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.parseFEN=yt.getFEN=yt.ascii=void 0;var Je=_t(),ig=Mr(),Vi=nr(),We=be(),Ke=ot(),Gi=[..."KkQqRrBbNnPp"],Bo=["6","3"];function sg(e){let t=`+---+---+---+---+---+---+---+---+
`;for(let r=7;r>=0;--r){for(let n=0;n<8;++n){let i=e.board[r*16+n];t+="| "+(i===-1?" ":Gi[i])+" "}t+=`|
`,t+=`+---+---+---+---+---+---+---+---+
`}return t+=(0,Je.colorToString)(e.turn)+" "+Ho(e)+" "+Uo(e),e.variant!==0&&(t+=" ("+(0,Je.variantToString)(e.variant)+")"),t}yt.ascii=sg;function ag(e,t=0,r=1,n=!1){let i="";for(let s=7;s>=0;--s){let a=0;for(let o=0;o<8;++o){let u=e.board[s*16+o];u===-1?++a:(a>0&&(i+=a,a=0),i+=Gi[u])}a>0&&(i+=a),s>0&&(i+="/")}return i+=" "+(0,Je.colorToString)(e.turn)+" "+Ho(e,n)+" "+Uo(e),i+=" "+t+" "+r,i}yt.getFEN=ag;function Ho(e,t=!1){if((0,Vi.refreshEffectiveCastling)(e),e.variant===1){if(t){let i=Go(e,0),s=Go(e,1);if(i!==!1&&s!==!1)return i===""&&s===""?"-":i.toUpperCase()+s}let r="",n="";for(let i=0;i<8;++i)e.effectiveCastling[0]&1<<i&&(r+=(0,Je.fileToString)(i)),e.effectiveCastling[1]&1<<i&&(n+=(0,Je.fileToString)(i));return r===""&&n===""?"-":r.toUpperCase()+n}else{let r="";return e.effectiveCastling[0]&128&&(r+="K"),e.effectiveCastling[0]&1&&(r+="Q"),e.effectiveCastling[1]&128&&(r+="k"),e.effectiveCastling[1]&1&&(r+="q"),r===""?"-":r}}function Go(e,t){let r=1<<e.king[t]%16,n=e.effectiveCastling[t]&~(r|r-1),i=e.effectiveCastling[t]&r-1,s="",a=112*t,o=112*t+7,u=2*2+t;if(n!==0){let l=!1;for(let f=e.king[t]+1;f<=o;++f)if(e.board[f]===u){if(l)return!1;l=!0}s+="k"}if(i!==0){let l=!1;for(let f=e.king[t]-1;f>=a;--f)if(e.board[f]===u){if(l)return!1;l=!0}s+="q"}return s}function Uo(e){return(0,Vi.refreshEffectiveEnPassant)(e),e.effectiveEnPassant<0?"-":(0,Je.fileToString)(e.effectiveEnPassant)+Bo[e.turn]}function og(e,t,r){let n=r?t.split(" "):t.replace(/^\s+|\s+$/g,"").split(/\s+/);if(n.length!==6)throw new We.InvalidFEN(t,Ke.i18n.WRONG_NUMBER_OF_FEN_FIELDS);let i=n[0].split("/");if(i.length!==8)throw new We.InvalidFEN(t,Ke.i18n.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD);let s=(0,ig.makeEmpty)(e);s.legal=null,s.effectiveCastling=null,s.effectiveEnPassant=null;for(let l=7;l>=0;--l){let f=i[7-l],g=0,h=0;for(;g<f.length&&h<8;){let m=f[g],_=Gi.indexOf(m);if(/^[1-8]$/.test(m))h+=parseInt(m,10);else if(_>=0)s.board[l*16+h]=_,++h;else throw new We.InvalidFEN(t,Ke.i18n.UNEXPECTED_CHARACTER_IN_BOARD_FIELD,m);++g}if(g!==f.length||h!==8)throw new We.InvalidFEN(t,Ke.i18n.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD,8-l)}if(s.turn=(0,Je.colorFromString)(n[1]),s.turn<0)throw new We.InvalidFEN(t,Ke.i18n.INVALID_TURN_FIELD);let a=e===1?lg(n[2],r,s.board):ug(n[2],r);if(a===null)throw new We.InvalidFEN(t,Ke.i18n.INVALID_CASTLING_FIELD);s.castling=a;let o=n[3];if(o!=="-"){if(!/^[a-h][36]$/.test(o))throw new We.InvalidFEN(t,Ke.i18n.INVALID_EN_PASSANT_FIELD);if(s.enPassant=(0,Je.fileFromString)(o[0]),r){if(o[1]!==Bo[s.turn])throw new We.InvalidFEN(t,Ke.i18n.WRONG_RANK_IN_EN_PASSANT_FIELD);if((0,Vi.refreshEffectiveEnPassant)(s),s.enPassant!==s.effectiveEnPassant)throw new We.InvalidFEN(t,Ke.i18n.INEFFECTIVE_EN_PASSANT_FIELD,(0,Je.fileToString)(s.enPassant))}}let u=r?/^(?:0|[1-9][0-9]*)$/:/^[0-9]+$/;if(!u.test(n[4]))throw new We.InvalidFEN(t,Ke.i18n.INVALID_HALF_MOVE_COUNT_FIELD);if(!u.test(n[5]))throw new We.InvalidFEN(t,Ke.i18n.INVALID_MOVE_NUMBER_FIELD);return{position:s,fiftyMoveClock:parseInt(n[4],10),fullMoveNumber:parseInt(n[5],10)}}yt.parseFEN=og;function ug(e,t){let r=[0,0];return e==="-"?r:(t?/^K?Q?k?q?$/:/^[KQkq]*$/).test(e)?(e.indexOf("K")>=0&&(r[0]|=1<<7),e.indexOf("Q")>=0&&(r[0]|=1<<0),e.indexOf("k")>=0&&(r[1]|=1<<7),e.indexOf("q")>=0&&(r[1]|=1<<0),r):null}function lg(e,t,r){let n=[0,0];if(e==="-")return n;if(!(t?/^[A-H]{0,2}[a-h]{0,2}$/:/^[A-Ha-h]*|[KQkq]*$/).test(e))return null;function i(a){let o=4+a,u=0*2+a;for(let l=112*a;l<112*a+8;++l){if(r[l]===o)return l%8;if(r[l]===u)break}return 0}function s(a){let o=4+a,u=0*2+a;for(let l=112*a+7;l>=112*a;--l){if(r[l]===o)return l%8;if(r[l]===u)break}return 7}t||(e.indexOf("K")>=0&&(n[0]|=1<<s(0)),e.indexOf("Q")>=0&&(n[0]|=1<<i(0)),e.indexOf("k")>=0&&(n[1]|=1<<s(1)),e.indexOf("q")>=0&&(n[1]|=1<<i(1)));for(let a=0;a<8;++a){let o=(0,Je.fileToString)(a);e.indexOf(o.toUpperCase())>=0&&(n[0]|=1<<a),e.indexOf(o)>=0&&(n[1]|=1<<a)}return n}});var Sn=v(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.MoveDescriptorImpl=void 0;var $e=_t(),Ot=be(),cg=Mi(),jo=1,Wo=2,yn=4,Ko=8,Et=class extends cg.MoveDescriptor{constructor(t,r,n,i,s,a,o,u){super(),this._flags=t,this._from=r,this._to=n,this._movingColoredPiece=i,this._finalColoredPiece=s,this._optionalColoredPiece=a,this._optionalSquare1=o,this._optionalSquare2=u}static make(t,r,n,i){let s=i===-1?0:yn;return new Et(s,t,r,n,n,i,-1,-1)}static makeCastling(t,r,n,i,s){let a=0+s,o=2*2+s;return new Et(jo,t,r,a,a,o,n,i)}static makeEnPassant(t,r,n,i){let s=Wo|yn,a=5*2+i,o=5*2+1-i;return new Et(s,t,r,a,a,o,n,-1)}static makePromotion(t,r,n,i,s){let a=Ko|(i===-1?0:yn),o=5*2+n,u=s*2+n;return new Et(a,t,r,o,u,i,-1,-1)}isCastling(){return(this._flags&jo)!==0}isEnPassant(){return(this._flags&Wo)!==0}isCapture(){return(this._flags&yn)!==0}isPromotion(){return(this._flags&Ko)!==0}from(){return(0,$e.squareToString)(this._from)}to(){return(0,$e.squareToString)(this._to)}color(){return(0,$e.colorToString)(this._movingColoredPiece%2)}movingPiece(){return(0,$e.pieceToString)(Math.trunc(this._movingColoredPiece/2))}movingColoredPiece(){return(0,$e.coloredPieceToString)(this._movingColoredPiece)}capturedPiece(){if(!this.isCapture())throw new Ot.IllegalArgument("MoveDescriptor.capturedPiece()");return(0,$e.pieceToString)(Math.trunc(this._optionalColoredPiece/2))}capturedColoredPiece(){if(!this.isCapture())throw new Ot.IllegalArgument("MoveDescriptor.capturedColoredPiece()");return(0,$e.coloredPieceToString)(this._optionalColoredPiece)}rookFrom(){if(!this.isCastling())throw new Ot.IllegalArgument("MoveDescriptor.rookFrom()");return(0,$e.squareToString)(this._optionalSquare1)}rookTo(){if(!this.isCastling())throw new Ot.IllegalArgument("MoveDescriptor.rookTo()");return(0,$e.squareToString)(this._optionalSquare2)}enPassantSquare(){if(!this.isEnPassant())throw new Ot.IllegalArgument("MoveDescriptor.enPassantSquare()");return(0,$e.squareToString)(this._optionalSquare1)}promotion(){if(!this.isPromotion())throw new Ot.IllegalArgument("MoveDescriptor.promotion()");return(0,$e.pieceToString)(Math.trunc(this._finalColoredPiece/2))}coloredPromotion(){if(!this.isPromotion())throw new Ot.IllegalArgument("MoveDescriptor.coloredPromotion()");return(0,$e.coloredPieceToString)(this._finalColoredPiece)}};En.MoveDescriptorImpl=Et});var An=v(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.playNullMove=ne.isNullMoveLegal=ne.play=ne.isMoveLegal=ne.isCastlingMoveLegal=ne.isCaptureMandatory=ne.moves=ne.hasMove=ne.isStalemate=ne.isCheckmate=ne.isCheck=void 0;var ir=Fr(),le=nr(),me=Sn(),fg=[204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,0,768,2255,2111,2255,768,0,0,0,0,0,0,60,60,60,60,60,60,63,0,63,60,60,60,60,60,60,0,0,0,0,0,0,768,1231,1087,1231,768,0,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0],hg=[-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,0,-16,0,-15,0,0,0,0,0,0,0,0,0,0,0,0,-17,-16,-15,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,15,16,17,0,0,0,0,0,0,0,0,0,0,0,0,15,0,16,0,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0];function Xo(e,t){for(let r=0;r<120;r+=(r&7)===7?9:1)if(e.board[r]!==-1&&e.board[r]%2===t)return!0;return!1}function bn(e){return e.king[e.turn]>=0&&(0,ir.isAttacked)(e,e.king[e.turn],1-e.turn)}function dg(e){return(0,le.isLegal)(e)&&bn(e)}ne.isCheck=dg;function gg(e){return!(0,le.isLegal)(e)||Bi(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?!Xo(e,0):bn(e)}ne.isCheckmate=gg;function _g(e){return!(0,le.isLegal)(e)||Bi(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?Xo(e,0):!bn(e)}ne.isStalemate=_g;function Bi(e){class t{}try{return Qo(e,()=>{throw new t}),!1}catch(r){if(r instanceof t)return!0;throw r}}ne.hasMove=Bi;function pg(e){let t=[];return Qo(e,r=>{t.push(r)}),t}ne.moves=pg;function Qo(e,t){if(!(0,le.isLegal)(e))return;let r=!Hi(e);if((0,le.refreshEffectiveCastling)(e),r&&e.effectiveCastling[e.turn]!==0){let n=112*e.turn;for(let i=0;i<8;++i)if((e.effectiveCastling[e.turn]&1<<i)!==0){let s=n+i,a=n+(s<e.king[e.turn]?3:5),o=n+(s<e.king[e.turn]?2:6);Zo(e,e.king[e.turn],o,s,a)&&t(me.MoveDescriptorImpl.makeCastling(e.king[e.turn],o,s,a,e.turn))}}if((0,le.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0){let n=(5-e.turn*3)*16+e.effectiveEnPassant,i=(4-e.turn)*16+e.effectiveEnPassant,s=5*2+e.turn;(i-1&136)===0&&e.board[i-1]===s&&(0,le.isKingSafeAfterMove)(e,i-1,n,i)&&t(me.MoveDescriptorImpl.makeEnPassant(i-1,n,i,e.turn)),(i+1&136)===0&&e.board[i+1]===s&&(0,le.isKingSafeAfterMove)(e,i+1,n,i)&&t(me.MoveDescriptorImpl.makeEnPassant(i+1,n,i,e.turn))}for(let n=0;n<120;n+=(n&7)===7?9:1){let i=e.board[n],s=Math.trunc(i/2);if(!(i===-1||i%2!==e.turn))if(s===5){let a=ir.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o){let u=n+a[o];(u&136)===0&&e.board[u]!==-1&&e.board[u]%2!==e.turn&&(0,le.isKingSafeAfterMove)(e,n,u)&&Yo(e,n,u,t)}if(r){let o=16-e.turn*32,u=n+o;if(e.board[u]===-1){(0,le.isKingSafeAfterMove)(e,n,u)&&Yo(e,n,u,t);let l=e.turn*96;n>=l&&n<l+24&&(u+=o,e.board[u]===-1&&(0,le.isKingSafeAfterMove)(e,n,u)&&t(me.MoveDescriptorImpl.make(n,u,i,-1)))}}}else if(s===4||s===0){let a=ir.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o){let u=n+a[o];if((u&136)===0){let l=e.board[u];(l===-1?r:l%2!==e.turn)&&(0,le.isKingSafeAfterMove)(e,n,u)&&t(me.MoveDescriptorImpl.make(n,u,i,l))}}}else{let a=ir.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o)for(let u=n+a[o];(u&136)===0;u+=a[o]){let l=e.board[u];if((l===-1?r:l%2!==e.turn)&&(0,le.isKingSafeAfterMove)(e,n,u)&&t(me.MoveDescriptorImpl.make(n,u,i,l)),l!==-1)break}}}}function Yo(e,t,r,n){let i=e.board[r];r<8||r>=112?(n(me.MoveDescriptorImpl.makePromotion(t,r,e.turn,i,1)),n(me.MoveDescriptorImpl.makePromotion(t,r,e.turn,i,2)),n(me.MoveDescriptorImpl.makePromotion(t,r,e.turn,i,3)),n(me.MoveDescriptorImpl.makePromotion(t,r,e.turn,i,4)),e.variant===5&&n(me.MoveDescriptorImpl.makePromotion(t,r,e.turn,i,0))):n(me.MoveDescriptorImpl.make(t,r,5*2+e.turn,i))}function Hi(e){if(e.variant!==5)return!1;for(let t=0;t<120;t+=(t&7)===7?9:1){let r=e.board[t];if(r!==-1&&r%2!==e.turn&&(0,ir.isAttacked)(e,t,e.turn))return!0}return(0,le.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0}ne.isCaptureMandatory=Hi;function zo(e,t,r){let n=-1,i=-1;if(e.variant===1){let s=r%16;if(Math.trunc(r/16)!==e.turn*7||(e.effectiveCastling[e.turn]&1<<s)===0)return!1;n=r,i=(t>r?3:5)+112*e.turn,r=(t>r?2:6)+112*e.turn}else if(r===2+e.turn*112){if((e.effectiveCastling[e.turn]&1)===0)return!1;n=112*e.turn,i=3+112*e.turn}else if(r===6+e.turn*112){if((e.effectiveCastling[e.turn]&1<<7)===0)return!1;n=7+112*e.turn,i=5+112*e.turn}else return!1;return Zo(e,t,r,n,i)?me.MoveDescriptorImpl.makeCastling(t,r,n,i,e.turn):!1}ne.isCastlingMoveLegal=zo;function Zo(e,t,r,n,i){e.board[t]=-1,e.board[n]=-1;try{for(let a=Math.min(t,r,n,i);a<=Math.max(t,r,n,i);++a)if(e.board[a]!==-1)return!1;let s=1-e.turn;for(let a=Math.min(t,r);a<=Math.max(t,r);++a)if((0,ir.isAttacked)(e,a,s))return!1;return!0}finally{e.board[t]=0*2+e.turn,e.board[n]=2*2+e.turn}}function mg(e,t,r){if(!(0,le.isLegal)(e))return!1;let n=e.board[t],i=e.board[r],s=Math.trunc(n/2);if(n===-1||n%2!==e.turn)return!1;let a=r-t+119,o=-1,u=!1,l=s===5&&(r<8||r>=112),f=Hi(e);if(s===0&&!f&&((0,le.refreshEffectiveCastling)(e),e.effectiveCastling[e.turn]!==0)){let g=zo(e,t,r);if(g)return{type:"regular",moveDescriptor:g}}if((fg[a]&1<<n)===0)if(s===5&&a===151-e.turn*64){let g=e.turn*96;if(t<g||t>=g+24)return!1;u=!0}else return!1;if(s===5){if((0,le.refreshEffectiveEnPassant)(e),a===135-e.turn*32||u){if(f||i!==-1)return!1}else if(i===-1){if(r!==(5-e.turn*3)*16+e.effectiveEnPassant)return!1;o=(4-e.turn)*16+e.effectiveEnPassant}else if(i%2===e.turn)return!1}else if(i===-1?f:i%2===e.turn)return!1;if(s===3||s===2||s===1){let g=hg[a];for(let h=t+g;h!==r;h+=g)if(e.board[h]!==-1)return!1}else if(u&&e.board[(t+r)/2]!==-1)return!1;return(0,le.isKingSafeAfterMove)(e,t,r,o)?l?{type:"promotion",moveDescriptorFactory:vg(t,r,e.variant,e.turn,i)}:{type:"regular",moveDescriptor:o>=0?me.MoveDescriptorImpl.makeEnPassant(t,r,o,e.turn):me.MoveDescriptorImpl.make(t,r,n,i)}:!1}ne.isMoveLegal=mg;function vg(e,t,r,n,i){return s=>s===5||s===0&&r!==5?!1:me.MoveDescriptorImpl.makePromotion(e,t,n,i,s)}function yg(e,t){(0,le.refreshEffectiveCastling)(e),e.board[t._from]=-1,t.isEnPassant()?e.board[t._optionalSquare1]=-1:t.isCastling()&&(e.board[t._optionalSquare1]=-1,e.board[t._optionalSquare2]=t._optionalColoredPiece),e.board[t._to]=t._finalColoredPiece;let r=Math.trunc(t._movingColoredPiece/2);if(r===0&&(e.effectiveCastling[e.turn]=0),t._from<8&&(e.effectiveCastling[0]&=~(1<<t._from)),t._to<8&&(e.effectiveCastling[0]&=~(1<<t._to)),t._from>=112&&(e.effectiveCastling[1]&=~(1<<t._from%16)),t._to>=112&&(e.effectiveCastling[1]&=~(1<<t._to%16)),e.castling[0]=e.effectiveCastling[0],e.castling[1]=e.effectiveCastling[1],e.enPassant=-1,e.effectiveEnPassant=-1,r===5&&Math.abs(t._from-t._to)===32){let n=(1+5*e.turn)*16;if(t._from>=n&&t._from<n+8){let i=t._movingColoredPiece^1;((t._to-1&136)===0&&e.board[t._to-1]===i||(t._to+1&136)===0&&e.board[t._to+1]===i)&&(e.enPassant=t._to%16,e.effectiveEnPassant=null)}}r===0&&e.king[e.turn]>=0&&(e.king[e.turn]=t._to),e.turn=1-e.turn}ne.play=yg;function Jo(e){return(0,le.isLegal)(e)&&!bn(e)}ne.isNullMoveLegal=Jo;function Eg(e){return Jo(e)?(e.turn=1-e.turn,e.enPassant=-1,e.effectiveEnPassant=-1,!0):!1}ne.playNullMove=Eg});var su=v(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.parseNotation=ar.getNotation=void 0;var tu=Fr(),Ae=_t(),Y=vn(),Sg=Mr(),Dr=nr(),In=Sn(),sr=An(),X=be(),H=ot();function bg(e,t,r){let n="";return t.isCastling()?n=t._to%16===6?"O-O":"O-O-O":Math.trunc(t._movingColoredPiece/2)===5?(t.isCapture()&&(n+=(0,Ae.fileToString)(t._from%16)+"x"),n+=(0,Ae.squareToString)(t._to),t.isPromotion()&&(n+="="+eu(t._finalColoredPiece,r))):(n+=eu(t._movingColoredPiece,r),n+=nu(e,t._from,t._to),t.isCapture()&&(n+="x"),n+=(0,Ae.squareToString)(t._to)),n+=ru(e,t),n}ar.getNotation=bg;function eu(e,t){switch(t){case"figurine":return(0,Ae.figurineToString)(e);case"standard":return(0,Ae.pieceToString)(Math.trunc(e/2)).toUpperCase()}}function ru(e,t){let r=(0,Sg.makeCopy)(e);return(0,sr.play)(r,t),(0,sr.isCheckmate)(r)?"#":(0,sr.isCheck)(r)?"+":""}function nu(e,t,r){let n=(0,tu.getAttacks)(e,r,e.turn).filter(l=>e.board[l]===e.board[t]);if(n.length<2)return"";let i=!1,s=!1,a=!1,o=Math.trunc(t/16),u=t%16;for(let l=0;l<n.length;++l){let f=n[l];f===t||Ag(e,f,r)||(i=!0,o===Math.trunc(f/16)&&(s=!0),u===f%16&&(a=!0))}return a?s?(0,Ae.squareToString)(t):(0,Ae.rankToString)(o):i?(0,Ae.fileToString)(u):""}function Ag(e,t,r){let n=e.king[e.turn];if(n<0)return!1;let i=Math.abs(n-t),s=Math.abs(r-t),a=1*2+1-e.turn,o=2*2+1-e.turn,u=3*2+1-e.turn;return i<8?s>=8&&wn(e,n,t,n<t?1:-1,o,a):i%16===0?s%16!==0&&wn(e,n,t,n<t?16:-16,o,a):i%15===0?s%15!==0&&wn(e,n,t,n<t?15:-15,u,a):i%17===0?s%17!==0&&wn(e,n,t,n<t?17:-17,u,a):!1}function wn(e,t,r,n,i,s){for(let a=t+n;a!==r;a+=n)if(e.board[a]!==-1)return!1;for(let a=r+n;(a&136)===0;a+=n)if(e.board[a]!==-1)return e.board[a]===i||e.board[a]===s;return!1}function wg(e,t,r,n){let i=/^(?:(O-O-O|0-0-0)|(O-O|0-0)|([A-Z\u2654-\u265f])([a-h])?([1-8])?(x)?([a-h][1-8])|(?:([a-h])(x)?)?([a-h][1-8])(?:(=)?([A-Z\u2654-\u265f]))?)([+#])?$/.exec(t);if(i===null)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_MOVE_NOTATION_SYNTAX);if(!(0,Dr.isLegal)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_POSITION);let s=!1;if(i[1]!==void 0||i[2]!==void 0?s=Ig(e,t,r,i[1],i[2]):i[3]!==void 0?s=Pg(e,t,r,n,i[3],i[4],i[5],i[7]):s=Cg(e,t,r,n,i[8],i[10],i[11],i[12]),r){let a=i[6]!==void 0||i[9]!==void 0;if(s.isCapture()!==a){let l=s.isCapture()?H.i18n.MISSING_CAPTURE_SYMBOL:H.i18n.INVALID_CAPTURE_SYMBOL;throw new X.InvalidNotation((0,Y.getFEN)(e),t,l)}let o=ru(e,s),u=i[13]===void 0?"":i[13];if(o!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.WRONG_CHECK_CHECKMATE_SYMBOL,o,u)}return s}ar.parseNotation=wg;function Ig(e,t,r,n,i){let s=e.king[e.turn];if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_NO_KING_CASTLING);(0,Dr.refreshEffectiveCastling)(e);let a=i!==void 0,o=Ng(e,a),u=o>=0?(0,sr.isCastlingMoveLegal)(e,s,o+112*e.turn):!1;if(!u){let l=a?H.i18n.ILLEGAL_KING_SIDE_CASTLING:H.i18n.ILLEGAL_QUEEN_SIDE_CASTLING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,l)}if(r&&(a?i:n).charAt(0)==="0")throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CASTLING_MOVE_ENCODED_WITH_ZERO);return u}function Ng(e,t){if(e.variant===1){if(e.effectiveCastling[e.turn]!==0){let r=0+e.turn;for(let n=t?7:0;e.board[n+112*e.turn]!==r;n+=t?-1:1)if((e.effectiveCastling[e.turn]&1<<n)!==0)return n}return-1}else return t?6:2}function Pg(e,t,r,n,i,s,a,o){let u=iu(e,t,i,r,n)*2+e.turn,l=(0,Ae.squareFromString)(o),f=e.board[l];if(f!==-1&&f%2===e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.TRYING_TO_CAPTURE_YOUR_OWN_PIECES);if(f===-1&&(0,sr.isCaptureMandatory)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CAPTURE_IS_MANDATORY);let g=(0,tu.getAttacks)(e,l,e.turn).filter(m=>e.board[m]===u);if(s!==void 0){let m=(0,Ae.fileFromString)(s);g=g.filter(_=>_%16===m)}if(a!==void 0){let m=(0,Ae.rankFromString)(a);g=g.filter(_=>Math.trunc(_/16)===m)}if(g.length===0){let m=s===void 0&&a===void 0?H.i18n.NO_PIECE_CAN_MOVE_TO:H.i18n.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION;throw new X.InvalidNotation((0,Y.getFEN)(e),t,m,i,o)}let h=!1;for(let m=0;m<g.length;++m)if((0,Dr.isKingSafeAfterMove)(e,g[m],l)){if(h)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.REQUIRE_DISAMBIGUATION,i,o);h=In.MoveDescriptorImpl.make(g[m],l,u,f)}if(!h){let m=e.turn===0?H.i18n.NOT_SAFE_FOR_WHITE_KING:H.i18n.NOT_SAFE_FOR_BLACK_KING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,m)}if(r){let m=nu(e,h._from,l),_=(s===void 0?"":s)+(a===void 0?"":a);if(m!==_)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.WRONG_DISAMBIGUATION_SYMBOL,m,_)}return h}function Cg(e,t,r,n,i,s,a,o){let u=10+e.turn,l=(0,Ae.squareFromString)(s),f=e.board[l],g=16-e.turn*32,h=l-g,m=-1;if(i!==void 0){if((h&136)!==0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);let _=(0,Ae.fileFromString)(i),b=l%16;if(b-_===1)h-=1;else if(b-_===-1)h+=1;else throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);if(e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);if(f===-1){if((0,Dr.refreshEffectiveEnPassant)(e),l!==(5-e.turn*3)*16+e.effectiveEnPassant)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);m=(4-e.turn)*16+e.effectiveEnPassant}else if(f%2===e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE)}else{if((0,sr.isCaptureMandatory)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CAPTURE_IS_MANDATORY);if((h&136)!==0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(f!==-1)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(e.board[h]===-1){h-=g;let _=e.turn*96;if(h<_||h>=_+24||e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}else if(e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}if(!(0,Dr.isKingSafeAfterMove)(e,h,l,m)){let _=e.turn===0?H.i18n.NOT_SAFE_FOR_WHITE_KING:H.i18n.NOT_SAFE_FOR_BLACK_KING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,_)}if(l<8||l>=112){if(o===void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.MISSING_PROMOTION);let _=iu(e,t,o,r,n);if(_===5||_===0&&e.variant!==5)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PROMOTED_PIECE,o);if(r&&a===void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.MISSING_PROMOTION_SYMBOL);return In.MoveDescriptorImpl.makePromotion(h,l,e.turn,f,_)}else{if(o!==void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_PROMOTION);return m>=0?In.MoveDescriptorImpl.makeEnPassant(h,l,m,e.turn):In.MoveDescriptorImpl.make(h,l,u,f)}}function iu(e,t,r,n,i){switch(i){case"figurine":{let s=(0,Ae.figurineFromString)(r);if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL,r);if(n&&s%2!==e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL_COLOR,r);return Math.trunc(s/2)}case"standard":{let s=(0,Ae.pieceFromString)(r.toLowerCase());if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL,r);return s}}}});var au=v(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});or.parseUCINotation=or.getUCINotation=void 0;var Ui=_t(),kt=vn(),Tg=nr(),Rg=An(),Mt=be(),Lt=ot();function xg(e,t,r){let n=t.from();return t.isCastling()?n+=r||e.variant===1?t.rookFrom():t.to():n+=t.to(),t.isPromotion()&&(n+=t.promotion()),n}or.getUCINotation=xg;function Og(e,t,r){let n=/^([a-h][1-8])([a-h][1-8])([kqrbnp]?)$/.exec(t);if(n===null)throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.INVALID_UCI_NOTATION_SYNTAX);if(!(0,Tg.isLegal)(e))throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_POSITION);let i=(0,Ui.squareFromString)(n[1]),s=(0,Ui.squareFromString)(n[2]),a=!1,o=-1;if(e.variant!==1&&!r&&e.board[i]!==-1&&e.board[s]!==-1&&e.board[i]%2===e.board[s]%2){let f=Math.trunc(e.board[i]/2),g=Math.trunc(e.board[s]/2);f===0&&g===2&&(a=!0,o=s,s=e.turn*112+(i<s?6:2))}let u=(0,Rg.isMoveLegal)(e,i,s),l=!1;if(!u)throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_UCI_MOVE);if(u.type==="promotion"){if(n[3]==="")throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_UCI_MOVE);if(l=u.moveDescriptorFactory((0,Ui.pieceFromString)(n[3])),!l)throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_UCI_MOVE)}else{if(n[3]!=="")throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_UCI_MOVE);l=u.moveDescriptor}if(a&&(!l.isCastling()||o!==l._optionalSquare1))throw new Mt.InvalidNotation((0,kt.getFEN)(e),t,Lt.i18n.ILLEGAL_UCI_MOVE);return l}or.parseUCINotation=Og});var ur=v(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.Position=void 0;var J=be(),kg=ot(),ou=Fr(),Z=_t(),St=vn(),we=Mr(),$r=nr(),qr=Sn(),et=An(),Ft=su(),Nn=au(),Dt=class{constructor(t,r){switch(arguments.length){case 0:this._impl=(0,we.makeInitial)(0);break;case 1:{if(t==="start")this._impl=(0,we.makeInitial)(0);else if(t==="empty")this._impl=(0,we.makeEmpty)(0);else if(t instanceof Dt)this._impl=(0,we.makeCopy)(t._impl);else{let n=(0,Z.variantFromString)(t);if(n>=0){if(!(0,we.hasCanonicalStartPosition)(n))throw new J.IllegalArgument("Position()");this._impl=(0,we.makeInitial)(n)}else if(typeof t=="string"){let i=t.indexOf(":");if(i<0)this._impl=(0,St.parseFEN)(0,t,!1).position;else{let s=t.substring(0,i),a=(0,Z.variantFromString)(s);if(a<0)throw new J.InvalidFEN(t,kg.i18n.INVALID_VARIANT_PREFIX,s);this._impl=(0,St.parseFEN)(a,t.substring(i+1),!1).position}}else throw new J.IllegalArgument("Position()")}break}default:{let n=(0,Z.variantFromString)(t);if(n<0)throw new J.IllegalArgument("Position()");if(r==="start"){if(!(0,we.hasCanonicalStartPosition)(n))throw new J.IllegalArgument("Position()");this._impl=(0,we.makeInitial)(n)}else if(r==="empty")this._impl=(0,we.makeEmpty)(n);else if(typeof r=="number"){if(n!==1||!uu(r))throw new J.IllegalArgument("Position()");this._impl=(0,we.make960FromScharnagl)(r)}else if(typeof r=="string")this._impl=(0,St.parseFEN)(n,r,!1).position;else throw new J.IllegalArgument("Position()");break}}}clear(t="regular"){let r=(0,Z.variantFromString)(t);if(r<0)throw new J.IllegalArgument("Position.clear()");this._impl=(0,we.makeEmpty)(r)}reset(){this._impl=(0,we.makeInitial)(0)}reset960(t){if(!uu(t))throw new J.IllegalArgument("Position.reset960()");this._impl=(0,we.make960FromScharnagl)(t)}resetAntichess(){this._impl=(0,we.makeInitial)(5)}resetHorde(){this._impl=(0,we.makeInitial)(6)}static isEqual(t,r){return t instanceof Dt&&r instanceof Dt&&(0,$r.isEqual)(t._impl,r._impl)}ascii(){return(0,St.ascii)(this._impl)}fen(t,r){if(arguments.length===0)return(0,St.getFEN)(this._impl);if(arguments.length===1&&typeof t=="object"){let n=Mg(t,"Position.fen()"),i=n("fiftyMoveClock",0,u=>Number.isInteger(u)),s=n("fullMoveNumber",1,u=>Number.isInteger(u)),a=n("withVariant",!1,u=>typeof u=="boolean"),o=n("regularFENIfPossible",!1,u=>typeof u=="boolean");return(a?(0,Z.variantToString)(this._impl.variant)+":":"")+(0,St.getFEN)(this._impl,i,s,o)}else if(arguments.length===1&&typeof t=="string"){let n=(0,St.parseFEN)(this._impl.variant,t,!1);return this._impl=n.position,{fiftyMoveClock:n.fiftyMoveClock,fullMoveNumber:n.fullMoveNumber}}else if(arguments.length>=2&&typeof t=="string"&&typeof r=="boolean"){let n=(0,St.parseFEN)(this._impl.variant,t,r);return this._impl=n.position,{fiftyMoveClock:n.fiftyMoveClock,fullMoveNumber:n.fullMoveNumber}}else throw new J.IllegalArgument("Position.fen()")}variant(){return(0,Z.variantToString)(this._impl.variant)}square(t,r){let n=(0,Z.squareFromString)(t);if(n<0)throw new J.IllegalArgument("Position.square()");if(arguments.length===1){let i=this._impl.board[n];return i===-1?"-":(0,Z.coloredPieceToString)(i)}else if(r==="-")this._impl.board[n]=-1,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null;else{let i=(0,Z.coloredPieceFromString)(r);if(i<0)throw new J.IllegalArgument("Position.square()");this._impl.board[n]=i,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null}}turn(t){if(arguments.length===0)return(0,Z.colorToString)(this._impl.turn);{let r=(0,Z.colorFromString)(t);if(r<0)throw new J.IllegalArgument("Position.turn()");this._impl.turn=r,this._impl.legal=null,this._impl.effectiveEnPassant=null}}castling(t,r){if(typeof t!="string"||!(this._impl.variant===1?/^[wb][a-h]$/:/^[wb][kq]$/).test(t))throw new J.IllegalArgument("Position.castling()");let n=(0,Z.colorFromString)(t[0]),i=this._impl.variant===1?(0,Z.fileFromString)(t[1]):t[1]==="k"?7:0;if(arguments.length===1)return(this._impl.castling[n]&1<<i)!==0;if(typeof r=="boolean")r?this._impl.castling[n]|=1<<i:this._impl.castling[n]&=~(1<<i),this._impl.effectiveCastling=null;else throw new J.IllegalArgument("Position.castling()")}effectiveCastling(t){if(typeof t!="string"||!(this._impl.variant===1?/^[wb][a-h]$/:/^[wb][kq]$/).test(t))throw new J.IllegalArgument("Position.effectiveCastling()");let r=(0,Z.colorFromString)(t[0]),n=this._impl.variant===1?(0,Z.fileFromString)(t[1]):t[1]==="k"?7:0;return(0,$r.refreshEffectiveCastling)(this._impl),(this._impl.effectiveCastling[r]&1<<n)!==0}enPassant(t){if(arguments.length===0)return this._impl.enPassant<0?"-":(0,Z.fileToString)(this._impl.enPassant);if(t==="-")this._impl.enPassant=-1,this._impl.effectiveEnPassant=-1;else{let r=(0,Z.fileFromString)(t);if(r<0)throw new J.IllegalArgument("Position.enPassant()");this._impl.enPassant=r,this._impl.effectiveEnPassant=null}}effectiveEnPassant(){return(0,$r.refreshEffectiveEnPassant)(this._impl),this._impl.effectiveEnPassant<0?"-":(0,Z.fileToString)(this._impl.effectiveEnPassant)}isAttacked(t,r){let n=(0,Z.squareFromString)(t),i=(0,Z.colorFromString)(r);if(n<0||i<0)throw new J.IllegalArgument("Position.isAttacked()");return(0,ou.isAttacked)(this._impl,n,i)}getAttacks(t,r){let n=(0,Z.squareFromString)(t),i=(0,Z.colorFromString)(r);if(n<0||i<0)throw new J.IllegalArgument("Position.getAttacks()");return(0,ou.getAttacks)(this._impl,n,i).map(Z.squareToString)}isLegal(){return(0,$r.isLegal)(this._impl)}kingSquare(t){let r=(0,Z.colorFromString)(t);if(r<0)throw new J.IllegalArgument("Position.kingSquare()");(0,$r.refreshLegalFlagAndKingSquares)(this._impl);let n=this._impl.king[r];return n<0?!1:(0,Z.squareToString)(n)}isCheck(){return(0,et.isCheck)(this._impl)}isCheckmate(){return(0,et.isCheckmate)(this._impl)}isStalemate(){return(0,et.isStalemate)(this._impl)}hasMove(){return(0,et.hasMove)(this._impl)}moves(){return(0,et.moves)(this._impl)}isMoveLegal(t,r){let n=(0,Z.squareFromString)(t),i=(0,Z.squareFromString)(r);if(n<0||i<0)throw new J.IllegalArgument("Position.isMoveLegal()");let s=(0,et.isMoveLegal)(this._impl,n,i);if(!s)return!1;switch(s.type){case"promotion":{let a=o=>{let u=(0,Z.pieceFromString)(o);if(u>=0){let l=s.moveDescriptorFactory(u);if(l)return l}throw new J.IllegalArgument("Position.isMoveLegal()")};return a.status="promotion",a}case"regular":{let a=()=>s.moveDescriptor;return a.status="regular",a}}}play(t){if(typeof t=="string")try{return(0,et.play)(this._impl,(0,Ft.parseNotation)(this._impl,t,!1,"standard")),!0}catch(r){if(r instanceof J.InvalidNotation)return!1;throw r}else{if(t instanceof qr.MoveDescriptorImpl)return(0,et.play)(this._impl,t),!0;throw new J.IllegalArgument("Position.play()")}}isNullMoveLegal(){return(0,et.isNullMoveLegal)(this._impl)}playNullMove(){return(0,et.playNullMove)(this._impl)}notation(t,r){if(arguments.length===1&&t instanceof qr.MoveDescriptorImpl)return(0,Ft.getNotation)(this._impl,t,"standard");if(arguments.length===1&&typeof t=="string")return(0,Ft.parseNotation)(this._impl,t,!1,"standard");if(arguments.length>=2&&typeof t=="string"&&typeof r=="boolean")return(0,Ft.parseNotation)(this._impl,t,r,"standard");throw new J.IllegalArgument("Position.notation()")}figurineNotation(t,r){if(arguments.length===1&&t instanceof qr.MoveDescriptorImpl)return(0,Ft.getNotation)(this._impl,t,"figurine");if(arguments.length===1&&typeof t=="string")return(0,Ft.parseNotation)(this._impl,t,!1,"figurine");if(arguments.length>=2&&typeof t=="string"&&typeof r=="boolean")return(0,Ft.parseNotation)(this._impl,t,r,"figurine");throw new J.IllegalArgument("Position.figurineNotation()")}uci(t,r){if(arguments.length===1&&t instanceof qr.MoveDescriptorImpl)return(0,Nn.getUCINotation)(this._impl,t,!1);if(arguments.length>=2&&t instanceof qr.MoveDescriptorImpl&&typeof r=="boolean")return(0,Nn.getUCINotation)(this._impl,t,r);if(arguments.length===1&&typeof t=="string")return(0,Nn.parseUCINotation)(this._impl,t,!1);if(arguments.length>=2&&typeof t=="string"&&typeof r=="boolean")return(0,Nn.parseUCINotation)(this._impl,t,r);throw new J.IllegalArgument("Position.uci()")}};Pn.Position=Dt;function uu(e){return Number.isInteger(e)&&e>=0&&e<960}function Mg(e,t){return function(r,n,i){if(e[r]===void 0)return n;{let s=e[r];if(!i(s))throw new J.IllegalArgument(t);return s}}}});var Gr=v(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.Variation=bt.Node=bt.AbstractNode=void 0;var Vr=class{constructor(){}};bt.AbstractNode=Vr;var ji=class extends Vr{constructor(){super()}isVariation(){return!1}toString(){return`${this.id()}[${this.notation()}]`}};bt.Node=ji;var Wi=class extends Vr{constructor(){super()}isVariation(){return!0}toString(){return this.id()}};bt.Variation=Wi});var Tn=v(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.trimAndCollapseSpaces=void 0;function Lg(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}Cn.trimAndCollapseSpaces=Lg});var mu=v(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.MoveTreeRoot=void 0;var Ce=be(),Fg=ot(),fu=Gr(),ut=ur(),At=class{constructor(){this._position=new ut.Position,this._fullMoveNumber=1,this._mainVariationData=xn(this,!0)}clearTree(){this._mainVariationData=xn(this,!0)}mainVariation(){return new qt(this._mainVariationData,this._position)}findById(t){let r=t.split("-");if(r.length%2!==1)return;let n=new ut.Position(this._position),i=this._mainVariationData;for(let a=0;a+1<r.length;a+=2){let o=lu(i,r[a],n);if(o===void 0)return;let u=/^v(\d+)$/.exec(r[a+1]);if(!u)return;let l=parseInt(u[1]);if(l>=o.variations.length)return;i=o.variations[l]}let s=r[r.length-1];if(s==="start")return new qt(i,n);{let a=lu(i,s,n);return a===void 0?void 0:new Ye(a,n)}}};On.MoveTreeRoot=At;function lu(e,t,r){let n=e.child;for(;n!==void 0;){if(t===n.fullMoveNumber+n.moveColor)return n;$t(r,n),n=n.child}}function hu(e,t,r,n){return{parentVariation:e,child:void 0,variations:[],moveColor:t,fullMoveNumber:r,moveDescriptor:n,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function xn(e,t){return{parent:e,child:void 0,isLongVariation:t,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function du(e,t){if(t==="--"){if(!e.isNullMoveLegal())throw new Ce.InvalidNotation(e.fen(),"--",Fg.i18n.ILLEGAL_NULL_MOVE);return null}else return e.notation(t)}function $t(e,t){t.moveDescriptor===null?e.playNullMove():e.play(t.moveDescriptor)}function Ki(e){if(e.parent instanceof At)return new ut.Position(e.parent._position);{let t=e.parent.parentVariation.child,r=Ki(e.parent.parentVariation);for(;t!==e.parent;)$t(r,t),t=t.child;return r}}function gu(e){return _u(e.parentVariation)+e.fullMoveNumber+e.moveColor}function _u(e){if(e.parent instanceof At)return"";{let t=gu(e.parent),r=e.parent.variations.indexOf(e);return`${t}-v${r}-`}}function Yi(e){for(;;){if(!e.isLongVariation)return!1;if(e.parent instanceof At)return!0;e=e.parent.parentVariation}}function Rn(e,t){return Number.isInteger(e)&&e>=0&&e<t.variations.length}function lr(e){return Number.isInteger(e)&&e>=0}function pu(e){return typeof e=="string"&&/^\w+$/.test(e)}var Ye=class extends fu.Node{constructor(t,r){super(),this._data=t,this._positionBefore=r}id(){return gu(this._data)}nags(){let t=[];for(let r of this._data.nags)t.push(r);return t.sort((r,n)=>r-n)}hasNag(t){if(!lr(t))throw new Ce.IllegalArgument("Node.hasNag()");return this._data.nags.has(t)}addNag(t){if(!lr(t))throw new Ce.IllegalArgument("Node.addNag()");return this._data.nags.add(t)}removeNag(t){if(!lr(t))throw new Ce.IllegalArgument("Node.removeNag()");return this._data.nags.delete(t)}tags(){let t=[];for(let r of this._data.tags.keys())t.push(r);return t.sort()}tag(t,r){if(!pu(t))throw new Ce.IllegalArgument("Node.tag()");if(arguments.length===1)return this._data.tags.get(t);if(arguments.length>=2)r==null?this._data.tags.delete(t):this._data.tags.set(t,String(r));else throw new Ce.IllegalArgument("Node.tag()")}comment(t,r){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=Boolean(r))}isLongComment(){return this._data.isLongComment&&Yi(this._data.parentVariation)}parentVariation(){let t=Ki(this._data.parentVariation);return new qt(this._data.parentVariation,t)}previous(){let t=this._data.parentVariation.child;if(t===this._data)return;let r=Ki(this._data.parentVariation);for(;t.child!==this._data;)$t(r,t),t=t.child;return new Ye(t,r)}next(){if(this._data.child===void 0)return;let t=new ut.Position(this._positionBefore);return $t(t,this._data),new Ye(this._data.child,t)}notation(){return this._data.moveDescriptor===null?"--":this._positionBefore.notation(this._data.moveDescriptor)}figurineNotation(){return this._data.moveDescriptor===null?"--":this._positionBefore.figurineNotation(this._data.moveDescriptor)}positionBefore(){return new ut.Position(this._positionBefore)}position(){let t=new ut.Position(this._positionBefore);return $t(t,this._data),t}fullMoveNumber(){return this._data.fullMoveNumber}moveColor(){return this._data.moveColor}variations(){return this._data.variations.map(t=>new qt(t,this._positionBefore))}play(t){let r=new ut.Position(this._positionBefore);$t(r,this._data);let n=r.turn(),i=n==="w"?this._data.fullMoveNumber+1:this._data.fullMoveNumber;return this._data.child=hu(this._data.parentVariation,n,i,du(r,t)),new Ye(this._data.child,r)}removeFollowingMoves(){this._data.child=void 0}addVariation(t){let r=xn(this._data,t===void 0?!1:t);return this._data.variations.push(r),new qt(r,this._positionBefore)}removeVariation(t){if(!Rn(t,this._data))throw new Ce.IllegalArgument("Node.removeVariation()");this._data.variations=this._data.variations.slice(0,t).concat(this._data.variations.slice(t+1))}swapVariations(t,r){if(!Rn(t,this._data)||!Rn(r,this._data))throw new Ce.IllegalArgument("Node.swapVariations()");let n=this._data.variations[t];this._data.variations[t]=this._data.variations[r],this._data.variations[r]=n}promoteVariation(t){if(!Rn(t,this._data)||this._data.variations[t].child===void 0)throw new Ce.IllegalArgument("Node.promoteVariation()");let r=this._data,n=this._data.variations[t].child,i=r.variations;r.variations=[],i[t]=xn(n,!1),i[t].child=r,this._data=n,n.variations=i.concat(n.variations),Dg(r).child=n,cu(n,r.parentVariation),cu(r,i[t]);for(let s of n.variations)s.parent=n}};function Dg(e){let t=e.parentVariation;for(;t.child!==e;)t=t.child;return t}function cu(e,t){let r=e;for(;r!==void 0;)r.parentVariation=t,r=r.child}var qt=class extends fu.Variation{constructor(t,r){super(),this._data=t,this._initialPosition=r}id(){return _u(this._data)+"start"}nags(){let t=[];for(let r of this._data.nags)t.push(r);return t.sort((r,n)=>r-n)}hasNag(t){if(!lr(t))throw new Ce.IllegalArgument("Variation.hasNag()");return this._data.nags.has(t)}addNag(t){if(!lr(t))throw new Ce.IllegalArgument("Variation.addNag()");return this._data.nags.add(t)}removeNag(t){if(!lr(t))throw new Ce.IllegalArgument("Variation.removeNag()");return this._data.nags.delete(t)}tags(){let t=[];for(let r of this._data.tags.keys())t.push(r);return t.sort()}tag(t,r){if(!pu(t))throw new Ce.IllegalArgument("Variation.tag()");if(arguments.length===1)return this._data.tags.get(t);if(arguments.length>=2)r==null?this._data.tags.delete(t):this._data.tags.set(t,String(r));else throw new Ce.IllegalArgument("Variation.tag()")}comment(t,r){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=Boolean(r))}isLongComment(){return this._data.isLongComment&&Yi(this._data)}parentNode(){return this._data.parent instanceof At?void 0:new Ye(this._data.parent,this._initialPosition)}first(){return this._data.child===void 0?void 0:new Ye(this._data.child,this._initialPosition)}nodes(){let t=[],r=this._data.child,n,i=this._initialPosition;for(;r!==void 0;)i=new ut.Position(i),n!==void 0&&$t(i,n),t.push(new Ye(r,i)),n=r,r=r.child;return t}isLongVariation(){return Yi(this._data)}initialPosition(){return new ut.Position(this._initialPosition)}initialFullMoveNumber(){return this._data.parent instanceof At?this._data.parent._fullMoveNumber:this._data.parent.fullMoveNumber}play(t){let r=this._initialPosition.turn(),n=this.initialFullMoveNumber();return this._data.child=hu(this._data,r,n,du(this._initialPosition,t)),new Ye(this._data.child,this._initialPosition)}clearMoves(){this._data.child=void 0}}});var Mn=v(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.Game=void 0;var cr=_n(),lt=be(),Su=Lr(),Br=ur(),bu=Tn(),$g=mu(),fr=_t(),Xi=class{constructor(){this._playerName=[void 0,void 0],this._playerElo=[void 0,void 0],this._playerTitle=[void 0,void 0],this._result=3,this._moveTreeRoot=new $g.MoveTreeRoot}playerName(t,r){let n=(0,fr.colorFromString)(t);if(n<0)throw new lt.IllegalArgument("Game.playerName()");if(arguments.length===1)return this._playerName[n];this._playerName[n]=hr(r)}playerElo(t,r){let n=(0,fr.colorFromString)(t);if(n<0)throw new lt.IllegalArgument("Game.playerElo()");if(arguments.length===1)return this._playerElo[n];if(r=qg(r),r===void 0||Number.isInteger(r)&&r>=0)this._playerElo[n]=r;else throw new lt.IllegalArgument("Game.playerElo()")}playerTitle(t,r){let n=(0,fr.colorFromString)(t);if(n<0)throw new lt.IllegalArgument("Game.playerTitle()");if(arguments.length===1)return this._playerTitle[n];this._playerTitle[n]=hr(r)}event(t){if(arguments.length===0)return this._event;this._event=hr(t)}round(t){if(arguments.length===0)return this._round;this._round=hr(t)}date(t,r,n){switch(arguments.length){case 0:return this._date;case 1:if(t==null)this._date=void 0;else if(t instanceof cr.DateValue)this._date=t;else if(t instanceof Date)this._date=new cr.DateValue(t);else if(cr.DateValue.isValid(t))this._date=new cr.DateValue(t);else throw new lt.IllegalArgument("Game.date()");break;default:if(cr.DateValue.isValid(t,r,n))this._date=new cr.DateValue(t,r,n);else throw new lt.IllegalArgument("Game.date()");break}}dateAsDate(){return this._date===void 0?void 0:this._date.toDate()}dateAsString(t){return this._date===void 0?void 0:this._date.toHumanReadableString(t)}site(t){if(arguments.length===0)return this._site;this._site=hr(t)}annotator(t){if(arguments.length===0)return this._annotator;this._annotator=hr(t)}result(t){if(arguments.length===0)return(0,fr.resultToString)(this._result);{let r=(0,fr.resultFromString)(t);if(r<0)throw new lt.IllegalArgument("Game.result()");this._result=r}}variant(){return this._moveTreeRoot._position.variant()}initialPosition(t,r){if(arguments.length===0)return new Br.Position(this._moveTreeRoot._position);if(!(t instanceof Br.Position))throw new lt.IllegalArgument("Game.initialPosition()");if(arguments.length>=2){if(!Number.isInteger(r))throw new lt.IllegalArgument("Game.initialPosition()");this._moveTreeRoot._fullMoveNumber=r}else this._moveTreeRoot._fullMoveNumber=1;this._moveTreeRoot._position=new Br.Position(t),this._moveTreeRoot.clearTree()}mainVariation(){return this._moveTreeRoot.mainVariation()}nodes(t=!1){if(!t)return this.mainVariation().nodes();let r=[];function n(i){for(let s of i.nodes()){for(let a of s.variations())n(a);r.push(s)}}return n(this.mainVariation()),r}findById(t){return this._moveTreeRoot.findById(t)}ascii(){let t=[];function r(o){o!==void 0&&t.push(o)}r(Vg(this._event,this._round)),r(vu("Site",this._site)),r(Gg(this.dateAsString("en-us"))),r(yu("White",this._playerName[0],this._playerElo[0],this._playerTitle[0])),r(yu("Black",this._playerName[1],this._playerElo[1],this._playerTitle[1])),r(vu("Annotator",this._annotator));let n=this._moveTreeRoot._position.variant();n!=="regular"&&t.push("Variant: "+n),(!(0,Su.variantWithCanonicalStartPosition)(n)||!Br.Position.isEqual(this._moveTreeRoot._position,new Br.Position(n)))&&t.push(this._moveTreeRoot._position.ascii());function i(o){return o.first()!==void 0||o.nags().length>0||o.tags().length>0||o.comment()!==void 0}function s(o,u,l){let f=u+o.fullMoveNumber()+(o.moveColor()==="w"?".":"...")+o.notation(),g=Eu(o);t.push(g.length===0?f:f+" "+g.join(" "));let h=!1;for(let m of o.variations())i(m)&&(t.push(u+" |"),a(m,u+(l?" |  ":"    "),u+" +- ",!1),h=!0);return h}function a(o,u,l,f){let g=Eu(o);g.length>0&&t.push(l+g.join(" "));let h=o.first(),m=!1,_=!0;for(;h!==void 0;){m&&t.push(u+" |");let b=h.next();m=s(h,_&&g.length===0?l:u,f||b!==void 0),_=!1,h=b}}return a(this._moveTreeRoot.mainVariation(),"","",!1),t.push((0,fr.resultToString)(this._result)),t.join(`
`)}};kn.Game=Xi;function hr(e){return e==null?void 0:String(e)}function qg(e){return e==null?void 0:Number(e)}function Vt(e){return e=(0,bu.trimAndCollapseSpaces)(e),e===""?"<empty>":e}function vu(e,t){return t===void 0?void 0:`${e}: ${Vt(t)}`}function Vg(e,t){if(e===void 0&&t===void 0)return;let r=e===void 0?"Event: <undefined>":`Event: ${Vt(e)}`;return t!==void 0&&(r+=` (${Vt(t)})`),r}function Gg(e){return e===void 0?void 0:"Date: "+e}function yu(e,t,r,n){if(t===void 0&&r===void 0&&n===void 0)return;let i=t===void 0?`${e}: <undefined>`:`${e}: ${Vt(t)}`;return r!==void 0&&n!==void 0?i+=` (${Vt(n)} ${r})`:r!==void 0?i+=` (${r})`:n!==void 0&&(i+=` (${Vt(n)})`),i}function Eu(e){let t=[];for(let n of e.nags())t.push((0,Su.nagSymbol)(n));for(let n of e.tags())t.push(`${n}={${(0,bu.trimAndCollapseSpaces)(e.tag(n))}}`);let r=e.comment();return r!==void 0&&t.push(Vt(r)),t}});var Ln=v(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.Database=dr.isValidGameIndex=void 0;var Bg=be();function Au(e){return Number.isInteger(e)&&e>=0}dr.isValidGameIndex=Au;var Qi=class{constructor(){}gameCount(){return this.doGameCount()}game(t){if(!Au(t))throw new Bg.IllegalArgument("Database.game()");return this.doGame(t)}};dr.Database=Qi});var wu=v(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.TokenStream=void 0;var zi=be(),Zi=ot(),Ji=Tn();function ge(e,t){let r=e;return r.needIncrementLineIndex=t!==void 0&&t,r.matchedIndex=-1,r.matched=null,r}var Hg=5,Ug=11,ce=new Map;ce.set("!!",3);ce.set("!",1);ce.set("!?",5);ce.set("?!",6);ce.set("?",2);ce.set("??",4);ce.set("+-",18);ce.set("+/-",16);ce.set("+/=",14);ce.set("+=",14);ce.set("=",10);ce.set("~",13);ce.set("inf",13);ce.set("=/+",15);ce.set("=+",15);ce.set("-/+",17);ce.set("-+",19);ce.set("RR",145);ce.set("N",146);var es=class{constructor(t,r){this._pos=0,this._lineIndex=1,this._token=0,this._tokenValue=null,this._tokenCharacterIndex=-1,this._tokenLineIndex=-1,this._emptyLineBeforeToken=!1,this._emptyLineAfterToken=!1,this._matchSpaces=ge(/[ \f\t\v]+/g),this._matchLineBreak=ge(/\r?\n|\r/g,!0),this._matchFastAdvance=ge(/[^ \f\t\v\r\n"{][^ \f\t\v\r\n"{10*]*/g),this._matchBeginHeader=ge(/\[/g),this._matchEndHeader=ge(/\]/g),this._matchHeaderId=ge(/(\w+)/g),this._matchEnterHeaderValue=ge(/"/g),this._matchMoveNumber=ge(/[0-9]+\.(?:\.\.)?/g),this._matchMove=ge(/(?:O-O(?:-O)?|0-0(?:-0)?|[KQRBN][a-h]?[1-8]?x?[a-h][1-8]|(?:[a-h]x?)?[a-h][1-8](?:=?[KQRBNP])?)[+#]?|--/g),this._matchNag=ge(/([!?][!?]?|\+\/?[-=]|[-=]\/?\+|=|inf|~|RR|N)|\$([1-9][0-9]*)/g),this._matchEnterComment=ge(/\{/g),this._matchBeginVariation=ge(/\(/g),this._matchEndVariation=ge(/\)/g),this._matchEndOfGame=ge(/1-0|0-1|1\/2-1\/2|\*/g),this._headerValueMode=ge(/((?:[^\\"\f\t\v\r\n]|\\[^\f\t\v\r\n])*)"/g),this._headerValueDegradedMode=ge(/[^\r\n]*/g),this._commentMode=ge(/((?:[^\\}]|\\(?:.|[\r\n]))*)\}/g,!0),t.codePointAt(0)===65279&&(t=t.substring(1)),this._text=t,r!==void 0&&(this._pos=r.pos,this._lineIndex=r.lineIndex)}text(){return this._text}currentLocation(){return{pos:this._pos,lineIndex:this._lineIndex}}emptyLineBeforeToken(){return this._emptyLineBeforeToken}emptyLineAfterToken(){return this._emptyLineAfterToken}token(){return this._token}tokenValue(){return this._tokenValue}tokenCharacterIndex(){return this._tokenCharacterIndex}tokenLineIndex(){return this._tokenLineIndex}isMoveTextSection(){return this._token>=Hg&&this._token<=Ug}consumeToken(){if(this._emptyLineBeforeToken=this._token===0||this._token===11?this.skipBlanks():this._emptyLineAfterToken,this._pos>=this._text.length)return this._tokenCharacterIndex=this._text.length,this._tokenLineIndex=this._lineIndex,!1;if(this._tokenCharacterIndex=this._pos,this._tokenLineIndex=this._lineIndex,this.testAtPos(this._matchMoveNumber))this._token=5,this._tokenValue=null;else if(this.testAtPos(this._matchMove))this._token=6,this._tokenValue=this._matchMove.matched[0];else if(this.testAtPos(this._matchNag))this._token=7,this._tokenValue=this._matchNag.matched[2]===void 0?ce.get(this._matchNag.matched[1]):parseInt(this._matchNag.matched[2],10);else if(this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))throw new zi.InvalidPGN(this._text,this._pos,this._lineIndex,Zi.i18n.INVALID_PGN_TOKEN);this._token=8,this._tokenValue=Wg(this._commentMode.matched[1])}else if(this.testAtPos(this._matchBeginVariation))this._token=9,this._tokenValue=null;else if(this.testAtPos(this._matchEndVariation))this._token=10,this._tokenValue=null;else if(this.testAtPos(this._matchEndOfGame))this._token=11,this._tokenValue=this._matchEndOfGame.matched[0];else if(this.testAtPos(this._matchBeginHeader))this._token=1,this._tokenValue=null;else if(this.testAtPos(this._matchEndHeader))this._token=2,this._tokenValue=null;else if(this.testAtPos(this._matchHeaderId))this._token=3,this._tokenValue=this._matchHeaderId.matched[1];else if(this.testAtPos(this._matchEnterHeaderValue)){if(!this.testAtPos(this._headerValueMode))throw new zi.InvalidPGN(this._text,this._pos,this._lineIndex,Zi.i18n.INVALID_PGN_TOKEN);this._token=4,this._tokenValue=jg(this._headerValueMode.matched[1])}else throw new zi.InvalidPGN(this._text,this._pos,this._lineIndex,Zi.i18n.INVALID_PGN_TOKEN);return this._emptyLineAfterToken=this._token===11?!1:this.skipBlanks(),!0}skipGame(){let t=!1;for(this._token=0;;){if(this.skipBlanks(),this._pos>=this._text.length)return t;if(t=!0,this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))return this._pos=this._text.length,!0}else if(this.testAtPos(this._matchEnterHeaderValue))this.testAtPos(this._headerValueMode)||this.testAtPos(this._headerValueDegradedMode);else{if(this.testAtPos(this._matchEndOfGame))return!0;this.testAtPos(this._matchFastAdvance)}}}skipBlanks(){let t=0;for(;this._pos<this._text.length;)if(!this.testAtPos(this._matchSpaces))if(this.testAtPos(this._matchLineBreak))++t;else break;return t>=2}testAtPos(t){if(t.matchedIndex<this._pos&&(t.lastIndex=this._pos,t.matched=t.exec(this._text),t.matchedIndex=t.matched===null?this._text.length:t.matched.index),t.matchedIndex===this._pos){if(this._pos=t.lastIndex,t.needIncrementLineIndex){let r=/\r?\n|\r/g;for(;r.exec(t.matched[0]);)++this._lineIndex}return!0}else return!1}};Fn.TokenStream=es;function jg(e){return(0,Ji.trimAndCollapseSpaces)(e.replace(/\\([\\"])/g,"$1"))}function Wg(e){e=e.replace(/\\([\\}])/g,"$1");let t=new Map,r=e.replace(/\[%(\w+)\s([^[\]]*)\]/g,(n,i,s)=>(s=(0,Ji.trimAndCollapseSpaces)(s),s!==""&&t.set(i,s)," "));return r=(0,Ji.trimAndCollapseSpaces)(r),r===""&&(r=void 0),{comment:r,tags:t}}});var Cu=v(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.readOneGame=gr.readDatabase=void 0;var Kg=Ln(),qe=_n(),_e=be(),Yg=Mn(),Xg=Lr(),Ie=ot(),Iu=Gr(),ts=ur(),rs=wu();function Hr(e){return e==="?"?void 0:e}function Nu(e){if(/^\d+$/.test(e)){let t=Number(e);if(Number.isInteger(t))return t}}function Qg(e){if(/^([0-9]{4})\.([0-9]{2})\.([0-9]{2})$/.test(e)){let t=RegExp.$1,r=RegExp.$2,n=RegExp.$3,i=parseInt(t,10),s=parseInt(r,10),a=parseInt(n,10);return qe.DateValue.isValid(i,s,a)?new qe.DateValue(i,s,a):qe.DateValue.isValid(i,s)?new qe.DateValue(i,s):qe.DateValue.isValid(i)?new qe.DateValue(i):void 0}else if(/^([0-9]{4})\.([0-9]{2})\.\?\?$/.test(e)){let t=RegExp.$1,r=RegExp.$2,n=parseInt(t,10),i=parseInt(r,10);return qe.DateValue.isValid(n,i)?new qe.DateValue(n,i):qe.DateValue.isValid(n)?new qe.DateValue(n):void 0}else if(/^([0-9]{4})(?:\.\?\?\.\?\?)?$/.test(e)){let t=parseInt(RegExp.$1,10);return qe.DateValue.isValid(t)?new qe.DateValue(t):void 0}else return}function zg(e){return e=e.toLowerCase(),e==="regular"||e==="standard"?"regular":e==="fischerandom"||/^chess[ -]?960$/.test(e)?"chess960":/^no[ -]king$/.test(e)?"no-king":/^white[ -]king[ -]only$/.test(e)?"white-king-only":/^black[ -]king[ -]only$/.test(e)?"black-king-only":/^anti[ -]?chess/.test(e)?"antichess":e==="horde"?"horde":void 0}function Zg(e,t,r,n,i,s,a){switch(i=i.trim(),n){case"White":t.playerName("w",Hr(i));break;case"Black":t.playerName("b",Hr(i));break;case"WhiteElo":t.playerElo("w",Nu(i));break;case"BlackElo":t.playerElo("b",Nu(i));break;case"WhiteTitle":t.playerTitle("w",i);break;case"BlackTitle":t.playerTitle("b",i);break;case"Event":t.event(Hr(i));break;case"Round":t.round(Hr(i));break;case"Date":t.date(Qg(i));break;case"Site":t.site(Hr(i));break;case"Annotator":t.annotator(i);break;case"FEN":r.fen=i,r.fenTokenCharacterIndex=s,r.fenTokenLineIndex=a;break;case"Variant":if(r.variant=zg(i),r.variant===void 0)throw new _e.InvalidPGN(e.text(),s,a,Ie.i18n.UNKNOWN_VARIANT,i);r.variantTokenCharacterIndex=s,r.variantTokenLineIndex=a;break}}function Jg(e,t,r){if(r.fen!==void 0)try{let n=r.variant===void 0?new ts.Position:new ts.Position(r.variant,"empty"),i=n.fen(r.fen);t.initialPosition(n,i.fullMoveNumber)}catch(n){throw n instanceof _e.InvalidFEN?new _e.InvalidPGN(e.text(),r.fenTokenCharacterIndex,r.fenTokenLineIndex,Ie.i18n.INVALID_FEN_IN_PGN_TEXT,n.message):n}else if(r.variant!==void 0)if((0,Xg.variantWithCanonicalStartPosition)(r.variant)){let n=new ts.Position(r.variant,"start");t.initialPosition(n,1)}else throw new _e.InvalidPGN(e.text(),r.variantTokenCharacterIndex,r.variantTokenLineIndex,Ie.i18n.VARIANT_WITHOUT_FEN,r.variant)}function Pu(e){let t=null,r=null,n=[],i={};for(;e.consumeToken();)switch(t===null&&(t=new Yg.Game),e.isMoveTextSection()&&r===null&&(Jg(e,t,i),r=t.mainVariation()),e.token()){case 1:{if(r!==null)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.UNEXPECTED_PGN_HEADER);if(!e.consumeToken()||e.token()!==3)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.MISSING_PGN_HEADER_ID);let s=e.tokenValue();if(!e.consumeToken()||e.token()!==4)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.MISSING_PGN_HEADER_VALUE);let a=e.tokenValue(),o=e.tokenCharacterIndex(),u=e.tokenLineIndex();if(!e.consumeToken()||e.token()!==2)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.MISSING_END_OF_PGN_HEADER);Zg(e,t,i,s,a,o,u);break}case 5:break;case 6:try{r=r.play(e.tokenValue())}catch(s){throw s instanceof _e.InvalidNotation?new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.INVALID_MOVE_IN_PGN_TEXT,s.notation,s.message):s}break;case 7:r.addNag(e.tokenValue());break;case 8:{let s=e.tokenValue();for(let[a,o]of s.tags)r.tag(a,o);if(s.comment!==void 0){let a=r instanceof Iu.Variation?e.emptyLineAfterToken():e.emptyLineBeforeToken();r.comment(s.comment,a)}break}case 9:if(r instanceof Iu.Variation)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.UNEXPECTED_BEGIN_OF_VARIATION);n.push(r),r=r.addVariation(e.emptyLineBeforeToken());break;case 10:if(n.length===0)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.UNEXPECTED_END_OF_VARIATION);r=n.pop();break;case 11:if(n.length!==0)throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.UNEXPECTED_END_OF_GAME);return t.result(e.tokenValue()),t;default:throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.INVALID_PGN_TOKEN)}throw new _e.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ie.i18n.UNEXPECTED_END_OF_TEXT)}var ns=class extends Kg.Database{constructor(t){for(super(),this._currentGameIndex=-1,this._text=t,this._gameLocations=[],this._stream=new rs.TokenStream(t);;){let r=this._stream.currentLocation();if(!this._stream.skipGame())break;this._gameLocations.push(r)}}doGameCount(){return this._gameLocations.length}doGame(t){if(t>=this._gameLocations.length)throw new _e.InvalidPGN(this._text,-1,-1,Ie.i18n.INVALID_GAME_INDEX,t,this._gameLocations.length);this._currentGameIndex!==t&&(this._stream=new rs.TokenStream(this._text,this._gameLocations[t])),this._currentGameIndex=-1;let r=Pu(this._stream);return this._currentGameIndex=t+1,r}};function e_(e){return new ns(e)}gr.readDatabase=e_;function t_(e,t){let r=new rs.TokenStream(e),n=0;for(;n!==t;)if(r.skipGame())++n;else throw new _e.InvalidPGN(e,-1,-1,Ie.i18n.INVALID_GAME_INDEX,t,n);return Pu(r)}gr.readOneGame=t_});var Fu=v(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.writeGames=_r.writeGame=void 0;var r_=Lr(),n_=Gr(),Tu=ur(),$n=Tn();function Ou(e){return e.replace(/([\\"])/g,"\\$1")}function Ru(e){return e.replace(/([\\}])/g,"\\$1")}function Ur(e){return e!==void 0&&(e=(0,$n.trimAndCollapseSpaces)(e)),e?Ou(e):"?"}function i_(e){return e===void 0?"????.??.??":e.toPGNString()}function s_(e){switch(e){case"regular":return;case"chess960":return"Fischerandom";case"antichess":return"Antichess";case"horde":return"Horde";default:return e}}function Dn(e,t){return t!==void 0&&(t=(0,$n.trimAndCollapseSpaces)(t)),t?`[${e} "${Ou(t)}"]
`:""}function xu(e,t){return t===void 0?"":`[${e} "${t}"]
`}function ku(e,t,r,n){for(let u of e.nags())r("$"+u,!1,!1);let i=e.comment();i!==void 0&&(i=(0,$n.trimAndCollapseSpaces)(i));let s=e.tags(),a=new Map,o=!1;for(let u of s){let l=(0,$n.trimAndCollapseSpaces)(e.tag(u).replace(/[[\]]/g,""));l&&(a.set(u,l),o=!0)}if(o||i){i&&e.isLongComment()&&e instanceof n_.Node&&n(),r("{",!1,!0);for(let u of s){let l=a.get(u);if(l){r("[%"+u,!1,!1);for(let f of Ru(l+"]").split(" "))r(f,!1,!1)}}if(i)for(let u of Ru(i).split(" "))r(u,!1,!1);return r("}",!0,!1),i&&e.isLongComment()&&t&&n(),!0}else return!1}function a_(e,t,r,n,i){e.moveColor()==="w"?n(e.fullMoveNumber()+".",!1,!1):t&&n(e.fullMoveNumber()+"...",!1,!1),n(e.notation(),!1,!1);let s=e.variations(),a=-1;for(let u=s.length-1;u>=0;--u)if(s[u].first()!==void 0){a=u;break}let o=ku(e,(r||e.next()!==void 0)&&a<0,n,i);for(let u=0;u<s.length;++u){let l=s[u];l.first()!==void 0&&(l.isLongVariation()&&i(),n("(",!1,!0),Mu(l,!1,n,i),n(")",!0,!1),u===a&&l.isLongVariation()&&i(),o=!0)}return o}function Mu(e,t,r,n){ku(e,!0,r,n);let i=e.first(),s=!0;for(;i!==void 0;)s=a_(i,s,t,r,n),i=i.next()}function Lu(e){let t="";t+='[Event "'+Ur(e.event())+`"]
`,t+='[Site "'+Ur(e.site())+`"]
`,t+='[Date "'+i_(e.date())+`"]
`,t+='[Round "'+Ur(e.round())+`"]
`,t+='[White "'+Ur(e.playerName("w"))+`"]
`,t+='[Black "'+Ur(e.playerName("b"))+`"]
`,t+='[Result "'+e.result()+`"]
`;let r=e.variant(),n=e.initialPosition(),i=!(0,r_.variantWithCanonicalStartPosition)(r)||!Tu.Position.isEqual(n,new Tu.Position(r));t+=Dn("Annotator",e.annotator()),t+=xu("BlackElo",e.playerElo("b")),t+=Dn("BlackTitle",e.playerTitle("b")),i&&(t+='[FEN "'+n.fen({fullMoveNumber:e.mainVariation().initialFullMoveNumber(),regularFENIfPossible:!0})+`"]
`,t+=`[SetUp "1"]
`),t+=Dn("Variant",s_(r)),t+=xu("WhiteElo",e.playerElo("w")),t+=Dn("WhiteTitle",e.playerTitle("w")),t+=`
`;let s="",a=!1;function o(l,f,g){s.length===0?s=l:s.length+l.length+(a||f?0:1)<=80?s+=(a||f?"":" ")+l:(t+=s+`
`,s=l),a=g}function u(){t+=s+`
`,t+=`
`,s="",a=!1}return Mu(e.mainVariation(),!0,o,u),o(e.result(),!1,!1),t+=s+`
`,t}_r.writeGame=Lu;function o_(e){return e.map(Lu).join(`

`)}_r.writeGames=o_});var Vu=v(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.pgnWrite=pr.pgnRead=void 0;var u_=Ln(),is=be(),Du=Mn(),$u=Cu(),qu=Fu();function l_(e,t){if(typeof e!="string")throw new is.IllegalArgument("pgnRead()");if(arguments.length===1)return(0,$u.readDatabase)(e);if(!(0,u_.isValidGameIndex)(t))throw new is.IllegalArgument("pgnRead()");return(0,$u.readOneGame)(e,t)}pr.pgnRead=l_;function c_(e){if(e instanceof Du.Game)return(0,qu.writeGame)(e);if(Array.isArray(e)&&e.every(t=>t instanceof Du.Game))return(0,qu.writeGames)(e);throw new is.IllegalArgument("pgnWrite()")}pr.pgnWrite=c_});var Hu=v($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.pgnWrite=$.pgnRead=$.Database=$.Game=$.Variation=$.Node=$.AbstractNode=$.Position=$.isMoveDescriptor=$.MoveDescriptor=$.DateValue=$.nagSymbol=$.variantWithCanonicalStartPosition=$.oppositeColor=$.coordinatesToSquare=$.squareToCoordinates=$.squareColor=$.forEachSquare=$.exception=$.i18n=void 0;var f_=ot();Object.defineProperty($,"i18n",{enumerable:!0,get:function(){return f_.i18n}});$.exception=be();var Gt=Lr();Object.defineProperty($,"forEachSquare",{enumerable:!0,get:function(){return Gt.forEachSquare}});Object.defineProperty($,"squareColor",{enumerable:!0,get:function(){return Gt.squareColor}});Object.defineProperty($,"squareToCoordinates",{enumerable:!0,get:function(){return Gt.squareToCoordinates}});Object.defineProperty($,"coordinatesToSquare",{enumerable:!0,get:function(){return Gt.coordinatesToSquare}});Object.defineProperty($,"oppositeColor",{enumerable:!0,get:function(){return Gt.oppositeColor}});Object.defineProperty($,"variantWithCanonicalStartPosition",{enumerable:!0,get:function(){return Gt.variantWithCanonicalStartPosition}});Object.defineProperty($,"nagSymbol",{enumerable:!0,get:function(){return Gt.nagSymbol}});var h_=_n();Object.defineProperty($,"DateValue",{enumerable:!0,get:function(){return h_.DateValue}});var Gu=Mi();Object.defineProperty($,"MoveDescriptor",{enumerable:!0,get:function(){return Gu.MoveDescriptor}});Object.defineProperty($,"isMoveDescriptor",{enumerable:!0,get:function(){return Gu.isMoveDescriptor}});var d_=ur();Object.defineProperty($,"Position",{enumerable:!0,get:function(){return d_.Position}});var ss=Gr();Object.defineProperty($,"AbstractNode",{enumerable:!0,get:function(){return ss.AbstractNode}});Object.defineProperty($,"Node",{enumerable:!0,get:function(){return ss.Node}});Object.defineProperty($,"Variation",{enumerable:!0,get:function(){return ss.Variation}});var g_=Mn();Object.defineProperty($,"Game",{enumerable:!0,get:function(){return g_.Game}});var __=Ln();Object.defineProperty($,"Database",{enumerable:!0,get:function(){return __.Database}});var Bu=Vu();Object.defineProperty($,"pgnRead",{enumerable:!0,get:function(){return Bu.pgnRead}});Object.defineProperty($,"pgnWrite",{enumerable:!0,get:function(){return Bu.pgnWrite}})});var os=v((kv,Qu)=>{"use strict";var v_=require("stream"),Yu=v_.PassThrough,y_=Array.prototype.slice;Qu.exports=E_;function E_(){let e=[],t=y_.call(arguments),r=!1,n=t[t.length-1];n&&!Array.isArray(n)&&n.pipe==null?t.pop():n={};let i=n.end!==!1,s=n.pipeError===!0;n.objectMode==null&&(n.objectMode=!0),n.highWaterMark==null&&(n.highWaterMark=64*1024);let a=Yu(n);function o(){for(let f=0,g=arguments.length;f<g;f++)e.push(Xu(arguments[f],n));return u(),this}function u(){if(r)return;r=!0;let f=e.shift();if(!f){process.nextTick(l);return}Array.isArray(f)||(f=[f]);let g=f.length+1;function h(){--g>0||(r=!1,u())}function m(_){function b(){_.removeListener("merge2UnpipeEnd",b),_.removeListener("end",b),s&&_.removeListener("error",P),h()}function P(C){a.emit("error",C)}if(_._readableState.endEmitted)return h();_.on("merge2UnpipeEnd",b),_.on("end",b),s&&_.on("error",P),_.pipe(a,{end:!1}),_.resume()}for(let _=0;_<f.length;_++)m(f[_]);h()}function l(){r=!1,a.emit("queueDrain"),i&&a.end()}return a.setMaxListeners(0),a.add=o,a.on("unpipe",function(f){f.emit("merge2UnpipeEnd")}),t.length&&o.apply(null,t),a}function Xu(e,t){if(Array.isArray(e))for(let r=0,n=e.length;r<n;r++)e[r]=Xu(e[r],t);else{if(!e._readableState&&e.pipe&&(e=e.pipe(Yu(t))),!e._readableState||!e.pause||!e.pipe)throw new Error("Only readable stream can be merged.");e.pause()}return e}});var zu=v(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.splitWhen=mr.flatten=void 0;function S_(e){return e.reduce((t,r)=>[].concat(t,r),[])}mr.flatten=S_;function b_(e,t){let r=[[]],n=0;for(let i of e)t(i)?(n++,r[n]=[]):r[n].push(i);return r}mr.splitWhen=b_});var Zu=v(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.isEnoentCodeError=void 0;function A_(e){return e.code==="ENOENT"}Vn.isEnoentCodeError=A_});var Ju=v(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.createDirentFromStats=void 0;var us=class{constructor(t,r){this.name=t,this.isBlockDevice=r.isBlockDevice.bind(r),this.isCharacterDevice=r.isCharacterDevice.bind(r),this.isDirectory=r.isDirectory.bind(r),this.isFIFO=r.isFIFO.bind(r),this.isFile=r.isFile.bind(r),this.isSocket=r.isSocket.bind(r),this.isSymbolicLink=r.isSymbolicLink.bind(r)}};function w_(e,t){return new us(e,t)}Gn.createDirentFromStats=w_});var el=v(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.removeLeadingDotSegment=tt.escape=tt.makeAbsolute=tt.unixify=void 0;var I_=require("path"),N_=2,P_=/(\\?)([()*?[\]{|}]|^!|[!+@](?=\())/g;function C_(e){return e.replace(/\\/g,"/")}tt.unixify=C_;function T_(e,t){return I_.resolve(e,t)}tt.makeAbsolute=T_;function R_(e){return e.replace(P_,"\\$2")}tt.escape=R_;function x_(e){if(e.charAt(0)==="."){let t=e.charAt(1);if(t==="/"||t==="\\")return e.slice(N_)}return e}tt.removeLeadingDotSegment=x_});var rl=v(($v,tl)=>{tl.exports=function(t){if(typeof t!="string"||t==="")return!1;for(var r;r=/(\\).|([@?!+*]\(.*\))/g.exec(t);){if(r[2])return!0;t=t.slice(r.index+r[0].length)}return!1}});var sl=v((qv,il)=>{var O_=rl(),nl={"{":"}","(":")","[":"]"},k_=function(e){if(e[0]==="!")return!0;for(var t=0,r=-2,n=-2,i=-2,s=-2,a=-2;t<e.length;){if(e[t]==="*"||e[t+1]==="?"&&/[\].+)]/.test(e[t])||n!==-1&&e[t]==="["&&e[t+1]!=="]"&&(n<t&&(n=e.indexOf("]",t)),n>t&&(a===-1||a>n||(a=e.indexOf("\\",t),a===-1||a>n)))||i!==-1&&e[t]==="{"&&e[t+1]!=="}"&&(i=e.indexOf("}",t),i>t&&(a=e.indexOf("\\",t),a===-1||a>i))||s!==-1&&e[t]==="("&&e[t+1]==="?"&&/[:!=]/.test(e[t+2])&&e[t+3]!==")"&&(s=e.indexOf(")",t),s>t&&(a=e.indexOf("\\",t),a===-1||a>s))||r!==-1&&e[t]==="("&&e[t+1]!=="|"&&(r<t&&(r=e.indexOf("|",t)),r!==-1&&e[r+1]!==")"&&(s=e.indexOf(")",r),s>r&&(a=e.indexOf("\\",r),a===-1||a>s))))return!0;if(e[t]==="\\"){var o=e[t+1];t+=2;var u=nl[o];if(u){var l=e.indexOf(u,t);l!==-1&&(t=l+1)}if(e[t]==="!")return!0}else t++}return!1},M_=function(e){if(e[0]==="!")return!0;for(var t=0;t<e.length;){if(/[*?{}()[\]]/.test(e[t]))return!0;if(e[t]==="\\"){var r=e[t+1];t+=2;var n=nl[r];if(n){var i=e.indexOf(n,t);i!==-1&&(t=i+1)}if(e[t]==="!")return!0}else t++}return!1};il.exports=function(t,r){if(typeof t!="string"||t==="")return!1;if(O_(t))return!0;var n=k_;return r&&r.strict===!1&&(n=M_),n(t)}});var ol=v((Vv,al)=>{"use strict";var L_=sl(),F_=require("path").posix.dirname,D_=require("os").platform()==="win32",ls="/",$_=/\\/g,q_=/[\{\[].*[\}\]]$/,V_=/(^|[^\\])([\{\[]|\([^\)]+$)/,G_=/\\([\!\*\?\|\[\]\(\)\{\}])/g;al.exports=function(t,r){var n=Object.assign({flipBackslashes:!0},r);n.flipBackslashes&&D_&&t.indexOf(ls)<0&&(t=t.replace($_,ls)),q_.test(t)&&(t+=ls),t+="a";do t=F_(t);while(L_(t)||V_.test(t));return t.replace(G_,"$1")}});var Bn=v(Ve=>{"use strict";Ve.isInteger=e=>typeof e=="number"?Number.isInteger(e):typeof e=="string"&&e.trim()!==""?Number.isInteger(Number(e)):!1;Ve.find=(e,t)=>e.nodes.find(r=>r.type===t);Ve.exceedsLimit=(e,t,r=1,n)=>n===!1||!Ve.isInteger(e)||!Ve.isInteger(t)?!1:(Number(t)-Number(e))/Number(r)>=n;Ve.escapeNode=(e,t=0,r)=>{let n=e.nodes[t];!n||(r&&n.type===r||n.type==="open"||n.type==="close")&&n.escaped!==!0&&(n.value="\\"+n.value,n.escaped=!0)};Ve.encloseBrace=e=>e.type!=="brace"?!1:e.commas>>0+e.ranges>>0===0?(e.invalid=!0,!0):!1;Ve.isInvalidBrace=e=>e.type!=="brace"?!1:e.invalid===!0||e.dollar?!0:e.commas>>0+e.ranges>>0===0||e.open!==!0||e.close!==!0?(e.invalid=!0,!0):!1;Ve.isOpenOrClose=e=>e.type==="open"||e.type==="close"?!0:e.open===!0||e.close===!0;Ve.reduce=e=>e.reduce((t,r)=>(r.type==="text"&&t.push(r.value),r.type==="range"&&(r.type="text"),t),[]);Ve.flatten=(...e)=>{let t=[],r=n=>{for(let i=0;i<n.length;i++){let s=n[i];Array.isArray(s)?r(s,t):s!==void 0&&t.push(s)}return t};return r(e),t}});var Hn=v((Bv,ll)=>{"use strict";var ul=Bn();ll.exports=(e,t={})=>{let r=(n,i={})=>{let s=t.escapeInvalid&&ul.isInvalidBrace(i),a=n.invalid===!0&&t.escapeInvalid===!0,o="";if(n.value)return(s||a)&&ul.isOpenOrClose(n)?"\\"+n.value:n.value;if(n.value)return n.value;if(n.nodes)for(let u of n.nodes)o+=r(u);return o};return r(e)}});var fl=v((Hv,cl)=>{"use strict";cl.exports=function(e){return typeof e=="number"?e-e===0:typeof e=="string"&&e.trim()!==""?Number.isFinite?Number.isFinite(+e):isFinite(+e):!1}});var El=v((Uv,yl)=>{"use strict";var hl=fl(),Ht=(e,t,r)=>{if(hl(e)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(t===void 0||e===t)return String(e);if(hl(t)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let n={relaxZeros:!0,...r};typeof n.strictZeros=="boolean"&&(n.relaxZeros=n.strictZeros===!1);let i=String(n.relaxZeros),s=String(n.shorthand),a=String(n.capture),o=String(n.wrap),u=e+":"+t+"="+i+s+a+o;if(Ht.cache.hasOwnProperty(u))return Ht.cache[u].result;let l=Math.min(e,t),f=Math.max(e,t);if(Math.abs(l-f)===1){let b=e+"|"+t;return n.capture?`(${b})`:n.wrap===!1?b:`(?:${b})`}let g=vl(e)||vl(t),h={min:e,max:t,a:l,b:f},m=[],_=[];if(g&&(h.isPadded=g,h.maxLen=String(h.max).length),l<0){let b=f<0?Math.abs(f):1;_=dl(b,Math.abs(l),h,n),l=h.a=0}return f>=0&&(m=dl(l,f,h,n)),h.negatives=_,h.positives=m,h.result=B_(_,m,n),n.capture===!0?h.result=`(${h.result})`:n.wrap!==!1&&m.length+_.length>1&&(h.result=`(?:${h.result})`),Ht.cache[u]=h,h.result};function B_(e,t,r){let n=cs(e,t,"-",!1,r)||[],i=cs(t,e,"",!1,r)||[],s=cs(e,t,"-?",!0,r)||[];return n.concat(s).concat(i).join("|")}function H_(e,t){let r=1,n=1,i=_l(e,r),s=new Set([t]);for(;e<=i&&i<=t;)s.add(i),r+=1,i=_l(e,r);for(i=pl(t+1,n)-1;e<i&&i<=t;)s.add(i),n+=1,i=pl(t+1,n)-1;return s=[...s],s.sort(W_),s}function U_(e,t,r){if(e===t)return{pattern:e,count:[],digits:0};let n=j_(e,t),i=n.length,s="",a=0;for(let o=0;o<i;o++){let[u,l]=n[o];u===l?s+=u:u!=="0"||l!=="9"?s+=K_(u,l,r):a++}return a&&(s+=r.shorthand===!0?"\\d":"[0-9]"),{pattern:s,count:[a],digits:i}}function dl(e,t,r,n){let i=H_(e,t),s=[],a=e,o;for(let u=0;u<i.length;u++){let l=i[u],f=U_(String(a),String(l),n),g="";if(!r.isPadded&&o&&o.pattern===f.pattern){o.count.length>1&&o.count.pop(),o.count.push(f.count[0]),o.string=o.pattern+ml(o.count),a=l+1;continue}r.isPadded&&(g=Y_(l,r,n)),f.string=g+f.pattern+ml(f.count),s.push(f),a=l+1,o=f}return s}function cs(e,t,r,n,i){let s=[];for(let a of e){let{string:o}=a;!n&&!gl(t,"string",o)&&s.push(r+o),n&&gl(t,"string",o)&&s.push(r+o)}return s}function j_(e,t){let r=[];for(let n=0;n<e.length;n++)r.push([e[n],t[n]]);return r}function W_(e,t){return e>t?1:t>e?-1:0}function gl(e,t,r){return e.some(n=>n[t]===r)}function _l(e,t){return Number(String(e).slice(0,-t)+"9".repeat(t))}function pl(e,t){return e-e%Math.pow(10,t)}function ml(e){let[t=0,r=""]=e;return r||t>1?`{${t+(r?","+r:"")}}`:""}function K_(e,t,r){return`[${e}${t-e===1?"":"-"}${t}]`}function vl(e){return/^-?(0+)\d/.test(e)}function Y_(e,t,r){if(!t.isPadded)return e;let n=Math.abs(t.maxLen-String(e).length),i=r.relaxZeros!==!1;switch(n){case 0:return"";case 1:return i?"0?":"0";case 2:return i?"0{0,2}":"00";default:return i?`0{0,${n}}`:`0{${n}}`}}Ht.cache={};Ht.clearCache=()=>Ht.cache={};yl.exports=Ht});var ds=v((jv,Cl)=>{"use strict";var X_=require("util"),Al=El(),Sl=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),Q_=e=>t=>e===!0?Number(t):String(t),fs=e=>typeof e=="number"||typeof e=="string"&&e!=="",jr=e=>Number.isInteger(+e),hs=e=>{let t=`${e}`,r=-1;if(t[0]==="-"&&(t=t.slice(1)),t==="0")return!1;for(;t[++r]==="0";);return r>0},z_=(e,t,r)=>typeof e=="string"||typeof t=="string"?!0:r.stringify===!0,Z_=(e,t,r)=>{if(t>0){let n=e[0]==="-"?"-":"";n&&(e=e.slice(1)),e=n+e.padStart(n?t-1:t,"0")}return r===!1?String(e):e},bl=(e,t)=>{let r=e[0]==="-"?"-":"";for(r&&(e=e.slice(1),t--);e.length<t;)e="0"+e;return r?"-"+e:e},J_=(e,t)=>{e.negatives.sort((a,o)=>a<o?-1:a>o?1:0),e.positives.sort((a,o)=>a<o?-1:a>o?1:0);let r=t.capture?"":"?:",n="",i="",s;return e.positives.length&&(n=e.positives.join("|")),e.negatives.length&&(i=`-(${r}${e.negatives.join("|")})`),n&&i?s=`${n}|${i}`:s=n||i,t.wrap?`(${r}${s})`:s},wl=(e,t,r,n)=>{if(r)return Al(e,t,{wrap:!1,...n});let i=String.fromCharCode(e);if(e===t)return i;let s=String.fromCharCode(t);return`[${i}-${s}]`},Il=(e,t,r)=>{if(Array.isArray(e)){let n=r.wrap===!0,i=r.capture?"":"?:";return n?`(${i}${e.join("|")})`:e.join("|")}return Al(e,t,r)},Nl=(...e)=>new RangeError("Invalid range arguments: "+X_.inspect(...e)),Pl=(e,t,r)=>{if(r.strictRanges===!0)throw Nl([e,t]);return[]},ep=(e,t)=>{if(t.strictRanges===!0)throw new TypeError(`Expected step "${e}" to be a number`);return[]},tp=(e,t,r=1,n={})=>{let i=Number(e),s=Number(t);if(!Number.isInteger(i)||!Number.isInteger(s)){if(n.strictRanges===!0)throw Nl([e,t]);return[]}i===0&&(i=0),s===0&&(s=0);let a=i>s,o=String(e),u=String(t),l=String(r);r=Math.max(Math.abs(r),1);let f=hs(o)||hs(u)||hs(l),g=f?Math.max(o.length,u.length,l.length):0,h=f===!1&&z_(e,t,n)===!1,m=n.transform||Q_(h);if(n.toRegex&&r===1)return wl(bl(e,g),bl(t,g),!0,n);let _={negatives:[],positives:[]},b=B=>_[B<0?"negatives":"positives"].push(Math.abs(B)),P=[],C=0;for(;a?i>=s:i<=s;)n.toRegex===!0&&r>1?b(i):P.push(Z_(m(i,C),g,h)),i=a?i-r:i+r,C++;return n.toRegex===!0?r>1?J_(_,n):Il(P,null,{wrap:!1,...n}):P},rp=(e,t,r=1,n={})=>{if(!jr(e)&&e.length>1||!jr(t)&&t.length>1)return Pl(e,t,n);let i=n.transform||(h=>String.fromCharCode(h)),s=`${e}`.charCodeAt(0),a=`${t}`.charCodeAt(0),o=s>a,u=Math.min(s,a),l=Math.max(s,a);if(n.toRegex&&r===1)return wl(u,l,!1,n);let f=[],g=0;for(;o?s>=a:s<=a;)f.push(i(s,g)),s=o?s-r:s+r,g++;return n.toRegex===!0?Il(f,null,{wrap:!1,options:n}):f},Un=(e,t,r,n={})=>{if(t==null&&fs(e))return[e];if(!fs(e)||!fs(t))return Pl(e,t,n);if(typeof r=="function")return Un(e,t,1,{transform:r});if(Sl(r))return Un(e,t,0,r);let i={...n};return i.capture===!0&&(i.wrap=!0),r=r||i.step||1,jr(r)?jr(e)&&jr(t)?tp(e,t,r,i):rp(e,t,Math.max(Math.abs(r),1),i):r!=null&&!Sl(r)?ep(r,i):Un(e,t,1,r)};Cl.exports=Un});var xl=v((Wv,Rl)=>{"use strict";var np=ds(),Tl=Bn(),ip=(e,t={})=>{let r=(n,i={})=>{let s=Tl.isInvalidBrace(i),a=n.invalid===!0&&t.escapeInvalid===!0,o=s===!0||a===!0,u=t.escapeInvalid===!0?"\\":"",l="";if(n.isOpen===!0||n.isClose===!0)return u+n.value;if(n.type==="open")return o?u+n.value:"(";if(n.type==="close")return o?u+n.value:")";if(n.type==="comma")return n.prev.type==="comma"?"":o?n.value:"|";if(n.value)return n.value;if(n.nodes&&n.ranges>0){let f=Tl.reduce(n.nodes),g=np(...f,{...t,wrap:!1,toRegex:!0});if(g.length!==0)return f.length>1&&g.length>1?`(${g})`:g}if(n.nodes)for(let f of n.nodes)l+=r(f,n);return l};return r(e)};Rl.exports=ip});var Ml=v((Kv,kl)=>{"use strict";var sp=ds(),Ol=Hn(),vr=Bn(),Ut=(e="",t="",r=!1)=>{let n=[];if(e=[].concat(e),t=[].concat(t),!t.length)return e;if(!e.length)return r?vr.flatten(t).map(i=>`{${i}}`):t;for(let i of e)if(Array.isArray(i))for(let s of i)n.push(Ut(s,t,r));else for(let s of t)r===!0&&typeof s=="string"&&(s=`{${s}}`),n.push(Array.isArray(s)?Ut(i,s,r):i+s);return vr.flatten(n)},ap=(e,t={})=>{let r=t.rangeLimit===void 0?1e3:t.rangeLimit,n=(i,s={})=>{i.queue=[];let a=s,o=s.queue;for(;a.type!=="brace"&&a.type!=="root"&&a.parent;)a=a.parent,o=a.queue;if(i.invalid||i.dollar){o.push(Ut(o.pop(),Ol(i,t)));return}if(i.type==="brace"&&i.invalid!==!0&&i.nodes.length===2){o.push(Ut(o.pop(),["{}"]));return}if(i.nodes&&i.ranges>0){let g=vr.reduce(i.nodes);if(vr.exceedsLimit(...g,t.step,r))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let h=sp(...g,t);h.length===0&&(h=Ol(i,t)),o.push(Ut(o.pop(),h)),i.nodes=[];return}let u=vr.encloseBrace(i),l=i.queue,f=i;for(;f.type!=="brace"&&f.type!=="root"&&f.parent;)f=f.parent,l=f.queue;for(let g=0;g<i.nodes.length;g++){let h=i.nodes[g];if(h.type==="comma"&&i.type==="brace"){g===1&&l.push(""),l.push("");continue}if(h.type==="close"){o.push(Ut(o.pop(),l,u));continue}if(h.value&&h.type!=="open"){l.push(Ut(l.pop(),h.value));continue}h.nodes&&n(h,i)}return l};return vr.flatten(n(e))};kl.exports=ap});var Fl=v((Yv,Ll)=>{"use strict";Ll.exports={MAX_LENGTH:1024*64,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}});var Gl=v((Xv,Vl)=>{"use strict";var op=Hn(),{MAX_LENGTH:Dl,CHAR_BACKSLASH:gs,CHAR_BACKTICK:up,CHAR_COMMA:lp,CHAR_DOT:cp,CHAR_LEFT_PARENTHESES:fp,CHAR_RIGHT_PARENTHESES:hp,CHAR_LEFT_CURLY_BRACE:dp,CHAR_RIGHT_CURLY_BRACE:gp,CHAR_LEFT_SQUARE_BRACKET:$l,CHAR_RIGHT_SQUARE_BRACKET:ql,CHAR_DOUBLE_QUOTE:_p,CHAR_SINGLE_QUOTE:pp,CHAR_NO_BREAK_SPACE:mp,CHAR_ZERO_WIDTH_NOBREAK_SPACE:vp}=Fl(),yp=(e,t={})=>{if(typeof e!="string")throw new TypeError("Expected a string");let r=t||{},n=typeof r.maxLength=="number"?Math.min(Dl,r.maxLength):Dl;if(e.length>n)throw new SyntaxError(`Input length (${e.length}), exceeds max characters (${n})`);let i={type:"root",input:e,nodes:[]},s=[i],a=i,o=i,u=0,l=e.length,f=0,g=0,h,m={},_=()=>e[f++],b=P=>{if(P.type==="text"&&o.type==="dot"&&(o.type="text"),o&&o.type==="text"&&P.type==="text"){o.value+=P.value;return}return a.nodes.push(P),P.parent=a,P.prev=o,o=P,P};for(b({type:"bos"});f<l;)if(a=s[s.length-1],h=_(),!(h===vp||h===mp)){if(h===gs){b({type:"text",value:(t.keepEscaping?h:"")+_()});continue}if(h===ql){b({type:"text",value:"\\"+h});continue}if(h===$l){u++;let P=!0,C;for(;f<l&&(C=_());){if(h+=C,C===$l){u++;continue}if(C===gs){h+=_();continue}if(C===ql&&(u--,u===0))break}b({type:"text",value:h});continue}if(h===fp){a=b({type:"paren",nodes:[]}),s.push(a),b({type:"text",value:h});continue}if(h===hp){if(a.type!=="paren"){b({type:"text",value:h});continue}a=s.pop(),b({type:"text",value:h}),a=s[s.length-1];continue}if(h===_p||h===pp||h===up){let P=h,C;for(t.keepQuotes!==!0&&(h="");f<l&&(C=_());){if(C===gs){h+=C+_();continue}if(C===P){t.keepQuotes===!0&&(h+=C);break}h+=C}b({type:"text",value:h});continue}if(h===dp){g++;let P=o.value&&o.value.slice(-1)==="$"||a.dollar===!0;a=b({type:"brace",open:!0,close:!1,dollar:P,depth:g,commas:0,ranges:0,nodes:[]}),s.push(a),b({type:"open",value:h});continue}if(h===gp){if(a.type!=="brace"){b({type:"text",value:h});continue}let P="close";a=s.pop(),a.close=!0,b({type:P,value:h}),g--,a=s[s.length-1];continue}if(h===lp&&g>0){if(a.ranges>0){a.ranges=0;let P=a.nodes.shift();a.nodes=[P,{type:"text",value:op(a)}]}b({type:"comma",value:h}),a.commas++;continue}if(h===cp&&g>0&&a.commas===0){let P=a.nodes;if(g===0||P.length===0){b({type:"text",value:h});continue}if(o.type==="dot"){if(a.range=[],o.value+=h,o.type="range",a.nodes.length!==3&&a.nodes.length!==5){a.invalid=!0,a.ranges=0,o.type="text";continue}a.ranges++,a.args=[];continue}if(o.type==="range"){P.pop();let C=P[P.length-1];C.value+=o.value+h,o=C,a.ranges--;continue}b({type:"dot",value:h});continue}b({type:"text",value:h})}do if(a=s.pop(),a.type!=="root"){a.nodes.forEach(B=>{B.nodes||(B.type==="open"&&(B.isOpen=!0),B.type==="close"&&(B.isClose=!0),B.nodes||(B.type="text"),B.invalid=!0)});let P=s[s.length-1],C=P.nodes.indexOf(a);P.nodes.splice(C,1,...a.nodes)}while(s.length>0);return b({type:"eos"}),i};Vl.exports=yp});var Ul=v((Qv,Hl)=>{"use strict";var Bl=Hn(),Ep=xl(),Sp=Ml(),bp=Gl(),Oe=(e,t={})=>{let r=[];if(Array.isArray(e))for(let n of e){let i=Oe.create(n,t);Array.isArray(i)?r.push(...i):r.push(i)}else r=[].concat(Oe.create(e,t));return t&&t.expand===!0&&t.nodupes===!0&&(r=[...new Set(r)]),r};Oe.parse=(e,t={})=>bp(e,t);Oe.stringify=(e,t={})=>Bl(typeof e=="string"?Oe.parse(e,t):e,t);Oe.compile=(e,t={})=>(typeof e=="string"&&(e=Oe.parse(e,t)),Ep(e,t));Oe.expand=(e,t={})=>{typeof e=="string"&&(e=Oe.parse(e,t));let r=Sp(e,t);return t.noempty===!0&&(r=r.filter(Boolean)),t.nodupes===!0&&(r=[...new Set(r)]),r};Oe.create=(e,t={})=>e===""||e.length<3?[e]:t.expand!==!0?Oe.compile(e,t):Oe.expand(e,t);Hl.exports=Oe});var Wr=v((zv,Xl)=>{"use strict";var Ap=require("path"),rt="\\\\/",jl=`[^${rt}]`,ct="\\.",wp="\\+",Ip="\\?",jn="\\/",Np="(?=.)",Wl="[^/]",_s=`(?:${jn}|$)`,Kl=`(?:^|${jn})`,ps=`${ct}{1,2}${_s}`,Pp=`(?!${ct})`,Cp=`(?!${Kl}${ps})`,Tp=`(?!${ct}{0,1}${_s})`,Rp=`(?!${ps})`,xp=`[^.${jn}]`,Op=`${Wl}*?`,Yl={DOT_LITERAL:ct,PLUS_LITERAL:wp,QMARK_LITERAL:Ip,SLASH_LITERAL:jn,ONE_CHAR:Np,QMARK:Wl,END_ANCHOR:_s,DOTS_SLASH:ps,NO_DOT:Pp,NO_DOTS:Cp,NO_DOT_SLASH:Tp,NO_DOTS_SLASH:Rp,QMARK_NO_DOT:xp,STAR:Op,START_ANCHOR:Kl},kp={...Yl,SLASH_LITERAL:`[${rt}]`,QMARK:jl,STAR:`${jl}*?`,DOTS_SLASH:`${ct}{1,2}(?:[${rt}]|$)`,NO_DOT:`(?!${ct})`,NO_DOTS:`(?!(?:^|[${rt}])${ct}{1,2}(?:[${rt}]|$))`,NO_DOT_SLASH:`(?!${ct}{0,1}(?:[${rt}]|$))`,NO_DOTS_SLASH:`(?!${ct}{1,2}(?:[${rt}]|$))`,QMARK_NO_DOT:`[^.${rt}]`,START_ANCHOR:`(?:^|[${rt}])`,END_ANCHOR:`(?:[${rt}]|$)`},Mp={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};Xl.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:Mp,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Ap.sep,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?kp:Yl}}});var Kr=v(Te=>{"use strict";var Lp=require("path"),Fp=process.platform==="win32",{REGEX_BACKSLASH:Dp,REGEX_REMOVE_BACKSLASH:$p,REGEX_SPECIAL_CHARS:qp,REGEX_SPECIAL_CHARS_GLOBAL:Vp}=Wr();Te.isObject=e=>e!==null&&typeof e=="object"&&!Array.isArray(e);Te.hasRegexChars=e=>qp.test(e);Te.isRegexChar=e=>e.length===1&&Te.hasRegexChars(e);Te.escapeRegex=e=>e.replace(Vp,"\\$1");Te.toPosixSlashes=e=>e.replace(Dp,"/");Te.removeBackslashes=e=>e.replace($p,t=>t==="\\"?"":t);Te.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return e.length===3&&e[0]>=9||e[0]===8&&e[1]>=10};Te.isWindows=e=>e&&typeof e.windows=="boolean"?e.windows:Fp===!0||Lp.sep==="\\";Te.escapeLast=(e,t,r)=>{let n=e.lastIndexOf(t,r);return n===-1?e:e[n-1]==="\\"?Te.escapeLast(e,t,n-1):`${e.slice(0,n)}\\${e.slice(n)}`};Te.removePrefix=(e,t={})=>{let r=e;return r.startsWith("./")&&(r=r.slice(2),t.prefix="./"),r};Te.wrapOutput=(e,t={},r={})=>{let n=r.contains?"":"^",i=r.contains?"":"$",s=`${n}(?:${e})${i}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var nc=v((Jv,rc)=>{"use strict";var Ql=Kr(),{CHAR_ASTERISK:ms,CHAR_AT:Gp,CHAR_BACKWARD_SLASH:Yr,CHAR_COMMA:Bp,CHAR_DOT:vs,CHAR_EXCLAMATION_MARK:ys,CHAR_FORWARD_SLASH:tc,CHAR_LEFT_CURLY_BRACE:Es,CHAR_LEFT_PARENTHESES:Ss,CHAR_LEFT_SQUARE_BRACKET:Hp,CHAR_PLUS:Up,CHAR_QUESTION_MARK:zl,CHAR_RIGHT_CURLY_BRACE:jp,CHAR_RIGHT_PARENTHESES:Zl,CHAR_RIGHT_SQUARE_BRACKET:Wp}=Wr(),Jl=e=>e===tc||e===Yr,ec=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?1/0:1)},Kp=(e,t)=>{let r=t||{},n=e.length-1,i=r.parts===!0||r.scanToEnd===!0,s=[],a=[],o=[],u=e,l=-1,f=0,g=0,h=!1,m=!1,_=!1,b=!1,P=!1,C=!1,B=!1,V=!1,se=!1,x=!1,K=0,F,T,R={value:"",depth:0,isGlob:!1},O=()=>l>=n,p=()=>u.charCodeAt(l+1),ee=()=>(F=T,u.charCodeAt(++l));for(;l<n;){T=ee();let E;if(T===Yr){B=R.backslashes=!0,T=ee(),T===Es&&(C=!0);continue}if(C===!0||T===Es){for(K++;O()!==!0&&(T=ee());){if(T===Yr){B=R.backslashes=!0,ee();continue}if(T===Es){K++;continue}if(C!==!0&&T===vs&&(T=ee())===vs){if(h=R.isBrace=!0,_=R.isGlob=!0,x=!0,i===!0)continue;break}if(C!==!0&&T===Bp){if(h=R.isBrace=!0,_=R.isGlob=!0,x=!0,i===!0)continue;break}if(T===jp&&(K--,K===0)){C=!1,h=R.isBrace=!0,x=!0;break}}if(i===!0)continue;break}if(T===tc){if(s.push(l),a.push(R),R={value:"",depth:0,isGlob:!1},x===!0)continue;if(F===vs&&l===f+1){f+=2;continue}g=l+1;continue}if(r.noext!==!0&&(T===Up||T===Gp||T===ms||T===zl||T===ys)===!0&&p()===Ss){if(_=R.isGlob=!0,b=R.isExtglob=!0,x=!0,T===ys&&l===f&&(se=!0),i===!0){for(;O()!==!0&&(T=ee());){if(T===Yr){B=R.backslashes=!0,T=ee();continue}if(T===Zl){_=R.isGlob=!0,x=!0;break}}continue}break}if(T===ms){if(F===ms&&(P=R.isGlobstar=!0),_=R.isGlob=!0,x=!0,i===!0)continue;break}if(T===zl){if(_=R.isGlob=!0,x=!0,i===!0)continue;break}if(T===Hp){for(;O()!==!0&&(E=ee());){if(E===Yr){B=R.backslashes=!0,ee();continue}if(E===Wp){m=R.isBracket=!0,_=R.isGlob=!0,x=!0;break}}if(i===!0)continue;break}if(r.nonegate!==!0&&T===ys&&l===f){V=R.negated=!0,f++;continue}if(r.noparen!==!0&&T===Ss){if(_=R.isGlob=!0,i===!0){for(;O()!==!0&&(T=ee());){if(T===Ss){B=R.backslashes=!0,T=ee();continue}if(T===Zl){x=!0;break}}continue}break}if(_===!0){if(x=!0,i===!0)continue;break}}r.noext===!0&&(b=!1,_=!1);let I=u,w="",c="";f>0&&(w=u.slice(0,f),u=u.slice(f),g-=f),I&&_===!0&&g>0?(I=u.slice(0,g),c=u.slice(g)):_===!0?(I="",c=u):I=u,I&&I!==""&&I!=="/"&&I!==u&&Jl(I.charCodeAt(I.length-1))&&(I=I.slice(0,-1)),r.unescape===!0&&(c&&(c=Ql.removeBackslashes(c)),I&&B===!0&&(I=Ql.removeBackslashes(I)));let d={prefix:w,input:e,start:f,base:I,glob:c,isBrace:h,isBracket:m,isGlob:_,isExtglob:b,isGlobstar:P,negated:V,negatedExtglob:se};if(r.tokens===!0&&(d.maxDepth=0,Jl(T)||a.push(R),d.tokens=a),r.parts===!0||r.tokens===!0){let E;for(let A=0;A<s.length;A++){let N=E?E+1:f,q=s[A],U=e.slice(N,q);r.tokens&&(A===0&&f!==0?(a[A].isPrefix=!0,a[A].value=w):a[A].value=U,ec(a[A]),d.maxDepth+=a[A].depth),(A!==0||U!=="")&&o.push(U),E=q}if(E&&E+1<e.length){let A=e.slice(E+1);o.push(A),r.tokens&&(a[a.length-1].value=A,ec(a[a.length-1]),d.maxDepth+=a[a.length-1].depth)}d.slashes=s,d.parts=o}return d};rc.exports=Kp});var ac=v((ey,sc)=>{"use strict";var Wn=Wr(),ke=Kr(),{MAX_LENGTH:Kn,POSIX_REGEX_SOURCE:Yp,REGEX_NON_SPECIAL_CHARS:Xp,REGEX_SPECIAL_CHARS_BACKREF:Qp,REPLACEMENTS:ic}=Wn,zp=(e,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...e,t);e.sort();let r=`[${e.join("-")}]`;try{new RegExp(r)}catch{return e.map(i=>ke.escapeRegex(i)).join("..")}return r},yr=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,bs=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=ic[e]||e;let r={...t},n=typeof r.maxLength=="number"?Math.min(Kn,r.maxLength):Kn,i=e.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);let s={type:"bos",value:"",output:r.prepend||""},a=[s],o=r.capture?"":"?:",u=ke.isWindows(t),l=Wn.globChars(u),f=Wn.extglobChars(l),{DOT_LITERAL:g,PLUS_LITERAL:h,SLASH_LITERAL:m,ONE_CHAR:_,DOTS_SLASH:b,NO_DOT:P,NO_DOT_SLASH:C,NO_DOTS_SLASH:B,QMARK:V,QMARK_NO_DOT:se,STAR:x,START_ANCHOR:K}=l,F=y=>`(${o}(?:(?!${K}${y.dot?b:g}).)*?)`,T=r.dot?"":P,R=r.dot?V:se,O=r.bash===!0?F(r):x;r.capture&&(O=`(${O})`),typeof r.noext=="boolean"&&(r.noextglob=r.noext);let p={input:e,index:-1,start:0,dot:r.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};e=ke.removePrefix(e,p),i=e.length;let ee=[],I=[],w=[],c=s,d,E=()=>p.index===i-1,A=p.peek=(y=1)=>e[p.index+y],N=p.advance=()=>e[++p.index]||"",q=()=>e.slice(p.index+1),U=(y="",j=0)=>{p.consumed+=y,p.index+=j},te=y=>{p.output+=y.output!=null?y.output:y.value,U(y.value)},he=()=>{let y=1;for(;A()==="!"&&(A(2)!=="("||A(3)==="?");)N(),p.start++,y++;return y%2===0?!1:(p.negated=!0,p.start++,!0)},Re=y=>{p[y]++,w.push(y)},de=y=>{p[y]--,w.pop()},D=y=>{if(c.type==="globstar"){let j=p.braces>0&&(y.type==="comma"||y.type==="brace"),S=y.extglob===!0||ee.length&&(y.type==="pipe"||y.type==="paren");y.type!=="slash"&&y.type!=="paren"&&!j&&!S&&(p.output=p.output.slice(0,-c.output.length),c.type="star",c.value="*",c.output=O,p.output+=c.output)}if(ee.length&&y.type!=="paren"&&(ee[ee.length-1].inner+=y.value),(y.value||y.output)&&te(y),c&&c.type==="text"&&y.type==="text"){c.value+=y.value,c.output=(c.output||"")+y.value;return}y.prev=c,a.push(y),c=y},Xe=(y,j)=>{let S={...f[j],conditions:1,inner:""};S.prev=c,S.parens=p.parens,S.output=p.output;let M=(r.capture?"(":"")+S.open;Re("parens"),D({type:y,value:j,output:p.output?"":_}),D({type:"paren",extglob:!0,value:N(),output:M}),ee.push(S)},gt=y=>{let j=y.close+(r.capture?")":""),S;if(y.type==="negate"){let M=O;if(y.inner&&y.inner.length>1&&y.inner.includes("/")&&(M=F(r)),(M!==O||E()||/^\)+$/.test(q()))&&(j=y.close=`)$))${M}`),y.inner.includes("*")&&(S=q())&&/^\.[^\\/.]+$/.test(S)){let ae=bs(S,{...t,fastpaths:!1}).output;j=y.close=`)${ae})${M})`}y.prev.type==="bos"&&(p.negatedExtglob=!0)}D({type:"paren",extglob:!0,value:d,output:j}),de("parens")};if(r.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let y=!1,j=e.replace(Qp,(S,M,ae,Ee,fe,yi)=>Ee==="\\"?(y=!0,S):Ee==="?"?M?M+Ee+(fe?V.repeat(fe.length):""):yi===0?R+(fe?V.repeat(fe.length):""):V.repeat(ae.length):Ee==="."?g.repeat(ae.length):Ee==="*"?M?M+Ee+(fe?O:""):O:M?S:`\\${S}`);return y===!0&&(r.unescape===!0?j=j.replace(/\\/g,""):j=j.replace(/\\+/g,S=>S.length%2===0?"\\\\":S?"\\":"")),j===e&&r.contains===!0?(p.output=e,p):(p.output=ke.wrapOutput(j,p,t),p)}for(;!E();){if(d=N(),d==="\0")continue;if(d==="\\"){let S=A();if(S==="/"&&r.bash!==!0||S==="."||S===";")continue;if(!S){d+="\\",D({type:"text",value:d});continue}let M=/^\\+/.exec(q()),ae=0;if(M&&M[0].length>2&&(ae=M[0].length,p.index+=ae,ae%2!==0&&(d+="\\")),r.unescape===!0?d=N():d+=N(),p.brackets===0){D({type:"text",value:d});continue}}if(p.brackets>0&&(d!=="]"||c.value==="["||c.value==="[^")){if(r.posix!==!1&&d===":"){let S=c.value.slice(1);if(S.includes("[")&&(c.posix=!0,S.includes(":"))){let M=c.value.lastIndexOf("["),ae=c.value.slice(0,M),Ee=c.value.slice(M+2),fe=Yp[Ee];if(fe){c.value=ae+fe,p.backtrack=!0,N(),!s.output&&a.indexOf(c)===1&&(s.output=_);continue}}}(d==="["&&A()!==":"||d==="-"&&A()==="]")&&(d=`\\${d}`),d==="]"&&(c.value==="["||c.value==="[^")&&(d=`\\${d}`),r.posix===!0&&d==="!"&&c.value==="["&&(d="^"),c.value+=d,te({value:d});continue}if(p.quotes===1&&d!=='"'){d=ke.escapeRegex(d),c.value+=d,te({value:d});continue}if(d==='"'){p.quotes=p.quotes===1?0:1,r.keepQuotes===!0&&D({type:"text",value:d});continue}if(d==="("){Re("parens"),D({type:"paren",value:d});continue}if(d===")"){if(p.parens===0&&r.strictBrackets===!0)throw new SyntaxError(yr("opening","("));let S=ee[ee.length-1];if(S&&p.parens===S.parens+1){gt(ee.pop());continue}D({type:"paren",value:d,output:p.parens?")":"\\)"}),de("parens");continue}if(d==="["){if(r.nobracket===!0||!q().includes("]")){if(r.nobracket!==!0&&r.strictBrackets===!0)throw new SyntaxError(yr("closing","]"));d=`\\${d}`}else Re("brackets");D({type:"bracket",value:d});continue}if(d==="]"){if(r.nobracket===!0||c&&c.type==="bracket"&&c.value.length===1){D({type:"text",value:d,output:`\\${d}`});continue}if(p.brackets===0){if(r.strictBrackets===!0)throw new SyntaxError(yr("opening","["));D({type:"text",value:d,output:`\\${d}`});continue}de("brackets");let S=c.value.slice(1);if(c.posix!==!0&&S[0]==="^"&&!S.includes("/")&&(d=`/${d}`),c.value+=d,te({value:d}),r.literalBrackets===!1||ke.hasRegexChars(S))continue;let M=ke.escapeRegex(c.value);if(p.output=p.output.slice(0,-c.value.length),r.literalBrackets===!0){p.output+=M,c.value=M;continue}c.value=`(${o}${M}|${c.value})`,p.output+=c.value;continue}if(d==="{"&&r.nobrace!==!0){Re("braces");let S={type:"brace",value:d,output:"(",outputIndex:p.output.length,tokensIndex:p.tokens.length};I.push(S),D(S);continue}if(d==="}"){let S=I[I.length-1];if(r.nobrace===!0||!S){D({type:"text",value:d,output:d});continue}let M=")";if(S.dots===!0){let ae=a.slice(),Ee=[];for(let fe=ae.length-1;fe>=0&&(a.pop(),ae[fe].type!=="brace");fe--)ae[fe].type!=="dots"&&Ee.unshift(ae[fe].value);M=zp(Ee,r),p.backtrack=!0}if(S.comma!==!0&&S.dots!==!0){let ae=p.output.slice(0,S.outputIndex),Ee=p.tokens.slice(S.tokensIndex);S.value=S.output="\\{",d=M="\\}",p.output=ae;for(let fe of Ee)p.output+=fe.output||fe.value}D({type:"brace",value:d,output:M}),de("braces"),I.pop();continue}if(d==="|"){ee.length>0&&ee[ee.length-1].conditions++,D({type:"text",value:d});continue}if(d===","){let S=d,M=I[I.length-1];M&&w[w.length-1]==="braces"&&(M.comma=!0,S="|"),D({type:"comma",value:d,output:S});continue}if(d==="/"){if(c.type==="dot"&&p.index===p.start+1){p.start=p.index+1,p.consumed="",p.output="",a.pop(),c=s;continue}D({type:"slash",value:d,output:m});continue}if(d==="."){if(p.braces>0&&c.type==="dot"){c.value==="."&&(c.output=g);let S=I[I.length-1];c.type="dots",c.output+=d,c.value+=d,S.dots=!0;continue}if(p.braces+p.parens===0&&c.type!=="bos"&&c.type!=="slash"){D({type:"text",value:d,output:g});continue}D({type:"dot",value:d,output:g});continue}if(d==="?"){if(!(c&&c.value==="(")&&r.noextglob!==!0&&A()==="("&&A(2)!=="?"){Xe("qmark",d);continue}if(c&&c.type==="paren"){let M=A(),ae=d;if(M==="<"&&!ke.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(c.value==="("&&!/[!=<:]/.test(M)||M==="<"&&!/<([!=]|\w+>)/.test(q()))&&(ae=`\\${d}`),D({type:"text",value:d,output:ae});continue}if(r.dot!==!0&&(c.type==="slash"||c.type==="bos")){D({type:"qmark",value:d,output:se});continue}D({type:"qmark",value:d,output:V});continue}if(d==="!"){if(r.noextglob!==!0&&A()==="("&&(A(2)!=="?"||!/[!=<:]/.test(A(3)))){Xe("negate",d);continue}if(r.nonegate!==!0&&p.index===0){he();continue}}if(d==="+"){if(r.noextglob!==!0&&A()==="("&&A(2)!=="?"){Xe("plus",d);continue}if(c&&c.value==="("||r.regex===!1){D({type:"plus",value:d,output:h});continue}if(c&&(c.type==="bracket"||c.type==="paren"||c.type==="brace")||p.parens>0){D({type:"plus",value:d});continue}D({type:"plus",value:h});continue}if(d==="@"){if(r.noextglob!==!0&&A()==="("&&A(2)!=="?"){D({type:"at",extglob:!0,value:d,output:""});continue}D({type:"text",value:d});continue}if(d!=="*"){(d==="$"||d==="^")&&(d=`\\${d}`);let S=Xp.exec(q());S&&(d+=S[0],p.index+=S[0].length),D({type:"text",value:d});continue}if(c&&(c.type==="globstar"||c.star===!0)){c.type="star",c.star=!0,c.value+=d,c.output=O,p.backtrack=!0,p.globstar=!0,U(d);continue}let y=q();if(r.noextglob!==!0&&/^\([^?]/.test(y)){Xe("star",d);continue}if(c.type==="star"){if(r.noglobstar===!0){U(d);continue}let S=c.prev,M=S.prev,ae=S.type==="slash"||S.type==="bos",Ee=M&&(M.type==="star"||M.type==="globstar");if(r.bash===!0&&(!ae||y[0]&&y[0]!=="/")){D({type:"star",value:d,output:""});continue}let fe=p.braces>0&&(S.type==="comma"||S.type==="brace"),yi=ee.length&&(S.type==="pipe"||S.type==="paren");if(!ae&&S.type!=="paren"&&!fe&&!yi){D({type:"star",value:d,output:""});continue}for(;y.slice(0,3)==="/**";){let Zr=e[p.index+4];if(Zr&&Zr!=="/")break;y=y.slice(3),U("/**",3)}if(S.type==="bos"&&E()){c.type="globstar",c.value+=d,c.output=F(r),p.output=c.output,p.globstar=!0,U(d);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&!Ee&&E()){p.output=p.output.slice(0,-(S.output+c.output).length),S.output=`(?:${S.output}`,c.type="globstar",c.output=F(r)+(r.strictSlashes?")":"|$)"),c.value+=d,p.globstar=!0,p.output+=S.output+c.output,U(d);continue}if(S.type==="slash"&&S.prev.type!=="bos"&&y[0]==="/"){let Zr=y[1]!==void 0?"|$":"";p.output=p.output.slice(0,-(S.output+c.output).length),S.output=`(?:${S.output}`,c.type="globstar",c.output=`${F(r)}${m}|${m}${Zr})`,c.value+=d,p.output+=S.output+c.output,p.globstar=!0,U(d+N()),D({type:"slash",value:"/",output:""});continue}if(S.type==="bos"&&y[0]==="/"){c.type="globstar",c.value+=d,c.output=`(?:^|${m}|${F(r)}${m})`,p.output=c.output,p.globstar=!0,U(d+N()),D({type:"slash",value:"/",output:""});continue}p.output=p.output.slice(0,-c.output.length),c.type="globstar",c.output=F(r),c.value+=d,p.output+=c.output,p.globstar=!0,U(d);continue}let j={type:"star",value:d,output:O};if(r.bash===!0){j.output=".*?",(c.type==="bos"||c.type==="slash")&&(j.output=T+j.output),D(j);continue}if(c&&(c.type==="bracket"||c.type==="paren")&&r.regex===!0){j.output=d,D(j);continue}(p.index===p.start||c.type==="slash"||c.type==="dot")&&(c.type==="dot"?(p.output+=C,c.output+=C):r.dot===!0?(p.output+=B,c.output+=B):(p.output+=T,c.output+=T),A()!=="*"&&(p.output+=_,c.output+=_)),D(j)}for(;p.brackets>0;){if(r.strictBrackets===!0)throw new SyntaxError(yr("closing","]"));p.output=ke.escapeLast(p.output,"["),de("brackets")}for(;p.parens>0;){if(r.strictBrackets===!0)throw new SyntaxError(yr("closing",")"));p.output=ke.escapeLast(p.output,"("),de("parens")}for(;p.braces>0;){if(r.strictBrackets===!0)throw new SyntaxError(yr("closing","}"));p.output=ke.escapeLast(p.output,"{"),de("braces")}if(r.strictSlashes!==!0&&(c.type==="star"||c.type==="bracket")&&D({type:"maybe_slash",value:"",output:`${m}?`}),p.backtrack===!0){p.output="";for(let y of p.tokens)p.output+=y.output!=null?y.output:y.value,y.suffix&&(p.output+=y.suffix)}return p};bs.fastpaths=(e,t)=>{let r={...t},n=typeof r.maxLength=="number"?Math.min(Kn,r.maxLength):Kn,i=e.length;if(i>n)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${n}`);e=ic[e]||e;let s=ke.isWindows(t),{DOT_LITERAL:a,SLASH_LITERAL:o,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:f,NO_DOTS:g,NO_DOTS_SLASH:h,STAR:m,START_ANCHOR:_}=Wn.globChars(s),b=r.dot?g:f,P=r.dot?h:f,C=r.capture?"":"?:",B={negated:!1,prefix:""},V=r.bash===!0?".*?":m;r.capture&&(V=`(${V})`);let se=T=>T.noglobstar===!0?V:`(${C}(?:(?!${_}${T.dot?l:a}).)*?)`,x=T=>{switch(T){case"*":return`${b}${u}${V}`;case".*":return`${a}${u}${V}`;case"*.*":return`${b}${V}${a}${u}${V}`;case"*/*":return`${b}${V}${o}${u}${P}${V}`;case"**":return b+se(r);case"**/*":return`(?:${b}${se(r)}${o})?${P}${u}${V}`;case"**/*.*":return`(?:${b}${se(r)}${o})?${P}${V}${a}${u}${V}`;case"**/.*":return`(?:${b}${se(r)}${o})?${a}${u}${V}`;default:{let R=/^(.*?)\.(\w+)$/.exec(T);if(!R)return;let O=x(R[1]);return O?O+a+R[2]:void 0}}},K=ke.removePrefix(e,B),F=x(K);return F&&r.strictSlashes!==!0&&(F+=`${o}?`),F};sc.exports=bs});var uc=v((ty,oc)=>{"use strict";var Zp=require("path"),Jp=nc(),As=ac(),ws=Kr(),em=Wr(),tm=e=>e&&typeof e=="object"&&!Array.isArray(e),oe=(e,t,r=!1)=>{if(Array.isArray(e)){let f=e.map(h=>oe(h,t,r));return h=>{for(let m of f){let _=m(h);if(_)return _}return!1}}let n=tm(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},s=ws.isWindows(t),a=n?oe.compileRe(e,t):oe.makeRe(e,t,!1,!0),o=a.state;delete a.state;let u=()=>!1;if(i.ignore){let f={...t,ignore:null,onMatch:null,onResult:null};u=oe(i.ignore,f,r)}let l=(f,g=!1)=>{let{isMatch:h,match:m,output:_}=oe.test(f,a,t,{glob:e,posix:s}),b={glob:e,state:o,regex:a,posix:s,input:f,output:_,match:m,isMatch:h};return typeof i.onResult=="function"&&i.onResult(b),h===!1?(b.isMatch=!1,g?b:!1):u(f)?(typeof i.onIgnore=="function"&&i.onIgnore(b),b.isMatch=!1,g?b:!1):(typeof i.onMatch=="function"&&i.onMatch(b),g?b:!0)};return r&&(l.state=o),l};oe.test=(e,t,r,{glob:n,posix:i}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};let s=r||{},a=s.format||(i?ws.toPosixSlashes:null),o=e===n,u=o&&a?a(e):e;return o===!1&&(u=a?a(e):e,o=u===n),(o===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?o=oe.matchBase(e,t,r,i):o=t.exec(u)),{isMatch:Boolean(o),match:o,output:u}};oe.matchBase=(e,t,r,n=ws.isWindows(r))=>(t instanceof RegExp?t:oe.makeRe(t,r)).test(Zp.basename(e));oe.isMatch=(e,t,r)=>oe(t,r)(e);oe.parse=(e,t)=>Array.isArray(e)?e.map(r=>oe.parse(r,t)):As(e,{...t,fastpaths:!1});oe.scan=(e,t)=>Jp(e,t);oe.compileRe=(e,t,r=!1,n=!1)=>{if(r===!0)return e.output;let i=t||{},s=i.contains?"":"^",a=i.contains?"":"$",o=`${s}(?:${e.output})${a}`;e&&e.negated===!0&&(o=`^(?!${o}).*$`);let u=oe.toRegex(o,t);return n===!0&&(u.state=e),u};oe.makeRe=(e,t={},r=!1,n=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(i.output=As.fastpaths(e,t)),i.output||(i=As(e,t)),oe.compileRe(i,t,r,n)};oe.toRegex=(e,t)=>{try{let r=t||{};return new RegExp(e,r.flags||(r.nocase?"i":""))}catch(r){if(t&&t.debug===!0)throw r;return/$^/}};oe.constants=em;oc.exports=oe});var cc=v((ry,lc)=>{"use strict";lc.exports=uc()});var _c=v((ny,gc)=>{"use strict";var hc=require("util"),dc=Ul(),nt=cc(),Is=Kr(),fc=e=>e===""||e==="./",ie=(e,t,r)=>{t=[].concat(t),e=[].concat(e);let n=new Set,i=new Set,s=new Set,a=0,o=f=>{s.add(f.output),r&&r.onResult&&r.onResult(f)};for(let f=0;f<t.length;f++){let g=nt(String(t[f]),{...r,onResult:o},!0),h=g.state.negated||g.state.negatedExtglob;h&&a++;for(let m of e){let _=g(m,!0);!(h?!_.isMatch:_.isMatch)||(h?n.add(_.output):(n.delete(_.output),i.add(_.output)))}}let l=(a===t.length?[...s]:[...i]).filter(f=>!n.has(f));if(r&&l.length===0){if(r.failglob===!0)throw new Error(`No matches found for "${t.join(", ")}"`);if(r.nonull===!0||r.nullglob===!0)return r.unescape?t.map(f=>f.replace(/\\/g,"")):t}return l};ie.match=ie;ie.matcher=(e,t)=>nt(e,t);ie.isMatch=(e,t,r)=>nt(t,r)(e);ie.any=ie.isMatch;ie.not=(e,t,r={})=>{t=[].concat(t).map(String);let n=new Set,i=[],s=o=>{r.onResult&&r.onResult(o),i.push(o.output)},a=new Set(ie(e,t,{...r,onResult:s}));for(let o of i)a.has(o)||n.add(o);return[...n]};ie.contains=(e,t,r)=>{if(typeof e!="string")throw new TypeError(`Expected a string: "${hc.inspect(e)}"`);if(Array.isArray(t))return t.some(n=>ie.contains(e,n,r));if(typeof t=="string"){if(fc(e)||fc(t))return!1;if(e.includes(t)||e.startsWith("./")&&e.slice(2).includes(t))return!0}return ie.isMatch(e,t,{...r,contains:!0})};ie.matchKeys=(e,t,r)=>{if(!Is.isObject(e))throw new TypeError("Expected the first argument to be an object");let n=ie(Object.keys(e),t,r),i={};for(let s of n)i[s]=e[s];return i};ie.some=(e,t,r)=>{let n=[].concat(e);for(let i of[].concat(t)){let s=nt(String(i),r);if(n.some(a=>s(a)))return!0}return!1};ie.every=(e,t,r)=>{let n=[].concat(e);for(let i of[].concat(t)){let s=nt(String(i),r);if(!n.every(a=>s(a)))return!1}return!0};ie.all=(e,t,r)=>{if(typeof e!="string")throw new TypeError(`Expected a string: "${hc.inspect(e)}"`);return[].concat(t).every(n=>nt(n,r)(e))};ie.capture=(e,t,r)=>{let n=Is.isWindows(r),s=nt.makeRe(String(e),{...r,capture:!0}).exec(n?Is.toPosixSlashes(t):t);if(s)return s.slice(1).map(a=>a===void 0?"":a)};ie.makeRe=(...e)=>nt.makeRe(...e);ie.scan=(...e)=>nt.scan(...e);ie.parse=(e,t)=>{let r=[];for(let n of[].concat(e||[]))for(let i of dc(String(n),t))r.push(nt.parse(i,t));return r};ie.braces=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");return t&&t.nobrace===!0||!/\{.*\}/.test(e)?[e]:dc(e,t)};ie.braceExpand=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");return ie.braces(e,{...t,expand:!0})};gc.exports=ie});var Ac=v(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.matchAny=k.convertPatternsToRe=k.makeRe=k.getPatternParts=k.expandBraceExpansion=k.expandPatternsWithBraceExpansion=k.isAffectDepthOfReadingPattern=k.endsWithSlashGlobStar=k.hasGlobStar=k.getBaseDirectory=k.isPatternRelatedToParentDirectory=k.getPatternsOutsideCurrentDirectory=k.getPatternsInsideCurrentDirectory=k.getPositivePatterns=k.getNegativePatterns=k.isPositivePattern=k.isNegativePattern=k.convertToNegativePattern=k.convertToPositivePattern=k.isDynamicPattern=k.isStaticPattern=void 0;var rm=require("path"),nm=ol(),Ns=_c(),pc="**",im="\\",sm=/[*?]|^!/,am=/\[[^[]*]/,om=/(?:^|[^!*+?@])\([^(]*\|[^|]*\)/,um=/[!*+?@]\([^(]*\)/,lm=/,|\.\./;function mc(e,t={}){return!vc(e,t)}k.isStaticPattern=mc;function vc(e,t={}){return e===""?!1:!!(t.caseSensitiveMatch===!1||e.includes(im)||sm.test(e)||am.test(e)||om.test(e)||t.extglob!==!1&&um.test(e)||t.braceExpansion!==!1&&cm(e))}k.isDynamicPattern=vc;function cm(e){let t=e.indexOf("{");if(t===-1)return!1;let r=e.indexOf("}",t+1);if(r===-1)return!1;let n=e.slice(t,r);return lm.test(n)}function fm(e){return Yn(e)?e.slice(1):e}k.convertToPositivePattern=fm;function hm(e){return"!"+e}k.convertToNegativePattern=hm;function Yn(e){return e.startsWith("!")&&e[1]!=="("}k.isNegativePattern=Yn;function yc(e){return!Yn(e)}k.isPositivePattern=yc;function dm(e){return e.filter(Yn)}k.getNegativePatterns=dm;function gm(e){return e.filter(yc)}k.getPositivePatterns=gm;function _m(e){return e.filter(t=>!Ps(t))}k.getPatternsInsideCurrentDirectory=_m;function pm(e){return e.filter(Ps)}k.getPatternsOutsideCurrentDirectory=pm;function Ps(e){return e.startsWith("..")||e.startsWith("./..")}k.isPatternRelatedToParentDirectory=Ps;function mm(e){return nm(e,{flipBackslashes:!1})}k.getBaseDirectory=mm;function vm(e){return e.includes(pc)}k.hasGlobStar=vm;function Ec(e){return e.endsWith("/"+pc)}k.endsWithSlashGlobStar=Ec;function ym(e){let t=rm.basename(e);return Ec(e)||mc(t)}k.isAffectDepthOfReadingPattern=ym;function Em(e){return e.reduce((t,r)=>t.concat(Sc(r)),[])}k.expandPatternsWithBraceExpansion=Em;function Sc(e){return Ns.braces(e,{expand:!0,nodupes:!0})}k.expandBraceExpansion=Sc;function Sm(e,t){let{parts:r}=Ns.scan(e,Object.assign(Object.assign({},t),{parts:!0}));return r.length===0&&(r=[e]),r[0].startsWith("/")&&(r[0]=r[0].slice(1),r.unshift("")),r}k.getPatternParts=Sm;function bc(e,t){return Ns.makeRe(e,t)}k.makeRe=bc;function bm(e,t){return e.map(r=>bc(r,t))}k.convertPatternsToRe=bm;function Am(e,t){return t.some(r=>r.test(e))}k.matchAny=Am});var Ic=v(Xn=>{"use strict";Object.defineProperty(Xn,"__esModule",{value:!0});Xn.merge=void 0;var wm=os();function Im(e){let t=wm(e);return e.forEach(r=>{r.once("error",n=>t.emit("error",n))}),t.once("close",()=>wc(e)),t.once("end",()=>wc(e)),t}Xn.merge=Im;function wc(e){e.forEach(t=>t.emit("close"))}});var Nc=v(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.isEmpty=Er.isString=void 0;function Nm(e){return typeof e=="string"}Er.isString=Nm;function Pm(e){return e===""}Er.isEmpty=Pm});var ft=v(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.string=ve.stream=ve.pattern=ve.path=ve.fs=ve.errno=ve.array=void 0;var Cm=zu();ve.array=Cm;var Tm=Zu();ve.errno=Tm;var Rm=Ju();ve.fs=Rm;var xm=el();ve.path=xm;var Om=Ac();ve.pattern=Om;var km=Ic();ve.stream=km;var Mm=Nc();ve.string=Mm});var Tc=v(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.convertPatternGroupToTask=ye.convertPatternGroupsToTasks=ye.groupPatternsByBaseDirectory=ye.getNegativePatternsAsPositive=ye.getPositivePatterns=ye.convertPatternsToTasks=ye.generate=void 0;var ht=ft();function Lm(e,t){let r=Pc(e),n=Cc(e,t.ignore),i=r.filter(u=>ht.pattern.isStaticPattern(u,t)),s=r.filter(u=>ht.pattern.isDynamicPattern(u,t)),a=Cs(i,n,!1),o=Cs(s,n,!0);return a.concat(o)}ye.generate=Lm;function Cs(e,t,r){let n=[],i=ht.pattern.getPatternsOutsideCurrentDirectory(e),s=ht.pattern.getPatternsInsideCurrentDirectory(e),a=Ts(i),o=Ts(s);return n.push(...Rs(a,t,r)),"."in o?n.push(xs(".",s,t,r)):n.push(...Rs(o,t,r)),n}ye.convertPatternsToTasks=Cs;function Pc(e){return ht.pattern.getPositivePatterns(e)}ye.getPositivePatterns=Pc;function Cc(e,t){return ht.pattern.getNegativePatterns(e).concat(t).map(ht.pattern.convertToPositivePattern)}ye.getNegativePatternsAsPositive=Cc;function Ts(e){let t={};return e.reduce((r,n)=>{let i=ht.pattern.getBaseDirectory(n);return i in r?r[i].push(n):r[i]=[n],r},t)}ye.groupPatternsByBaseDirectory=Ts;function Rs(e,t,r){return Object.keys(e).map(n=>xs(n,e[n],t,r))}ye.convertPatternGroupsToTasks=Rs;function xs(e,t,r,n){return{dynamic:n,positive:t,negative:r,base:e,patterns:[].concat(t,r.map(ht.pattern.convertToNegativePattern))}}ye.convertPatternGroupToTask=xs});var xc=v(Sr=>{"use strict";Object.defineProperty(Sr,"__esModule",{value:!0});Sr.removeDuplicateSlashes=Sr.transform=void 0;var Fm=/(?!^)\/{2,}/g;function Dm(e){return e.map(t=>Rc(t))}Sr.transform=Dm;function Rc(e){return e.replace(Fm,"/")}Sr.removeDuplicateSlashes=Rc});var kc=v(Qn=>{"use strict";Object.defineProperty(Qn,"__esModule",{value:!0});Qn.read=void 0;function $m(e,t,r){t.fs.lstat(e,(n,i)=>{if(n!==null){Oc(r,n);return}if(!i.isSymbolicLink()||!t.followSymbolicLink){Os(r,i);return}t.fs.stat(e,(s,a)=>{if(s!==null){if(t.throwErrorOnBrokenSymbolicLink){Oc(r,s);return}Os(r,i);return}t.markSymbolicLink&&(a.isSymbolicLink=()=>!0),Os(r,a)})})}Qn.read=$m;function Oc(e,t){e(t)}function Os(e,t){e(null,t)}});var Mc=v(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.read=void 0;function qm(e,t){let r=t.fs.lstatSync(e);if(!r.isSymbolicLink()||!t.followSymbolicLink)return r;try{let n=t.fs.statSync(e);return t.markSymbolicLink&&(n.isSymbolicLink=()=>!0),n}catch(n){if(!t.throwErrorOnBrokenSymbolicLink)return r;throw n}}zn.read=qm});var Lc=v(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.createFileSystemAdapter=wt.FILE_SYSTEM_ADAPTER=void 0;var Zn=require("fs");wt.FILE_SYSTEM_ADAPTER={lstat:Zn.lstat,stat:Zn.stat,lstatSync:Zn.lstatSync,statSync:Zn.statSync};function Vm(e){return e===void 0?wt.FILE_SYSTEM_ADAPTER:Object.assign(Object.assign({},wt.FILE_SYSTEM_ADAPTER),e)}wt.createFileSystemAdapter=Vm});var Fc=v(Ms=>{"use strict";Object.defineProperty(Ms,"__esModule",{value:!0});var Gm=Lc(),ks=class{constructor(t={}){this._options=t,this.followSymbolicLink=this._getValue(this._options.followSymbolicLink,!0),this.fs=Gm.createFileSystemAdapter(this._options.fs),this.markSymbolicLink=this._getValue(this._options.markSymbolicLink,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!0)}_getValue(t,r){return t??r}};Ms.default=ks});var jt=v(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.statSync=It.stat=It.Settings=void 0;var Dc=kc(),Bm=Mc(),Ls=Fc();It.Settings=Ls.default;function Hm(e,t,r){if(typeof t=="function"){Dc.read(e,Fs(),t);return}Dc.read(e,Fs(t),r)}It.stat=Hm;function Um(e,t){let r=Fs(t);return Bm.read(e,r)}It.statSync=Um;function Fs(e={}){return e instanceof Ls.default?e:new Ls.default(e)}});var Vc=v((_y,qc)=>{var $c;qc.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):e=>($c||($c=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0))});var Bc=v((py,Gc)=>{Gc.exports=Wm;var jm=Vc();function Wm(e,t){let r,n,i,s=!0;Array.isArray(e)?(r=[],n=e.length):(i=Object.keys(e),r={},n=i.length);function a(u){function l(){t&&t(u,r),t=null}s?jm(l):l()}function o(u,l,f){r[u]=f,(--n===0||l)&&a(l)}n?i?i.forEach(function(u){e[u](function(l,f){o(u,l,f)})}):e.forEach(function(u,l){u(function(f,g){o(l,f,g)})}):a(null),s=!1}});var Ds=v(ei=>{"use strict";Object.defineProperty(ei,"__esModule",{value:!0});ei.IS_SUPPORT_READDIR_WITH_FILE_TYPES=void 0;var Jn=process.versions.node.split(".");if(Jn[0]===void 0||Jn[1]===void 0)throw new Error(`Unexpected behavior. The 'process.versions.node' variable has invalid value: ${process.versions.node}`);var Hc=Number.parseInt(Jn[0],10),Km=Number.parseInt(Jn[1],10),Uc=10,Ym=10,Xm=Hc>Uc,Qm=Hc===Uc&&Km>=Ym;ei.IS_SUPPORT_READDIR_WITH_FILE_TYPES=Xm||Qm});var jc=v(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.createDirentFromStats=void 0;var $s=class{constructor(t,r){this.name=t,this.isBlockDevice=r.isBlockDevice.bind(r),this.isCharacterDevice=r.isCharacterDevice.bind(r),this.isDirectory=r.isDirectory.bind(r),this.isFIFO=r.isFIFO.bind(r),this.isFile=r.isFile.bind(r),this.isSocket=r.isSocket.bind(r),this.isSymbolicLink=r.isSymbolicLink.bind(r)}};function zm(e,t){return new $s(e,t)}ti.createDirentFromStats=zm});var qs=v(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.fs=void 0;var Zm=jc();ri.fs=Zm});var Vs=v(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.joinPathSegments=void 0;function Jm(e,t,r){return e.endsWith(r)?e+t:e+r+t}ni.joinPathSegments=Jm});var zc=v(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.readdir=Nt.readdirWithFileTypes=Nt.read=void 0;var e0=jt(),Wc=Bc(),t0=Ds(),Kc=qs(),Yc=Vs();function r0(e,t,r){if(!t.stats&&t0.IS_SUPPORT_READDIR_WITH_FILE_TYPES){Xc(e,t,r);return}Qc(e,t,r)}Nt.read=r0;function Xc(e,t,r){t.fs.readdir(e,{withFileTypes:!0},(n,i)=>{if(n!==null){ii(r,n);return}let s=i.map(o=>({dirent:o,name:o.name,path:Yc.joinPathSegments(e,o.name,t.pathSegmentSeparator)}));if(!t.followSymbolicLinks){Gs(r,s);return}let a=s.map(o=>n0(o,t));Wc(a,(o,u)=>{if(o!==null){ii(r,o);return}Gs(r,u)})})}Nt.readdirWithFileTypes=Xc;function n0(e,t){return r=>{if(!e.dirent.isSymbolicLink()){r(null,e);return}t.fs.stat(e.path,(n,i)=>{if(n!==null){if(t.throwErrorOnBrokenSymbolicLink){r(n);return}r(null,e);return}e.dirent=Kc.fs.createDirentFromStats(e.name,i),r(null,e)})}}function Qc(e,t,r){t.fs.readdir(e,(n,i)=>{if(n!==null){ii(r,n);return}let s=i.map(a=>{let o=Yc.joinPathSegments(e,a,t.pathSegmentSeparator);return u=>{e0.stat(o,t.fsStatSettings,(l,f)=>{if(l!==null){u(l);return}let g={name:a,path:o,dirent:Kc.fs.createDirentFromStats(a,f)};t.stats&&(g.stats=f),u(null,g)})}});Wc(s,(a,o)=>{if(a!==null){ii(r,a);return}Gs(r,o)})})}Nt.readdir=Qc;function ii(e,t){e(t)}function Gs(e,t){e(null,t)}});var rf=v(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.readdir=Pt.readdirWithFileTypes=Pt.read=void 0;var i0=jt(),s0=Ds(),Zc=qs(),Jc=Vs();function a0(e,t){return!t.stats&&s0.IS_SUPPORT_READDIR_WITH_FILE_TYPES?ef(e,t):tf(e,t)}Pt.read=a0;function ef(e,t){return t.fs.readdirSync(e,{withFileTypes:!0}).map(n=>{let i={dirent:n,name:n.name,path:Jc.joinPathSegments(e,n.name,t.pathSegmentSeparator)};if(i.dirent.isSymbolicLink()&&t.followSymbolicLinks)try{let s=t.fs.statSync(i.path);i.dirent=Zc.fs.createDirentFromStats(i.name,s)}catch(s){if(t.throwErrorOnBrokenSymbolicLink)throw s}return i})}Pt.readdirWithFileTypes=ef;function tf(e,t){return t.fs.readdirSync(e).map(n=>{let i=Jc.joinPathSegments(e,n,t.pathSegmentSeparator),s=i0.statSync(i,t.fsStatSettings),a={name:n,path:i,dirent:Zc.fs.createDirentFromStats(n,s)};return t.stats&&(a.stats=s),a})}Pt.readdir=tf});var nf=v(Ct=>{"use strict";Object.defineProperty(Ct,"__esModule",{value:!0});Ct.createFileSystemAdapter=Ct.FILE_SYSTEM_ADAPTER=void 0;var br=require("fs");Ct.FILE_SYSTEM_ADAPTER={lstat:br.lstat,stat:br.stat,lstatSync:br.lstatSync,statSync:br.statSync,readdir:br.readdir,readdirSync:br.readdirSync};function o0(e){return e===void 0?Ct.FILE_SYSTEM_ADAPTER:Object.assign(Object.assign({},Ct.FILE_SYSTEM_ADAPTER),e)}Ct.createFileSystemAdapter=o0});var sf=v(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});var u0=require("path"),l0=jt(),c0=nf(),Bs=class{constructor(t={}){this._options=t,this.followSymbolicLinks=this._getValue(this._options.followSymbolicLinks,!1),this.fs=c0.createFileSystemAdapter(this._options.fs),this.pathSegmentSeparator=this._getValue(this._options.pathSegmentSeparator,u0.sep),this.stats=this._getValue(this._options.stats,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!0),this.fsStatSettings=new l0.Settings({followSymbolicLink:this.followSymbolicLinks,fs:this.fs,throwErrorOnBrokenSymbolicLink:this.throwErrorOnBrokenSymbolicLink})}_getValue(t,r){return t??r}};Hs.default=Bs});var si=v(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.Settings=Tt.scandirSync=Tt.scandir=void 0;var af=zc(),f0=rf(),Us=sf();Tt.Settings=Us.default;function h0(e,t,r){if(typeof t=="function"){af.read(e,js(),t);return}af.read(e,js(t),r)}Tt.scandir=h0;function d0(e,t){let r=js(t);return f0.read(e,r)}Tt.scandirSync=d0;function js(e={}){return e instanceof Us.default?e:new Us.default(e)}});var uf=v((Ny,of)=>{"use strict";function g0(e){var t=new e,r=t;function n(){var s=t;return s.next?t=s.next:(t=new e,r=t),s.next=null,s}function i(s){r.next=s,r=s}return{get:n,release:i}}of.exports=g0});var cf=v((Py,Ws)=>{"use strict";var _0=uf();function lf(e,t,r){if(typeof e=="function"&&(r=t,t=e,e=null),r<1)throw new Error("fastqueue concurrency must be greater than 1");var n=_0(p0),i=null,s=null,a=0,o=null,u={push:b,drain:Ge,saturated:Ge,pause:f,paused:!1,concurrency:r,running:l,resume:m,idle:_,length:g,getQueue:h,unshift:P,empty:Ge,kill:B,killAndDrain:V,error:se};return u;function l(){return a}function f(){u.paused=!0}function g(){for(var x=i,K=0;x;)x=x.next,K++;return K}function h(){for(var x=i,K=[];x;)K.push(x.value),x=x.next;return K}function m(){if(!!u.paused){u.paused=!1;for(var x=0;x<u.concurrency;x++)a++,C()}}function _(){return a===0&&u.length()===0}function b(x,K){var F=n.get();F.context=e,F.release=C,F.value=x,F.callback=K||Ge,F.errorHandler=o,a===u.concurrency||u.paused?s?(s.next=F,s=F):(i=F,s=F,u.saturated()):(a++,t.call(e,F.value,F.worked))}function P(x,K){var F=n.get();F.context=e,F.release=C,F.value=x,F.callback=K||Ge,a===u.concurrency||u.paused?i?(F.next=i,i=F):(i=F,s=F,u.saturated()):(a++,t.call(e,F.value,F.worked))}function C(x){x&&n.release(x);var K=i;K?u.paused?a--:(s===i&&(s=null),i=K.next,K.next=null,t.call(e,K.value,K.worked),s===null&&u.empty()):--a===0&&u.drain()}function B(){i=null,s=null,u.drain=Ge}function V(){i=null,s=null,u.drain(),u.drain=Ge}function se(x){o=x}}function Ge(){}function p0(){this.value=null,this.callback=Ge,this.next=null,this.release=Ge,this.context=null,this.errorHandler=null;var e=this;this.worked=function(r,n){var i=e.callback,s=e.errorHandler,a=e.value;e.value=null,e.callback=Ge,e.errorHandler&&s(r,a),i.call(e.context,r,n),e.release(e)}}function m0(e,t,r){typeof e=="function"&&(r=t,t=e,e=null);function n(f,g){t.call(this,f).then(function(h){g(null,h)},g)}var i=lf(e,n,r),s=i.push,a=i.unshift;return i.push=o,i.unshift=u,i.drained=l,i;function o(f){var g=new Promise(function(h,m){s(f,function(_,b){if(_){m(_);return}h(b)})});return g.catch(Ge),g}function u(f){var g=new Promise(function(h,m){a(f,function(_,b){if(_){m(_);return}h(b)})});return g.catch(Ge),g}function l(){var f=i.drain,g=new Promise(function(h){i.drain=function(){f(),h()}});return g}}Ws.exports=lf;Ws.exports.promise=m0});var ai=v(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.joinPathSegments=it.replacePathSegmentSeparator=it.isAppliedFilter=it.isFatalError=void 0;function v0(e,t){return e.errorFilter===null?!0:!e.errorFilter(t)}it.isFatalError=v0;function y0(e,t){return e===null||e(t)}it.isAppliedFilter=y0;function E0(e,t){return e.split(/[/\\]/).join(t)}it.replacePathSegmentSeparator=E0;function S0(e,t,r){return e===""?t:e.endsWith(r)?e+t:e+r+t}it.joinPathSegments=S0});var Xs=v(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});var b0=ai(),Ks=class{constructor(t,r){this._root=t,this._settings=r,this._root=b0.replacePathSegmentSeparator(t,r.pathSegmentSeparator)}};Ys.default=Ks});var Zs=v(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});var A0=require("events"),w0=si(),I0=cf(),oi=ai(),N0=Xs(),Qs=class extends N0.default{constructor(t,r){super(t,r),this._settings=r,this._scandir=w0.scandir,this._emitter=new A0.EventEmitter,this._queue=I0(this._worker.bind(this),this._settings.concurrency),this._isFatalError=!1,this._isDestroyed=!1,this._queue.drain=()=>{this._isFatalError||this._emitter.emit("end")}}read(){return this._isFatalError=!1,this._isDestroyed=!1,setImmediate(()=>{this._pushToQueue(this._root,this._settings.basePath)}),this._emitter}get isDestroyed(){return this._isDestroyed}destroy(){if(this._isDestroyed)throw new Error("The reader is already destroyed");this._isDestroyed=!0,this._queue.killAndDrain()}onEntry(t){this._emitter.on("entry",t)}onError(t){this._emitter.once("error",t)}onEnd(t){this._emitter.once("end",t)}_pushToQueue(t,r){let n={directory:t,base:r};this._queue.push(n,i=>{i!==null&&this._handleError(i)})}_worker(t,r){this._scandir(t.directory,this._settings.fsScandirSettings,(n,i)=>{if(n!==null){r(n,void 0);return}for(let s of i)this._handleEntry(s,t.base);r(null,void 0)})}_handleError(t){this._isDestroyed||!oi.isFatalError(this._settings,t)||(this._isFatalError=!0,this._isDestroyed=!0,this._emitter.emit("error",t))}_handleEntry(t,r){if(this._isDestroyed||this._isFatalError)return;let n=t.path;r!==void 0&&(t.path=oi.joinPathSegments(r,t.name,this._settings.pathSegmentSeparator)),oi.isAppliedFilter(this._settings.entryFilter,t)&&this._emitEntry(t),t.dirent.isDirectory()&&oi.isAppliedFilter(this._settings.deepFilter,t)&&this._pushToQueue(n,r===void 0?void 0:t.path)}_emitEntry(t){this._emitter.emit("entry",t)}};zs.default=Qs});var ff=v(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});var P0=Zs(),Js=class{constructor(t,r){this._root=t,this._settings=r,this._reader=new P0.default(this._root,this._settings),this._storage=[]}read(t){this._reader.onError(r=>{C0(t,r)}),this._reader.onEntry(r=>{this._storage.push(r)}),this._reader.onEnd(()=>{T0(t,this._storage)}),this._reader.read()}};ea.default=Js;function C0(e,t){e(t)}function T0(e,t){e(null,t)}});var hf=v(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});var R0=require("stream"),x0=Zs(),ta=class{constructor(t,r){this._root=t,this._settings=r,this._reader=new x0.default(this._root,this._settings),this._stream=new R0.Readable({objectMode:!0,read:()=>{},destroy:()=>{this._reader.isDestroyed||this._reader.destroy()}})}read(){return this._reader.onError(t=>{this._stream.emit("error",t)}),this._reader.onEntry(t=>{this._stream.push(t)}),this._reader.onEnd(()=>{this._stream.push(null)}),this._reader.read(),this._stream}};ra.default=ta});var df=v(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});var O0=si(),ui=ai(),k0=Xs(),na=class extends k0.default{constructor(){super(...arguments),this._scandir=O0.scandirSync,this._storage=[],this._queue=new Set}read(){return this._pushToQueue(this._root,this._settings.basePath),this._handleQueue(),this._storage}_pushToQueue(t,r){this._queue.add({directory:t,base:r})}_handleQueue(){for(let t of this._queue.values())this._handleDirectory(t.directory,t.base)}_handleDirectory(t,r){try{let n=this._scandir(t,this._settings.fsScandirSettings);for(let i of n)this._handleEntry(i,r)}catch(n){this._handleError(n)}}_handleError(t){if(!!ui.isFatalError(this._settings,t))throw t}_handleEntry(t,r){let n=t.path;r!==void 0&&(t.path=ui.joinPathSegments(r,t.name,this._settings.pathSegmentSeparator)),ui.isAppliedFilter(this._settings.entryFilter,t)&&this._pushToStorage(t),t.dirent.isDirectory()&&ui.isAppliedFilter(this._settings.deepFilter,t)&&this._pushToQueue(n,r===void 0?void 0:t.path)}_pushToStorage(t){this._storage.push(t)}};ia.default=na});var gf=v(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});var M0=df(),sa=class{constructor(t,r){this._root=t,this._settings=r,this._reader=new M0.default(this._root,this._settings)}read(){return this._reader.read()}};aa.default=sa});var _f=v(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});var L0=require("path"),F0=si(),oa=class{constructor(t={}){this._options=t,this.basePath=this._getValue(this._options.basePath,void 0),this.concurrency=this._getValue(this._options.concurrency,Number.POSITIVE_INFINITY),this.deepFilter=this._getValue(this._options.deepFilter,null),this.entryFilter=this._getValue(this._options.entryFilter,null),this.errorFilter=this._getValue(this._options.errorFilter,null),this.pathSegmentSeparator=this._getValue(this._options.pathSegmentSeparator,L0.sep),this.fsScandirSettings=new F0.Settings({followSymbolicLinks:this._options.followSymbolicLinks,fs:this._options.fs,pathSegmentSeparator:this._options.pathSegmentSeparator,stats:this._options.stats,throwErrorOnBrokenSymbolicLink:this._options.throwErrorOnBrokenSymbolicLink})}_getValue(t,r){return t??r}};ua.default=oa});var ci=v(st=>{"use strict";Object.defineProperty(st,"__esModule",{value:!0});st.Settings=st.walkStream=st.walkSync=st.walk=void 0;var pf=ff(),D0=hf(),$0=gf(),la=_f();st.Settings=la.default;function q0(e,t,r){if(typeof t=="function"){new pf.default(e,li()).read(t);return}new pf.default(e,li(t)).read(r)}st.walk=q0;function V0(e,t){let r=li(t);return new $0.default(e,r).read()}st.walkSync=V0;function G0(e,t){let r=li(t);return new D0.default(e,r).read()}st.walkStream=G0;function li(e={}){return e instanceof la.default?e:new la.default(e)}});var fi=v(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});var B0=require("path"),H0=jt(),mf=ft(),ca=class{constructor(t){this._settings=t,this._fsStatSettings=new H0.Settings({followSymbolicLink:this._settings.followSymbolicLinks,fs:this._settings.fs,throwErrorOnBrokenSymbolicLink:this._settings.followSymbolicLinks})}_getFullEntryPath(t){return B0.resolve(this._settings.cwd,t)}_makeEntry(t,r){let n={name:r,path:r,dirent:mf.fs.createDirentFromStats(r,t)};return this._settings.stats&&(n.stats=t),n}_isFatalError(t){return!mf.errno.isEnoentCodeError(t)&&!this._settings.suppressErrors}};fa.default=ca});var ga=v(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});var U0=require("stream"),j0=jt(),W0=ci(),K0=fi(),ha=class extends K0.default{constructor(){super(...arguments),this._walkStream=W0.walkStream,this._stat=j0.stat}dynamic(t,r){return this._walkStream(t,r)}static(t,r){let n=t.map(this._getFullEntryPath,this),i=new U0.PassThrough({objectMode:!0});i._write=(s,a,o)=>this._getEntry(n[s],t[s],r).then(u=>{u!==null&&r.entryFilter(u)&&i.push(u),s===n.length-1&&i.end(),o()}).catch(o);for(let s=0;s<n.length;s++)i.write(s);return i}_getEntry(t,r,n){return this._getStat(t).then(i=>this._makeEntry(i,r)).catch(i=>{if(n.errorFilter(i))return null;throw i})}_getStat(t){return new Promise((r,n)=>{this._stat(t,this._fsStatSettings,(i,s)=>i===null?r(s):n(i))})}};da.default=ha});var vf=v(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});var Y0=ci(),X0=fi(),Q0=ga(),_a=class extends X0.default{constructor(){super(...arguments),this._walkAsync=Y0.walk,this._readerStream=new Q0.default(this._settings)}dynamic(t,r){return new Promise((n,i)=>{this._walkAsync(t,r,(s,a)=>{s===null?n(a):i(s)})})}async static(t,r){let n=[],i=this._readerStream.static(t,r);return new Promise((s,a)=>{i.once("error",a),i.on("data",o=>n.push(o)),i.once("end",()=>s(n))})}};pa.default=_a});var yf=v(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});var Ar=ft(),ma=class{constructor(t,r,n){this._patterns=t,this._settings=r,this._micromatchOptions=n,this._storage=[],this._fillStorage()}_fillStorage(){let t=Ar.pattern.expandPatternsWithBraceExpansion(this._patterns);for(let r of t){let n=this._getPatternSegments(r),i=this._splitSegmentsIntoSections(n);this._storage.push({complete:i.length<=1,pattern:r,segments:n,sections:i})}}_getPatternSegments(t){return Ar.pattern.getPatternParts(t,this._micromatchOptions).map(n=>Ar.pattern.isDynamicPattern(n,this._settings)?{dynamic:!0,pattern:n,patternRe:Ar.pattern.makeRe(n,this._micromatchOptions)}:{dynamic:!1,pattern:n})}_splitSegmentsIntoSections(t){return Ar.array.splitWhen(t,r=>r.dynamic&&Ar.pattern.hasGlobStar(r.pattern))}};va.default=ma});var Ef=v(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});var z0=yf(),ya=class extends z0.default{match(t){let r=t.split("/"),n=r.length,i=this._storage.filter(s=>!s.complete||s.segments.length>n);for(let s of i){let a=s.sections[0];if(!s.complete&&n>a.length||r.every((u,l)=>{let f=s.segments[l];return!!(f.dynamic&&f.patternRe.test(u)||!f.dynamic&&f.pattern===u)}))return!0}return!1}};Ea.default=ya});var Sf=v(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});var hi=ft(),Z0=Ef(),Sa=class{constructor(t,r){this._settings=t,this._micromatchOptions=r}getFilter(t,r,n){let i=this._getMatcher(r),s=this._getNegativePatternsRe(n);return a=>this._filter(t,a,i,s)}_getMatcher(t){return new Z0.default(t,this._settings,this._micromatchOptions)}_getNegativePatternsRe(t){let r=t.filter(hi.pattern.isAffectDepthOfReadingPattern);return hi.pattern.convertPatternsToRe(r,this._micromatchOptions)}_filter(t,r,n,i){if(this._isSkippedByDeep(t,r.path)||this._isSkippedSymbolicLink(r))return!1;let s=hi.path.removeLeadingDotSegment(r.path);return this._isSkippedByPositivePatterns(s,n)?!1:this._isSkippedByNegativePatterns(s,i)}_isSkippedByDeep(t,r){return this._settings.deep===1/0?!1:this._getEntryLevel(t,r)>=this._settings.deep}_getEntryLevel(t,r){let n=r.split("/").length;if(t==="")return n;let i=t.split("/").length;return n-i}_isSkippedSymbolicLink(t){return!this._settings.followSymbolicLinks&&t.dirent.isSymbolicLink()}_isSkippedByPositivePatterns(t,r){return!this._settings.baseNameMatch&&!r.match(t)}_isSkippedByNegativePatterns(t,r){return!hi.pattern.matchAny(t,r)}};ba.default=Sa});var bf=v(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});var Wt=ft(),Aa=class{constructor(t,r){this._settings=t,this._micromatchOptions=r,this.index=new Map}getFilter(t,r){let n=Wt.pattern.convertPatternsToRe(t,this._micromatchOptions),i=Wt.pattern.convertPatternsToRe(r,this._micromatchOptions);return s=>this._filter(s,n,i)}_filter(t,r,n){if(this._settings.unique&&this._isDuplicateEntry(t)||this._onlyFileFilter(t)||this._onlyDirectoryFilter(t)||this._isSkippedByAbsoluteNegativePatterns(t.path,n))return!1;let i=this._settings.baseNameMatch?t.name:t.path,s=t.dirent.isDirectory(),a=this._isMatchToPatterns(i,r,s)&&!this._isMatchToPatterns(t.path,n,s);return this._settings.unique&&a&&this._createIndexRecord(t),a}_isDuplicateEntry(t){return this.index.has(t.path)}_createIndexRecord(t){this.index.set(t.path,void 0)}_onlyFileFilter(t){return this._settings.onlyFiles&&!t.dirent.isFile()}_onlyDirectoryFilter(t){return this._settings.onlyDirectories&&!t.dirent.isDirectory()}_isSkippedByAbsoluteNegativePatterns(t,r){if(!this._settings.absolute)return!1;let n=Wt.path.makeAbsolute(this._settings.cwd,t);return Wt.pattern.matchAny(n,r)}_isMatchToPatterns(t,r,n){let i=Wt.path.removeLeadingDotSegment(t),s=Wt.pattern.matchAny(i,r);return!s&&n?Wt.pattern.matchAny(i+"/",r):s}};wa.default=Aa});var Af=v(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});var J0=ft(),Ia=class{constructor(t){this._settings=t}getFilter(){return t=>this._isNonFatalError(t)}_isNonFatalError(t){return J0.errno.isEnoentCodeError(t)||this._settings.suppressErrors}};Na.default=Ia});var If=v(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});var wf=ft(),Pa=class{constructor(t){this._settings=t}getTransformer(){return t=>this._transform(t)}_transform(t){let r=t.path;return this._settings.absolute&&(r=wf.path.makeAbsolute(this._settings.cwd,r),r=wf.path.unixify(r)),this._settings.markDirectories&&t.dirent.isDirectory()&&(r+="/"),this._settings.objectMode?Object.assign(Object.assign({},t),{path:r}):r}};Ca.default=Pa});var di=v(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});var e1=require("path"),t1=Sf(),r1=bf(),n1=Af(),i1=If(),Ta=class{constructor(t){this._settings=t,this.errorFilter=new n1.default(this._settings),this.entryFilter=new r1.default(this._settings,this._getMicromatchOptions()),this.deepFilter=new t1.default(this._settings,this._getMicromatchOptions()),this.entryTransformer=new i1.default(this._settings)}_getRootDirectory(t){return e1.resolve(this._settings.cwd,t.base)}_getReaderOptions(t){let r=t.base==="."?"":t.base;return{basePath:r,pathSegmentSeparator:"/",concurrency:this._settings.concurrency,deepFilter:this.deepFilter.getFilter(r,t.positive,t.negative),entryFilter:this.entryFilter.getFilter(t.positive,t.negative),errorFilter:this.errorFilter.getFilter(),followSymbolicLinks:this._settings.followSymbolicLinks,fs:this._settings.fs,stats:this._settings.stats,throwErrorOnBrokenSymbolicLink:this._settings.throwErrorOnBrokenSymbolicLink,transform:this.entryTransformer.getTransformer()}}_getMicromatchOptions(){return{dot:this._settings.dot,matchBase:this._settings.baseNameMatch,nobrace:!this._settings.braceExpansion,nocase:!this._settings.caseSensitiveMatch,noext:!this._settings.extglob,noglobstar:!this._settings.globstar,posix:!0,strictSlashes:!1}}};Ra.default=Ta});var Nf=v(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});var s1=vf(),a1=di(),xa=class extends a1.default{constructor(){super(...arguments),this._reader=new s1.default(this._settings)}async read(t){let r=this._getRootDirectory(t),n=this._getReaderOptions(t);return(await this.api(r,t,n)).map(s=>n.transform(s))}api(t,r,n){return r.dynamic?this._reader.dynamic(t,n):this._reader.static(r.patterns,n)}};Oa.default=xa});var Pf=v(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var o1=require("stream"),u1=ga(),l1=di(),ka=class extends l1.default{constructor(){super(...arguments),this._reader=new u1.default(this._settings)}read(t){let r=this._getRootDirectory(t),n=this._getReaderOptions(t),i=this.api(r,t,n),s=new o1.Readable({objectMode:!0,read:()=>{}});return i.once("error",a=>s.emit("error",a)).on("data",a=>s.emit("data",n.transform(a))).once("end",()=>s.emit("end")),s.once("close",()=>i.destroy()),s}api(t,r,n){return r.dynamic?this._reader.dynamic(t,n):this._reader.static(r.patterns,n)}};Ma.default=ka});var Cf=v(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});var c1=jt(),f1=ci(),h1=fi(),La=class extends h1.default{constructor(){super(...arguments),this._walkSync=f1.walkSync,this._statSync=c1.statSync}dynamic(t,r){return this._walkSync(t,r)}static(t,r){let n=[];for(let i of t){let s=this._getFullEntryPath(i),a=this._getEntry(s,i,r);a===null||!r.entryFilter(a)||n.push(a)}return n}_getEntry(t,r,n){try{let i=this._getStat(t);return this._makeEntry(i,r)}catch(i){if(n.errorFilter(i))return null;throw i}}_getStat(t){return this._statSync(t,this._fsStatSettings)}};Fa.default=La});var Tf=v($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});var d1=Cf(),g1=di(),Da=class extends g1.default{constructor(){super(...arguments),this._reader=new d1.default(this._settings)}read(t){let r=this._getRootDirectory(t),n=this._getReaderOptions(t);return this.api(r,t,n).map(n.transform)}api(t,r,n){return r.dynamic?this._reader.dynamic(t,n):this._reader.static(r.patterns,n)}};$a.default=Da});var Rf=v(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});Ir.DEFAULT_FILE_SYSTEM_ADAPTER=void 0;var wr=require("fs"),_1=require("os"),p1=Math.max(_1.cpus().length,1);Ir.DEFAULT_FILE_SYSTEM_ADAPTER={lstat:wr.lstat,lstatSync:wr.lstatSync,stat:wr.stat,statSync:wr.statSync,readdir:wr.readdir,readdirSync:wr.readdirSync};var qa=class{constructor(t={}){this._options=t,this.absolute=this._getValue(this._options.absolute,!1),this.baseNameMatch=this._getValue(this._options.baseNameMatch,!1),this.braceExpansion=this._getValue(this._options.braceExpansion,!0),this.caseSensitiveMatch=this._getValue(this._options.caseSensitiveMatch,!0),this.concurrency=this._getValue(this._options.concurrency,p1),this.cwd=this._getValue(this._options.cwd,process.cwd()),this.deep=this._getValue(this._options.deep,1/0),this.dot=this._getValue(this._options.dot,!1),this.extglob=this._getValue(this._options.extglob,!0),this.followSymbolicLinks=this._getValue(this._options.followSymbolicLinks,!0),this.fs=this._getFileSystemMethods(this._options.fs),this.globstar=this._getValue(this._options.globstar,!0),this.ignore=this._getValue(this._options.ignore,[]),this.markDirectories=this._getValue(this._options.markDirectories,!1),this.objectMode=this._getValue(this._options.objectMode,!1),this.onlyDirectories=this._getValue(this._options.onlyDirectories,!1),this.onlyFiles=this._getValue(this._options.onlyFiles,!0),this.stats=this._getValue(this._options.stats,!1),this.suppressErrors=this._getValue(this._options.suppressErrors,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!1),this.unique=this._getValue(this._options.unique,!0),this.onlyDirectories&&(this.onlyFiles=!1),this.stats&&(this.objectMode=!0)}_getValue(t,r){return t===void 0?r:t}_getFileSystemMethods(t={}){return Object.assign(Object.assign({},Ir.DEFAULT_FILE_SYSTEM_ADAPTER),t)}};Ir.default=qa});var Ha=v((Zy,kf)=>{"use strict";var xf=Tc(),Of=xc(),m1=Nf(),v1=Pf(),y1=Tf(),Va=Rf(),Kt=ft();async function Ga(e,t){Nr(e);let r=Ba(e,m1.default,t),n=await Promise.all(r);return Kt.array.flatten(n)}(function(e){function t(a,o){Nr(a);let u=Ba(a,y1.default,o);return Kt.array.flatten(u)}e.sync=t;function r(a,o){Nr(a);let u=Ba(a,v1.default,o);return Kt.stream.merge(u)}e.stream=r;function n(a,o){Nr(a);let u=Of.transform([].concat(a)),l=new Va.default(o);return xf.generate(u,l)}e.generateTasks=n;function i(a,o){Nr(a);let u=new Va.default(o);return Kt.pattern.isDynamicPattern(a,u)}e.isDynamicPattern=i;function s(a){return Nr(a),Kt.path.escape(a)}e.escapePath=s})(Ga||(Ga={}));function Ba(e,t,r){let n=Of.transform([].concat(e)),i=new Va.default(r),s=xf.generate(n,i),a=new t(i);return s.map(a.read,a)}function Nr(e){if(![].concat(e).every(n=>Kt.string.isString(n)&&!Kt.string.isEmpty(n)))throw new TypeError("Patterns must be a string (non empty) or an array of strings")}kf.exports=Ga});var Lf=v(Yt=>{"use strict";var{promisify:E1}=require("util"),Mf=require("fs");async function Ua(e,t,r){if(typeof r!="string")throw new TypeError(`Expected a string, got ${typeof r}`);try{return(await E1(Mf[e])(r))[t]()}catch(n){if(n.code==="ENOENT")return!1;throw n}}function ja(e,t,r){if(typeof r!="string")throw new TypeError(`Expected a string, got ${typeof r}`);try{return Mf[e](r)[t]()}catch(n){if(n.code==="ENOENT")return!1;throw n}}Yt.isFile=Ua.bind(null,"stat","isFile");Yt.isDirectory=Ua.bind(null,"stat","isDirectory");Yt.isSymlink=Ua.bind(null,"lstat","isSymbolicLink");Yt.isFileSync=ja.bind(null,"statSync","isFile");Yt.isDirectorySync=ja.bind(null,"statSync","isDirectory");Yt.isSymlinkSync=ja.bind(null,"lstatSync","isSymbolicLink")});var Vf=v((eE,Wa)=>{"use strict";var Xt=require("path"),Ff=Lf(),Df=e=>e.length>1?`{${e.join(",")}}`:e[0],$f=(e,t)=>{let r=e[0]==="!"?e.slice(1):e;return Xt.isAbsolute(r)?r:Xt.join(t,r)},S1=(e,t)=>Xt.extname(e)?`**/${e}`:`**/${e}.${Df(t)}`,qf=(e,t)=>{if(t.files&&!Array.isArray(t.files))throw new TypeError(`Expected \`files\` to be of type \`Array\` but received type \`${typeof t.files}\``);if(t.extensions&&!Array.isArray(t.extensions))throw new TypeError(`Expected \`extensions\` to be of type \`Array\` but received type \`${typeof t.extensions}\``);return t.files&&t.extensions?t.files.map(r=>Xt.posix.join(e,S1(r,t.extensions))):t.files?t.files.map(r=>Xt.posix.join(e,`**/${r}`)):t.extensions?[Xt.posix.join(e,`**/*.${Df(t.extensions)}`)]:[Xt.posix.join(e,"**")]};Wa.exports=async(e,t)=>{if(t={cwd:process.cwd(),...t},typeof t.cwd!="string")throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof t.cwd}\``);let r=await Promise.all([].concat(e).map(async n=>await Ff.isDirectory($f(n,t.cwd))?qf(n,t):n));return[].concat.apply([],r)};Wa.exports.sync=(e,t)=>{if(t={cwd:process.cwd(),...t},typeof t.cwd!="string")throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof t.cwd}\``);let r=[].concat(e).map(n=>Ff.isDirectorySync($f(n,t.cwd))?qf(n,t):n);return[].concat.apply([],r)}});var Xf=v((tE,Yf)=>{function Gf(e){return Array.isArray(e)?e:[e]}var jf="",Bf=" ",Ka="\\",b1=/^\s+$/,A1=/^\\!/,w1=/^\\#/,I1=/\r?\n/g,N1=/^\.*\/|^\.+$/,Ya="/",Hf=typeof Symbol<"u"?Symbol.for("node-ignore"):"node-ignore",P1=(e,t,r)=>Object.defineProperty(e,t,{value:r}),C1=/([0-z])-([0-z])/g,Wf=()=>!1,T1=e=>e.replace(C1,(t,r,n)=>r.charCodeAt(0)<=n.charCodeAt(0)?t:jf),R1=e=>{let{length:t}=e;return e.slice(0,t-t%2)},x1=[[/\\?\s+$/,e=>e.indexOf("\\")===0?Bf:jf],[/\\\s/g,()=>Bf],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,r)=>t+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)\\\*(?=.+)/g,(e,t)=>`${t}[^\\/]*`],[/\\\\\\(?=[$.|*+(){^])/g,()=>Ka],[/\\\\/g,()=>Ka],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,r,n,i)=>t===Ka?`\\[${r}${R1(n)}${i}`:i==="]"&&n.length%2===0?`[${T1(r)}${n}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(e,t)=>`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`]],Uf=Object.create(null),O1=(e,t)=>{let r=Uf[e];return r||(r=x1.reduce((n,i)=>n.replace(i[0],i[1].bind(e)),e),Uf[e]=r),t?new RegExp(r,"i"):new RegExp(r)},za=e=>typeof e=="string",k1=e=>e&&za(e)&&!b1.test(e)&&e.indexOf("#")!==0,M1=e=>e.split(I1),Xa=class{constructor(t,r,n,i){this.origin=t,this.pattern=r,this.negative=n,this.regex=i}},L1=(e,t)=>{let r=e,n=!1;e.indexOf("!")===0&&(n=!0,e=e.substr(1)),e=e.replace(A1,"!").replace(w1,"#");let i=O1(e,t);return new Xa(r,e,n,i)},F1=(e,t)=>{throw new t(e)},dt=(e,t,r)=>za(e)?e?dt.isNotRelative(e)?r(`path should be a \`path.relative()\`d string, but got "${t}"`,RangeError):!0:r("path must not be empty",TypeError):r(`path must be a string, but got \`${t}\``,TypeError),Kf=e=>N1.test(e);dt.isNotRelative=Kf;dt.convert=e=>e;var Qa=class{constructor({ignorecase:t=!0,ignoreCase:r=t,allowRelativePaths:n=!1}={}){P1(this,Hf,!0),this._rules=[],this._ignoreCase=r,this._allowRelativePaths=n,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(t){if(t&&t[Hf]){this._rules=this._rules.concat(t._rules),this._added=!0;return}if(k1(t)){let r=L1(t,this._ignoreCase);this._added=!0,this._rules.push(r)}}add(t){return this._added=!1,Gf(za(t)?M1(t):t).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(t){return this.add(t)}_testOne(t,r){let n=!1,i=!1;return this._rules.forEach(s=>{let{negative:a}=s;if(i===a&&n!==i||a&&!n&&!i&&!r)return;s.regex.test(t)&&(n=!a,i=a)}),{ignored:n,unignored:i}}_test(t,r,n,i){let s=t&&dt.convert(t);return dt(s,t,this._allowRelativePaths?Wf:F1),this._t(s,r,n,i)}_t(t,r,n,i){if(t in r)return r[t];if(i||(i=t.split(Ya)),i.pop(),!i.length)return r[t]=this._testOne(t,n);let s=this._t(i.join(Ya)+Ya,r,n,i);return r[t]=s.ignored?s:this._testOne(t,n)}ignores(t){return this._test(t,this._ignoreCache,!1).ignored}createFilter(){return t=>!this.ignores(t)}filter(t){return Gf(t).filter(this.createFilter())}test(t){return this._test(t,this._testCache,!0)}},gi=e=>new Qa(e),D1=e=>dt(e&&dt.convert(e),e,Wf);gi.isPathValid=D1;gi.default=gi;Yf.exports=gi;if(typeof process<"u"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let e=r=>/^\\\\\?\\/.test(r)||/["<>|\u0000-\u001F]+/u.test(r)?r:r.replace(/\\/g,"/");dt.convert=e;let t=/^[a-z]:\//i;dt.isNotRelative=r=>t.test(r)||Kf(r)}});function Pr(e){let t=/^\\\\\?\\/.test(e),r=/[^\u0000-\u0080]+/.test(e);return t||r?e:e.replace(/\\/g,"/")}var Qf=en(()=>{});var zf,Zf,Xr,_i,pi,Za=en(()=>{zf=require("url"),Zf=require("stream"),Xr=e=>e instanceof URL?(0,zf.fileURLToPath)(e):e,_i=class extends Zf.Transform{constructor(t){super({objectMode:!0,transform(r,n,i){i(void 0,t(r)?r:void 0)}})}},pi=e=>e[0]==="!"});var Jf,Ja,Qt,eo,eh,th,mi,$1,q1,V1,rh,nh,to,ro,ih,sh,no=en(()=>{Jf=Ne(require("process"),1),Ja=Ne(require("fs"),1),Qt=Ne(require("path"),1),eo=Ne(Ha(),1),eh=Ne(Xf(),1);Qf();Za();th={ignore:["**/node_modules","**/flow-typed","**/coverage","**/.git"],absolute:!0,dot:!0},mi="**/.gitignore",$1=(e,t)=>pi(e)?"!"+Qt.default.posix.join(t,e.slice(1)):Qt.default.posix.join(t,e),q1=(e,t)=>{let r=Pr(Qt.default.relative(t,Qt.default.dirname(e.filePath)));return e.content.split(/\r?\n/).filter(n=>n&&!n.startsWith("#")).map(n=>$1(n,r))},V1=(e,t)=>{if(t=Pr(t),Qt.default.isAbsolute(e)){if(Pr(e).startsWith(t))return Qt.default.relative(t,e);throw new Error(`Path ${e} is not in cwd ${t}`)}return e},rh=(e,t)=>{let r=e.flatMap(i=>q1(i,t)),n=(0,eh.default)().add(r);return i=>(i=Xr(i),i=V1(i,t),n.ignores(Pr(i)))},nh=(e={})=>({cwd:Xr(e.cwd)||Jf.default.cwd()}),to=async(e,t)=>{let{cwd:r}=nh(t),n=await(0,eo.default)(e,{cwd:r,...th}),i=await Promise.all(n.map(async s=>({filePath:s,content:await Ja.default.promises.readFile(s,"utf8")})));return rh(i,r)},ro=(e,t)=>{let{cwd:r}=nh(t),i=eo.default.sync(e,{cwd:r,...th}).map(s=>({filePath:s,content:Ja.default.readFileSync(s,"utf8")}));return rh(i,r)},ih=e=>to(mi,e),sh=e=>ro(mi,e)});var vh={};Ph(vh,{generateGlobTasks:()=>X1,generateGlobTasksSync:()=>Q1,globby:()=>j1,globbyStream:()=>K1,globbySync:()=>W1,isDynamicPattern:()=>Y1,isGitIgnored:()=>ih,isGitIgnoredSync:()=>sh});var ah,oh,uh,zr,Qr,G1,io,B1,lh,ch,vi,fh,H1,hh,dh,gh,U1,_h,ph,mh,so,j1,W1,K1,Y1,X1,Q1,yh=en(()=>{ah=Ne(require("fs"),1),oh=Ne(require("path"),1),uh=Ne(os(),1),zr=Ne(Ha(),1),Qr=Ne(Vf(),1);no();Za();no();G1=e=>{if(e.some(t=>typeof t!="string"))throw new TypeError("Patterns must be a string or an array of strings")},io=e=>(e=[...new Set([e].flat())],G1(e),e),B1=e=>{if(!e.cwd)return;let t;try{t=ah.default.statSync(e.cwd)}catch{return}if(!t.isDirectory())throw new Error("The `cwd` option must be a path to a directory")},lh=(e={})=>(e={ignore:[],expandDirectories:!0,...e,cwd:Xr(e.cwd)},B1(e),e),ch=e=>async(t,r)=>e(io(t),lh(r)),vi=e=>(t,r)=>e(io(t),lh(r)),fh=e=>{let{ignoreFiles:t,gitignore:r}=e,n=t?io(t):[];return r&&n.push(mi),n},H1=async e=>{let t=fh(e);return dh(t.length>0&&await to(t,{cwd:e.cwd}))},hh=e=>{let t=fh(e);return dh(t.length>0&&ro(t,{cwd:e.cwd}))},dh=e=>{let t=new Set;return r=>{let n=r.path||r,i=oh.default.normalize(n),s=t.has(i)||e&&e(n);return t.add(i),!s}},gh=(e,t)=>e.flat().filter(r=>t(r)),U1=(e,t)=>(0,uh.default)(e).pipe(new _i(r=>t(r))),_h=(e,t)=>{let r=[];for(;e.length>0;){let n=e.findIndex(s=>pi(s));if(n===-1){r.push({patterns:e,options:t});break}let i=e[n].slice(1);for(let s of r)s.options.ignore.push(i);n!==0&&r.push({patterns:e.slice(0,n),options:{...t,ignore:[...t.ignore,i]}}),e=e.slice(n+1)}return r},ph=(e,t)=>({...t?{cwd:t}:{},...Array.isArray(e)?{files:e}:e}),mh=async(e,t)=>{let r=_h(e,t),{cwd:n,expandDirectories:i}=t;if(!i)return r;let s=ph(i,n),a=n?{cwd:n}:void 0;return Promise.all(r.map(async o=>{let{patterns:u,options:l}=o;return[u,l.ignore]=await Promise.all([(0,Qr.default)(u,s),(0,Qr.default)(l.ignore,a)]),{patterns:u,options:l}}))},so=(e,t)=>{let r=_h(e,t),{cwd:n,expandDirectories:i}=t;if(!i)return r;let s=ph(i,n),a=n?{cwd:n}:void 0;return r.map(o=>{let{patterns:u,options:l}=o;return u=Qr.default.sync(u,s),l.ignore=Qr.default.sync(l.ignore,a),{patterns:u,options:l}})},j1=ch(async(e,t)=>{let[r,n]=await Promise.all([mh(e,t),H1(t)]),i=await Promise.all(r.map(s=>(0,zr.default)(s.patterns,s.options)));return gh(i,n)}),W1=vi((e,t)=>{let r=so(e,t),n=hh(t),i=r.map(s=>zr.default.sync(s.patterns,s.options));return gh(i,n)}),K1=vi((e,t)=>{let r=so(e,t),n=hh(t),i=r.map(s=>zr.default.stream(s.patterns,s.options));return U1(i,n)}),Y1=vi((e,t)=>e.some(r=>zr.default.isDynamicPattern(r,t))),X1=ch(mh),Q1=vi(so)});var Eh=require("fs"),Be=Ne(un());var Or=Ne(un()),Io=require("child_process"),cn=require("fs");var Jt=class{constructor(t,r){L(this,"score");L(this,"type");this.score=t,this.type=r}toString(){switch(this.type){case"exact":return this.score;case"mate":return`mate in ${this.score}`;case"lowerbound":return`>= ${this.score}`;case"upperbound":return`<= ${this.score}`;default:return""}}},ln=class{constructor(t){L(this,"instance");L(this,"buffer");L(this,"timeout");L(this,"startTime",process.hrtime.bigint());L(this,"noMoves",!1);L(this,"lines",new Map);L(this,"depth",0);L(this,"turn");L(this,"engineOptions",[]);L(this,"duration",0);L(this,"lastFen","");L(this,"ascii",[]);L(this,"name");L(this,"info",[]);L(this,"options",{lines:25,depth:10,maxTime:1e3,engine:"",nnue:"",debug:!1,maxScore:10,options:[]});L(this,"state");if(t?.depth&&(this.options.depth=t.depth),t?.lines&&(this.options.lines=t.lines),t?.maxTime&&(this.options.maxTime=t.maxTime),t?.debug&&(this.options.debug=t.debug),t?.engine&&(this.options.engine=t.engine),t?.nnue&&(this.options.nnue=t.nnue),t?.options&&(this.options.options=t.options),!(0,cn.existsSync)(this.options.engine))throw new Error(`uci: engine not found: ${this.options.engine}`);if(!(0,cn.statSync)(this.options.engine).isFile())throw new Error(`uci: engine not valid: ${this.options.engine}`);this.instance=(0,Io.spawn)(this.options.engine),this.buffer=Buffer.alloc(0),this.instance.stdout?.on("data",r=>{this.options.debug&&Or.data("sf",{stdout:r.toString()}),r=Buffer.concat([this.buffer,r]);let n=r.lastIndexOf(`
`);n!==r.length-1?this.buffer=r.slice(n+1):this.buffer=Buffer.alloc(0),this.process(r.slice(0,n).toString())}),this.send("compiler"),this.send("uci"),this.send("setoption name UCI_AnalyseMode value true"),this.options.nnue.length>0?(this.send(`setoption name EvalFile value ${this.options.nnue}`),this.send("setoption name Use NNUE value true")):this.send("setoption name Use NNUE value false");for(let r of this.options.options)this.send(`setoption name ${r}`);this.send("go depth 1"),this.send("stop"),this.send("isready"),this.state="starting",this.reset()}async reset(){this.startTime=process.hrtime.bigint(),this.duration=0,this.lines=new Map,this.depth=0,this.noMoves=!1,this.ascii=[],this.state="busy",this.send("stop"),this.send("ucinewgame"),this.send("position startpos"),this.send("isready"),await this.ready()}async ready(){return new Promise(t=>{let r=setInterval(()=>{this.state==="ready"&&(clearInterval(r),t(!0))},5)})}set fen(t){this.lastFen=t,this.noMoves=!1,this.send(`position fen ${t}`),this.turn=t.split(" ")[1]==="b"?"black":"white"}get fen(){return this.lastFen}set move(t){this.send(`position startpos moves ${t}`),this.turn=t.split(" ").length%2?"black":"white"}start(t){this.state="busy",this.startTime=process.hrtime.bigint(),this.lines=new Map,this.depth=0,t?.depth&&(this.options.depth=t.depth),t?.lines&&(this.options.lines=t.lines),t?.maxTime&&(this.options.maxTime=t.maxTime),this.options.lines>1&&this.send(`setoption name MultiPV value ${this.options.lines}`),this.options.depth>0?this.send(`go depth ${this.options.depth}`):this.send("go infinite"),this.timeout&&clearTimeout(this.timeout),this.options.maxTime&&(this.timeout=setTimeout(()=>this.stop(),this.options.maxTime))}stop(){this.send("stop"),this.state="stopping"}async board(){return this.ascii=[],this.send("d"),await this.ready(),this.ascii.join(`
`)}async play(t){return this.fen=t,this.start(),await this.ready(),this.best}process(t){let r=t.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);for(let n of r)if(n.startsWith("id name")&&(this.name=n.replace("id name ","")),n.startsWith("option")&&this.engineOptions.push(n.replace("option name ","")),n.startsWith("uciok")&&(this.state="started"),(n.startsWith("readyok")||n.startsWith("bestmove"))&&(this.duration=Number((process.hrtime.bigint()-this.startTime)/1000n/1000n),this.state="ready"),!(this.state!=="ready"&&this.state!=="busy")){if(n.startsWith("info"))if(n.includes("pv"))this.processInfo(n);else if(n.includes("mate 0")||n.includes("cp 0"))this.noMoves=!0;else if(n.startsWith("info string")){let i=n.replace("info string ","");this.info.includes(i)||this.info.push(i)}else{if(n.includes("currmove"))continue;Or.data("sf unknown line",{line:n})}if(n.startsWith("|")){let i=n.replace(/[1-8,|]/g,"");this.ascii.push(i)}if(n.startsWith("Compil")){let i=n.replace("Compiled by","").replace("Compilation settings include:","").trim();this.info.includes(i)||this.info.push(i)}}}processInfo(t){if(t.indexOf(" score ")===-1||t.indexOf(" depth ")===-1||t.indexOf(" multipv ")===-1)return;let r=t.indexOf(" depth ")+7,n=t.indexOf(" ",r),i=+t.substring(r,n),s=t.indexOf(" multipv ")+9,a=t.indexOf(" ",s),o=+t.substring(s,a),u=t.indexOf(" score ")+7,l=t.indexOf(" ",u),f=t.substring(u,l),g=l+1,h=t.indexOf(" ",g),m;if(f==="cp")m=new Jt(+t.substring(g,h)/100,"exact");else if(f==="mate")m=new Jt(+t.substring(g,h),"mate");else if(f==="lowerbound")m=new Jt(+t.substring(g,h)/100,"lowerbound");else if(f==="upperbound")m=new Jt(+t.substring(g,h)/100,"upperbound");else{Or.data("sf unknown score",{scoreType:f});return}this.turn==="black"&&(m.score*=-1);let _=t.indexOf(" pv ")+4,b=t.substring(_).split(" ");this.lines.has(i)||this.lines.set(i,[]);let P=this.lines.get(i)||[],C=P[0]?.score?.score||0,B=Math.round(100*(m.score-C))/100;P[o-1]={score:m,moves:b,cpl:B};let V=P?.filter(x=>x!==null).length;(V===this.options.lines||i>1&&V===this.lines.get(1)?.length)&&i>this.depth&&(this.depth=i)}get best(){return this.noMoves?{depth:0,time:0,lines:[{score:{type:"mate",score:0},cpl:0,moves:[]}]}:{depth:this.depth,time:this.duration,lines:this.lines.get(this.depth)||[]}}send(t){this.instance?.stdin?.write(`${t}
`)}terminate(){this.send("stop"),this.send("quit"),setTimeout(()=>this.instance.kill("SIGTERM"),10),setTimeout(()=>this.instance.kill("SIGKILL"),100),setTimeout(()=>{this.options.debug&&Or.data("sf exit",{code:this.instance.exitCode,signal:this.instance.signalCode})},200),this.state="terminated"}};var Bt=Ne(un()),Wu=Ne(Hu());var qn=class{constructor(t){L(this,"i");L(this,"move");L(this,"best","");L(this,"score",0);L(this,"cpl",0);L(this,"color");L(this,"symbol");L(this,"fen");L(this,"flags");this.i=t?t?.fullMoveNumber():-1,this.symbol=t?.figurineNotation(),this.move=`${t?._data.moveDescriptor.from()}${t?._data.moveDescriptor.to()}`,this.color=t?.moveColor()==="w"?"white":"black",this.fen=t?.position().fen()}},as=class{constructor(t){L(this,"file");L(this,"game");L(this,"moves");L(this,"date");L(this,"analyzed");L(this,"players");L(this,"result");L(this,"win");L(this,"line");L(this,"color");L(this,"acpl",{full:void 0,decided:void 0});L(this,"pgn",[]);L(this,"engine");L(this,"summary",{full:void 0,decided:void 0});this.analyzed=new Date,this.file=t?.file,this.game=t?.game||0,this.moves=t?.moves||0,this.date=t?.date,this.players=t?.players||["",""],this.line=t?.line||[],this.color=t?.color,t?.pgn&&(this.pgn=t.pgn),t?.engine&&(this.engine=t.engine)}},Uu=(e,t)=>{if(!e?.color)return;let r=t&&t>0?e.line.findIndex(s=>s.score>=t):e.line.length-1,n=e.line.slice(0,r).filter(s=>e.color?.startsWith(s.color));return Math.round(100*n.reduce((s,a)=>s+=a.cpl,0)/n.length)},p_=e=>e.flags?e.flags:e.move===e.best?"best":e.cpl>=2?"blunder":e.cpl>=1?"mistake":e.cpl>=.5?"inaccurate":e.cpl>=0?"good":e.cpl<=-1?"great":"ok",ju=(e,t)=>{if(!e?.color)return;let r=t&&t>0?e.line.findIndex(i=>i.score>=t):e.line.length-1,n=e.line.slice(0,r);return{best:n.filter(i=>i.flags==="best"&&e.color?.startsWith(i.color)).length,blunder:n.filter(i=>i.flags==="blunder"&&e.color?.startsWith(i.color)).length,mistake:n.filter(i=>i.flags==="mistake"&&e.color?.startsWith(i.color)).length,inaccurate:n.filter(i=>i.flags==="inaccurate"&&e.color?.startsWith(i.color)).length,good:n.filter(i=>i.flags==="good"&&e.color?.startsWith(i.color)).length,great:n.filter(i=>i.flags==="great"&&e.color?.startsWith(i.color)).length}};async function Ku(e,t,r,n){let i=(0,Wu.pgnRead)(t),s=[];for(let a=0;a<i.gameCount();a++){let o=process.hrtime.bigint(),u;try{u=i.game(a)}catch{Bt.error({error:"cannot process",file:r});continue}let l=[u.playerName("w")||"",u.playerName("b")||""],f;l[0]===n&&(f="white"),l[1]===n&&(f="black");let h=u.mainVariation().nodes(),m=new as({file:r,game:a+1,moves:Math.round(h.length/2),date:u.dateAsDate(),players:l,color:f,pgn:t.split(`
`),engine:{name:e.name,info:e.info,options:e.options,time:0}});m.result=u.result(),m.color==="white"&&(m.win=m.result==="1-0"),m.color==="black"&&(m.win=m.result==="0-1"),await e.reset();let _=new qn,b=[];for(let C=0;C<=h.length;C++){let B=new qn(h[C]),V=await e.play(_.fen||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1");if(!V||!V.depth||!V.lines||V.lines.length===0){Bt.warn("sf engine return no move",{current:B,previous:_,fen:e.fen,res:V});continue}let se=V.lines[0];B.best=se.moves[0],m.line.push(B),se.score.type==="exact"&&b.push(se.score.score),se.score.type==="mate"&&(b.push(m.color?.startsWith(B.color)?99:-99),_.flags=`mate in ${se.score.score}`),_.cpl=Math.round(100*(b[b.length-2]-b[b.length-1]))/100,_.score=b[b.length-1],_.flags=p_(_),_=B,e.options.debug&&(se.moves.length=1,Bt.data("move",{move:B,previous:_}),Bt.data("engine",{move:B.i,depth:e.best.depth,time:e.best.time,lines:e.best.lines.length,best:se}))}let P=process.hrtime.bigint();m.line.length=Math.min(m.line.length,h.length),m.line.forEach(C=>C.score*=m.color==="white"?1:-1),m.acpl={full:Uu(m,0),decided:Uu(m,10)},m.summary={full:ju(m,0),decided:ju(m,10)},m.engine&&(m.engine.time=Math.round(Number(P-o)/1e3/1e3)),s.push(m)}return s}var z1="VladMandic",Z1={debug:!1,lines:1,depth:12,maxTime:2e3,maxScore:10,engine:"/home/vlado/dev/chess/engine/sf15-bmi2",nnue:"nn-6877cd24400e.nnue",options:["Threads value 16"]};async function J1(){Be.configure({inspect:{breakLength:400}}),Be.headerJson();let e=new ln(Z1);await e.ready(),Be.state("engine",{name:e.name,state:e.state,info:e.info}),Be.state("options",e.options);let t=[],r=process.argv.slice(2),i=await(await Promise.resolve().then(()=>(yh(),vh))).globby(r,{expandDirectories:!0,gitignore:!0,deep:2});Be.info("list",{files:i.length});for(let s of i){let a=(0,Eh.readFileSync)(s,"utf8"),o=await Ku(e,a,s,z1);t.push(...o);for(let u of o){let l={file:u.file,game:u.game,date:u.date,players:u.players,win:u.win,color:u.color,moves:u.moves,acpl:u.acpl.decided,time:u.engine?.time,summary:u.summary.decided};Be.data("summary",l)}}t.length===1&&Be.data("details",t[0]),e.terminate(),process.exit(0)}J1();
//# sourceMappingURL=chess.js.map
