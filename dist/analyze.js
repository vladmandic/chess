/*
  Chess
  homepage: <https://github.com/vladmandic/chess>
  author: <https://github.com/vladmandic>'
*/

"use strict";var Lh=Object.create;var lr=Object.defineProperty;var Fh=Object.getOwnPropertyDescriptor;var Dh=Object.getOwnPropertyNames;var $h=Object.getPrototypeOf,qh=Object.prototype.hasOwnProperty;var Vh=(e,t,n)=>t in e?lr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var cr=(e,t)=>()=>(e&&(t=e(e=0)),t);var m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Gh=(e,t)=>{for(var n in t)lr(e,n,{get:t[n],enumerable:!0})},Bh=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Dh(t))!qh.call(e,i)&&i!==n&&lr(e,i,{get:()=>t[i],enumerable:!(r=Fh(t,i))||r.enumerable});return e};var ue=(e,t,n)=>(n=e!=null?Lh($h(e)):{},Bh(t||!e||!e.__esModule?lr(n,"default",{value:e,enumerable:!0}):n,e));var N=(e,t,n)=>(Vh(e,typeof t!="symbol"?t+"":t,n),n);var sn=m((Sy,Fo)=>{"use strict";var Hh=Object.create,pr=Object.defineProperty,Uh=Object.getOwnPropertyDescriptor,Po=Object.getOwnPropertyNames,jh=Object.getPrototypeOf,Wh=Object.prototype.hasOwnProperty,Kh=(e,t)=>function(){return t||(0,e[Po(e)[0]])((t={exports:{}}).exports,t),t.exports},Yh=(e,t)=>{for(var n in t)pr(e,n,{get:t[n],enumerable:!0})},Co=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Po(t))!Wh.call(e,i)&&i!==n&&pr(e,i,{get:()=>t[i],enumerable:!(r=Uh(t,i))||r.enumerable});return e},Dt=(e,t,n)=>(n=e!=null?Hh(jh(e)):{},Co(t||!e||!e.__esModule?pr(n,"default",{value:e,enumerable:!0}):n,e)),Xh=e=>Co(pr({},"__esModule",{value:!0}),e),Qh=Kh({"node_modules/.pnpm/dayjs@1.11.4/node_modules/dayjs/dayjs.min.js"(e,t){(function(n,r){typeof e=="object"&&typeof t<"u"?t.exports=r():typeof define=="function"&&define.amd?define(r):(n=typeof globalThis<"u"?globalThis:n||self).dayjs=r()})(e,function(){"use strict";var n=1e3,r=6e4,i=36e5,s="millisecond",a="second",o="minute",u="hour",l="day",f="week",d="month",h="quarter",y="year",p="date",S="Invalid Date",C=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,M=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,W={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},T=function(P,I,c){var g=String(P);return!g||g.length>=I?P:""+Array(I+1-g.length).join(c)+P},he={s:T,z:function(P){var I=-P.utcOffset(),c=Math.abs(I),g=Math.floor(c/60),b=c%60;return(I<=0?"+":"-")+T(g,2,"0")+":"+T(b,2,"0")},m:function P(I,c){if(I.date()<c.date())return-P(c,I);var g=12*(c.year()-I.year())+(c.month()-I.month()),b=I.clone().add(g,d),w=c-b<0,k=I.clone().add(g+(w?-1:1),d);return+(-(g+(c-b)/(w?b-k:k-b))||0)},a:function(P){return P<0?Math.ceil(P)||0:Math.floor(P)},p:function(P){return{M:d,y,w:f,d:l,D:p,h:u,m:o,s:a,ms:s,Q:h}[P]||String(P||"").toLowerCase().replace(/s$/,"")},u:function(P){return P===void 0}},x="en",G={};G[x]=W;var O=function(P){return P instanceof _},A=function P(I,c,g){var b;if(!I)return x;if(typeof I=="string"){var w=I.toLowerCase();G[w]&&(b=w),c&&(G[w]=c,b=w);var k=I.split("-");if(!b&&k.length>1)return P(k[0])}else{var B=I.name;G[B]=I,b=B}return!g&&b&&(x=b),b||!g&&x},R=function(P,I){if(O(P))return P.clone();var c=typeof I=="object"?I:{};return c.date=P,c.args=arguments,new _(c)},L=he;L.l=A,L.i=O,L.w=function(P,I){return R(P,{locale:I.$L,utc:I.$u,x:I.$x,$offset:I.$offset})};var _=function(){function P(c){this.$L=A(c.locale,null,!0),this.parse(c)}var I=P.prototype;return I.parse=function(c){this.$d=function(g){var b=g.date,w=g.utc;if(b===null)return new Date(NaN);if(L.u(b))return new Date;if(b instanceof Date)return new Date(b);if(typeof b=="string"&&!/Z$/i.test(b)){var k=b.match(C);if(k){var B=k[2]-1||0,U=(k[7]||"0").substring(0,3);return w?new Date(Date.UTC(k[1],B,k[3]||1,k[4]||0,k[5]||0,k[6]||0,U)):new Date(k[1],B,k[3]||1,k[4]||0,k[5]||0,k[6]||0,U)}}return new Date(b)}(c),this.$x=c.x||{},this.init()},I.init=function(){var c=this.$d;this.$y=c.getFullYear(),this.$M=c.getMonth(),this.$D=c.getDate(),this.$W=c.getDay(),this.$H=c.getHours(),this.$m=c.getMinutes(),this.$s=c.getSeconds(),this.$ms=c.getMilliseconds()},I.$utils=function(){return L},I.isValid=function(){return this.$d.toString()!==S},I.isSame=function(c,g){var b=R(c);return this.startOf(g)<=b&&b<=this.endOf(g)},I.isAfter=function(c,g){return R(c)<this.startOf(g)},I.isBefore=function(c,g){return this.endOf(g)<R(c)},I.$g=function(c,g,b){return L.u(c)?this[g]:this.set(b,c)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(c,g){var b=this,w=!!L.u(g)||g,k=L.p(c),B=function(vt,v){var j=L.w(b.$u?Date.UTC(b.$y,v,vt):new Date(b.$y,v,vt),b);return w?j:j.endOf(l)},U=function(vt,v){return L.w(b.toDate()[vt].apply(b.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(v)),b)},te=this.$W,de=this.$M,Re=this.$D,_e="set"+(this.$u?"UTC":"");switch(k){case y:return w?B(1,0):B(31,11);case d:return w?B(1,de):B(0,de+1);case f:var q=this.$locale().weekStart||0,Qe=(te<q?te+7:te)-q;return B(w?Re-Qe:Re+(6-Qe),de);case l:case p:return U(_e+"Hours",0);case u:return U(_e+"Minutes",1);case o:return U(_e+"Seconds",2);case a:return U(_e+"Milliseconds",3);default:return this.clone()}},I.endOf=function(c){return this.startOf(c,!1)},I.$set=function(c,g){var b,w=L.p(c),k="set"+(this.$u?"UTC":""),B=(b={},b[l]=k+"Date",b[p]=k+"Date",b[d]=k+"Month",b[y]=k+"FullYear",b[u]=k+"Hours",b[o]=k+"Minutes",b[a]=k+"Seconds",b[s]=k+"Milliseconds",b)[w],U=w===l?this.$D+(g-this.$W):g;if(w===d||w===y){var te=this.clone().set(p,1);te.$d[B](U),te.init(),this.$d=te.set(p,Math.min(this.$D,te.daysInMonth())).$d}else B&&this.$d[B](U);return this.init(),this},I.set=function(c,g){return this.clone().$set(c,g)},I.get=function(c){return this[L.p(c)]()},I.add=function(c,g){var b,w=this;c=Number(c);var k=L.p(g),B=function(de){var Re=R(w);return L.w(Re.date(Re.date()+Math.round(de*c)),w)};if(k===d)return this.set(d,this.$M+c);if(k===y)return this.set(y,this.$y+c);if(k===l)return B(1);if(k===f)return B(7);var U=(b={},b[o]=r,b[u]=i,b[a]=n,b)[k]||1,te=this.$d.getTime()+c*U;return L.w(te,this)},I.subtract=function(c,g){return this.add(-1*c,g)},I.format=function(c){var g=this,b=this.$locale();if(!this.isValid())return b.invalidDate||S;var w=c||"YYYY-MM-DDTHH:mm:ssZ",k=L.z(this),B=this.$H,U=this.$m,te=this.$M,de=b.weekdays,Re=b.months,_e=function(v,j,E,$){return v&&(v[j]||v(g,w))||E[j].slice(0,$)},q=function(v){return L.s(B%12||12,v,"0")},Qe=b.meridiem||function(v,j,E){var $=v<12?"AM":"PM";return E?$.toLowerCase():$},vt={YY:String(this.$y).slice(-2),YYYY:this.$y,M:te+1,MM:L.s(te+1,2,"0"),MMM:_e(b.monthsShort,te,Re,3),MMMM:_e(Re,te),D:this.$D,DD:L.s(this.$D,2,"0"),d:String(this.$W),dd:_e(b.weekdaysMin,this.$W,de,2),ddd:_e(b.weekdaysShort,this.$W,de,3),dddd:de[this.$W],H:String(B),HH:L.s(B,2,"0"),h:q(1),hh:q(2),a:Qe(B,U,!0),A:Qe(B,U,!1),m:String(U),mm:L.s(U,2,"0"),s:String(this.$s),ss:L.s(this.$s,2,"0"),SSS:L.s(this.$ms,3,"0"),Z:k};return w.replace(M,function(v,j){return j||vt[v]||k.replace(":","")})},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(c,g,b){var w,k=L.p(g),B=R(c),U=(B.utcOffset()-this.utcOffset())*r,te=this-B,de=L.m(this,B);return de=(w={},w[y]=de/12,w[d]=de,w[h]=de/3,w[f]=(te-U)/6048e5,w[l]=(te-U)/864e5,w[u]=te/i,w[o]=te/r,w[a]=te/n,w)[k]||te,b?de:L.a(de)},I.daysInMonth=function(){return this.endOf(d).$D},I.$locale=function(){return G[this.$L]},I.locale=function(c,g){if(!c)return this.$L;var b=this.clone(),w=A(c,g,!0);return w&&(b.$L=w),b},I.clone=function(){return L.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},P}(),ee=_.prototype;return R.prototype=ee,[["$ms",s],["$s",a],["$m",o],["$H",u],["$W",l],["$M",d],["$y",y],["$D",p]].forEach(function(P){ee[P[1]]=function(I){return this.$g(I,P[0],P[1])}}),R.extend=function(P,I){return P.$i||(P(I,_,R),P.$i=!0),R},R.locale=A,R.isDayjs=O,R.unix=function(P){return R(1e3*P)},R.en=G[x],R.Ls=G,R.p={},R})}}),To={};Yh(To,{access:()=>_d,accessFile:()=>Mo,assert:()=>gd,blank:()=>bd,client:()=>pd,clientFile:()=>Lo,configure:()=>md,console:()=>Td,data:()=>Ad,debug:()=>Cd,error:()=>Id,fatal:()=>Nd,header:()=>yd,headerJson:()=>vd,info:()=>Ed,logFile:()=>xo,options:()=>K,print:()=>Ze,ring:()=>fr,state:()=>Sd,tags:()=>ke,timed:()=>dd,verbose:()=>Pd,warn:()=>wd});Fo.exports=Xh(To);var Ro=Dt(require("os")),Ft=Dt(require("fs")),lt=Dt(require("path")),$n=Dt(Qh()),ki=10,vo=(e=0)=>t=>`\x1B[${t+e}m`,bo=(e=0)=>t=>`\x1B[${38+e};5;${t}m`,Eo=(e=0)=>(t,n,r)=>`\x1B[${38+e};2;${t};${n};${r}m`;function zh(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright;for(let[n,r]of Object.entries(t)){for(let[i,s]of Object.entries(r))t[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},r[i]=t[i],e.set(s[0],s[1]);Object.defineProperty(t,n,{value:r,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1B[39m",t.bgColor.close="\x1B[49m",t.color.ansi=vo(),t.color.ansi256=bo(),t.color.ansi16m=Eo(),t.bgColor.ansi=vo(ki),t.bgColor.ansi256=bo(ki),t.bgColor.ansi16m=Eo(ki),Object.defineProperties(t,{rgbToAnsi256:{value:(n,r,i)=>n===r&&r===i?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(r/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:n=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(n.toString(16));if(!r)return[0,0,0];let{colorString:i}=r.groups;i.length===3&&(i=[...i].map(a=>a+a).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:n=>t.rgbToAnsi256(...t.hexToRgb(n)),enumerable:!1},ansi256ToAnsi:{value:n=>{if(n<8)return 30+n;if(n<16)return 90+(n-8);let r,i,s;if(n>=232)r=((n-232)*10+8)/255,i=r,s=r;else{n-=16;let u=n%36;r=Math.floor(n/36)/5,i=Math.floor(u/6)/5,s=u%6/5}let a=Math.max(r,i,s)*2;if(a===0)return 30;let o=30+(Math.round(s)<<2|Math.round(i)<<1|Math.round(r));return a===2&&(o+=60),o},enumerable:!1},rgbToAnsi:{value:(n,r,i)=>t.ansi256ToAnsi(t.rgbToAnsi256(n,r,i)),enumerable:!1},hexToAnsi:{value:n=>t.ansi256ToAnsi(t.hexToAnsi256(n)),enumerable:!1}}),t}var Zh=zh(),ze=Zh,Li=Dt(require("process"),1),Jh=Dt(require("os"),1),So=Dt(require("tty"),1);function Me(e,t=Li.default.argv){let n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),i=t.indexOf("--");return r!==-1&&(i===-1||r<i)}var{env:le}=Li.default,dr;Me("no-color")||Me("no-colors")||Me("color=false")||Me("color=never")?dr=0:(Me("color")||Me("colors")||Me("color=true")||Me("color=always"))&&(dr=1);function ed(){if("FORCE_COLOR"in le)return le.FORCE_COLOR==="true"?1:le.FORCE_COLOR==="false"?0:le.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(le.FORCE_COLOR,10),3)}function td(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function nd(e,{streamIsTTY:t,sniffFlags:n=!0}={}){let r=ed();r!==void 0&&(dr=r);let i=n?dr:r;if(i===0)return 0;if(n){if(Me("color=16m")||Me("color=full")||Me("color=truecolor"))return 3;if(Me("color=256"))return 2}if(e&&!t&&i===void 0)return 0;let s=i||0;if(le.TERM==="dumb")return s;if(Li.default.platform==="win32"){let a=Jh.default.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in le)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(a=>a in le)||le.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in le)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(le.TEAMCITY_VERSION)?1:0;if("TF_BUILD"in le&&"AGENT_NAME"in le)return 1;if(le.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in le){let a=Number.parseInt((le.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(le.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(le.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(le.TERM)||"COLORTERM"in le?1:s}function Ao(e,t={}){let n=nd(e,{streamIsTTY:e&&e.isTTY,...t});return td(n)}var rd={stdout:Ao({isTTY:So.default.isatty(1)}),stderr:Ao({isTTY:So.default.isatty(2)})},id=rd;function sd(e,t,n){let r=e.indexOf(t);if(r===-1)return e;let i=t.length,s=0,a="";do a+=e.substr(s,r-s)+t+n,s=r+i,r=e.indexOf(t,s);while(r!==-1);return a+=e.slice(s),a}function ad(e,t,n,r){let i=0,s="";do{let a=e[r-1]==="\r";s+=e.substr(i,(a?r-1:r)-i)+t+(a?`\r
`:`
`)+n,i=r+1,r=e.indexOf(`
`,i)}while(r!==-1);return s+=e.slice(i),s}var{stdout:wo,stderr:Io}=id,Oi=Symbol("GENERATOR"),nn=Symbol("STYLER"),Fn=Symbol("IS_EMPTY"),No=["ansi","ansi","ansi256","ansi16m"],rn=Object.create(null),od=(e,t={})=>{if(t.level&&!(Number.isInteger(t.level)&&t.level>=0&&t.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");let n=wo?wo.level:0;e.level=t.level===void 0?n:t.level},ud=class{constructor(e){return ko(e)}},ko=e=>{let t=(...n)=>n.join(" ");return od(t,e),Object.setPrototypeOf(t,qn.prototype),t};function qn(e){return ko(e)}Object.setPrototypeOf(qn.prototype,Function.prototype);for(let[e,t]of Object.entries(ze))rn[e]={get(){let n=gr(this,Mi(t.open,t.close,this[nn]),this[Fn]);return Object.defineProperty(this,e,{value:n}),n}};rn.visible={get(){let e=gr(this,this[nn],!0);return Object.defineProperty(this,"visible",{value:e}),e}};var xi=(e,t,n,...r)=>e==="rgb"?t==="ansi16m"?ze[n].ansi16m(...r):t==="ansi256"?ze[n].ansi256(ze.rgbToAnsi256(...r)):ze[n].ansi(ze.rgbToAnsi(...r)):e==="hex"?xi("rgb",t,n,...ze.hexToRgb(...r)):ze[n][e](...r),ld=["rgb","hex","ansi256"];for(let e of ld){rn[e]={get(){let{level:n}=this;return function(...r){let i=Mi(xi(e,No[n],"color",...r),ze.color.close,this[nn]);return gr(this,i,this[Fn])}}};let t="bg"+e[0].toUpperCase()+e.slice(1);rn[t]={get(){let{level:n}=this;return function(...r){let i=Mi(xi(e,No[n],"bgColor",...r),ze.bgColor.close,this[nn]);return gr(this,i,this[Fn])}}}}var cd=Object.defineProperties(()=>{},{...rn,level:{enumerable:!0,get(){return this[Oi].level},set(e){this[Oi].level=e}}}),Mi=(e,t,n)=>{let r,i;return n===void 0?(r=e,i=t):(r=n.openAll+e,i=t+n.closeAll),{open:e,close:t,openAll:r,closeAll:i,parent:n}},gr=(e,t,n)=>{let r=(...i)=>fd(r,i.length===1?""+i[0]:i.join(" "));return Object.setPrototypeOf(r,cd),r[Oi]=e,r[nn]=t,r[Fn]=n,r},fd=(e,t)=>{if(e.level<=0||!t)return e[Fn]?"":t;let n=e[nn];if(n===void 0)return t;let{openAll:r,closeAll:i}=n;if(t.includes("\x1B"))for(;n!==void 0;)t=sd(t,n.close,n.open),n=n.parent;let s=t.indexOf(`
`);return s!==-1&&(t=ad(t,i,r,s)),r+t+i};Object.defineProperties(qn.prototype,rn);var by=qn(),Ey=qn({level:Io?Io.level:0}),Oo=require("console"),Ge=new ud({level:2}),fr=[],K={dateFormat:"YYYY-MM-DD HH:mm:ss",ringLength:100,console:!0,timeStamp:!0},Q={logFile:!1,accessFile:!1,clientFile:!1,logStream:void 0,accessStream:void 0,clientStream:void 0},ke={blank:"",continue:":     ",info:Ge.cyan("INFO: "),warn:Ge.yellow("WARN: "),data:Ge.green("DATA: "),error:Ge.red("ERROR:"),fatal:Ge.bold.red("FATAL:"),assert:Ge.italic.bold.red("ASSERT:"),timed:Ge.magentaBright("TIMED:"),state:Ge.magenta("STATE:"),verbose:Ge.bgGray.yellowBright("VERB: "),debug:Ge.bgGray.redBright("DEBUG:"),console:Ge.gray("CONSOLE:")},hr={showHidden:!1,depth:5,colors:!0,showProxy:!0,maxArrayLength:1024,maxStringLength:10240,breakLength:200,compact:64,sorted:!1,getters:!1},_r=new Oo.Console({stdout:process.stdout,stderr:process.stderr,ignoreErrors:!0,inspectOptions:hr});function hd(e){let t="";try{t=JSON.stringify(e)}catch{}return t}function Dn(...e){let t="";for(let n of e)t+=typeof n=="object"?hd(n):n,t+=" ";return t}function Ze(...e){let t=(0,$n.default)(Date.now()).format(K.dateFormat);K.console&&(K.timeStamp?_r.log(t,...e):_r.log(...e))}function xo(e){typeof e=="string"&&(K.logFile=e,Q.logFile=!0,Q.logStream=Ft.createWriteStream(lt.resolve(K.logFile||""),{flags:"a"}),Q.logStream&&Q.logStream.on("error",t=>{Ze(ke.error,"Cannot open application log",K.logFile,t),Q.logFile=!1}))}function Mo(e){typeof e=="string"&&(K.accessFile=e,Q.accessFile=!0,Q.accessStream=Ft.createWriteStream(lt.resolve(K.accessFile),{flags:"a"}),Q.accessStream&&Q.accessStream.on("error",t=>{Ze(ke.error,"Cannot open application log",K.accessFile,t),Q.accessFile=!1}))}function Lo(e){typeof e=="string"&&(K.clientFile=e,Q.clientFile=!0,Q.clientStream=Ft.createWriteStream(lt.resolve(K.clientFile),{flags:"a"}),Q.clientStream&&Q.clientStream.on("error",t=>{Ze(ke.error,"Cannot open application log",K.clientFile,t),Q.clientFile=!1}))}async function dd(e,...t){arguments.length<2&&(t=[e],e=process.hrtime.bigint());let n=process.hrtime.bigint(),r=0;try{r=parseInt((n-e).toString())}catch{}r=Math.round(r/1e6);let i=(0,$n.default)(Date.now()).format(K.dateFormat);K.console&&_r.log(i,ke.timed,`${r.toLocaleString()} ms`,...t),Q.logFile&&Q.logStream&&Q.logStream.write(`${ke.timed} ${i} ${r.toLocaleString()} ms ${Dn(...t)}
`)}async function Se(e,...t){let n=(0,$n.default)(Date.now()).format(K.dateFormat);ke[e]?Ze(ke[e],...t):Ze(...t),Q.logFile&&Q.logStream&&Q.logStream.write(`${n} ${ke[e]} ${Dn(...t)}
`),fr.push({tag:e,time:n,msg:Dn(...t)}),fr.length>K.ringLength&&fr.shift()}async function gd(e,t,...n){e!==t&&Se("assert",...n,{res:e,exp:t})}async function _d(...e){let t=(0,$n.default)(Date.now()).format(K.dateFormat);Q.accessFile&&Q.accessStream&&Q.accessStream.write(`${t} ${Dn(...e)}
`)}async function pd(...e){let t=(0,$n.default)(Date.now()).format(K.dateFormat);Q.clientFile&&Q.clientStream&&Q.clientStream.write(`${t} ${Dn(...e)}
`)}function md(e){!e||(e.dateFormat&&(K.dateFormat=e.dateFormat),e.ringLength&&(K.ringLength=e.ringLength),e.logFile&&xo(e.logFile),e.accessFile&&Mo(e.accessFile),e.clientFile&&Lo(e.clientFile),e.inspect&&(hr={...hr,...e.inspect}),_r=new Oo.Console({stdout:process.stdout,stderr:process.stderr,ignoreErrors:!0,inspectOptions:hr}))}function yd(){let e="./package.json";if(!Ft.existsSync(e))return;let t=JSON.parse(Ft.readFileSync(e).toString());process.title=t.name,Se("info",t.name,"version",t.version),Se("info","User:",Ro.userInfo().username,"Platform:",process.platform,"Arch:",process.arch,"Node:",process.version),K.logFile&&Q.logFile&&Ze(ke.state,"Application log:",lt.resolve(K.logFile)),K.accessFile&&Q.accessFile&&Ze(ke.state,"Access log:",lt.resolve(K.accessFile)),K.clientFile&&Q.clientFile&&Ze(ke.state,"Client log:",lt.resolve(K.clientFile))}function vd(){let e="./package.json";if(!Ft.existsSync(e))return;let t=JSON.parse(Ft.readFileSync(e).toString());process.title=t.name,Se("info",{application:t.name,version:t.version}),Se("info",{user:Ro.userInfo().username,platform:process.platform,arch:process.arch,node:process.version}),(K.logFile||K.accessFile||K.clientFile)&&Ze(ke.state,{log:lt.resolve(K.logFile||""),access:lt.resolve(K.accessFile||""),client:lt.resolve(K.clientFile||"")})}var bd=(...e)=>Se("blank",...e),Ed=(...e)=>Se("info",...e),Sd=(...e)=>Se("state",...e),Ad=(...e)=>Se("data",...e),wd=(...e)=>Se("warn",...e),Id=(...e)=>Se("error",...e),Nd=(...e)=>Se("fatal",...e),Pd=(...e)=>Se("verbose",...e),Cd=(...e)=>Se("debug",...e),Td=(...e)=>Se("console",...e)});var ct=m(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.i18n=void 0;var kd;(function(e){e.WRONG_NUMBER_OF_FEN_FIELDS="A FEN string must contain exactly 6 space-separated fields.",e.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD="The 1st field of a FEN string must contain exactly 8 `/`-separated subfields.",e.UNEXPECTED_CHARACTER_IN_BOARD_FIELD="Unexpected character in the 1st field of the FEN string: `{0}`.",e.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD="Subfield {0} of the FEN string 1st field is unexpectedly short.",e.INVALID_TURN_FIELD="The 2nd field of a FEN string must be either `w` or `b`.",e.INVALID_CASTLING_FIELD="The 3rd field of a FEN string must be either `-` or a list of characters among `K`, `Q`, `k` and `q` (in this order).",e.INVALID_EN_PASSANT_FIELD="The 4th field of a FEN string must be either `-` or a square from the 3rd or 6th rank where en-passant is allowed.",e.WRONG_RANK_IN_EN_PASSANT_FIELD="The rank number indicated in the FEN string 4th field is inconsistent with respect to the 2nd field.",e.INEFFECTIVE_EN_PASSANT_FIELD="No en-passant capture can happen on file {0} in the position defined in the FEN string.",e.INVALID_HALF_MOVE_COUNT_FIELD="The 5th field of a FEN string must be a number, indicating the number of half-move since the last pawn move or capture.",e.INVALID_MOVE_NUMBER_FIELD="The 6th field of a FEN string must be a number, indicating the move number of the game.",e.INVALID_VARIANT_PREFIX="Invalid variant prefix: `{0}`.",e.INVALID_UCI_NOTATION_SYNTAX="The syntax of the UCI notation is invalid.",e.ILLEGAL_UCI_MOVE="The UCI move is not legal.",e.INVALID_MOVE_NOTATION_SYNTAX="The syntax of the move notation is invalid.",e.ILLEGAL_POSITION="The position is not legal.",e.ILLEGAL_NO_KING_CASTLING="Castling is not legal in the considered position as it has no king.",e.ILLEGAL_QUEEN_SIDE_CASTLING="Queen-side castling is not legal in the considered position.",e.ILLEGAL_KING_SIDE_CASTLING="King-side castling is not legal in the considered position.",e.NO_PIECE_CAN_MOVE_TO="No {0} can move to {1}.",e.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION="No {0} on the specified rank/file can move to {1}.",e.REQUIRE_DISAMBIGUATION="Cannot determine uniquely which {0} is supposed to move to {1}.",e.WRONG_DISAMBIGUATION_SYMBOL="Wrong disambiguation symbol (expected: `{0}`, observed: `{1}`).",e.CASTLING_MOVE_ENCODED_WITH_ZERO="Capital O must be used for castling moves (instead of digit 0).",e.TRYING_TO_CAPTURE_YOUR_OWN_PIECES="Capturing its own pieces is not legal.",e.CAPTURE_IS_MANDATORY="Capture is mandatory.",e.INVALID_PIECE_SYMBOL="Character `{0}` is not a valid piece symbol.",e.INVALID_PIECE_SYMBOL_COLOR="Invalid color for piece symbol `{0}`.",e.INVALID_CAPTURING_PAWN_MOVE="Invalid capturing pawn move.",e.INVALID_NON_CAPTURING_PAWN_MOVE="Invalid non-capturing pawn move.",e.NOT_SAFE_FOR_WHITE_KING="This move would let the white king in check.",e.NOT_SAFE_FOR_BLACK_KING="This move would let the black king in check.",e.MISSING_PROMOTION="A promoted piece must be specified for this move.",e.MISSING_PROMOTION_SYMBOL="Character `=` is required to specify a promoted piece.",e.INVALID_PROMOTED_PIECE="{0} cannot be specified as a promoted piece.",e.ILLEGAL_PROMOTION="Specifying a promoted piece is illegal for this move.",e.ILLEGAL_NULL_MOVE="Cannot play a null-move in this position.",e.MISSING_CAPTURE_SYMBOL="Capture symbol `x` is missing.",e.INVALID_CAPTURE_SYMBOL="This move is not a capture move.",e.WRONG_CHECK_CHECKMATE_SYMBOL="Wrong check/checkmate symbol (expected: `{0}`, observed: `{1}`).",e.INVALID_PGN_TOKEN="Unrecognized character or group of characters.",e.INVALID_MOVE_IN_PGN_TEXT="Invalid move ({0}). {1}",e.INVALID_FEN_IN_PGN_TEXT="Invalid FEN string in the initial position header. {0}",e.UNEXPECTED_PGN_HEADER="Unexpected PGN game header.",e.MISSING_PGN_HEADER_ID="Missing or invalid PGN game header ID.",e.MISSING_PGN_HEADER_VALUE="Missing or invalid PGN game header value.",e.MISSING_END_OF_PGN_HEADER="Missing or invalid end of PGN game header.",e.UNEXPECTED_BEGIN_OF_VARIATION="Unexpected begin of variation.",e.UNEXPECTED_END_OF_VARIATION="Unexpected end of variation.",e.UNEXPECTED_END_OF_GAME="Unexpected end of game: there are pending variations.",e.UNEXPECTED_END_OF_TEXT="Unexpected end of text: there is a pending game.",e.INVALID_GAME_INDEX="Game index {0} is invalid (only {1} game(s) found in the PGN data).",e.UNKNOWN_VARIANT="Unknown chess game variant ({0}).",e.VARIANT_WITHOUT_FEN="For game variant {0}, the FEN header is mandatory."})(kd=Gn.i18n||(Gn.i18n={}))});var Ae=m(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.InvalidPGN=Je.InvalidNotation=Je.InvalidFEN=Je.IllegalArgument=void 0;var Fi=class{constructor(t){this.functionName=t}toString(){return`Illegal argument in function ${this.functionName}`}};Je.IllegalArgument=Fi;var Di=class{constructor(t,n,...r){this.fen=t,this.message=Vi(n,r)}toString(){return Gi("InvalidFEN",this.message)}};Je.InvalidFEN=Di;var $i=class{constructor(t,n,r,...i){this.fen=t,this.notation=n,this.message=Vi(r,i)}toString(){return Gi("InvalidNotation",this.message)}};Je.InvalidNotation=$i;var qi=class{constructor(t,n,r,i,...s){this.pgn=t,this.index=n,this.lineNumber=r,this.message=Vi(i,s)}toString(){return Gi("InvalidPGN",`[character=${this.index} line=${this.lineNumber}] ${this.message}`)}};Je.InvalidPGN=qi;function Vi(e,t){return e.replace(/{(\d+)}/g,(n,r)=>{let i=Number(r);return i<t.length?t[i]:n})}function Gi(e,t){return e+" -> "+t}});var ft=m(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.squareColorImpl=V.coloredPieceFromString=V.coloredPieceToString=V.squareFromString=V.squareToString=V.variantFromString=V.resultFromString=V.fileFromString=V.rankFromString=V.figurineFromString=V.pieceFromString=V.colorFromString=V.variantToString=V.resultToString=V.fileToString=V.rankToString=V.figurineToString=V.pieceToString=V.colorToString=void 0;var Er=[..."wb"],Sr=[..."kqrbnp"],qo=[..."\u2654\u265A\u2655\u265B\u2656\u265C\u2657\u265D\u2658\u265E\u2659\u265F"],Ar=[..."12345678"],wr=[..."abcdefgh"],Vo=["1-0","0-1","1/2-1/2","*"],Go=["regular","chess960","no-king","white-king-only","black-king-only","antichess","horde"];function Od(e){return Er[e]}V.colorToString=Od;function xd(e){return Sr[e]}V.pieceToString=xd;function Md(e){return qo[e]}V.figurineToString=Md;function Ld(e){return Ar[e]}V.rankToString=Ld;function Fd(e){return wr[e]}V.fileToString=Fd;function Dd(e){return Vo[e]}V.resultToString=Dd;function $d(e){return Go[e]}V.variantToString=$d;function qd(e){return Er.indexOf(e)}V.colorFromString=qd;function Vd(e){return Sr.indexOf(e)}V.pieceFromString=Vd;function Gd(e){return qo.indexOf(e)}V.figurineFromString=Gd;function Bd(e){return Ar.indexOf(e)}V.rankFromString=Bd;function Hd(e){return wr.indexOf(e)}V.fileFromString=Hd;function Ud(e){return Vo.indexOf(e)}V.resultFromString=Ud;function jd(e){return Go.indexOf(e)}V.variantFromString=jd;function Wd(e){return wr[e%16]+Ar[Math.trunc(e/16)]}V.squareToString=Wd;function Kd(e){if(typeof e!="string"||!/^[a-h][1-8]$/.test(e))return-1;let t=wr.indexOf(e[0]);return Ar.indexOf(e[1])*16+t}V.squareFromString=Kd;function Yd(e){return Er[e%2]+Sr[Math.trunc(e/2)]}V.coloredPieceToString=Yd;function Xd(e){if(typeof e!="string"||!/^[wb][kqrbnp]$/.test(e))return-1;let t=Er.indexOf(e[0]);return Sr.indexOf(e[1])*2+t}V.coloredPieceFromString=Xd;function Qd(e){return(~e^e>>4)&1}V.squareColorImpl=Qd});var Bn=m(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.makeCopy=Le.make960FromScharnagl=Le.makeInitial=Le.makeEmpty=Le.hasCanonicalStartPosition=void 0;var zd=[-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1],Bo=[4,8,6,2,0,6,8,4,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],Zd=[10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,10,10,-1,-1,10,10,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,5,9,7,3,1,7,9,5],Ho=[{board:Bo,castling:[129,129],king:[4,116]},null,null,null,null,{board:Bo,castling:[0,0],king:[-1,-1]},{board:Zd,castling:[0,129],king:[-1,116]}];function Jd(e){return Ho[e]!==null}Le.hasCanonicalStartPosition=Jd;function eg(e){return{board:zd.slice(),turn:0,castling:[0,0],enPassant:-1,variant:e,legal:e===2,king:[-1,-1],effectiveCastling:[0,0],effectiveEnPassant:-1}}Le.makeEmpty=eg;function tg(e){let t=Ho[e];return{board:t.board.slice(),turn:0,castling:t.castling.slice(),enPassant:-1,variant:e,legal:!0,king:t.king.slice(),effectiveCastling:t.castling.slice(),effectiveEnPassant:-1}}Le.makeInitial=tg;function ng(e){let t=rg(e),n=t.pieceScheme.map(i=>i*2+0),r=t.pieceScheme.map(i=>i*2+1);return{board:[n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],-2,-2,-2,-2,-2,-2,-2,-2,10,10,10,10,10,10,10,10,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,-1,-2,-2,-2,-2,-2,-2,-2,-2,11,11,11,11,11,11,11,11,-2,-2,-2,-2,-2,-2,-2,-2,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]],turn:0,castling:[t.castling,t.castling],enPassant:-1,variant:1,legal:!0,king:[0+t.kingFile,112+t.kingFile],effectiveCastling:[t.castling,t.castling],effectiveEnPassant:-1}}Le.make960FromScharnagl=ng;function rg(e){let t=[-1,-1,-1,-1,-1,-1,-1,-1],n=0,r=-1;function i(a){let o=0;for(let u=0;u<8;++u)t[u]>=0||(a(u,o),++o)}function s(a,o,u){i((l,f)=>{(f===o||f===u)&&(t[l]=a)})}switch(t[e%4*2+1]=3,e=Math.trunc(e/4),t[e%4*2]=3,e=Math.trunc(e/4),s(1,e%6,-1),e=Math.trunc(e/6),e){case 0:s(4,0,1);break;case 1:s(4,0,2);break;case 2:s(4,0,3);break;case 3:s(4,0,4);break;case 4:s(4,1,2);break;case 5:s(4,1,3);break;case 6:s(4,1,4);break;case 7:s(4,2,3);break;case 8:s(4,2,4);break;case 9:s(4,3,4);break}return i((a,o)=>{o===1?(t[a]=0,r=a):(t[a]=2,n|=1<<a)}),{pieceScheme:t,castling:n,kingFile:r}}function ig(e){return{board:e.board.slice(),turn:e.turn,castling:e.castling.slice(),enPassant:e.enPassant,variant:e.variant,legal:e.legal,king:e.king.slice(),effectiveCastling:e.effectiveCastling===null?null:e.effectiveCastling.slice(),effectiveEnPassant:e.effectiveEnPassant}}Le.makeCopy=ig});var Hn=m(ge=>{"use strict";Object.defineProperty(ge,"__esModule",{value:!0});ge.isValidECO=ge.nagSymbol=ge.variantWithCanonicalStartPosition=ge.oppositeColor=ge.coordinatesToSquare=ge.squareToCoordinates=ge.squareColor=ge.forEachSquare=void 0;var on=Ae(),et=ft(),sg=Bn();function ag(e){for(let t=0;t<8;++t)for(let n=0;n<8;++n)e((0,et.squareToString)(t*16+n))}ge.forEachSquare=ag;function og(e){let t=(0,et.squareFromString)(e);if(t<0)throw new on.IllegalArgument("squareColor()");return(0,et.colorToString)((0,et.squareColorImpl)(t))}ge.squareColor=og;function ug(e){let t=(0,et.squareFromString)(e);if(t<0)throw new on.IllegalArgument("squareToCoordinates()");return{rank:Math.trunc(t/16),file:t%16}}ge.squareToCoordinates=ug;function lg(e,t){let n=typeof e=="number"?e:e.file,r=typeof e=="number"?t:e.rank;if(!Number.isInteger(n)||!Number.isInteger(r)||n<0||n>=8||r<0||r>=8)throw new on.IllegalArgument("coordinatesToSquare()");return(0,et.fileToString)(n)+(0,et.rankToString)(r)}ge.coordinatesToSquare=lg;function cg(e){let t=(0,et.colorFromString)(e);if(t<0)throw new on.IllegalArgument("oppositeColor()");return(0,et.colorToString)(1-t)}ge.oppositeColor=cg;function fg(e){let t=(0,et.variantFromString)(e);if(t<0)throw new on.IllegalArgument("variantWithCanonicalStartPosition()");return(0,sg.hasCanonicalStartPosition)(t)}ge.variantWithCanonicalStartPosition=fg;var z=new Map;z.set(1,"!");z.set(2,"?");z.set(3,"!!");z.set(4,"??");z.set(5,"!?");z.set(6,"?!");z.set(7,"\u25A1");z.set(8,"\u25A1");z.set(10,"=");z.set(11,"=");z.set(13,"\u221E");z.set(14,"\u2A72");z.set(15,"\u2A71");z.set(16,"\xB1");z.set(17,"\u2213");z.set(18,"+\u2212");z.set(19,"\u2212+");z.set(22,"\u2A00");z.set(32,"\u27F3");z.set(36,"\u2191");z.set(40,"\u2192");z.set(132,"\u21C6");z.set(138,"\u2A01");z.set(140,"\u2206");z.set(141,"\u2207");z.set(142,"\u2313");z.set(143,"\u2264");z.set(145,"RR");z.set(146,"N");function hg(e){if(!Number.isInteger(e)||e<0)throw new on.IllegalArgument("nagSymbol()");let t=z.get(e);return t===void 0?"$"+e:t}ge.nagSymbol=hg;function dg(e){return/^[A-E][0-9][0-9]$/.test(e)}ge.isValidECO=dg});var Ir=m(Et=>{"use strict";var bt=Et&&Et.__classPrivateFieldSet||function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},re=Et&&Et.__classPrivateFieldGet||function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},un,Be,Fe,He;Object.defineProperty(Et,"__esModule",{value:!0});Et.DateValue=void 0;var Bi=Ae(),Ui=class{constructor(t,n,r){if(un.set(this,void 0),Be.set(this,void 0),Fe.set(this,void 0),He.set(this,void 0),t instanceof Date)bt(this,un,"ymd","f"),bt(this,Be,t.getFullYear(),"f"),bt(this,Fe,t.getMonth()+1,"f"),bt(this,He,t.getDate(),"f");else{let i=jo(t,n,r);if(!i)throw new Bi.IllegalArgument("DateValue()");bt(this,un,i,"f"),bt(this,Be,t,"f"),bt(this,Fe,n===null?void 0:n,"f"),bt(this,He,r===null?void 0:r,"f")}}type(){return re(this,un,"f")}year(){return re(this,Be,"f")}month(){if(re(this,Fe,"f")===void 0)throw new Bi.IllegalArgument("DateValue.month()");return re(this,Fe,"f")}day(){if(re(this,He,"f")===void 0)throw new Bi.IllegalArgument("DateValue.day()");return re(this,He,"f")}toDate(){let t=re(this,Fe,"f")===void 0?0:re(this,Fe,"f")-1,n=re(this,He,"f")===void 0?1:re(this,He,"f");return new Date(re(this,Be,"f"),t,n)}toString(){return Uo(re(this,Be,"f"),re(this,Fe,"f"),re(this,He,"f"),"-","**")}toPGNString(){return Uo(re(this,Be,"f"),re(this,Fe,"f"),re(this,He,"f"),".","??")}toHumanReadableString(t){switch(re(this,un,"f")){case"ymd":{let n=new Date(re(this,Be,"f"),re(this,Fe,"f")-1,re(this,He,"f"));return new Intl.DateTimeFormat(t,{dateStyle:"long"}).format(n)}case"ym":{let n=new Date(re(this,Be,"f"),re(this,Fe,"f")-1,1);return new Intl.DateTimeFormat(t,{month:"long",year:"numeric"}).format(n)}default:return String(re(this,Be,"f"))}}static isValid(t,n,r){return Boolean(jo(t,n,r))}};Et.DateValue=Ui;un=new WeakMap,Be=new WeakMap,Fe=new WeakMap,He=new WeakMap;function Uo(e,t,n,r,i){let s=String(e).padStart(4,"0"),a=t===void 0?i:String(t).padStart(2,"0"),o=n===void 0?i:String(n).padStart(2,"0");return s+r+a+r+o}function jo(e,t,n){return n!=null?Hi(e)&&Wo(t)&&Number.isInteger(n)&&n>=1&&n<=gg(e,t)?"ymd":!1:t!=null?Hi(e)&&Wo(t)?"ym":!1:Hi(e)?"y":!1}function Hi(e){return Number.isInteger(e)&&e>=0}function Wo(e){return Number.isInteger(e)&&e>=1&&e<=12}function gg(e,t){return new Date(e,t,0).getDate()}});var ji=m(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.isMoveDescriptor=ln.MoveDescriptor=void 0;var Nr=class{constructor(){}toString(){let t=this.from()+this.to();return this.isPromotion()?t+=this.promotion().toUpperCase():this.isCastling()&&(t+="O"),t}};ln.MoveDescriptor=Nr;function _g(e){return e instanceof Nr}ln.isMoveDescriptor=_g});var Un=m(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.getAttacks=De.isAttacked=De.ATTACK_DIRECTIONS=void 0;De.ATTACK_DIRECTIONS=[[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-17,-16,-15,-1,1,15,16,17],[-16,-1,1,16],[-16,-1,1,16],[-17,-15,15,17],[-17,-15,15,17],[-33,-31,-18,-14,14,18,31,33],[-33,-31,-18,-14,14,18,31,33],[15,17],[-17,-15]];function pg(e,t,n){return Wi(e,t,0*2+n)||Wi(e,t,4*2+n)||Wi(e,t,5*2+n)||Ko(e,t,2*2+n,1*2+n)||Ko(e,t,3*2+n,1*2+n)}De.isAttacked=pg;function Wi(e,t,n){let r=De.ATTACK_DIRECTIONS[n];for(let i=0;i<r.length;++i){let s=t-r[i];if((s&136)===0&&e.board[s]===n)return!0}return!1}function Ko(e,t,n,r){let i=De.ATTACK_DIRECTIONS[n];for(let s=0;s<i.length;++s){let a=t;for(;;){if(a-=i[s],(a&136)===0){let o=e.board[a];if(o===-1)continue;if(o===n||o===r)return!0}break}}return!1}function mg(e,t,n){let r=[];return Ki(e,t,r,0*2+n),Ki(e,t,r,4*2+n),Ki(e,t,r,5*2+n),Yo(e,t,r,2*2+n,1*2+n),Yo(e,t,r,3*2+n,1*2+n),r}De.getAttacks=mg;function Ki(e,t,n,r){let i=De.ATTACK_DIRECTIONS[r];for(let s=0;s<i.length;++s){let a=t-i[s];(a&136)===0&&e.board[a]===r&&n.push(a)}}function Yo(e,t,n,r,i){let s=De.ATTACK_DIRECTIONS[r];for(let a=0;a<s.length;++a){let o=t;for(;;){if(o-=s[a],(o&136)===0){let u=e.board[o];if(u===-1)continue;(u===r||u===i)&&n.push(o)}break}}}});var cn=m(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.isEqual=Pe.refreshEffectiveEnPassant=Pe.refreshEffectiveCastling=Pe.isKingSafeAfterMove=Pe.refreshLegalFlagAndKingSquares=Pe.isLegal=void 0;var Jo=Un();function yg(e){return Pr(e),e.legal}Pe.isLegal=yg;function Pr(e){if(e.legal!==null)return;e.legal=!1;let t=Xo(e,0),n=Xo(e,1);if(!t||!n)return;if(e.variant===5){if(!Qo(e,1-e.turn))return}else if(e.variant===6&&e.turn===1&&!Qo(e,0))return;if(e.king[1-e.turn]>=0&&(0,Jo.isAttacked)(e,e.king[1-e.turn],e.turn))return;let r=e.variant===6?-2:10;for(let i=0;i<8;++i){let s=e.board[0+i],a=e.board[112+i];if(s===r||a===10||s===11||a===11)return}e.legal=!0}Pe.refreshLegalFlagAndKingSquares=Pr;function Xo(e,t){let n=0+t;if(e.king[t]=-1,e.variant===5)return!0;if(e.variant===2||e.variant===4-t||e.variant===6&&t===0){for(let r=0;r<120;r+=(r&7)===7?9:1)if(e.board[r]===n)return!1;return!0}else{for(let r=0;r<120;r+=(r&7)===7?9:1)if(e.board[r]===n)if(e.king[t]<0)e.king[t]=r;else return e.king[t]=-1,!1;return e.king[t]>=0}}function Qo(e,t){for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==-1&&e.board[n]%2===t)return!0;return!1}function Yi(e,t,n,r=-1){if(e.king[e.turn]<0)return!0;let i=e.board[t],s=e.board[n],a=Math.trunc(i/2);e.board[n]=i,e.board[t]=-1,r>=0&&(e.board[r]=-1);try{return!(0,Jo.isAttacked)(e,a===0?n:e.king[e.turn],1-e.turn)}finally{e.board[t]=i,e.board[n]=s,r>=0&&(e.board[r]=5*2+1-e.turn)}}Pe.isKingSafeAfterMove=Yi;function Xi(e){e.effectiveCastling===null&&(Pr(e),e.effectiveCastling=e.variant===1?[Zo(e,0),Zo(e,1)]:[zo(e,0),zo(e,1)])}Pe.refreshEffectiveCastling=Xi;function zo(e,t){let n=112*t;if(e.king[t]!==n+4||e.castling[t]===0)return 0;let r=2*2+t,i=0;return(e.castling[t]&1)!==0&&e.board[n]===r&&(i|=1),(e.castling[t]&128)!==0&&e.board[n+7]===r&&(i|=128),i}function Zo(e,t){let n=112*t;if(e.king[t]<=n||e.king[t]>=n+7||e.castling[t]===0)return 0;let r=2*2+t,i=0,s=-1;for(let o=e.king[t]%16-1;o>=0;--o)if(!((e.castling[t]&1<<o)===0||e.board[n+o]!==r))if(s<0)s=o;else{s=-1;break}s>=0&&(i|=1<<s);let a=-1;for(let o=e.king[t]%16+1;o<8;++o)if(!((e.castling[t]&1<<o)===0||e.board[n+o]!==r))if(a<0)a=o;else{a=-1;break}return a>=0&&(i|=1<<a),i}function Qi(e){if(e.effectiveEnPassant!==null||(e.effectiveEnPassant=-1,e.enPassant<0))return;let t=(6-e.turn*5)*16+e.enPassant,n=(5-e.turn*3)*16+e.enPassant,r=(4-e.turn)*16+e.enPassant,i=5*2+e.turn,s=5*2+1-e.turn;if(e.board[t]!==-1||e.board[n]!==-1||e.board[r]!==s)return;let a=(r-1&136)===0&&e.board[r-1]===i,o=(r+1&136)===0&&e.board[r+1]===i;!a&&!o||(Pr(e),!(!(a&&Yi(e,r-1,n,r))&&!(o&&Yi(e,r+1,n,r)))&&(e.effectiveEnPassant=e.enPassant))}Pe.refreshEffectiveEnPassant=Qi;function vg(e,t){if(e.turn!==t.turn||e.variant!==t.variant)return!1;for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==t.board[n])return!1;return Xi(e),Xi(t),e.effectiveCastling[0]!==t.effectiveCastling[0]||e.effectiveCastling[1]!==t.effectiveCastling[1]?!1:(Qi(e),Qi(t),e.effectiveEnPassant===t.effectiveEnPassant)}Pe.isEqual=vg});var Cr=m(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.parseFEN=St.getFEN=St.ascii=void 0;var tt=ft(),bg=Bn(),zi=cn(),Ue=Ae(),je=ct(),Zi=[..."KkQqRrBbNnPp"],tu=["6","3"];function Eg(e){let t=`+---+---+---+---+---+---+---+---+
`;for(let n=7;n>=0;--n){for(let r=0;r<8;++r){let i=e.board[n*16+r];t+="| "+(i===-1?" ":Zi[i])+" "}t+=`|
`,t+=`+---+---+---+---+---+---+---+---+
`}return t+=(0,tt.colorToString)(e.turn)+" "+nu(e)+" "+ru(e),e.variant!==0&&(t+=" ("+(0,tt.variantToString)(e.variant)+")"),t}St.ascii=Eg;function Sg(e,t=0,n=1,r=!1){let i="";for(let s=7;s>=0;--s){let a=0;for(let o=0;o<8;++o){let u=e.board[s*16+o];u===-1?++a:(a>0&&(i+=a,a=0),i+=Zi[u])}a>0&&(i+=a),s>0&&(i+="/")}return i+=" "+(0,tt.colorToString)(e.turn)+" "+nu(e,r)+" "+ru(e),i+=" "+t+" "+n,i}St.getFEN=Sg;function nu(e,t=!1){if((0,zi.refreshEffectiveCastling)(e),e.variant===1){if(t){let i=eu(e,0),s=eu(e,1);if(i!==!1&&s!==!1)return i===""&&s===""?"-":i.toUpperCase()+s}let n="",r="";for(let i=0;i<8;++i)e.effectiveCastling[0]&1<<i&&(n+=(0,tt.fileToString)(i)),e.effectiveCastling[1]&1<<i&&(r+=(0,tt.fileToString)(i));return n===""&&r===""?"-":n.toUpperCase()+r}else{let n="";return e.effectiveCastling[0]&128&&(n+="K"),e.effectiveCastling[0]&1&&(n+="Q"),e.effectiveCastling[1]&128&&(n+="k"),e.effectiveCastling[1]&1&&(n+="q"),n===""?"-":n}}function eu(e,t){let n=1<<e.king[t]%16,r=e.effectiveCastling[t]&~(n|n-1),i=e.effectiveCastling[t]&n-1,s="",a=112*t,o=112*t+7,u=2*2+t;if(r!==0){let l=!1;for(let f=e.king[t]+1;f<=o;++f)if(e.board[f]===u){if(l)return!1;l=!0}s+="k"}if(i!==0){let l=!1;for(let f=e.king[t]-1;f>=a;--f)if(e.board[f]===u){if(l)return!1;l=!0}s+="q"}return s}function ru(e){return(0,zi.refreshEffectiveEnPassant)(e),e.effectiveEnPassant<0?"-":(0,tt.fileToString)(e.effectiveEnPassant)+tu[e.turn]}function Ag(e,t,n){let r=n?t.split(" "):t.replace(/^\s+|\s+$/g,"").split(/\s+/);if(r.length!==6)throw new Ue.InvalidFEN(t,je.i18n.WRONG_NUMBER_OF_FEN_FIELDS);let i=r[0].split("/");if(i.length!==8)throw new Ue.InvalidFEN(t,je.i18n.WRONG_NUMBER_OF_SUBFIELDS_IN_BOARD_FIELD);let s=(0,bg.makeEmpty)(e);s.legal=null,s.effectiveCastling=null,s.effectiveEnPassant=null;for(let l=7;l>=0;--l){let f=i[7-l],d=0,h=0;for(;d<f.length&&h<8;){let y=f[d],p=Zi.indexOf(y);if(/^[1-8]$/.test(y))h+=parseInt(y,10);else if(p>=0)s.board[l*16+h]=p,++h;else throw new Ue.InvalidFEN(t,je.i18n.UNEXPECTED_CHARACTER_IN_BOARD_FIELD,y);++d}if(d!==f.length||h!==8)throw new Ue.InvalidFEN(t,je.i18n.UNEXPECTED_END_OF_SUBFIELD_IN_BOARD_FIELD,8-l)}if(s.turn=(0,tt.colorFromString)(r[1]),s.turn<0)throw new Ue.InvalidFEN(t,je.i18n.INVALID_TURN_FIELD);let a=e===1?Ig(r[2],n,s.board):wg(r[2],n);if(a===null)throw new Ue.InvalidFEN(t,je.i18n.INVALID_CASTLING_FIELD);s.castling=a;let o=r[3];if(o!=="-"){if(!/^[a-h][36]$/.test(o))throw new Ue.InvalidFEN(t,je.i18n.INVALID_EN_PASSANT_FIELD);if(s.enPassant=(0,tt.fileFromString)(o[0]),n){if(o[1]!==tu[s.turn])throw new Ue.InvalidFEN(t,je.i18n.WRONG_RANK_IN_EN_PASSANT_FIELD);if((0,zi.refreshEffectiveEnPassant)(s),s.enPassant!==s.effectiveEnPassant)throw new Ue.InvalidFEN(t,je.i18n.INEFFECTIVE_EN_PASSANT_FIELD,(0,tt.fileToString)(s.enPassant))}}let u=n?/^(?:0|[1-9][0-9]*)$/:/^[0-9]+$/;if(!u.test(r[4]))throw new Ue.InvalidFEN(t,je.i18n.INVALID_HALF_MOVE_COUNT_FIELD);if(!u.test(r[5]))throw new Ue.InvalidFEN(t,je.i18n.INVALID_MOVE_NUMBER_FIELD);return{position:s,fiftyMoveClock:parseInt(r[4],10),fullMoveNumber:parseInt(r[5],10)}}St.parseFEN=Ag;function wg(e,t){let n=[0,0];return e==="-"?n:(t?/^K?Q?k?q?$/:/^[KQkq]*$/).test(e)?(e.indexOf("K")>=0&&(n[0]|=1<<7),e.indexOf("Q")>=0&&(n[0]|=1<<0),e.indexOf("k")>=0&&(n[1]|=1<<7),e.indexOf("q")>=0&&(n[1]|=1<<0),n):null}function Ig(e,t,n){let r=[0,0];if(e==="-")return r;if(!(t?/^[A-H]{0,2}[a-h]{0,2}$/:/^[A-Ha-h]*|[KQkq]*$/).test(e))return null;function i(a){let o=4+a,u=0*2+a;for(let l=112*a;l<112*a+8;++l){if(n[l]===o)return l%8;if(n[l]===u)break}return 0}function s(a){let o=4+a,u=0*2+a;for(let l=112*a+7;l>=112*a;--l){if(n[l]===o)return l%8;if(n[l]===u)break}return 7}t||(e.indexOf("K")>=0&&(r[0]|=1<<s(0)),e.indexOf("Q")>=0&&(r[0]|=1<<i(0)),e.indexOf("k")>=0&&(r[1]|=1<<s(1)),e.indexOf("q")>=0&&(r[1]|=1<<i(1)));for(let a=0;a<8;++a){let o=(0,tt.fileToString)(a);e.indexOf(o.toUpperCase())>=0&&(r[0]|=1<<a),e.indexOf(o)>=0&&(r[1]|=1<<a)}return r}});var kr=m(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.MoveDescriptorImpl=void 0;var $e=ft(),Vt=Ae(),Ng=ji(),iu=1,su=2,Tr=4,au=8,At=class extends Ng.MoveDescriptor{constructor(t,n,r,i,s,a,o,u){super(),this._flags=t,this._from=n,this._to=r,this._movingColoredPiece=i,this._finalColoredPiece=s,this._optionalColoredPiece=a,this._optionalSquare1=o,this._optionalSquare2=u}static make(t,n,r,i){let s=i===-1?0:Tr;return new At(s,t,n,r,r,i,-1,-1)}static makeCastling(t,n,r,i,s){let a=0+s,o=2*2+s;return new At(iu,t,n,a,a,o,r,i)}static makeEnPassant(t,n,r,i){let s=su|Tr,a=5*2+i,o=5*2+1-i;return new At(s,t,n,a,a,o,r,-1)}static makePromotion(t,n,r,i,s){let a=au|(i===-1?0:Tr),o=5*2+r,u=s*2+r;return new At(a,t,n,o,u,i,-1,-1)}isCastling(){return(this._flags&iu)!==0}isEnPassant(){return(this._flags&su)!==0}isCapture(){return(this._flags&Tr)!==0}isPromotion(){return(this._flags&au)!==0}from(){return(0,$e.squareToString)(this._from)}to(){return(0,$e.squareToString)(this._to)}color(){return(0,$e.colorToString)(this._movingColoredPiece%2)}movingPiece(){return(0,$e.pieceToString)(Math.trunc(this._movingColoredPiece/2))}movingColoredPiece(){return(0,$e.coloredPieceToString)(this._movingColoredPiece)}capturedPiece(){if(!this.isCapture())throw new Vt.IllegalArgument("MoveDescriptor.capturedPiece()");return(0,$e.pieceToString)(Math.trunc(this._optionalColoredPiece/2))}capturedColoredPiece(){if(!this.isCapture())throw new Vt.IllegalArgument("MoveDescriptor.capturedColoredPiece()");return(0,$e.coloredPieceToString)(this._optionalColoredPiece)}rookFrom(){if(!this.isCastling())throw new Vt.IllegalArgument("MoveDescriptor.rookFrom()");return(0,$e.squareToString)(this._optionalSquare1)}rookTo(){if(!this.isCastling())throw new Vt.IllegalArgument("MoveDescriptor.rookTo()");return(0,$e.squareToString)(this._optionalSquare2)}enPassantSquare(){if(!this.isEnPassant())throw new Vt.IllegalArgument("MoveDescriptor.enPassantSquare()");return(0,$e.squareToString)(this._optionalSquare1)}promotion(){if(!this.isPromotion())throw new Vt.IllegalArgument("MoveDescriptor.promotion()");return(0,$e.pieceToString)(Math.trunc(this._finalColoredPiece/2))}coloredPromotion(){if(!this.isPromotion())throw new Vt.IllegalArgument("MoveDescriptor.coloredPromotion()");return(0,$e.coloredPieceToString)(this._finalColoredPiece)}};Rr.MoveDescriptorImpl=At});var xr=m(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.playNullMove=ne.isNullMoveLegal=ne.play=ne.isMoveLegal=ne.isCastlingMoveLegal=ne.isCaptureMandatory=ne.moves=ne.hasMove=ne.isDead=ne.isStalemate=ne.isCheckmate=ne.isCheck=void 0;var fn=Un(),uu=ft(),ae=cn(),ye=kr(),Pg=[204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,0,768,2255,2111,2255,768,0,0,0,0,0,0,60,60,60,60,60,60,63,0,63,60,60,60,60,60,60,0,0,0,0,0,0,768,1231,1087,1231,768,0,0,0,0,0,0,0,0,0,0,0,204,768,60,768,204,0,0,0,0,0,0,0,0,0,0,204,0,0,60,0,0,204,0,0,0,0,0,0,0,0,204,0,0,0,60,0,0,0,204,0,0,0,0,0,0,204,0,0,0,0,60,0,0,0,0,204,0,0,0,0,204,0,0,0,0,0,60,0,0,0,0,0,204,0,0,204,0,0,0,0,0,0,60,0,0,0,0,0,0,204,0],Cg=[-17,0,0,0,0,0,0,-16,0,0,0,0,0,0,-15,0,0,-17,0,0,0,0,0,-16,0,0,0,0,0,-15,0,0,0,0,-17,0,0,0,0,-16,0,0,0,0,-15,0,0,0,0,0,0,-17,0,0,0,-16,0,0,0,-15,0,0,0,0,0,0,0,0,-17,0,0,-16,0,0,-15,0,0,0,0,0,0,0,0,0,0,-17,0,-16,0,-15,0,0,0,0,0,0,0,0,0,0,0,0,-17,-16,-15,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,15,16,17,0,0,0,0,0,0,0,0,0,0,0,0,15,0,16,0,17,0,0,0,0,0,0,0,0,0,0,15,0,0,16,0,0,17,0,0,0,0,0,0,0,0,15,0,0,0,16,0,0,0,17,0,0,0,0,0,0,15,0,0,0,0,16,0,0,0,0,17,0,0,0,0,15,0,0,0,0,0,16,0,0,0,0,0,17,0,0,15,0,0,0,0,0,0,16,0,0,0,0,0,0,17,0];function lu(e,t){for(let n=0;n<120;n+=(n&7)===7?9:1)if(e.board[n]!==-1&&e.board[n]%2===t)return!0;return!1}function Or(e){return e.king[e.turn]>=0&&(0,fn.isAttacked)(e,e.king[e.turn],1-e.turn)}function Tg(e){return(0,ae.isLegal)(e)&&Or(e)}ne.isCheck=Tg;function Rg(e){return!(0,ae.isLegal)(e)||Ji(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?!lu(e,0):Or(e)}ne.isCheckmate=Rg;function kg(e){return!(0,ae.isLegal)(e)||Ji(e)?!1:e.variant===5?!0:e.variant===6&&e.turn===0?lu(e,0):!Or(e)}ne.isStalemate=kg;function Og(e,t){return(0,ae.isLegal)(e)&&(e.variant===0||e.variant===1)?t?Mg(e):xg(e):!1}ne.isDead=Og;function xg(e){let t=!1,n=-1;for(let r=0;r<120;r+=(r&7)===7?9:1){let i=e.board[r];if(i===-1)continue;let s=Math.trunc(i/2);if(s===3){let a=(0,uu.squareColorImpl)(r);if(n===a)continue;n=a}if(s===3||s===4){if(t)return!1;t=!0}else if(s!==0)return!1}return!0}function Mg(e){let t=[0,0],n=[-1,-1];for(let r=0;r<120;r+=(r&7)===7?9:1){let i=e.board[r];if(i===-1)continue;let s=i%2,a=Math.trunc(i/2);if(a===3){let o=(0,uu.squareColorImpl)(r);if(n[s]===o)continue;n[s]=o}if(a===3||a===4){if(t[s]+=a===3?2:1,t[s]>=3)return!1}else if(a!==0)return!1}return!0}function Ji(e){class t{}try{return cu(e,()=>{throw new t}),!1}catch(n){if(n instanceof t)return!0;throw n}}ne.hasMove=Ji;function Lg(e){let t=[];return cu(e,n=>{t.push(n)}),t}ne.moves=Lg;function cu(e,t){if(!(0,ae.isLegal)(e))return;let n=!es(e);if((0,ae.refreshEffectiveCastling)(e),n&&e.effectiveCastling[e.turn]!==0){let r=112*e.turn;for(let i=0;i<8;++i)if((e.effectiveCastling[e.turn]&1<<i)!==0){let s=r+i,a=r+(s<e.king[e.turn]?3:5),o=r+(s<e.king[e.turn]?2:6);hu(e,e.king[e.turn],o,s,a)&&t(ye.MoveDescriptorImpl.makeCastling(e.king[e.turn],o,s,a,e.turn))}}if((0,ae.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0){let r=(5-e.turn*3)*16+e.effectiveEnPassant,i=(4-e.turn)*16+e.effectiveEnPassant,s=5*2+e.turn;(i-1&136)===0&&e.board[i-1]===s&&(0,ae.isKingSafeAfterMove)(e,i-1,r,i)&&t(ye.MoveDescriptorImpl.makeEnPassant(i-1,r,i,e.turn)),(i+1&136)===0&&e.board[i+1]===s&&(0,ae.isKingSafeAfterMove)(e,i+1,r,i)&&t(ye.MoveDescriptorImpl.makeEnPassant(i+1,r,i,e.turn))}for(let r=0;r<120;r+=(r&7)===7?9:1){let i=e.board[r],s=Math.trunc(i/2);if(!(i===-1||i%2!==e.turn))if(s===5){let a=fn.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o){let u=r+a[o];(u&136)===0&&e.board[u]!==-1&&e.board[u]%2!==e.turn&&(0,ae.isKingSafeAfterMove)(e,r,u)&&ou(e,r,u,t)}if(n){let o=16-e.turn*32,u=r+o;if(e.board[u]===-1){(0,ae.isKingSafeAfterMove)(e,r,u)&&ou(e,r,u,t);let l=e.turn*96;r>=l&&r<l+24&&(u+=o,e.board[u]===-1&&(0,ae.isKingSafeAfterMove)(e,r,u)&&t(ye.MoveDescriptorImpl.make(r,u,i,-1)))}}}else if(s===4||s===0){let a=fn.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o){let u=r+a[o];if((u&136)===0){let l=e.board[u];(l===-1?n:l%2!==e.turn)&&(0,ae.isKingSafeAfterMove)(e,r,u)&&t(ye.MoveDescriptorImpl.make(r,u,i,l))}}}else{let a=fn.ATTACK_DIRECTIONS[i];for(let o=0;o<a.length;++o)for(let u=r+a[o];(u&136)===0;u+=a[o]){let l=e.board[u];if((l===-1?n:l%2!==e.turn)&&(0,ae.isKingSafeAfterMove)(e,r,u)&&t(ye.MoveDescriptorImpl.make(r,u,i,l)),l!==-1)break}}}}function ou(e,t,n,r){let i=e.board[n];n<8||n>=112?(r(ye.MoveDescriptorImpl.makePromotion(t,n,e.turn,i,1)),r(ye.MoveDescriptorImpl.makePromotion(t,n,e.turn,i,2)),r(ye.MoveDescriptorImpl.makePromotion(t,n,e.turn,i,3)),r(ye.MoveDescriptorImpl.makePromotion(t,n,e.turn,i,4)),e.variant===5&&r(ye.MoveDescriptorImpl.makePromotion(t,n,e.turn,i,0))):r(ye.MoveDescriptorImpl.make(t,n,5*2+e.turn,i))}function es(e){if(e.variant!==5)return!1;for(let t=0;t<120;t+=(t&7)===7?9:1){let n=e.board[t];if(n!==-1&&n%2!==e.turn&&(0,fn.isAttacked)(e,t,e.turn))return!0}return(0,ae.refreshEffectiveEnPassant)(e),e.effectiveEnPassant>=0}ne.isCaptureMandatory=es;function fu(e,t,n){let r=-1,i=-1;if(e.variant===1){let s=n%16;if(Math.trunc(n/16)!==e.turn*7||(e.effectiveCastling[e.turn]&1<<s)===0)return!1;r=n,i=(t>n?3:5)+112*e.turn,n=(t>n?2:6)+112*e.turn}else if(n===2+e.turn*112){if((e.effectiveCastling[e.turn]&1)===0)return!1;r=112*e.turn,i=3+112*e.turn}else if(n===6+e.turn*112){if((e.effectiveCastling[e.turn]&1<<7)===0)return!1;r=7+112*e.turn,i=5+112*e.turn}else return!1;return hu(e,t,n,r,i)?ye.MoveDescriptorImpl.makeCastling(t,n,r,i,e.turn):!1}ne.isCastlingMoveLegal=fu;function hu(e,t,n,r,i){e.board[t]=-1,e.board[r]=-1;try{for(let a=Math.min(t,n,r,i);a<=Math.max(t,n,r,i);++a)if(e.board[a]!==-1)return!1;let s=1-e.turn;for(let a=Math.min(t,n);a<=Math.max(t,n);++a)if((0,fn.isAttacked)(e,a,s))return!1;return!0}finally{e.board[t]=0*2+e.turn,e.board[r]=2*2+e.turn}}function Fg(e,t,n){if(!(0,ae.isLegal)(e))return!1;let r=e.board[t],i=e.board[n],s=Math.trunc(r/2);if(r===-1||r%2!==e.turn)return!1;let a=n-t+119,o=-1,u=!1,l=s===5&&(n<8||n>=112),f=es(e);if(s===0&&!f&&((0,ae.refreshEffectiveCastling)(e),e.effectiveCastling[e.turn]!==0)){let d=fu(e,t,n);if(d)return{type:"regular",moveDescriptor:d}}if((Pg[a]&1<<r)===0)if(s===5&&a===151-e.turn*64){let d=e.turn*96;if(t<d||t>=d+24)return!1;u=!0}else return!1;if(s===5){if((0,ae.refreshEffectiveEnPassant)(e),a===135-e.turn*32||u){if(f||i!==-1)return!1}else if(i===-1){if(n!==(5-e.turn*3)*16+e.effectiveEnPassant)return!1;o=(4-e.turn)*16+e.effectiveEnPassant}else if(i%2===e.turn)return!1}else if(i===-1?f:i%2===e.turn)return!1;if(s===3||s===2||s===1){let d=Cg[a];for(let h=t+d;h!==n;h+=d)if(e.board[h]!==-1)return!1}else if(u&&e.board[(t+n)/2]!==-1)return!1;return(0,ae.isKingSafeAfterMove)(e,t,n,o)?l?{type:"promotion",moveDescriptorFactory:Dg(t,n,e.variant,e.turn,i)}:{type:"regular",moveDescriptor:o>=0?ye.MoveDescriptorImpl.makeEnPassant(t,n,o,e.turn):ye.MoveDescriptorImpl.make(t,n,r,i)}:!1}ne.isMoveLegal=Fg;function Dg(e,t,n,r,i){return s=>s===5||s===0&&n!==5?!1:ye.MoveDescriptorImpl.makePromotion(e,t,r,i,s)}function $g(e,t){(0,ae.refreshEffectiveCastling)(e),e.board[t._from]=-1,t.isEnPassant()?e.board[t._optionalSquare1]=-1:t.isCastling()&&(e.board[t._optionalSquare1]=-1,e.board[t._optionalSquare2]=t._optionalColoredPiece),e.board[t._to]=t._finalColoredPiece;let n=Math.trunc(t._movingColoredPiece/2);if(n===0&&(e.effectiveCastling[e.turn]=0),t._from<8&&(e.effectiveCastling[0]&=~(1<<t._from)),t._to<8&&(e.effectiveCastling[0]&=~(1<<t._to)),t._from>=112&&(e.effectiveCastling[1]&=~(1<<t._from%16)),t._to>=112&&(e.effectiveCastling[1]&=~(1<<t._to%16)),e.castling[0]=e.effectiveCastling[0],e.castling[1]=e.effectiveCastling[1],e.enPassant=-1,e.effectiveEnPassant=-1,n===5&&Math.abs(t._from-t._to)===32){let r=(1+5*e.turn)*16;if(t._from>=r&&t._from<r+8){let i=t._movingColoredPiece^1;((t._to-1&136)===0&&e.board[t._to-1]===i||(t._to+1&136)===0&&e.board[t._to+1]===i)&&(e.enPassant=t._to%16,e.effectiveEnPassant=null)}}n===0&&e.king[e.turn]>=0&&(e.king[e.turn]=t._to),e.turn=1-e.turn}ne.play=$g;function du(e){return(0,ae.isLegal)(e)&&!Or(e)}ne.isNullMoveLegal=du;function qg(e){return du(e)?(e.turn=1-e.turn,e.enPassant=-1,e.effectiveEnPassant=-1,!0):!1}ne.playNullMove=qg});var vu=m(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.parseNotation=dn.getNotation=void 0;var _u=Un(),we=ft(),Y=Cr(),Vg=Bn(),jn=cn(),Lr=kr(),hn=xr(),X=Ae(),H=ct();function Gg(e,t,n){let r="";return t.isCastling()?r=t._to%16===6?"O-O":"O-O-O":Math.trunc(t._movingColoredPiece/2)===5?(t.isCapture()&&(r+=(0,we.fileToString)(t._from%16)+"x"),r+=(0,we.squareToString)(t._to),t.isPromotion()&&(r+="="+gu(t._finalColoredPiece,n))):(r+=gu(t._movingColoredPiece,n),r+=mu(e,t._from,t._to),t.isCapture()&&(r+="x"),r+=(0,we.squareToString)(t._to)),r+=pu(e,t),r}dn.getNotation=Gg;function gu(e,t){switch(t){case"figurine":return(0,we.figurineToString)(e);case"standard":return(0,we.pieceToString)(Math.trunc(e/2)).toUpperCase()}}function pu(e,t){let n=(0,Vg.makeCopy)(e);return(0,hn.play)(n,t),(0,hn.isCheckmate)(n)?"#":(0,hn.isCheck)(n)?"+":""}function mu(e,t,n){let r=(0,_u.getAttacks)(e,n,e.turn).filter(l=>e.board[l]===e.board[t]);if(r.length<2)return"";let i=!1,s=!1,a=!1,o=Math.trunc(t/16),u=t%16;for(let l=0;l<r.length;++l){let f=r[l];f===t||Bg(e,f,n)||(i=!0,o===Math.trunc(f/16)&&(s=!0),u===f%16&&(a=!0))}return a?s?(0,we.squareToString)(t):(0,we.rankToString)(o):i?(0,we.fileToString)(u):""}function Bg(e,t,n){let r=e.king[e.turn];if(r<0)return!1;let i=Math.abs(r-t),s=Math.abs(n-t),a=1*2+1-e.turn,o=2*2+1-e.turn,u=3*2+1-e.turn;return i<8?s>=8&&Mr(e,r,t,r<t?1:-1,o,a):i%16===0?s%16!==0&&Mr(e,r,t,r<t?16:-16,o,a):i%15===0?s%15!==0&&Mr(e,r,t,r<t?15:-15,u,a):i%17===0?s%17!==0&&Mr(e,r,t,r<t?17:-17,u,a):!1}function Mr(e,t,n,r,i,s){for(let a=t+r;a!==n;a+=r)if(e.board[a]!==-1)return!1;for(let a=n+r;(a&136)===0;a+=r)if(e.board[a]!==-1)return e.board[a]===i||e.board[a]===s;return!1}function Hg(e,t,n,r){let i=/^(?:(O-O-O|0-0-0)|(O-O|0-0)|([A-Z\u2654-\u265f])([a-h])?([1-8])?(x)?([a-h][1-8])|(?:([a-h])(x)?)?([a-h][1-8])(?:(=)?([A-Z\u2654-\u265f]))?)([+#])?$/.exec(t);if(i===null)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_MOVE_NOTATION_SYNTAX);if(!(0,jn.isLegal)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_POSITION);let s=!1;if(i[1]!==void 0||i[2]!==void 0?s=Ug(e,t,n,i[1],i[2]):i[3]!==void 0?s=Wg(e,t,n,r,i[3],i[4],i[5],i[7]):s=Kg(e,t,n,r,i[8],i[10],i[11],i[12]),n){let a=i[6]!==void 0||i[9]!==void 0;if(s.isCapture()!==a){let l=s.isCapture()?H.i18n.MISSING_CAPTURE_SYMBOL:H.i18n.INVALID_CAPTURE_SYMBOL;throw new X.InvalidNotation((0,Y.getFEN)(e),t,l)}let o=pu(e,s),u=i[13]===void 0?"":i[13];if(o!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.WRONG_CHECK_CHECKMATE_SYMBOL,o,u)}return s}dn.parseNotation=Hg;function Ug(e,t,n,r,i){let s=e.king[e.turn];if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_NO_KING_CASTLING);(0,jn.refreshEffectiveCastling)(e);let a=i!==void 0,o=jg(e,a),u=o>=0?(0,hn.isCastlingMoveLegal)(e,s,o+112*e.turn):!1;if(!u){let l=a?H.i18n.ILLEGAL_KING_SIDE_CASTLING:H.i18n.ILLEGAL_QUEEN_SIDE_CASTLING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,l)}if(n&&(a?i:r).charAt(0)==="0")throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CASTLING_MOVE_ENCODED_WITH_ZERO);return u}function jg(e,t){if(e.variant===1){if(e.effectiveCastling[e.turn]!==0){let n=0+e.turn;for(let r=t?7:0;e.board[r+112*e.turn]!==n;r+=t?-1:1)if((e.effectiveCastling[e.turn]&1<<r)!==0)return r}return-1}else return t?6:2}function Wg(e,t,n,r,i,s,a,o){let u=yu(e,t,i,n,r)*2+e.turn,l=(0,we.squareFromString)(o),f=e.board[l];if(f!==-1&&f%2===e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.TRYING_TO_CAPTURE_YOUR_OWN_PIECES);if(f===-1&&(0,hn.isCaptureMandatory)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CAPTURE_IS_MANDATORY);let d=(0,_u.getAttacks)(e,l,e.turn).filter(y=>e.board[y]===u);if(s!==void 0){let y=(0,we.fileFromString)(s);d=d.filter(p=>p%16===y)}if(a!==void 0){let y=(0,we.rankFromString)(a);d=d.filter(p=>Math.trunc(p/16)===y)}if(d.length===0){let y=s===void 0&&a===void 0?H.i18n.NO_PIECE_CAN_MOVE_TO:H.i18n.NO_PIECE_CAN_MOVE_TO_DISAMBIGUATION;throw new X.InvalidNotation((0,Y.getFEN)(e),t,y,i,o)}let h=!1;for(let y=0;y<d.length;++y)if((0,jn.isKingSafeAfterMove)(e,d[y],l)){if(h)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.REQUIRE_DISAMBIGUATION,i,o);h=Lr.MoveDescriptorImpl.make(d[y],l,u,f)}if(!h){let y=e.turn===0?H.i18n.NOT_SAFE_FOR_WHITE_KING:H.i18n.NOT_SAFE_FOR_BLACK_KING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,y)}if(n){let y=mu(e,h._from,l),p=(s===void 0?"":s)+(a===void 0?"":a);if(y!==p)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.WRONG_DISAMBIGUATION_SYMBOL,y,p)}return h}function Kg(e,t,n,r,i,s,a,o){let u=10+e.turn,l=(0,we.squareFromString)(s),f=e.board[l],d=16-e.turn*32,h=l-d,y=-1;if(i!==void 0){if((h&136)!==0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);let p=(0,we.fileFromString)(i),S=l%16;if(S-p===1)h-=1;else if(S-p===-1)h+=1;else throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);if(e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);if(f===-1){if((0,jn.refreshEffectiveEnPassant)(e),l!==(5-e.turn*3)*16+e.effectiveEnPassant)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE);y=(4-e.turn)*16+e.effectiveEnPassant}else if(f%2===e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_CAPTURING_PAWN_MOVE)}else{if((0,hn.isCaptureMandatory)(e))throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.CAPTURE_IS_MANDATORY);if((h&136)!==0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(f!==-1)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE);if(e.board[h]===-1){h-=d;let p=e.turn*96;if(h<p||h>=p+24||e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}else if(e.board[h]!==u)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_NON_CAPTURING_PAWN_MOVE)}if(!(0,jn.isKingSafeAfterMove)(e,h,l,y)){let p=e.turn===0?H.i18n.NOT_SAFE_FOR_WHITE_KING:H.i18n.NOT_SAFE_FOR_BLACK_KING;throw new X.InvalidNotation((0,Y.getFEN)(e),t,p)}if(l<8||l>=112){if(o===void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.MISSING_PROMOTION);let p=yu(e,t,o,n,r);if(p===5||p===0&&e.variant!==5)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PROMOTED_PIECE,o);if(n&&a===void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.MISSING_PROMOTION_SYMBOL);return Lr.MoveDescriptorImpl.makePromotion(h,l,e.turn,f,p)}else{if(o!==void 0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.ILLEGAL_PROMOTION);return y>=0?Lr.MoveDescriptorImpl.makeEnPassant(h,l,y,e.turn):Lr.MoveDescriptorImpl.make(h,l,u,f)}}function yu(e,t,n,r,i){switch(i){case"figurine":{let s=(0,we.figurineFromString)(n);if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL,n);if(r&&s%2!==e.turn)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL_COLOR,n);return Math.trunc(s/2)}case"standard":{let s=(0,we.pieceFromString)(n.toLowerCase());if(s<0)throw new X.InvalidNotation((0,Y.getFEN)(e),t,H.i18n.INVALID_PIECE_SYMBOL,n);return s}}}});var bu=m(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.parseUCINotation=gn.getUCINotation=void 0;var ts=ft(),Gt=Cr(),Yg=cn(),Xg=xr(),Bt=Ae(),Ht=ct();function Qg(e,t,n){let r=t.from();return t.isCastling()?r+=n||e.variant===1?t.rookFrom():t.to():r+=t.to(),t.isPromotion()&&(r+=t.promotion()),r}gn.getUCINotation=Qg;function zg(e,t,n){let r=/^([a-h][1-8])([a-h][1-8])([kqrbnp]?)$/.exec(t);if(r===null)throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.INVALID_UCI_NOTATION_SYNTAX);if(!(0,Yg.isLegal)(e))throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_POSITION);let i=(0,ts.squareFromString)(r[1]),s=(0,ts.squareFromString)(r[2]),a=!1,o=-1;if(e.variant!==1&&!n&&e.board[i]!==-1&&e.board[s]!==-1&&e.board[i]%2===e.board[s]%2){let f=Math.trunc(e.board[i]/2),d=Math.trunc(e.board[s]/2);f===0&&d===2&&(a=!0,o=s,s=e.turn*112+(i<s?6:2))}let u=(0,Xg.isMoveLegal)(e,i,s),l=!1;if(!u)throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_UCI_MOVE);if(u.type==="promotion"){if(r[3]==="")throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_UCI_MOVE);if(l=u.moveDescriptorFactory((0,ts.pieceFromString)(r[3])),!l)throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_UCI_MOVE)}else{if(r[3]!=="")throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_UCI_MOVE);l=u.moveDescriptor}if(a&&(!l.isCastling()||o!==l._optionalSquare1))throw new Bt.InvalidNotation((0,Gt.getFEN)(e),t,Ht.i18n.ILLEGAL_UCI_MOVE);return l}gn.parseUCINotation=zg});var _n=m(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.Position=void 0;var J=Ae(),Zg=ct(),Eu=Un(),Z=ft(),wt=Cr(),Ie=Bn(),Wn=cn(),Kn=kr(),We=xr(),Ut=vu(),Fr=bu(),jt=class{constructor(t,n){switch(arguments.length){case 0:this._impl=(0,Ie.makeInitial)(0);break;case 1:{if(t==="start")this._impl=(0,Ie.makeInitial)(0);else if(t==="empty")this._impl=(0,Ie.makeEmpty)(0);else if(t instanceof jt)this._impl=(0,Ie.makeCopy)(t._impl);else{let r=(0,Z.variantFromString)(t);if(r>=0){if(!(0,Ie.hasCanonicalStartPosition)(r))throw new J.IllegalArgument("Position()");this._impl=(0,Ie.makeInitial)(r)}else if(typeof t=="string"){let i=t.indexOf(":");if(i<0)this._impl=(0,wt.parseFEN)(0,t,!1).position;else{let s=t.substring(0,i),a=(0,Z.variantFromString)(s);if(a<0)throw new J.InvalidFEN(t,Zg.i18n.INVALID_VARIANT_PREFIX,s);this._impl=(0,wt.parseFEN)(a,t.substring(i+1),!1).position}}else throw new J.IllegalArgument("Position()")}break}default:{let r=(0,Z.variantFromString)(t);if(r<0)throw new J.IllegalArgument("Position()");if(n==="start"){if(!(0,Ie.hasCanonicalStartPosition)(r))throw new J.IllegalArgument("Position()");this._impl=(0,Ie.makeInitial)(r)}else if(n==="empty")this._impl=(0,Ie.makeEmpty)(r);else if(typeof n=="number"){if(r!==1||!Su(n))throw new J.IllegalArgument("Position()");this._impl=(0,Ie.make960FromScharnagl)(n)}else if(typeof n=="string")this._impl=(0,wt.parseFEN)(r,n,!1).position;else throw new J.IllegalArgument("Position()");break}}}clear(t="regular"){let n=(0,Z.variantFromString)(t);if(n<0)throw new J.IllegalArgument("Position.clear()");this._impl=(0,Ie.makeEmpty)(n)}reset(){this._impl=(0,Ie.makeInitial)(0)}reset960(t){if(!Su(t))throw new J.IllegalArgument("Position.reset960()");this._impl=(0,Ie.make960FromScharnagl)(t)}resetAntichess(){this._impl=(0,Ie.makeInitial)(5)}resetHorde(){this._impl=(0,Ie.makeInitial)(6)}static isEqual(t,n){return t instanceof jt&&n instanceof jt&&(0,Wn.isEqual)(t._impl,n._impl)}ascii(){return(0,wt.ascii)(this._impl)}fen(t,n){if(arguments.length===0)return(0,wt.getFEN)(this._impl);if(arguments.length===1&&typeof t=="object"){let r=Jg(t,"Position.fen()"),i=r("fiftyMoveClock",0,u=>Number.isInteger(u)),s=r("fullMoveNumber",1,u=>Number.isInteger(u)),a=r("withVariant",!1,u=>typeof u=="boolean"),o=r("regularFENIfPossible",!1,u=>typeof u=="boolean");return(a?(0,Z.variantToString)(this._impl.variant)+":":"")+(0,wt.getFEN)(this._impl,i,s,o)}else if(arguments.length===1&&typeof t=="string"){let r=(0,wt.parseFEN)(this._impl.variant,t,!1);return this._impl=r.position,{fiftyMoveClock:r.fiftyMoveClock,fullMoveNumber:r.fullMoveNumber}}else if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean"){let r=(0,wt.parseFEN)(this._impl.variant,t,n);return this._impl=r.position,{fiftyMoveClock:r.fiftyMoveClock,fullMoveNumber:r.fullMoveNumber}}else throw new J.IllegalArgument("Position.fen()")}variant(){return(0,Z.variantToString)(this._impl.variant)}square(t,n){let r=(0,Z.squareFromString)(t);if(r<0)throw new J.IllegalArgument("Position.square()");if(arguments.length===1){let i=this._impl.board[r];return i===-1?"-":(0,Z.coloredPieceToString)(i)}else if(n==="-")this._impl.board[r]=-1,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null;else{let i=(0,Z.coloredPieceFromString)(n);if(i<0)throw new J.IllegalArgument("Position.square()");this._impl.board[r]=i,this._impl.legal=null,this._impl.effectiveCastling=null,this._impl.effectiveEnPassant=null}}turn(t){if(arguments.length===0)return(0,Z.colorToString)(this._impl.turn);{let n=(0,Z.colorFromString)(t);if(n<0)throw new J.IllegalArgument("Position.turn()");this._impl.turn=n,this._impl.legal=null,this._impl.effectiveEnPassant=null}}castling(t,n){if(typeof t!="string"||!(this._impl.variant===1?/^[wb][a-h]$/:/^[wb][kq]$/).test(t))throw new J.IllegalArgument("Position.castling()");let r=(0,Z.colorFromString)(t[0]),i=this._impl.variant===1?(0,Z.fileFromString)(t[1]):t[1]==="k"?7:0;if(arguments.length===1)return(this._impl.castling[r]&1<<i)!==0;if(typeof n=="boolean")n?this._impl.castling[r]|=1<<i:this._impl.castling[r]&=~(1<<i),this._impl.effectiveCastling=null;else throw new J.IllegalArgument("Position.castling()")}effectiveCastling(t){if(typeof t!="string"||!(this._impl.variant===1?/^[wb][a-h]$/:/^[wb][kq]$/).test(t))throw new J.IllegalArgument("Position.effectiveCastling()");let n=(0,Z.colorFromString)(t[0]),r=this._impl.variant===1?(0,Z.fileFromString)(t[1]):t[1]==="k"?7:0;return(0,Wn.refreshEffectiveCastling)(this._impl),(this._impl.effectiveCastling[n]&1<<r)!==0}enPassant(t){if(arguments.length===0)return this._impl.enPassant<0?"-":(0,Z.fileToString)(this._impl.enPassant);if(t==="-")this._impl.enPassant=-1,this._impl.effectiveEnPassant=-1;else{let n=(0,Z.fileFromString)(t);if(n<0)throw new J.IllegalArgument("Position.enPassant()");this._impl.enPassant=n,this._impl.effectiveEnPassant=null}}effectiveEnPassant(){return(0,Wn.refreshEffectiveEnPassant)(this._impl),this._impl.effectiveEnPassant<0?"-":(0,Z.fileToString)(this._impl.effectiveEnPassant)}isAttacked(t,n){let r=(0,Z.squareFromString)(t),i=(0,Z.colorFromString)(n);if(r<0||i<0)throw new J.IllegalArgument("Position.isAttacked()");return(0,Eu.isAttacked)(this._impl,r,i)}getAttacks(t,n){let r=(0,Z.squareFromString)(t),i=(0,Z.colorFromString)(n);if(r<0||i<0)throw new J.IllegalArgument("Position.getAttacks()");return(0,Eu.getAttacks)(this._impl,r,i).map(Z.squareToString)}isLegal(){return(0,Wn.isLegal)(this._impl)}kingSquare(t){let n=(0,Z.colorFromString)(t);if(n<0)throw new J.IllegalArgument("Position.kingSquare()");(0,Wn.refreshLegalFlagAndKingSquares)(this._impl);let r=this._impl.king[n];return r<0?!1:(0,Z.squareToString)(r)}isCheck(){return(0,We.isCheck)(this._impl)}isCheckmate(){return(0,We.isCheckmate)(this._impl)}isStalemate(){return(0,We.isStalemate)(this._impl)}isDead(t=!1){return(0,We.isDead)(this._impl,t)}hasMove(){return(0,We.hasMove)(this._impl)}moves(){return(0,We.moves)(this._impl)}isMoveLegal(t,n){let r=(0,Z.squareFromString)(t),i=(0,Z.squareFromString)(n);if(r<0||i<0)throw new J.IllegalArgument("Position.isMoveLegal()");let s=(0,We.isMoveLegal)(this._impl,r,i);if(!s)return!1;switch(s.type){case"promotion":{let a=o=>{let u=(0,Z.pieceFromString)(o);if(u>=0){let l=s.moveDescriptorFactory(u);if(l)return l}throw new J.IllegalArgument("Position.isMoveLegal()")};return a.status="promotion",a}case"regular":{let a=()=>s.moveDescriptor;return a.status="regular",a}}}play(t){if(typeof t=="string")try{return(0,We.play)(this._impl,(0,Ut.parseNotation)(this._impl,t,!1,"standard")),!0}catch(n){if(n instanceof J.InvalidNotation)return!1;throw n}else{if(t instanceof Kn.MoveDescriptorImpl)return(0,We.play)(this._impl,t),!0;throw new J.IllegalArgument("Position.play()")}}isNullMoveLegal(){return(0,We.isNullMoveLegal)(this._impl)}playNullMove(){return(0,We.playNullMove)(this._impl)}notation(t,n){if(arguments.length===1&&t instanceof Kn.MoveDescriptorImpl)return(0,Ut.getNotation)(this._impl,t,"standard");if(arguments.length===1&&typeof t=="string")return(0,Ut.parseNotation)(this._impl,t,!1,"standard");if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,Ut.parseNotation)(this._impl,t,n,"standard");throw new J.IllegalArgument("Position.notation()")}figurineNotation(t,n){if(arguments.length===1&&t instanceof Kn.MoveDescriptorImpl)return(0,Ut.getNotation)(this._impl,t,"figurine");if(arguments.length===1&&typeof t=="string")return(0,Ut.parseNotation)(this._impl,t,!1,"figurine");if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,Ut.parseNotation)(this._impl,t,n,"figurine");throw new J.IllegalArgument("Position.figurineNotation()")}uci(t,n){if(arguments.length===1&&t instanceof Kn.MoveDescriptorImpl)return(0,Fr.getUCINotation)(this._impl,t,!1);if(arguments.length>=2&&t instanceof Kn.MoveDescriptorImpl&&typeof n=="boolean")return(0,Fr.getUCINotation)(this._impl,t,n);if(arguments.length===1&&typeof t=="string")return(0,Fr.parseUCINotation)(this._impl,t,!1);if(arguments.length>=2&&typeof t=="string"&&typeof n=="boolean")return(0,Fr.parseUCINotation)(this._impl,t,n);throw new J.IllegalArgument("Position.uci()")}};Dr.Position=jt;function Su(e){return Number.isInteger(e)&&e>=0&&e<960}function Jg(e,t){return function(n,r,i){if(e[n]===void 0)return r;{let s=e[n];if(!i(s))throw new J.IllegalArgument(t);return s}}}});var Xn=m(It=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});It.Variation=It.Node=It.AbstractNode=void 0;var Yn=class{constructor(){}};It.AbstractNode=Yn;var ns=class extends Yn{constructor(){super()}isVariation(){return!1}toString(){return`${this.id()}[${this.notation()}]`}};It.Node=ns;var rs=class extends Yn{constructor(){super()}isVariation(){return!0}toString(){return this.id()}};It.Variation=rs});var qr=m($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});$r.trimAndCollapseSpaces=void 0;function e_(e){return e.replace(/^\s+|\s+$/g,"").replace(/\s+/g," ")}$r.trimAndCollapseSpaces=e_});var ku=m(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});Br.MoveTreeRoot=void 0;var Ce=Ae(),t_=ct(),Iu=Xn(),ht=_n(),Nt=class{constructor(){this._position=new ht.Position,this._fullMoveNumber=1,this._mainVariationData=Gr(this,!0)}clearTree(){this._mainVariationData=Gr(this,!0)}mainVariation(){return new Kt(this._mainVariationData,this._position)}findById(t){let n=t.split("-");if(n.length%2!==1)return;let r=new ht.Position(this._position),i=this._mainVariationData;for(let a=0;a+1<n.length;a+=2){let o=Au(i,n[a],r);if(o===void 0)return;let u=/^v(\d+)$/.exec(n[a+1]);if(!u)return;let l=parseInt(u[1]);if(l>=o.variations.length)return;i=o.variations[l]}let s=n[n.length-1];if(s==="start")return new Kt(i,r);{let a=Au(i,s,r);return a===void 0?void 0:new Ke(a,r)}}};Br.MoveTreeRoot=Nt;function Au(e,t,n){let r=e.child;for(;r!==void 0;){if(t===r.fullMoveNumber+r.moveColor)return r;Wt(n,r),r=r.child}}function Nu(e,t,n,r){return{parentVariation:e,child:void 0,variations:[],moveColor:t,fullMoveNumber:n,moveDescriptor:r,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function Gr(e,t){return{parent:e,child:void 0,isLongVariation:t,nags:new Set,tags:new Map,comment:void 0,isLongComment:!1}}function Pu(e,t){if(t==="--"){if(!e.isNullMoveLegal())throw new Ce.InvalidNotation(e.fen(),"--",t_.i18n.ILLEGAL_NULL_MOVE);return null}else return e.notation(t)}function Wt(e,t){t.moveDescriptor===null?e.playNullMove():e.play(t.moveDescriptor)}function is(e){if(e.parent instanceof Nt)return new ht.Position(e.parent._position);{let t=e.parent.parentVariation.child,n=is(e.parent.parentVariation);for(;t!==e.parent;)Wt(n,t),t=t.child;return n}}function Cu(e){return Tu(e.parentVariation)+e.fullMoveNumber+e.moveColor}function Tu(e){if(e.parent instanceof Nt)return"";{let t=Cu(e.parent),n=e.parent.variations.indexOf(e);return`${t}-v${n}-`}}function ss(e){for(;;){if(!e.isLongVariation)return!1;if(e.parent instanceof Nt)return!0;e=e.parent.parentVariation}}function Vr(e,t){return Number.isInteger(e)&&e>=0&&e<t.variations.length}function pn(e){return Number.isInteger(e)&&e>=0}function Ru(e){return typeof e=="string"&&/^\w+$/.test(e)}var Ke=class extends Iu.Node{constructor(t,n){super(),this._data=t,this._positionBefore=n}id(){return Cu(this._data)}nags(){let t=[];for(let n of this._data.nags)t.push(n);return t.sort((n,r)=>n-r)}hasNag(t){if(!pn(t))throw new Ce.IllegalArgument("Node.hasNag()");return this._data.nags.has(t)}addNag(t){if(!pn(t))throw new Ce.IllegalArgument("Node.addNag()");return this._data.nags.add(t)}removeNag(t){if(!pn(t))throw new Ce.IllegalArgument("Node.removeNag()");return this._data.nags.delete(t)}tags(){let t=[];for(let n of this._data.tags.keys())t.push(n);return t.sort()}tag(t,n){if(!Ru(t))throw new Ce.IllegalArgument("Node.tag()");if(arguments.length===1)return this._data.tags.get(t);if(arguments.length>=2)n==null?this._data.tags.delete(t):this._data.tags.set(t,String(n));else throw new Ce.IllegalArgument("Node.tag()")}comment(t,n){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=Boolean(n))}isLongComment(){return this._data.isLongComment&&ss(this._data.parentVariation)}parentVariation(){let t=is(this._data.parentVariation);return new Kt(this._data.parentVariation,t)}previous(){let t=this._data.parentVariation.child;if(t===this._data)return;let n=is(this._data.parentVariation);for(;t.child!==this._data;)Wt(n,t),t=t.child;return new Ke(t,n)}next(){if(this._data.child===void 0)return;let t=new ht.Position(this._positionBefore);return Wt(t,this._data),new Ke(this._data.child,t)}notation(){return this._data.moveDescriptor===null?"--":this._positionBefore.notation(this._data.moveDescriptor)}figurineNotation(){return this._data.moveDescriptor===null?"--":this._positionBefore.figurineNotation(this._data.moveDescriptor)}positionBefore(){return new ht.Position(this._positionBefore)}position(){let t=new ht.Position(this._positionBefore);return Wt(t,this._data),t}fullMoveNumber(){return this._data.fullMoveNumber}moveColor(){return this._data.moveColor}variations(){return this._data.variations.map(t=>new Kt(t,this._positionBefore))}play(t){let n=new ht.Position(this._positionBefore);Wt(n,this._data);let r=n.turn(),i=r==="w"?this._data.fullMoveNumber+1:this._data.fullMoveNumber;return this._data.child=Nu(this._data.parentVariation,r,i,Pu(n,t)),new Ke(this._data.child,n)}removeFollowingMoves(){this._data.child=void 0}addVariation(t){let n=Gr(this._data,t===void 0?!1:t);return this._data.variations.push(n),new Kt(n,this._positionBefore)}removeVariation(t){if(!Vr(t,this._data))throw new Ce.IllegalArgument("Node.removeVariation()");this._data.variations=this._data.variations.slice(0,t).concat(this._data.variations.slice(t+1))}swapVariations(t,n){if(!Vr(t,this._data)||!Vr(n,this._data))throw new Ce.IllegalArgument("Node.swapVariations()");let r=this._data.variations[t];this._data.variations[t]=this._data.variations[n],this._data.variations[n]=r}promoteVariation(t){if(!Vr(t,this._data)||this._data.variations[t].child===void 0)throw new Ce.IllegalArgument("Node.promoteVariation()");let n=this._data,r=this._data.variations[t].child,i=n.variations;n.variations=[],i[t]=Gr(r,!1),i[t].child=n,this._data=r,r.variations=i.concat(r.variations),n_(n).child=r,wu(r,n.parentVariation),wu(n,i[t]);for(let s of r.variations)s.parent=r}};function n_(e){let t=e.parentVariation;for(;t.child!==e;)t=t.child;return t}function wu(e,t){let n=e;for(;n!==void 0;)n.parentVariation=t,n=n.child}var Kt=class extends Iu.Variation{constructor(t,n){super(),this._data=t,this._initialPosition=n}id(){return Tu(this._data)+"start"}nags(){let t=[];for(let n of this._data.nags)t.push(n);return t.sort((n,r)=>n-r)}hasNag(t){if(!pn(t))throw new Ce.IllegalArgument("Variation.hasNag()");return this._data.nags.has(t)}addNag(t){if(!pn(t))throw new Ce.IllegalArgument("Variation.addNag()");return this._data.nags.add(t)}removeNag(t){if(!pn(t))throw new Ce.IllegalArgument("Variation.removeNag()");return this._data.nags.delete(t)}tags(){let t=[];for(let n of this._data.tags.keys())t.push(n);return t.sort()}tag(t,n){if(!Ru(t))throw new Ce.IllegalArgument("Variation.tag()");if(arguments.length===1)return this._data.tags.get(t);if(arguments.length>=2)n==null?this._data.tags.delete(t):this._data.tags.set(t,String(n));else throw new Ce.IllegalArgument("Variation.tag()")}comment(t,n){if(arguments.length===0)return this._data.comment;t==null?(this._data.comment=void 0,this._data.isLongComment=!1):(this._data.comment=String(t),this._data.isLongComment=Boolean(n))}isLongComment(){return this._data.isLongComment&&ss(this._data)}parentNode(){return this._data.parent instanceof Nt?void 0:new Ke(this._data.parent,this._initialPosition)}first(){return this._data.child===void 0?void 0:new Ke(this._data.child,this._initialPosition)}nodes(){let t=[],n=this._data.child,r,i=this._initialPosition;for(;n!==void 0;)i=new ht.Position(i),r!==void 0&&Wt(i,r),t.push(new Ke(n,i)),r=n,n=n.child;return t}plyCount(){let t=0,n=this._data.child;for(;n!==void 0;)++t,n=n.child;return t}isLongVariation(){return ss(this._data)}initialPosition(){return new ht.Position(this._initialPosition)}initialFullMoveNumber(){return this._data.parent instanceof Nt?this._data.parent._fullMoveNumber:this._data.parent.fullMoveNumber}play(t){let n=this._initialPosition.turn(),r=this.initialFullMoveNumber();return this._data.child=Nu(this._data,n,r,Pu(this._initialPosition,t)),new Ke(this._data.child,this._initialPosition)}clearMoves(){this._data.child=void 0}}});var Ur=m(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.Game=void 0;var mn=Ir(),nt=Ae(),as=Hn(),Qn=_n(),Mu=qr(),r_=ku(),yn=ft(),os=class{constructor(){this._playerName=[void 0,void 0],this._playerElo=[void 0,void 0],this._playerTitle=[void 0,void 0],this._result=3,this._moveTreeRoot=new r_.MoveTreeRoot}playerName(t,n){let r=(0,yn.colorFromString)(t);if(r<0)throw new nt.IllegalArgument("Game.playerName()");if(arguments.length===1)return this._playerName[r];this._playerName[r]=Ye(n)}playerElo(t,n){let r=(0,yn.colorFromString)(t);if(r<0)throw new nt.IllegalArgument("Game.playerElo()");if(arguments.length===1)return this._playerElo[r];if(n=i_(n),n===void 0||Number.isInteger(n)&&n>=0)this._playerElo[r]=n;else throw new nt.IllegalArgument("Game.playerElo()")}playerTitle(t,n){let r=(0,yn.colorFromString)(t);if(r<0)throw new nt.IllegalArgument("Game.playerTitle()");if(arguments.length===1)return this._playerTitle[r];this._playerTitle[r]=Ye(n)}event(t){if(arguments.length===0)return this._event;this._event=Ye(t)}round(t){if(arguments.length===0)return this._round;this._round=Ye(t)}date(t,n,r){switch(arguments.length){case 0:return this._date;case 1:if(t==null)this._date=void 0;else if(t instanceof mn.DateValue)this._date=t;else if(t instanceof Date)this._date=new mn.DateValue(t);else if(mn.DateValue.isValid(t))this._date=new mn.DateValue(t);else throw new nt.IllegalArgument("Game.date()");break;default:if(mn.DateValue.isValid(t,n,r))this._date=new mn.DateValue(t,n,r);else throw new nt.IllegalArgument("Game.date()");break}}dateAsDate(){return this._date===void 0?void 0:this._date.toDate()}dateAsString(t){return this._date===void 0?void 0:this._date.toHumanReadableString(t)}site(t){if(arguments.length===0)return this._site;this._site=Ye(t)}annotator(t){if(arguments.length===0)return this._annotator;this._annotator=Ye(t)}eco(t){if(arguments.length===0)return this._eco;if(t=Ye(t),t!==void 0&&!(0,as.isValidECO)(t))throw new nt.IllegalArgument("Game.eco()");this._eco=t}opening(t){if(arguments.length===0)return this._opening;this._opening=Ye(t)}openingVariation(t){if(arguments.length===0)return this._openingVariation;this._openingVariation=Ye(t)}openingSubVariation(t){if(arguments.length===0)return this._openingSubVariation;this._openingSubVariation=Ye(t)}termination(t){if(arguments.length===0)return this._termination;this._termination=Ye(t)}result(t){if(arguments.length===0)return(0,yn.resultToString)(this._result);{let n=(0,yn.resultFromString)(t);if(n<0)throw new nt.IllegalArgument("Game.result()");this._result=n}}variant(){return this._moveTreeRoot._position.variant()}initialPosition(t,n){if(arguments.length===0)return new Qn.Position(this._moveTreeRoot._position);if(!(t instanceof Qn.Position))throw new nt.IllegalArgument("Game.initialPosition()");if(arguments.length>=2){if(!Number.isInteger(n))throw new nt.IllegalArgument("Game.initialPosition()");this._moveTreeRoot._fullMoveNumber=n}else this._moveTreeRoot._fullMoveNumber=1;this._moveTreeRoot._position=new Qn.Position(t),this._moveTreeRoot.clearTree()}mainVariation(){return this._moveTreeRoot.mainVariation()}nodes(t=!1){if(!t)return this.mainVariation().nodes();let n=[];function r(i){for(let s of i.nodes()){for(let a of s.variations())r(a);n.push(s)}}return r(this.mainVariation()),n}plyCount(){return this._moveTreeRoot.mainVariation().plyCount()}findById(t){return this._moveTreeRoot.findById(t)}ascii(){let t=[];function n(o){o!==void 0&&t.push(o)}n(s_(this._event,this._round)),n(zn("Site",this._site)),n(zn("Date",this.dateAsString("en-us"))),n(Ou("White",this._playerName[0],this._playerElo[0],this._playerTitle[0])),n(Ou("Black",this._playerName[1],this._playerElo[1],this._playerTitle[1])),n(zn("Annotator",this._annotator)),n(zn("ECO",this._eco)),n(a_(this._opening,this._openingVariation,this._openingSubVariation)),n(zn("Termination",this._termination));let r=this._moveTreeRoot._position.variant();r!=="regular"&&t.push("Variant: "+r),(!(0,as.variantWithCanonicalStartPosition)(r)||!Qn.Position.isEqual(this._moveTreeRoot._position,new Qn.Position(r)))&&t.push(this._moveTreeRoot._position.ascii());function i(o){return o.first()!==void 0||o.nags().length>0||o.tags().length>0||o.comment()!==void 0}function s(o,u,l){let f=u+o.fullMoveNumber()+(o.moveColor()==="w"?".":"...")+o.notation(),d=xu(o);t.push(d.length===0?f:f+" "+d.join(" "));let h=!1;for(let y of o.variations())i(y)&&(t.push(u+" |"),a(y,u+(l?" |  ":"    "),u+" +- ",!1),h=!0);return h}function a(o,u,l,f){let d=xu(o);d.length>0&&t.push(l+d.join(" "));let h=o.first(),y=!1,p=!0;for(;h!==void 0;){y&&t.push(u+" |");let S=h.next();y=s(h,p&&d.length===0?l:u,f||S!==void 0),p=!1,h=S}}return a(this._moveTreeRoot.mainVariation(),"","",!1),t.push((0,yn.resultToString)(this._result)),t.join(`
`)}};Hr.Game=os;function Ye(e){return e==null?void 0:String(e)}function i_(e){return e==null?void 0:Number(e)}function Xe(e){return e=(0,Mu.trimAndCollapseSpaces)(e),e===""?"<empty>":e}function zn(e,t){return t===void 0?void 0:`${e}: ${Xe(t)}`}function s_(e,t){if(e===void 0&&t===void 0)return;let n=e===void 0?"Event: <undefined>":`Event: ${Xe(e)}`;return t!==void 0&&(n+=` (${Xe(t)})`),n}function Ou(e,t,n,r){if(t===void 0&&n===void 0&&r===void 0)return;let i=t===void 0?`${e}: <undefined>`:`${e}: ${Xe(t)}`;return n!==void 0&&r!==void 0?i+=` (${Xe(r)} ${n})`:n!==void 0?i+=` (${n})`:r!==void 0&&(i+=` (${Xe(r)})`),i}function a_(e,t,n){if(e===void 0&&t===void 0&&n===void 0)return;let r=e===void 0?"Opening: <undefined>":`Opening: ${Xe(e)}`;return n!==void 0?r+=` (${t===void 0?"<undefined>":Xe(t)}, ${Xe(n)})`:t!==void 0&&(r+=` (${Xe(t)})`),r}function xu(e){let t=[];for(let r of e.nags())t.push((0,as.nagSymbol)(r));for(let r of e.tags())t.push(`${r}={${(0,Mu.trimAndCollapseSpaces)(e.tag(r))}}`);let n=e.comment();return n!==void 0&&t.push(Xe(n)),t}});var jr=m(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.Database=vn.isValidGameIndex=void 0;var o_=Ae();function Lu(e){return Number.isInteger(e)&&e>=0}vn.isValidGameIndex=Lu;var us=class{constructor(){}gameCount(){return this.doGameCount()}game(t){if(!Lu(t))throw new o_.IllegalArgument("Database.game()");return this.doGame(t)}};vn.Database=us});var Fu=m(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.TokenStream=void 0;var ls=Ae(),cs=ct(),fs=qr();function pe(e,t){let n=e;return n.needIncrementLineIndex=t!==void 0&&t,n.matchedIndex=-1,n.matched=null,n}var u_=5,l_=11,ce=new Map;ce.set("!!",3);ce.set("!",1);ce.set("!?",5);ce.set("?!",6);ce.set("?",2);ce.set("??",4);ce.set("+-",18);ce.set("+/-",16);ce.set("+/=",14);ce.set("+=",14);ce.set("=",10);ce.set("~",13);ce.set("inf",13);ce.set("=/+",15);ce.set("=+",15);ce.set("-/+",17);ce.set("-+",19);ce.set("RR",145);ce.set("N",146);var hs=class{constructor(t,n){this._pos=0,this._lineIndex=1,this._token=0,this._tokenValue=null,this._tokenCharacterIndex=-1,this._tokenLineIndex=-1,this._emptyLineBeforeToken=!1,this._emptyLineAfterToken=!1,this._matchSpaces=pe(/[ \f\t\v]+/g),this._matchLineBreak=pe(/\r?\n|\r/g,!0),this._matchFastAdvance=pe(/[^ \f\t\v\r\n"{][^ \f\t\v\r\n"{10*]*/g),this._matchBeginHeader=pe(/\[/g),this._matchEndHeader=pe(/\]/g),this._matchHeaderId=pe(/(\w+)/g),this._matchEnterHeaderValue=pe(/"/g),this._matchMoveNumber=pe(/[0-9]+\.(?:\.\.)?/g),this._matchMove=pe(/(?:O-O(?:-O)?|0-0(?:-0)?|[KQRBN][a-h]?[1-8]?x?[a-h][1-8]|(?:[a-h]x?)?[a-h][1-8](?:=?[KQRBNP])?)[+#]?|--/g),this._matchNag=pe(/([!?][!?]?|\+\/?[-=]|[-=]\/?\+|=|inf|~|RR|N)|\$([1-9][0-9]*)/g),this._matchEnterComment=pe(/\{/g),this._matchBeginVariation=pe(/\(/g),this._matchEndVariation=pe(/\)/g),this._matchEndOfGame=pe(/1-0|0-1|1\/2-1\/2|\*/g),this._headerValueMode=pe(/((?:[^\\"\f\t\v\r\n]|\\[^\f\t\v\r\n])*)"/g),this._headerValueDegradedMode=pe(/[^\r\n]*/g),this._commentMode=pe(/((?:[^\\}]|\\(?:.|[\r\n]))*)\}/g,!0),t.codePointAt(0)===65279&&(t=t.substring(1)),this._text=t,n!==void 0&&(this._pos=n.pos,this._lineIndex=n.lineIndex)}text(){return this._text}currentLocation(){return{pos:this._pos,lineIndex:this._lineIndex}}emptyLineBeforeToken(){return this._emptyLineBeforeToken}emptyLineAfterToken(){return this._emptyLineAfterToken}token(){return this._token}tokenValue(){return this._tokenValue}tokenCharacterIndex(){return this._tokenCharacterIndex}tokenLineIndex(){return this._tokenLineIndex}isMoveTextSection(){return this._token>=u_&&this._token<=l_}consumeToken(){if(this._emptyLineBeforeToken=this._token===0||this._token===11?this.skipBlanks():this._emptyLineAfterToken,this._pos>=this._text.length)return this._tokenCharacterIndex=this._text.length,this._tokenLineIndex=this._lineIndex,!1;if(this._tokenCharacterIndex=this._pos,this._tokenLineIndex=this._lineIndex,this.testAtPos(this._matchMoveNumber))this._token=5,this._tokenValue=null;else if(this.testAtPos(this._matchMove))this._token=6,this._tokenValue=this._matchMove.matched[0];else if(this.testAtPos(this._matchNag))this._token=7,this._tokenValue=this._matchNag.matched[2]===void 0?ce.get(this._matchNag.matched[1]):parseInt(this._matchNag.matched[2],10);else if(this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))throw new ls.InvalidPGN(this._text,this._pos,this._lineIndex,cs.i18n.INVALID_PGN_TOKEN);this._token=8,this._tokenValue=f_(this._commentMode.matched[1])}else if(this.testAtPos(this._matchBeginVariation))this._token=9,this._tokenValue=null;else if(this.testAtPos(this._matchEndVariation))this._token=10,this._tokenValue=null;else if(this.testAtPos(this._matchEndOfGame))this._token=11,this._tokenValue=this._matchEndOfGame.matched[0];else if(this.testAtPos(this._matchBeginHeader))this._token=1,this._tokenValue=null;else if(this.testAtPos(this._matchEndHeader))this._token=2,this._tokenValue=null;else if(this.testAtPos(this._matchHeaderId))this._token=3,this._tokenValue=this._matchHeaderId.matched[1];else if(this.testAtPos(this._matchEnterHeaderValue)){if(!this.testAtPos(this._headerValueMode))throw new ls.InvalidPGN(this._text,this._pos,this._lineIndex,cs.i18n.INVALID_PGN_TOKEN);this._token=4,this._tokenValue=c_(this._headerValueMode.matched[1])}else throw new ls.InvalidPGN(this._text,this._pos,this._lineIndex,cs.i18n.INVALID_PGN_TOKEN);return this._emptyLineAfterToken=this._token===11?!1:this.skipBlanks(),!0}skipGame(){let t=!1;for(this._token=0;;){if(this.skipBlanks(),this._pos>=this._text.length)return t;if(t=!0,this.testAtPos(this._matchEnterComment)){if(!this.testAtPos(this._commentMode))return this._pos=this._text.length,!0}else if(this.testAtPos(this._matchEnterHeaderValue))this.testAtPos(this._headerValueMode)||this.testAtPos(this._headerValueDegradedMode);else{if(this.testAtPos(this._matchEndOfGame))return!0;this.testAtPos(this._matchFastAdvance)}}}skipBlanks(){let t=0;for(;this._pos<this._text.length;)if(!this.testAtPos(this._matchSpaces))if(this.testAtPos(this._matchLineBreak))++t;else break;return t>=2}testAtPos(t){if(t.matchedIndex<this._pos&&(t.lastIndex=this._pos,t.matched=t.exec(this._text),t.matchedIndex=t.matched===null?this._text.length:t.matched.index),t.matchedIndex===this._pos){if(this._pos=t.lastIndex,t.needIncrementLineIndex){let n=/\r?\n|\r/g;for(;n.exec(t.matched[0]);)++this._lineIndex}return!0}else return!1}};Wr.TokenStream=hs;function c_(e){return(0,fs.trimAndCollapseSpaces)(e.replace(/\\([\\"])/g,"$1"))}function f_(e){e=e.replace(/\\([\\}])/g,"$1");let t=new Map,n=e.replace(/\[%(\w+)\s([^[\]]*)\]/g,(r,i,s)=>(s=(0,fs.trimAndCollapseSpaces)(s),s!==""&&t.set(i,s)," "));return n=(0,fs.trimAndCollapseSpaces)(n),n===""&&(n=void 0),{comment:n,tags:t}}});var Gu=m(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.readOneGame=bn.readDatabase=void 0;var h_=jr(),dt=Ir(),me=Ae(),d_=Ur(),qu=Hn(),Ne=ct(),Du=Xn(),ds=_n(),gs=Fu();function Zn(e){return e==="?"?void 0:e}function $u(e){if(/^\d+$/.test(e)){let t=Number(e);if(Number.isInteger(t))return t}}function g_(e){if(/^([0-9]{4})\.([0-9]{2})\.([0-9]{2})$/.test(e)){let t=RegExp.$1,n=RegExp.$2,r=RegExp.$3,i=parseInt(t,10),s=parseInt(n,10),a=parseInt(r,10);return dt.DateValue.isValid(i,s,a)?new dt.DateValue(i,s,a):dt.DateValue.isValid(i,s)?new dt.DateValue(i,s):new dt.DateValue(i)}else if(/^([0-9]{4})\.([0-9]{2})\.\?\?$/.test(e)){let t=RegExp.$1,n=RegExp.$2,r=parseInt(t,10),i=parseInt(n,10);return dt.DateValue.isValid(r,i)?new dt.DateValue(r,i):new dt.DateValue(r)}else if(/^([0-9]{4})(?:\.\?\?\.\?\?)?$/.test(e)){let t=parseInt(RegExp.$1,10);return new dt.DateValue(t)}else return}function __(e){return(0,qu.isValidECO)(e)?e:void 0}function p_(e){return e=e.toLowerCase(),e==="regular"||e==="standard"?"regular":e==="fischerandom"||/^chess[ -]?960$/.test(e)?"chess960":/^no[ -]king$/.test(e)?"no-king":/^white[ -]king[ -]only$/.test(e)?"white-king-only":/^black[ -]king[ -]only$/.test(e)?"black-king-only":/^anti[ -]?chess/.test(e)?"antichess":e==="horde"?"horde":void 0}function m_(e,t,n,r,i,s,a){switch(i=i.trim(),r){case"White":t.playerName("w",Zn(i));break;case"Black":t.playerName("b",Zn(i));break;case"WhiteElo":t.playerElo("w",$u(i));break;case"BlackElo":t.playerElo("b",$u(i));break;case"WhiteTitle":t.playerTitle("w",i);break;case"BlackTitle":t.playerTitle("b",i);break;case"Event":t.event(Zn(i));break;case"Round":t.round(Zn(i));break;case"Date":t.date(g_(i));break;case"Site":t.site(Zn(i));break;case"Annotator":t.annotator(i);break;case"ECO":t.eco(__(i));break;case"Opening":t.opening(i);break;case"Variation":t.openingVariation(i);break;case"SubVariation":t.openingSubVariation(i);break;case"Termination":t.termination(i);break;case"FEN":n.fen=i,n.fenTokenCharacterIndex=s,n.fenTokenLineIndex=a;break;case"Variant":if(n.variant=p_(i),n.variant===void 0)throw new me.InvalidPGN(e.text(),s,a,Ne.i18n.UNKNOWN_VARIANT,i);n.variantTokenCharacterIndex=s,n.variantTokenLineIndex=a;break}}function y_(e,t,n){if(n.fen!==void 0)try{let r=n.variant===void 0?new ds.Position:new ds.Position(n.variant,"empty"),i=r.fen(n.fen);t.initialPosition(r,i.fullMoveNumber)}catch(r){throw r instanceof me.InvalidFEN?new me.InvalidPGN(e.text(),n.fenTokenCharacterIndex,n.fenTokenLineIndex,Ne.i18n.INVALID_FEN_IN_PGN_TEXT,r.message):r}else if(n.variant!==void 0)if((0,qu.variantWithCanonicalStartPosition)(n.variant)){let r=new ds.Position(n.variant,"start");t.initialPosition(r,1)}else throw new me.InvalidPGN(e.text(),n.variantTokenCharacterIndex,n.variantTokenLineIndex,Ne.i18n.VARIANT_WITHOUT_FEN,n.variant)}function Vu(e){let t=null,n=null,r=[],i={};for(;e.consumeToken();)switch(t===null&&(t=new d_.Game),e.isMoveTextSection()&&n===null&&(y_(e,t,i),n=t.mainVariation()),e.token()){case 1:{if(n!==null)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.UNEXPECTED_PGN_HEADER);if(!e.consumeToken()||e.token()!==3)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.MISSING_PGN_HEADER_ID);let s=e.tokenValue();if(!e.consumeToken()||e.token()!==4)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.MISSING_PGN_HEADER_VALUE);let a=e.tokenValue(),o=e.tokenCharacterIndex(),u=e.tokenLineIndex();if(!e.consumeToken()||e.token()!==2)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.MISSING_END_OF_PGN_HEADER);m_(e,t,i,s,a,o,u);break}case 5:break;case 6:try{n=n.play(e.tokenValue())}catch(s){throw s instanceof me.InvalidNotation?new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.INVALID_MOVE_IN_PGN_TEXT,s.notation,s.message):s}break;case 7:n.addNag(e.tokenValue());break;case 8:{let s=e.tokenValue();for(let[a,o]of s.tags)n.tag(a,o);if(s.comment!==void 0){let a=n instanceof Du.Variation?e.emptyLineAfterToken():e.emptyLineBeforeToken();n.comment(s.comment,a)}break}case 9:if(n instanceof Du.Variation)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.UNEXPECTED_BEGIN_OF_VARIATION);r.push(n),n=n.addVariation(e.emptyLineBeforeToken());break;case 10:if(r.length===0)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.UNEXPECTED_END_OF_VARIATION);n=r.pop();break;case 11:if(r.length!==0)throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.UNEXPECTED_END_OF_GAME);return t.result(e.tokenValue()),t;default:throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.INVALID_PGN_TOKEN)}throw new me.InvalidPGN(e.text(),e.tokenCharacterIndex(),e.tokenLineIndex(),Ne.i18n.UNEXPECTED_END_OF_TEXT)}var _s=class extends h_.Database{constructor(t){for(super(),this._currentGameIndex=-1,this._text=t,this._gameLocations=[],this._stream=new gs.TokenStream(t);;){let n=this._stream.currentLocation();if(!this._stream.skipGame())break;this._gameLocations.push(n)}}doGameCount(){return this._gameLocations.length}doGame(t){if(t>=this._gameLocations.length)throw new me.InvalidPGN(this._text,-1,-1,Ne.i18n.INVALID_GAME_INDEX,t,this._gameLocations.length);this._currentGameIndex!==t&&(this._stream=new gs.TokenStream(this._text,this._gameLocations[t])),this._currentGameIndex=-1;let n=Vu(this._stream);return this._currentGameIndex=t+1,n}};function v_(e){return new _s(e)}bn.readDatabase=v_;function b_(e,t){let n=new gs.TokenStream(e),r=0;for(;r!==t;)if(n.skipGame())++r;else throw new me.InvalidPGN(e,-1,-1,Ne.i18n.INVALID_GAME_INDEX,t,r);return Vu(n)}bn.readOneGame=b_});var Xu=m(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.writeGames=En.writeGame=void 0;var E_=Hn(),S_=Xn(),Bu=_n(),Kr=qr();function ju(e){return e.replace(/([\\"])/g,"\\$1")}function Hu(e){return e.replace(/([\\}])/g,"\\$1")}function Jn(e){return e!==void 0&&(e=(0,Kr.trimAndCollapseSpaces)(e)),e?ju(e):"?"}function A_(e){return e===void 0?"????.??.??":e.toPGNString()}function w_(e){switch(e){case"regular":return;case"chess960":return"Fischerandom";case"antichess":return"Antichess";case"horde":return"Horde";default:return e}}function gt(e,t){return t!==void 0&&(t=(0,Kr.trimAndCollapseSpaces)(t)),t?`[${e} "${ju(t)}"]
`:""}function Uu(e,t){return t===void 0?"":`[${e} "${t}"]
`}function Wu(e,t,n,r){for(let u of e.nags())n("$"+u,!1,!1);let i=e.comment();i!==void 0&&(i=(0,Kr.trimAndCollapseSpaces)(i));let s=e.tags(),a=new Map,o=!1;for(let u of s){let l=(0,Kr.trimAndCollapseSpaces)(e.tag(u).replace(/[[\]]/g,""));l&&(a.set(u,l),o=!0)}if(o||i){i&&e.isLongComment()&&e instanceof S_.Node&&r(),n("{",!1,!0);for(let u of s){let l=a.get(u);if(l){n("[%"+u,!1,!1);for(let f of Hu(l+"]").split(" "))n(f,!1,!1)}}if(i)for(let u of Hu(i).split(" "))n(u,!1,!1);return n("}",!0,!1),i&&e.isLongComment()&&t&&r(),!0}else return!1}function I_(e,t,n,r,i){e.moveColor()==="w"?r(e.fullMoveNumber()+".",!1,!1):t&&r(e.fullMoveNumber()+"...",!1,!1),r(e.notation(),!1,!1);let s=e.variations(),a=-1;for(let u=s.length-1;u>=0;--u)if(s[u].first()!==void 0){a=u;break}let o=Wu(e,(n||e.next()!==void 0)&&a<0,r,i);for(let u=0;u<s.length;++u){let l=s[u];l.first()!==void 0&&(l.isLongVariation()&&i(),r("(",!1,!0),Ku(l,!1,r,i),r(")",!0,!1),u===a&&l.isLongVariation()&&i(),o=!0)}return o}function Ku(e,t,n,r){Wu(e,!0,n,r);let i=e.first(),s=!0;for(;i!==void 0;)s=I_(i,s,t,n,r),i=i.next()}function Yu(e,t){let n="";n+=`[Event "${Jn(e.event())}"]
`,n+=`[Site "${Jn(e.site())}"]
`,n+=`[Date "${A_(e.date())}"]
`,n+=`[Round "${Jn(e.round())}"]
`,n+=`[White "${Jn(e.playerName("w"))}"]
`,n+=`[Black "${Jn(e.playerName("b"))}"]
`,n+=`[Result "${e.result()}"]
`;let r=e.variant(),i=e.initialPosition(),s=!(0,E_.variantWithCanonicalStartPosition)(r)||!Bu.Position.isEqual(i,new Bu.Position(r));n+=gt("Annotator",e.annotator()),n+=Uu("BlackElo",e.playerElo("b")),n+=gt("BlackTitle",e.playerTitle("b")),n+=gt("ECO",e.eco()),s&&(n+=`[FEN "${i.fen({fullMoveNumber:e.mainVariation().initialFullMoveNumber(),regularFENIfPossible:!0})}"]
`),n+=gt("Opening",e.opening()),t.withPlyCount&&(n+=`[PlyCount "${e.plyCount()}"]
`),s&&(n+=`[SetUp "1"]
`),n+=gt("SubVariation",e.openingSubVariation()),n+=gt("Termination",e.termination()),n+=gt("Variant",w_(r)),n+=gt("Variation",e.openingVariation()),n+=Uu("WhiteElo",e.playerElo("w")),n+=gt("WhiteTitle",e.playerTitle("w")),n+=`
`;let a="",o=!1;function u(f,d,h){a.length===0?a=f:a.length+f.length+(o||d?0:1)<=80?a+=(o||d?"":" ")+f:(n+=a+`
`,a=f),o=h}function l(){n+=a+`
`,n+=`
`,a="",o=!1}return Ku(e.mainVariation(),!0,u,l),u(e.result(),!1,!1),n+=a+`
`,n}En.writeGame=Yu;function N_(e,t){return e.map(n=>Yu(n,t)).join(`

`)}En.writeGames=N_});var Ju=m(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.pgnWrite=Sn.pgnRead=void 0;var P_=jr(),ps=Ae(),Qu=Ur(),zu=Gu(),Zu=Xu();function C_(e,t){if(typeof e!="string")throw new ps.IllegalArgument("pgnRead()");if(arguments.length===1)return(0,zu.readDatabase)(e);if(!(0,P_.isValidGameIndex)(t))throw new ps.IllegalArgument("pgnRead()");return(0,zu.readOneGame)(e,t)}Sn.pgnRead=C_;function T_(e,t){if(t==null&&(t={}),e instanceof Qu.Game)return(0,Zu.writeGame)(e,t);if(Array.isArray(e)&&e.every(n=>n instanceof Qu.Game))return(0,Zu.writeGames)(e,t);throw new ps.IllegalArgument("pgnWrite()")}Sn.pgnWrite=T_});var nl=m(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.pgnWrite=F.pgnRead=F.Database=F.Game=F.Variation=F.Node=F.AbstractNode=F.Position=F.isMoveDescriptor=F.MoveDescriptor=F.DateValue=F.isValidECO=F.nagSymbol=F.variantWithCanonicalStartPosition=F.oppositeColor=F.coordinatesToSquare=F.squareToCoordinates=F.squareColor=F.forEachSquare=F.exception=F.i18n=void 0;var R_=ct();Object.defineProperty(F,"i18n",{enumerable:!0,get:function(){return R_.i18n}});F.exception=Ae();var Pt=Hn();Object.defineProperty(F,"forEachSquare",{enumerable:!0,get:function(){return Pt.forEachSquare}});Object.defineProperty(F,"squareColor",{enumerable:!0,get:function(){return Pt.squareColor}});Object.defineProperty(F,"squareToCoordinates",{enumerable:!0,get:function(){return Pt.squareToCoordinates}});Object.defineProperty(F,"coordinatesToSquare",{enumerable:!0,get:function(){return Pt.coordinatesToSquare}});Object.defineProperty(F,"oppositeColor",{enumerable:!0,get:function(){return Pt.oppositeColor}});Object.defineProperty(F,"variantWithCanonicalStartPosition",{enumerable:!0,get:function(){return Pt.variantWithCanonicalStartPosition}});Object.defineProperty(F,"nagSymbol",{enumerable:!0,get:function(){return Pt.nagSymbol}});Object.defineProperty(F,"isValidECO",{enumerable:!0,get:function(){return Pt.isValidECO}});var k_=Ir();Object.defineProperty(F,"DateValue",{enumerable:!0,get:function(){return k_.DateValue}});var el=ji();Object.defineProperty(F,"MoveDescriptor",{enumerable:!0,get:function(){return el.MoveDescriptor}});Object.defineProperty(F,"isMoveDescriptor",{enumerable:!0,get:function(){return el.isMoveDescriptor}});var O_=_n();Object.defineProperty(F,"Position",{enumerable:!0,get:function(){return O_.Position}});var ms=Xn();Object.defineProperty(F,"AbstractNode",{enumerable:!0,get:function(){return ms.AbstractNode}});Object.defineProperty(F,"Node",{enumerable:!0,get:function(){return ms.Node}});Object.defineProperty(F,"Variation",{enumerable:!0,get:function(){return ms.Variation}});var x_=Ur();Object.defineProperty(F,"Game",{enumerable:!0,get:function(){return x_.Game}});var M_=jr();Object.defineProperty(F,"Database",{enumerable:!0,get:function(){return M_.Database}});var tl=Ju();Object.defineProperty(F,"pgnRead",{enumerable:!0,get:function(){return tl.pgnRead}});Object.defineProperty(F,"pgnWrite",{enumerable:!0,get:function(){return tl.pgnWrite}})});var vs=m((iv,cl)=>{"use strict";var q_=require("stream"),ul=q_.PassThrough,V_=Array.prototype.slice;cl.exports=G_;function G_(){let e=[],t=V_.call(arguments),n=!1,r=t[t.length-1];r&&!Array.isArray(r)&&r.pipe==null?t.pop():r={};let i=r.end!==!1,s=r.pipeError===!0;r.objectMode==null&&(r.objectMode=!0),r.highWaterMark==null&&(r.highWaterMark=64*1024);let a=ul(r);function o(){for(let f=0,d=arguments.length;f<d;f++)e.push(ll(arguments[f],r));return u(),this}function u(){if(n)return;n=!0;let f=e.shift();if(!f){process.nextTick(l);return}Array.isArray(f)||(f=[f]);let d=f.length+1;function h(){--d>0||(n=!1,u())}function y(p){function S(){p.removeListener("merge2UnpipeEnd",S),p.removeListener("end",S),s&&p.removeListener("error",C),h()}function C(M){a.emit("error",M)}if(p._readableState.endEmitted)return h();p.on("merge2UnpipeEnd",S),p.on("end",S),s&&p.on("error",C),p.pipe(a,{end:!1}),p.resume()}for(let p=0;p<f.length;p++)y(f[p]);h()}function l(){n=!1,a.emit("queueDrain"),i&&a.end()}return a.setMaxListeners(0),a.add=o,a.on("unpipe",function(f){f.emit("merge2UnpipeEnd")}),t.length&&o.apply(null,t),a}function ll(e,t){if(Array.isArray(e))for(let n=0,r=e.length;n<r;n++)e[n]=ll(e[n],t);else{if(!e._readableState&&e.pipe&&(e=e.pipe(ul(t))),!e._readableState||!e.pause||!e.pipe)throw new Error("Only readable stream can be merged.");e.pause()}return e}});var fl=m(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.splitWhen=In.flatten=void 0;function B_(e){return e.reduce((t,n)=>[].concat(t,n),[])}In.flatten=B_;function H_(e,t){let n=[[]],r=0;for(let i of e)t(i)?(r++,n[r]=[]):n[r].push(i);return n}In.splitWhen=H_});var hl=m(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.isEnoentCodeError=void 0;function U_(e){return e.code==="ENOENT"}zr.isEnoentCodeError=U_});var dl=m(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.createDirentFromStats=void 0;var bs=class{constructor(t,n){this.name=t,this.isBlockDevice=n.isBlockDevice.bind(n),this.isCharacterDevice=n.isCharacterDevice.bind(n),this.isDirectory=n.isDirectory.bind(n),this.isFIFO=n.isFIFO.bind(n),this.isFile=n.isFile.bind(n),this.isSocket=n.isSocket.bind(n),this.isSymbolicLink=n.isSymbolicLink.bind(n)}};function j_(e,t){return new bs(e,t)}Zr.createDirentFromStats=j_});var gl=m(rt=>{"use strict";Object.defineProperty(rt,"__esModule",{value:!0});rt.removeLeadingDotSegment=rt.escape=rt.makeAbsolute=rt.unixify=void 0;var W_=require("path"),K_=2,Y_=/(\\?)([()*?[\]{|}]|^!|[!+@](?=\())/g;function X_(e){return e.replace(/\\/g,"/")}rt.unixify=X_;function Q_(e,t){return W_.resolve(e,t)}rt.makeAbsolute=Q_;function z_(e){return e.replace(Y_,"\\$2")}rt.escape=z_;function Z_(e){if(e.charAt(0)==="."){let t=e.charAt(1);if(t==="/"||t==="\\")return e.slice(K_)}return e}rt.removeLeadingDotSegment=Z_});var pl=m((lv,_l)=>{_l.exports=function(t){if(typeof t!="string"||t==="")return!1;for(var n;n=/(\\).|([@?!+*]\(.*\))/g.exec(t);){if(n[2])return!0;t=t.slice(n.index+n[0].length)}return!1}});var vl=m((cv,yl)=>{var J_=pl(),ml={"{":"}","(":")","[":"]"},ep=function(e){if(e[0]==="!")return!0;for(var t=0,n=-2,r=-2,i=-2,s=-2,a=-2;t<e.length;){if(e[t]==="*"||e[t+1]==="?"&&/[\].+)]/.test(e[t])||r!==-1&&e[t]==="["&&e[t+1]!=="]"&&(r<t&&(r=e.indexOf("]",t)),r>t&&(a===-1||a>r||(a=e.indexOf("\\",t),a===-1||a>r)))||i!==-1&&e[t]==="{"&&e[t+1]!=="}"&&(i=e.indexOf("}",t),i>t&&(a=e.indexOf("\\",t),a===-1||a>i))||s!==-1&&e[t]==="("&&e[t+1]==="?"&&/[:!=]/.test(e[t+2])&&e[t+3]!==")"&&(s=e.indexOf(")",t),s>t&&(a=e.indexOf("\\",t),a===-1||a>s))||n!==-1&&e[t]==="("&&e[t+1]!=="|"&&(n<t&&(n=e.indexOf("|",t)),n!==-1&&e[n+1]!==")"&&(s=e.indexOf(")",n),s>n&&(a=e.indexOf("\\",n),a===-1||a>s))))return!0;if(e[t]==="\\"){var o=e[t+1];t+=2;var u=ml[o];if(u){var l=e.indexOf(u,t);l!==-1&&(t=l+1)}if(e[t]==="!")return!0}else t++}return!1},tp=function(e){if(e[0]==="!")return!0;for(var t=0;t<e.length;){if(/[*?{}()[\]]/.test(e[t]))return!0;if(e[t]==="\\"){var n=e[t+1];t+=2;var r=ml[n];if(r){var i=e.indexOf(r,t);i!==-1&&(t=i+1)}if(e[t]==="!")return!0}else t++}return!1};yl.exports=function(t,n){if(typeof t!="string"||t==="")return!1;if(J_(t))return!0;var r=ep;return n&&n.strict===!1&&(r=tp),r(t)}});var El=m((fv,bl)=>{"use strict";var np=vl(),rp=require("path").posix.dirname,ip=require("os").platform()==="win32",Es="/",sp=/\\/g,ap=/[\{\[].*[\}\]]$/,op=/(^|[^\\])([\{\[]|\([^\)]+$)/,up=/\\([\!\*\?\|\[\]\(\)\{\}])/g;bl.exports=function(t,n){var r=Object.assign({flipBackslashes:!0},n);r.flipBackslashes&&ip&&t.indexOf(Es)<0&&(t=t.replace(sp,Es)),ap.test(t)&&(t+=Es),t+="a";do t=rp(t);while(np(t)||op.test(t));return t.replace(up,"$1")}});var Jr=m(qe=>{"use strict";qe.isInteger=e=>typeof e=="number"?Number.isInteger(e):typeof e=="string"&&e.trim()!==""?Number.isInteger(Number(e)):!1;qe.find=(e,t)=>e.nodes.find(n=>n.type===t);qe.exceedsLimit=(e,t,n=1,r)=>r===!1||!qe.isInteger(e)||!qe.isInteger(t)?!1:(Number(t)-Number(e))/Number(n)>=r;qe.escapeNode=(e,t=0,n)=>{let r=e.nodes[t];!r||(n&&r.type===n||r.type==="open"||r.type==="close")&&r.escaped!==!0&&(r.value="\\"+r.value,r.escaped=!0)};qe.encloseBrace=e=>e.type!=="brace"?!1:e.commas>>0+e.ranges>>0===0?(e.invalid=!0,!0):!1;qe.isInvalidBrace=e=>e.type!=="brace"?!1:e.invalid===!0||e.dollar?!0:e.commas>>0+e.ranges>>0===0||e.open!==!0||e.close!==!0?(e.invalid=!0,!0):!1;qe.isOpenOrClose=e=>e.type==="open"||e.type==="close"?!0:e.open===!0||e.close===!0;qe.reduce=e=>e.reduce((t,n)=>(n.type==="text"&&t.push(n.value),n.type==="range"&&(n.type="text"),t),[]);qe.flatten=(...e)=>{let t=[],n=r=>{for(let i=0;i<r.length;i++){let s=r[i];Array.isArray(s)?n(s,t):s!==void 0&&t.push(s)}return t};return n(e),t}});var ei=m((dv,Al)=>{"use strict";var Sl=Jr();Al.exports=(e,t={})=>{let n=(r,i={})=>{let s=t.escapeInvalid&&Sl.isInvalidBrace(i),a=r.invalid===!0&&t.escapeInvalid===!0,o="";if(r.value)return(s||a)&&Sl.isOpenOrClose(r)?"\\"+r.value:r.value;if(r.value)return r.value;if(r.nodes)for(let u of r.nodes)o+=n(u);return o};return n(e)}});var Il=m((gv,wl)=>{"use strict";wl.exports=function(e){return typeof e=="number"?e-e===0:typeof e=="string"&&e.trim()!==""?Number.isFinite?Number.isFinite(+e):isFinite(+e):!1}});var Ml=m((_v,xl)=>{"use strict";var Nl=Il(),Yt=(e,t,n)=>{if(Nl(e)===!1)throw new TypeError("toRegexRange: expected the first argument to be a number");if(t===void 0||e===t)return String(e);if(Nl(t)===!1)throw new TypeError("toRegexRange: expected the second argument to be a number.");let r={relaxZeros:!0,...n};typeof r.strictZeros=="boolean"&&(r.relaxZeros=r.strictZeros===!1);let i=String(r.relaxZeros),s=String(r.shorthand),a=String(r.capture),o=String(r.wrap),u=e+":"+t+"="+i+s+a+o;if(Yt.cache.hasOwnProperty(u))return Yt.cache[u].result;let l=Math.min(e,t),f=Math.max(e,t);if(Math.abs(l-f)===1){let S=e+"|"+t;return r.capture?`(${S})`:r.wrap===!1?S:`(?:${S})`}let d=Ol(e)||Ol(t),h={min:e,max:t,a:l,b:f},y=[],p=[];if(d&&(h.isPadded=d,h.maxLen=String(h.max).length),l<0){let S=f<0?Math.abs(f):1;p=Pl(S,Math.abs(l),h,r),l=h.a=0}return f>=0&&(y=Pl(l,f,h,r)),h.negatives=p,h.positives=y,h.result=lp(p,y,r),r.capture===!0?h.result=`(${h.result})`:r.wrap!==!1&&y.length+p.length>1&&(h.result=`(?:${h.result})`),Yt.cache[u]=h,h.result};function lp(e,t,n){let r=Ss(e,t,"-",!1,n)||[],i=Ss(t,e,"",!1,n)||[],s=Ss(e,t,"-?",!0,n)||[];return r.concat(s).concat(i).join("|")}function cp(e,t){let n=1,r=1,i=Tl(e,n),s=new Set([t]);for(;e<=i&&i<=t;)s.add(i),n+=1,i=Tl(e,n);for(i=Rl(t+1,r)-1;e<i&&i<=t;)s.add(i),r+=1,i=Rl(t+1,r)-1;return s=[...s],s.sort(dp),s}function fp(e,t,n){if(e===t)return{pattern:e,count:[],digits:0};let r=hp(e,t),i=r.length,s="",a=0;for(let o=0;o<i;o++){let[u,l]=r[o];u===l?s+=u:u!=="0"||l!=="9"?s+=gp(u,l,n):a++}return a&&(s+=n.shorthand===!0?"\\d":"[0-9]"),{pattern:s,count:[a],digits:i}}function Pl(e,t,n,r){let i=cp(e,t),s=[],a=e,o;for(let u=0;u<i.length;u++){let l=i[u],f=fp(String(a),String(l),r),d="";if(!n.isPadded&&o&&o.pattern===f.pattern){o.count.length>1&&o.count.pop(),o.count.push(f.count[0]),o.string=o.pattern+kl(o.count),a=l+1;continue}n.isPadded&&(d=_p(l,n,r)),f.string=d+f.pattern+kl(f.count),s.push(f),a=l+1,o=f}return s}function Ss(e,t,n,r,i){let s=[];for(let a of e){let{string:o}=a;!r&&!Cl(t,"string",o)&&s.push(n+o),r&&Cl(t,"string",o)&&s.push(n+o)}return s}function hp(e,t){let n=[];for(let r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}function dp(e,t){return e>t?1:t>e?-1:0}function Cl(e,t,n){return e.some(r=>r[t]===n)}function Tl(e,t){return Number(String(e).slice(0,-t)+"9".repeat(t))}function Rl(e,t){return e-e%Math.pow(10,t)}function kl(e){let[t=0,n=""]=e;return n||t>1?`{${t+(n?","+n:"")}}`:""}function gp(e,t,n){return`[${e}${t-e===1?"":"-"}${t}]`}function Ol(e){return/^-?(0+)\d/.test(e)}function _p(e,t,n){if(!t.isPadded)return e;let r=Math.abs(t.maxLen-String(e).length),i=n.relaxZeros!==!1;switch(r){case 0:return"";case 1:return i?"0?":"0";case 2:return i?"0{0,2}":"00";default:return i?`0{0,${r}}`:`0{${r}}`}}Yt.cache={};Yt.clearCache=()=>Yt.cache={};xl.exports=Yt});var Is=m((pv,Bl)=>{"use strict";var pp=require("util"),Dl=Ml(),Ll=e=>e!==null&&typeof e=="object"&&!Array.isArray(e),mp=e=>t=>e===!0?Number(t):String(t),As=e=>typeof e=="number"||typeof e=="string"&&e!=="",er=e=>Number.isInteger(+e),ws=e=>{let t=`${e}`,n=-1;if(t[0]==="-"&&(t=t.slice(1)),t==="0")return!1;for(;t[++n]==="0";);return n>0},yp=(e,t,n)=>typeof e=="string"||typeof t=="string"?!0:n.stringify===!0,vp=(e,t,n)=>{if(t>0){let r=e[0]==="-"?"-":"";r&&(e=e.slice(1)),e=r+e.padStart(r?t-1:t,"0")}return n===!1?String(e):e},Fl=(e,t)=>{let n=e[0]==="-"?"-":"";for(n&&(e=e.slice(1),t--);e.length<t;)e="0"+e;return n?"-"+e:e},bp=(e,t)=>{e.negatives.sort((a,o)=>a<o?-1:a>o?1:0),e.positives.sort((a,o)=>a<o?-1:a>o?1:0);let n=t.capture?"":"?:",r="",i="",s;return e.positives.length&&(r=e.positives.join("|")),e.negatives.length&&(i=`-(${n}${e.negatives.join("|")})`),r&&i?s=`${r}|${i}`:s=r||i,t.wrap?`(${n}${s})`:s},$l=(e,t,n,r)=>{if(n)return Dl(e,t,{wrap:!1,...r});let i=String.fromCharCode(e);if(e===t)return i;let s=String.fromCharCode(t);return`[${i}-${s}]`},ql=(e,t,n)=>{if(Array.isArray(e)){let r=n.wrap===!0,i=n.capture?"":"?:";return r?`(${i}${e.join("|")})`:e.join("|")}return Dl(e,t,n)},Vl=(...e)=>new RangeError("Invalid range arguments: "+pp.inspect(...e)),Gl=(e,t,n)=>{if(n.strictRanges===!0)throw Vl([e,t]);return[]},Ep=(e,t)=>{if(t.strictRanges===!0)throw new TypeError(`Expected step "${e}" to be a number`);return[]},Sp=(e,t,n=1,r={})=>{let i=Number(e),s=Number(t);if(!Number.isInteger(i)||!Number.isInteger(s)){if(r.strictRanges===!0)throw Vl([e,t]);return[]}i===0&&(i=0),s===0&&(s=0);let a=i>s,o=String(e),u=String(t),l=String(n);n=Math.max(Math.abs(n),1);let f=ws(o)||ws(u)||ws(l),d=f?Math.max(o.length,u.length,l.length):0,h=f===!1&&yp(e,t,r)===!1,y=r.transform||mp(h);if(r.toRegex&&n===1)return $l(Fl(e,d),Fl(t,d),!0,r);let p={negatives:[],positives:[]},S=W=>p[W<0?"negatives":"positives"].push(Math.abs(W)),C=[],M=0;for(;a?i>=s:i<=s;)r.toRegex===!0&&n>1?S(i):C.push(vp(y(i,M),d,h)),i=a?i-n:i+n,M++;return r.toRegex===!0?n>1?bp(p,r):ql(C,null,{wrap:!1,...r}):C},Ap=(e,t,n=1,r={})=>{if(!er(e)&&e.length>1||!er(t)&&t.length>1)return Gl(e,t,r);let i=r.transform||(h=>String.fromCharCode(h)),s=`${e}`.charCodeAt(0),a=`${t}`.charCodeAt(0),o=s>a,u=Math.min(s,a),l=Math.max(s,a);if(r.toRegex&&n===1)return $l(u,l,!1,r);let f=[],d=0;for(;o?s>=a:s<=a;)f.push(i(s,d)),s=o?s-n:s+n,d++;return r.toRegex===!0?ql(f,null,{wrap:!1,options:r}):f},ti=(e,t,n,r={})=>{if(t==null&&As(e))return[e];if(!As(e)||!As(t))return Gl(e,t,r);if(typeof n=="function")return ti(e,t,1,{transform:n});if(Ll(n))return ti(e,t,0,n);let i={...r};return i.capture===!0&&(i.wrap=!0),n=n||i.step||1,er(n)?er(e)&&er(t)?Sp(e,t,n,i):Ap(e,t,Math.max(Math.abs(n),1),i):n!=null&&!Ll(n)?Ep(n,i):ti(e,t,1,n)};Bl.exports=ti});var jl=m((mv,Ul)=>{"use strict";var wp=Is(),Hl=Jr(),Ip=(e,t={})=>{let n=(r,i={})=>{let s=Hl.isInvalidBrace(i),a=r.invalid===!0&&t.escapeInvalid===!0,o=s===!0||a===!0,u=t.escapeInvalid===!0?"\\":"",l="";if(r.isOpen===!0||r.isClose===!0)return u+r.value;if(r.type==="open")return o?u+r.value:"(";if(r.type==="close")return o?u+r.value:")";if(r.type==="comma")return r.prev.type==="comma"?"":o?r.value:"|";if(r.value)return r.value;if(r.nodes&&r.ranges>0){let f=Hl.reduce(r.nodes),d=wp(...f,{...t,wrap:!1,toRegex:!0});if(d.length!==0)return f.length>1&&d.length>1?`(${d})`:d}if(r.nodes)for(let f of r.nodes)l+=n(f,r);return l};return n(e)};Ul.exports=Ip});var Yl=m((yv,Kl)=>{"use strict";var Np=Is(),Wl=ei(),Nn=Jr(),Xt=(e="",t="",n=!1)=>{let r=[];if(e=[].concat(e),t=[].concat(t),!t.length)return e;if(!e.length)return n?Nn.flatten(t).map(i=>`{${i}}`):t;for(let i of e)if(Array.isArray(i))for(let s of i)r.push(Xt(s,t,n));else for(let s of t)n===!0&&typeof s=="string"&&(s=`{${s}}`),r.push(Array.isArray(s)?Xt(i,s,n):i+s);return Nn.flatten(r)},Pp=(e,t={})=>{let n=t.rangeLimit===void 0?1e3:t.rangeLimit,r=(i,s={})=>{i.queue=[];let a=s,o=s.queue;for(;a.type!=="brace"&&a.type!=="root"&&a.parent;)a=a.parent,o=a.queue;if(i.invalid||i.dollar){o.push(Xt(o.pop(),Wl(i,t)));return}if(i.type==="brace"&&i.invalid!==!0&&i.nodes.length===2){o.push(Xt(o.pop(),["{}"]));return}if(i.nodes&&i.ranges>0){let d=Nn.reduce(i.nodes);if(Nn.exceedsLimit(...d,t.step,n))throw new RangeError("expanded array length exceeds range limit. Use options.rangeLimit to increase or disable the limit.");let h=Np(...d,t);h.length===0&&(h=Wl(i,t)),o.push(Xt(o.pop(),h)),i.nodes=[];return}let u=Nn.encloseBrace(i),l=i.queue,f=i;for(;f.type!=="brace"&&f.type!=="root"&&f.parent;)f=f.parent,l=f.queue;for(let d=0;d<i.nodes.length;d++){let h=i.nodes[d];if(h.type==="comma"&&i.type==="brace"){d===1&&l.push(""),l.push("");continue}if(h.type==="close"){o.push(Xt(o.pop(),l,u));continue}if(h.value&&h.type!=="open"){l.push(Xt(l.pop(),h.value));continue}h.nodes&&r(h,i)}return l};return Nn.flatten(r(e))};Kl.exports=Pp});var Ql=m((vv,Xl)=>{"use strict";Xl.exports={MAX_LENGTH:1024*64,CHAR_0:"0",CHAR_9:"9",CHAR_UPPERCASE_A:"A",CHAR_LOWERCASE_A:"a",CHAR_UPPERCASE_Z:"Z",CHAR_LOWERCASE_Z:"z",CHAR_LEFT_PARENTHESES:"(",CHAR_RIGHT_PARENTHESES:")",CHAR_ASTERISK:"*",CHAR_AMPERSAND:"&",CHAR_AT:"@",CHAR_BACKSLASH:"\\",CHAR_BACKTICK:"`",CHAR_CARRIAGE_RETURN:"\r",CHAR_CIRCUMFLEX_ACCENT:"^",CHAR_COLON:":",CHAR_COMMA:",",CHAR_DOLLAR:"$",CHAR_DOT:".",CHAR_DOUBLE_QUOTE:'"',CHAR_EQUAL:"=",CHAR_EXCLAMATION_MARK:"!",CHAR_FORM_FEED:"\f",CHAR_FORWARD_SLASH:"/",CHAR_HASH:"#",CHAR_HYPHEN_MINUS:"-",CHAR_LEFT_ANGLE_BRACKET:"<",CHAR_LEFT_CURLY_BRACE:"{",CHAR_LEFT_SQUARE_BRACKET:"[",CHAR_LINE_FEED:`
`,CHAR_NO_BREAK_SPACE:"\xA0",CHAR_PERCENT:"%",CHAR_PLUS:"+",CHAR_QUESTION_MARK:"?",CHAR_RIGHT_ANGLE_BRACKET:">",CHAR_RIGHT_CURLY_BRACE:"}",CHAR_RIGHT_SQUARE_BRACKET:"]",CHAR_SEMICOLON:";",CHAR_SINGLE_QUOTE:"'",CHAR_SPACE:" ",CHAR_TAB:"	",CHAR_UNDERSCORE:"_",CHAR_VERTICAL_LINE:"|",CHAR_ZERO_WIDTH_NOBREAK_SPACE:"\uFEFF"}});var tc=m((bv,ec)=>{"use strict";var Cp=ei(),{MAX_LENGTH:zl,CHAR_BACKSLASH:Ns,CHAR_BACKTICK:Tp,CHAR_COMMA:Rp,CHAR_DOT:kp,CHAR_LEFT_PARENTHESES:Op,CHAR_RIGHT_PARENTHESES:xp,CHAR_LEFT_CURLY_BRACE:Mp,CHAR_RIGHT_CURLY_BRACE:Lp,CHAR_LEFT_SQUARE_BRACKET:Zl,CHAR_RIGHT_SQUARE_BRACKET:Jl,CHAR_DOUBLE_QUOTE:Fp,CHAR_SINGLE_QUOTE:Dp,CHAR_NO_BREAK_SPACE:$p,CHAR_ZERO_WIDTH_NOBREAK_SPACE:qp}=Ql(),Vp=(e,t={})=>{if(typeof e!="string")throw new TypeError("Expected a string");let n=t||{},r=typeof n.maxLength=="number"?Math.min(zl,n.maxLength):zl;if(e.length>r)throw new SyntaxError(`Input length (${e.length}), exceeds max characters (${r})`);let i={type:"root",input:e,nodes:[]},s=[i],a=i,o=i,u=0,l=e.length,f=0,d=0,h,y={},p=()=>e[f++],S=C=>{if(C.type==="text"&&o.type==="dot"&&(o.type="text"),o&&o.type==="text"&&C.type==="text"){o.value+=C.value;return}return a.nodes.push(C),C.parent=a,C.prev=o,o=C,C};for(S({type:"bos"});f<l;)if(a=s[s.length-1],h=p(),!(h===qp||h===$p)){if(h===Ns){S({type:"text",value:(t.keepEscaping?h:"")+p()});continue}if(h===Jl){S({type:"text",value:"\\"+h});continue}if(h===Zl){u++;let C=!0,M;for(;f<l&&(M=p());){if(h+=M,M===Zl){u++;continue}if(M===Ns){h+=p();continue}if(M===Jl&&(u--,u===0))break}S({type:"text",value:h});continue}if(h===Op){a=S({type:"paren",nodes:[]}),s.push(a),S({type:"text",value:h});continue}if(h===xp){if(a.type!=="paren"){S({type:"text",value:h});continue}a=s.pop(),S({type:"text",value:h}),a=s[s.length-1];continue}if(h===Fp||h===Dp||h===Tp){let C=h,M;for(t.keepQuotes!==!0&&(h="");f<l&&(M=p());){if(M===Ns){h+=M+p();continue}if(M===C){t.keepQuotes===!0&&(h+=M);break}h+=M}S({type:"text",value:h});continue}if(h===Mp){d++;let M={type:"brace",open:!0,close:!1,dollar:o.value&&o.value.slice(-1)==="$"||a.dollar===!0,depth:d,commas:0,ranges:0,nodes:[]};a=S(M),s.push(a),S({type:"open",value:h});continue}if(h===Lp){if(a.type!=="brace"){S({type:"text",value:h});continue}let C="close";a=s.pop(),a.close=!0,S({type:C,value:h}),d--,a=s[s.length-1];continue}if(h===Rp&&d>0){if(a.ranges>0){a.ranges=0;let C=a.nodes.shift();a.nodes=[C,{type:"text",value:Cp(a)}]}S({type:"comma",value:h}),a.commas++;continue}if(h===kp&&d>0&&a.commas===0){let C=a.nodes;if(d===0||C.length===0){S({type:"text",value:h});continue}if(o.type==="dot"){if(a.range=[],o.value+=h,o.type="range",a.nodes.length!==3&&a.nodes.length!==5){a.invalid=!0,a.ranges=0,o.type="text";continue}a.ranges++,a.args=[];continue}if(o.type==="range"){C.pop();let M=C[C.length-1];M.value+=o.value+h,o=M,a.ranges--;continue}S({type:"dot",value:h});continue}S({type:"text",value:h})}do if(a=s.pop(),a.type!=="root"){a.nodes.forEach(W=>{W.nodes||(W.type==="open"&&(W.isOpen=!0),W.type==="close"&&(W.isClose=!0),W.nodes||(W.type="text"),W.invalid=!0)});let C=s[s.length-1],M=C.nodes.indexOf(a);C.nodes.splice(M,1,...a.nodes)}while(s.length>0);return S({type:"eos"}),i};ec.exports=Vp});var ic=m((Ev,rc)=>{"use strict";var nc=ei(),Gp=jl(),Bp=Yl(),Hp=tc(),Oe=(e,t={})=>{let n=[];if(Array.isArray(e))for(let r of e){let i=Oe.create(r,t);Array.isArray(i)?n.push(...i):n.push(i)}else n=[].concat(Oe.create(e,t));return t&&t.expand===!0&&t.nodupes===!0&&(n=[...new Set(n)]),n};Oe.parse=(e,t={})=>Hp(e,t);Oe.stringify=(e,t={})=>nc(typeof e=="string"?Oe.parse(e,t):e,t);Oe.compile=(e,t={})=>(typeof e=="string"&&(e=Oe.parse(e,t)),Gp(e,t));Oe.expand=(e,t={})=>{typeof e=="string"&&(e=Oe.parse(e,t));let n=Bp(e,t);return t.noempty===!0&&(n=n.filter(Boolean)),t.nodupes===!0&&(n=[...new Set(n)]),n};Oe.create=(e,t={})=>e===""||e.length<3?[e]:t.expand!==!0?Oe.compile(e,t):Oe.expand(e,t);rc.exports=Oe});var tr=m((Sv,lc)=>{"use strict";var Up=require("path"),it="\\\\/",sc=`[^${it}]`,_t="\\.",jp="\\+",Wp="\\?",ni="\\/",Kp="(?=.)",ac="[^/]",Ps=`(?:${ni}|$)`,oc=`(?:^|${ni})`,Cs=`${_t}{1,2}${Ps}`,Yp=`(?!${_t})`,Xp=`(?!${oc}${Cs})`,Qp=`(?!${_t}{0,1}${Ps})`,zp=`(?!${Cs})`,Zp=`[^.${ni}]`,Jp=`${ac}*?`,uc={DOT_LITERAL:_t,PLUS_LITERAL:jp,QMARK_LITERAL:Wp,SLASH_LITERAL:ni,ONE_CHAR:Kp,QMARK:ac,END_ANCHOR:Ps,DOTS_SLASH:Cs,NO_DOT:Yp,NO_DOTS:Xp,NO_DOT_SLASH:Qp,NO_DOTS_SLASH:zp,QMARK_NO_DOT:Zp,STAR:Jp,START_ANCHOR:oc},em={...uc,SLASH_LITERAL:`[${it}]`,QMARK:sc,STAR:`${sc}*?`,DOTS_SLASH:`${_t}{1,2}(?:[${it}]|$)`,NO_DOT:`(?!${_t})`,NO_DOTS:`(?!(?:^|[${it}])${_t}{1,2}(?:[${it}]|$))`,NO_DOT_SLASH:`(?!${_t}{0,1}(?:[${it}]|$))`,NO_DOTS_SLASH:`(?!${_t}{1,2}(?:[${it}]|$))`,QMARK_NO_DOT:`[^.${it}]`,START_ANCHOR:`(?:^|[${it}])`,END_ANCHOR:`(?:[${it}]|$)`},tm={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};lc.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:tm,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:Up.sep,extglobChars(e){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(e){return e===!0?em:uc}}});var nr=m(Te=>{"use strict";var nm=require("path"),rm=process.platform==="win32",{REGEX_BACKSLASH:im,REGEX_REMOVE_BACKSLASH:sm,REGEX_SPECIAL_CHARS:am,REGEX_SPECIAL_CHARS_GLOBAL:om}=tr();Te.isObject=e=>e!==null&&typeof e=="object"&&!Array.isArray(e);Te.hasRegexChars=e=>am.test(e);Te.isRegexChar=e=>e.length===1&&Te.hasRegexChars(e);Te.escapeRegex=e=>e.replace(om,"\\$1");Te.toPosixSlashes=e=>e.replace(im,"/");Te.removeBackslashes=e=>e.replace(sm,t=>t==="\\"?"":t);Te.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return e.length===3&&e[0]>=9||e[0]===8&&e[1]>=10};Te.isWindows=e=>e&&typeof e.windows=="boolean"?e.windows:rm===!0||nm.sep==="\\";Te.escapeLast=(e,t,n)=>{let r=e.lastIndexOf(t,n);return r===-1?e:e[r-1]==="\\"?Te.escapeLast(e,t,r-1):`${e.slice(0,r)}\\${e.slice(r)}`};Te.removePrefix=(e,t={})=>{let n=e;return n.startsWith("./")&&(n=n.slice(2),t.prefix="./"),n};Te.wrapOutput=(e,t={},n={})=>{let r=n.contains?"":"^",i=n.contains?"":"$",s=`${r}(?:${e})${i}`;return t.negated===!0&&(s=`(?:^(?!${s}).*$)`),s}});var mc=m((wv,pc)=>{"use strict";var cc=nr(),{CHAR_ASTERISK:Ts,CHAR_AT:um,CHAR_BACKWARD_SLASH:rr,CHAR_COMMA:lm,CHAR_DOT:Rs,CHAR_EXCLAMATION_MARK:ks,CHAR_FORWARD_SLASH:_c,CHAR_LEFT_CURLY_BRACE:Os,CHAR_LEFT_PARENTHESES:xs,CHAR_LEFT_SQUARE_BRACKET:cm,CHAR_PLUS:fm,CHAR_QUESTION_MARK:fc,CHAR_RIGHT_CURLY_BRACE:hm,CHAR_RIGHT_PARENTHESES:hc,CHAR_RIGHT_SQUARE_BRACKET:dm}=tr(),dc=e=>e===_c||e===rr,gc=e=>{e.isPrefix!==!0&&(e.depth=e.isGlobstar?1/0:1)},gm=(e,t)=>{let n=t||{},r=e.length-1,i=n.parts===!0||n.scanToEnd===!0,s=[],a=[],o=[],u=e,l=-1,f=0,d=0,h=!1,y=!1,p=!1,S=!1,C=!1,M=!1,W=!1,T=!1,he=!1,x=!1,G=0,O,A,R={value:"",depth:0,isGlob:!1},L=()=>l>=r,_=()=>u.charCodeAt(l+1),ee=()=>(O=A,u.charCodeAt(++l));for(;l<r;){A=ee();let b;if(A===rr){W=R.backslashes=!0,A=ee(),A===Os&&(M=!0);continue}if(M===!0||A===Os){for(G++;L()!==!0&&(A=ee());){if(A===rr){W=R.backslashes=!0,ee();continue}if(A===Os){G++;continue}if(M!==!0&&A===Rs&&(A=ee())===Rs){if(h=R.isBrace=!0,p=R.isGlob=!0,x=!0,i===!0)continue;break}if(M!==!0&&A===lm){if(h=R.isBrace=!0,p=R.isGlob=!0,x=!0,i===!0)continue;break}if(A===hm&&(G--,G===0)){M=!1,h=R.isBrace=!0,x=!0;break}}if(i===!0)continue;break}if(A===_c){if(s.push(l),a.push(R),R={value:"",depth:0,isGlob:!1},x===!0)continue;if(O===Rs&&l===f+1){f+=2;continue}d=l+1;continue}if(n.noext!==!0&&(A===fm||A===um||A===Ts||A===fc||A===ks)===!0&&_()===xs){if(p=R.isGlob=!0,S=R.isExtglob=!0,x=!0,A===ks&&l===f&&(he=!0),i===!0){for(;L()!==!0&&(A=ee());){if(A===rr){W=R.backslashes=!0,A=ee();continue}if(A===hc){p=R.isGlob=!0,x=!0;break}}continue}break}if(A===Ts){if(O===Ts&&(C=R.isGlobstar=!0),p=R.isGlob=!0,x=!0,i===!0)continue;break}if(A===fc){if(p=R.isGlob=!0,x=!0,i===!0)continue;break}if(A===cm){for(;L()!==!0&&(b=ee());){if(b===rr){W=R.backslashes=!0,ee();continue}if(b===dm){y=R.isBracket=!0,p=R.isGlob=!0,x=!0;break}}if(i===!0)continue;break}if(n.nonegate!==!0&&A===ks&&l===f){T=R.negated=!0,f++;continue}if(n.noparen!==!0&&A===xs){if(p=R.isGlob=!0,i===!0){for(;L()!==!0&&(A=ee());){if(A===xs){W=R.backslashes=!0,A=ee();continue}if(A===hc){x=!0;break}}continue}break}if(p===!0){if(x=!0,i===!0)continue;break}}n.noext===!0&&(S=!1,p=!1);let P=u,I="",c="";f>0&&(I=u.slice(0,f),u=u.slice(f),d-=f),P&&p===!0&&d>0?(P=u.slice(0,d),c=u.slice(d)):p===!0?(P="",c=u):P=u,P&&P!==""&&P!=="/"&&P!==u&&dc(P.charCodeAt(P.length-1))&&(P=P.slice(0,-1)),n.unescape===!0&&(c&&(c=cc.removeBackslashes(c)),P&&W===!0&&(P=cc.removeBackslashes(P)));let g={prefix:I,input:e,start:f,base:P,glob:c,isBrace:h,isBracket:y,isGlob:p,isExtglob:S,isGlobstar:C,negated:T,negatedExtglob:he};if(n.tokens===!0&&(g.maxDepth=0,dc(A)||a.push(R),g.tokens=a),n.parts===!0||n.tokens===!0){let b;for(let w=0;w<s.length;w++){let k=b?b+1:f,B=s[w],U=e.slice(k,B);n.tokens&&(w===0&&f!==0?(a[w].isPrefix=!0,a[w].value=I):a[w].value=U,gc(a[w]),g.maxDepth+=a[w].depth),(w!==0||U!=="")&&o.push(U),b=B}if(b&&b+1<e.length){let w=e.slice(b+1);o.push(w),n.tokens&&(a[a.length-1].value=w,gc(a[a.length-1]),g.maxDepth+=a[a.length-1].depth)}g.slashes=s,g.parts=o}return g};pc.exports=gm});var bc=m((Iv,vc)=>{"use strict";var ri=tr(),xe=nr(),{MAX_LENGTH:ii,POSIX_REGEX_SOURCE:_m,REGEX_NON_SPECIAL_CHARS:pm,REGEX_SPECIAL_CHARS_BACKREF:mm,REPLACEMENTS:yc}=ri,ym=(e,t)=>{if(typeof t.expandRange=="function")return t.expandRange(...e,t);e.sort();let n=`[${e.join("-")}]`;try{new RegExp(n)}catch{return e.map(i=>xe.escapeRegex(i)).join("..")}return n},Pn=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,Ms=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");e=yc[e]||e;let n={...t},r=typeof n.maxLength=="number"?Math.min(ii,n.maxLength):ii,i=e.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);let s={type:"bos",value:"",output:n.prepend||""},a=[s],o=n.capture?"":"?:",u=xe.isWindows(t),l=ri.globChars(u),f=ri.extglobChars(l),{DOT_LITERAL:d,PLUS_LITERAL:h,SLASH_LITERAL:y,ONE_CHAR:p,DOTS_SLASH:S,NO_DOT:C,NO_DOT_SLASH:M,NO_DOTS_SLASH:W,QMARK:T,QMARK_NO_DOT:he,STAR:x,START_ANCHOR:G}=l,O=v=>`(${o}(?:(?!${G}${v.dot?S:d}).)*?)`,A=n.dot?"":C,R=n.dot?T:he,L=n.bash===!0?O(n):x;n.capture&&(L=`(${L})`),typeof n.noext=="boolean"&&(n.noextglob=n.noext);let _={input:e,index:-1,start:0,dot:n.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};e=xe.removePrefix(e,_),i=e.length;let ee=[],P=[],I=[],c=s,g,b=()=>_.index===i-1,w=_.peek=(v=1)=>e[_.index+v],k=_.advance=()=>e[++_.index]||"",B=()=>e.slice(_.index+1),U=(v="",j=0)=>{_.consumed+=v,_.index+=j},te=v=>{_.output+=v.output!=null?v.output:v.value,U(v.value)},de=()=>{let v=1;for(;w()==="!"&&(w(2)!=="("||w(3)==="?");)k(),_.start++,v++;return v%2===0?!1:(_.negated=!0,_.start++,!0)},Re=v=>{_[v]++,I.push(v)},_e=v=>{_[v]--,I.pop()},q=v=>{if(c.type==="globstar"){let j=_.braces>0&&(v.type==="comma"||v.type==="brace"),E=v.extglob===!0||ee.length&&(v.type==="pipe"||v.type==="paren");v.type!=="slash"&&v.type!=="paren"&&!j&&!E&&(_.output=_.output.slice(0,-c.output.length),c.type="star",c.value="*",c.output=L,_.output+=c.output)}if(ee.length&&v.type!=="paren"&&(ee[ee.length-1].inner+=v.value),(v.value||v.output)&&te(v),c&&c.type==="text"&&v.type==="text"){c.value+=v.value,c.output=(c.output||"")+v.value;return}v.prev=c,a.push(v),c=v},Qe=(v,j)=>{let E={...f[j],conditions:1,inner:""};E.prev=c,E.parens=_.parens,E.output=_.output;let $=(n.capture?"(":"")+E.open;Re("parens"),q({type:v,value:j,output:_.output?"":p}),q({type:"paren",extglob:!0,value:k(),output:$}),ee.push(E)},vt=v=>{let j=v.close+(n.capture?")":""),E;if(v.type==="negate"){let $=L;if(v.inner&&v.inner.length>1&&v.inner.includes("/")&&($=O(n)),($!==L||b()||/^\)+$/.test(B()))&&(j=v.close=`)$))${$}`),v.inner.includes("*")&&(E=B())&&/^\.[^\\/.]+$/.test(E)){let se=Ms(E,{...t,fastpaths:!1}).output;j=v.close=`)${se})${$})`}v.prev.type==="bos"&&(_.negatedExtglob=!0)}q({type:"paren",extglob:!0,value:g,output:j}),_e("parens")};if(n.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(e)){let v=!1,j=e.replace(mm,(E,$,se,Ee,fe,Ri)=>Ee==="\\"?(v=!0,E):Ee==="?"?$?$+Ee+(fe?T.repeat(fe.length):""):Ri===0?R+(fe?T.repeat(fe.length):""):T.repeat(se.length):Ee==="."?d.repeat(se.length):Ee==="*"?$?$+Ee+(fe?L:""):L:$?E:`\\${E}`);return v===!0&&(n.unescape===!0?j=j.replace(/\\/g,""):j=j.replace(/\\+/g,E=>E.length%2===0?"\\\\":E?"\\":"")),j===e&&n.contains===!0?(_.output=e,_):(_.output=xe.wrapOutput(j,_,t),_)}for(;!b();){if(g=k(),g==="\0")continue;if(g==="\\"){let E=w();if(E==="/"&&n.bash!==!0||E==="."||E===";")continue;if(!E){g+="\\",q({type:"text",value:g});continue}let $=/^\\+/.exec(B()),se=0;if($&&$[0].length>2&&(se=$[0].length,_.index+=se,se%2!==0&&(g+="\\")),n.unescape===!0?g=k():g+=k(),_.brackets===0){q({type:"text",value:g});continue}}if(_.brackets>0&&(g!=="]"||c.value==="["||c.value==="[^")){if(n.posix!==!1&&g===":"){let E=c.value.slice(1);if(E.includes("[")&&(c.posix=!0,E.includes(":"))){let $=c.value.lastIndexOf("["),se=c.value.slice(0,$),Ee=c.value.slice($+2),fe=_m[Ee];if(fe){c.value=se+fe,_.backtrack=!0,k(),!s.output&&a.indexOf(c)===1&&(s.output=p);continue}}}(g==="["&&w()!==":"||g==="-"&&w()==="]")&&(g=`\\${g}`),g==="]"&&(c.value==="["||c.value==="[^")&&(g=`\\${g}`),n.posix===!0&&g==="!"&&c.value==="["&&(g="^"),c.value+=g,te({value:g});continue}if(_.quotes===1&&g!=='"'){g=xe.escapeRegex(g),c.value+=g,te({value:g});continue}if(g==='"'){_.quotes=_.quotes===1?0:1,n.keepQuotes===!0&&q({type:"text",value:g});continue}if(g==="("){Re("parens"),q({type:"paren",value:g});continue}if(g===")"){if(_.parens===0&&n.strictBrackets===!0)throw new SyntaxError(Pn("opening","("));let E=ee[ee.length-1];if(E&&_.parens===E.parens+1){vt(ee.pop());continue}q({type:"paren",value:g,output:_.parens?")":"\\)"}),_e("parens");continue}if(g==="["){if(n.nobracket===!0||!B().includes("]")){if(n.nobracket!==!0&&n.strictBrackets===!0)throw new SyntaxError(Pn("closing","]"));g=`\\${g}`}else Re("brackets");q({type:"bracket",value:g});continue}if(g==="]"){if(n.nobracket===!0||c&&c.type==="bracket"&&c.value.length===1){q({type:"text",value:g,output:`\\${g}`});continue}if(_.brackets===0){if(n.strictBrackets===!0)throw new SyntaxError(Pn("opening","["));q({type:"text",value:g,output:`\\${g}`});continue}_e("brackets");let E=c.value.slice(1);if(c.posix!==!0&&E[0]==="^"&&!E.includes("/")&&(g=`/${g}`),c.value+=g,te({value:g}),n.literalBrackets===!1||xe.hasRegexChars(E))continue;let $=xe.escapeRegex(c.value);if(_.output=_.output.slice(0,-c.value.length),n.literalBrackets===!0){_.output+=$,c.value=$;continue}c.value=`(${o}${$}|${c.value})`,_.output+=c.value;continue}if(g==="{"&&n.nobrace!==!0){Re("braces");let E={type:"brace",value:g,output:"(",outputIndex:_.output.length,tokensIndex:_.tokens.length};P.push(E),q(E);continue}if(g==="}"){let E=P[P.length-1];if(n.nobrace===!0||!E){q({type:"text",value:g,output:g});continue}let $=")";if(E.dots===!0){let se=a.slice(),Ee=[];for(let fe=se.length-1;fe>=0&&(a.pop(),se[fe].type!=="brace");fe--)se[fe].type!=="dots"&&Ee.unshift(se[fe].value);$=ym(Ee,n),_.backtrack=!0}if(E.comma!==!0&&E.dots!==!0){let se=_.output.slice(0,E.outputIndex),Ee=_.tokens.slice(E.tokensIndex);E.value=E.output="\\{",g=$="\\}",_.output=se;for(let fe of Ee)_.output+=fe.output||fe.value}q({type:"brace",value:g,output:$}),_e("braces"),P.pop();continue}if(g==="|"){ee.length>0&&ee[ee.length-1].conditions++,q({type:"text",value:g});continue}if(g===","){let E=g,$=P[P.length-1];$&&I[I.length-1]==="braces"&&($.comma=!0,E="|"),q({type:"comma",value:g,output:E});continue}if(g==="/"){if(c.type==="dot"&&_.index===_.start+1){_.start=_.index+1,_.consumed="",_.output="",a.pop(),c=s;continue}q({type:"slash",value:g,output:y});continue}if(g==="."){if(_.braces>0&&c.type==="dot"){c.value==="."&&(c.output=d);let E=P[P.length-1];c.type="dots",c.output+=g,c.value+=g,E.dots=!0;continue}if(_.braces+_.parens===0&&c.type!=="bos"&&c.type!=="slash"){q({type:"text",value:g,output:d});continue}q({type:"dot",value:g,output:d});continue}if(g==="?"){if(!(c&&c.value==="(")&&n.noextglob!==!0&&w()==="("&&w(2)!=="?"){Qe("qmark",g);continue}if(c&&c.type==="paren"){let $=w(),se=g;if($==="<"&&!xe.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(c.value==="("&&!/[!=<:]/.test($)||$==="<"&&!/<([!=]|\w+>)/.test(B()))&&(se=`\\${g}`),q({type:"text",value:g,output:se});continue}if(n.dot!==!0&&(c.type==="slash"||c.type==="bos")){q({type:"qmark",value:g,output:he});continue}q({type:"qmark",value:g,output:T});continue}if(g==="!"){if(n.noextglob!==!0&&w()==="("&&(w(2)!=="?"||!/[!=<:]/.test(w(3)))){Qe("negate",g);continue}if(n.nonegate!==!0&&_.index===0){de();continue}}if(g==="+"){if(n.noextglob!==!0&&w()==="("&&w(2)!=="?"){Qe("plus",g);continue}if(c&&c.value==="("||n.regex===!1){q({type:"plus",value:g,output:h});continue}if(c&&(c.type==="bracket"||c.type==="paren"||c.type==="brace")||_.parens>0){q({type:"plus",value:g});continue}q({type:"plus",value:h});continue}if(g==="@"){if(n.noextglob!==!0&&w()==="("&&w(2)!=="?"){q({type:"at",extglob:!0,value:g,output:""});continue}q({type:"text",value:g});continue}if(g!=="*"){(g==="$"||g==="^")&&(g=`\\${g}`);let E=pm.exec(B());E&&(g+=E[0],_.index+=E[0].length),q({type:"text",value:g});continue}if(c&&(c.type==="globstar"||c.star===!0)){c.type="star",c.star=!0,c.value+=g,c.output=L,_.backtrack=!0,_.globstar=!0,U(g);continue}let v=B();if(n.noextglob!==!0&&/^\([^?]/.test(v)){Qe("star",g);continue}if(c.type==="star"){if(n.noglobstar===!0){U(g);continue}let E=c.prev,$=E.prev,se=E.type==="slash"||E.type==="bos",Ee=$&&($.type==="star"||$.type==="globstar");if(n.bash===!0&&(!se||v[0]&&v[0]!=="/")){q({type:"star",value:g,output:""});continue}let fe=_.braces>0&&(E.type==="comma"||E.type==="brace"),Ri=ee.length&&(E.type==="pipe"||E.type==="paren");if(!se&&E.type!=="paren"&&!fe&&!Ri){q({type:"star",value:g,output:""});continue}for(;v.slice(0,3)==="/**";){let ur=e[_.index+4];if(ur&&ur!=="/")break;v=v.slice(3),U("/**",3)}if(E.type==="bos"&&b()){c.type="globstar",c.value+=g,c.output=O(n),_.output=c.output,_.globstar=!0,U(g);continue}if(E.type==="slash"&&E.prev.type!=="bos"&&!Ee&&b()){_.output=_.output.slice(0,-(E.output+c.output).length),E.output=`(?:${E.output}`,c.type="globstar",c.output=O(n)+(n.strictSlashes?")":"|$)"),c.value+=g,_.globstar=!0,_.output+=E.output+c.output,U(g);continue}if(E.type==="slash"&&E.prev.type!=="bos"&&v[0]==="/"){let ur=v[1]!==void 0?"|$":"";_.output=_.output.slice(0,-(E.output+c.output).length),E.output=`(?:${E.output}`,c.type="globstar",c.output=`${O(n)}${y}|${y}${ur})`,c.value+=g,_.output+=E.output+c.output,_.globstar=!0,U(g+k()),q({type:"slash",value:"/",output:""});continue}if(E.type==="bos"&&v[0]==="/"){c.type="globstar",c.value+=g,c.output=`(?:^|${y}|${O(n)}${y})`,_.output=c.output,_.globstar=!0,U(g+k()),q({type:"slash",value:"/",output:""});continue}_.output=_.output.slice(0,-c.output.length),c.type="globstar",c.output=O(n),c.value+=g,_.output+=c.output,_.globstar=!0,U(g);continue}let j={type:"star",value:g,output:L};if(n.bash===!0){j.output=".*?",(c.type==="bos"||c.type==="slash")&&(j.output=A+j.output),q(j);continue}if(c&&(c.type==="bracket"||c.type==="paren")&&n.regex===!0){j.output=g,q(j);continue}(_.index===_.start||c.type==="slash"||c.type==="dot")&&(c.type==="dot"?(_.output+=M,c.output+=M):n.dot===!0?(_.output+=W,c.output+=W):(_.output+=A,c.output+=A),w()!=="*"&&(_.output+=p,c.output+=p)),q(j)}for(;_.brackets>0;){if(n.strictBrackets===!0)throw new SyntaxError(Pn("closing","]"));_.output=xe.escapeLast(_.output,"["),_e("brackets")}for(;_.parens>0;){if(n.strictBrackets===!0)throw new SyntaxError(Pn("closing",")"));_.output=xe.escapeLast(_.output,"("),_e("parens")}for(;_.braces>0;){if(n.strictBrackets===!0)throw new SyntaxError(Pn("closing","}"));_.output=xe.escapeLast(_.output,"{"),_e("braces")}if(n.strictSlashes!==!0&&(c.type==="star"||c.type==="bracket")&&q({type:"maybe_slash",value:"",output:`${y}?`}),_.backtrack===!0){_.output="";for(let v of _.tokens)_.output+=v.output!=null?v.output:v.value,v.suffix&&(_.output+=v.suffix)}return _};Ms.fastpaths=(e,t)=>{let n={...t},r=typeof n.maxLength=="number"?Math.min(ii,n.maxLength):ii,i=e.length;if(i>r)throw new SyntaxError(`Input length: ${i}, exceeds maximum allowed length: ${r}`);e=yc[e]||e;let s=xe.isWindows(t),{DOT_LITERAL:a,SLASH_LITERAL:o,ONE_CHAR:u,DOTS_SLASH:l,NO_DOT:f,NO_DOTS:d,NO_DOTS_SLASH:h,STAR:y,START_ANCHOR:p}=ri.globChars(s),S=n.dot?d:f,C=n.dot?h:f,M=n.capture?"":"?:",W={negated:!1,prefix:""},T=n.bash===!0?".*?":y;n.capture&&(T=`(${T})`);let he=A=>A.noglobstar===!0?T:`(${M}(?:(?!${p}${A.dot?l:a}).)*?)`,x=A=>{switch(A){case"*":return`${S}${u}${T}`;case".*":return`${a}${u}${T}`;case"*.*":return`${S}${T}${a}${u}${T}`;case"*/*":return`${S}${T}${o}${u}${C}${T}`;case"**":return S+he(n);case"**/*":return`(?:${S}${he(n)}${o})?${C}${u}${T}`;case"**/*.*":return`(?:${S}${he(n)}${o})?${C}${T}${a}${u}${T}`;case"**/.*":return`(?:${S}${he(n)}${o})?${a}${u}${T}`;default:{let R=/^(.*?)\.(\w+)$/.exec(A);if(!R)return;let L=x(R[1]);return L?L+a+R[2]:void 0}}},G=xe.removePrefix(e,W),O=x(G);return O&&n.strictSlashes!==!0&&(O+=`${o}?`),O};vc.exports=Ms});var Sc=m((Nv,Ec)=>{"use strict";var vm=require("path"),bm=mc(),Ls=bc(),Fs=nr(),Em=tr(),Sm=e=>e&&typeof e=="object"&&!Array.isArray(e),oe=(e,t,n=!1)=>{if(Array.isArray(e)){let f=e.map(h=>oe(h,t,n));return h=>{for(let y of f){let p=y(h);if(p)return p}return!1}}let r=Sm(e)&&e.tokens&&e.input;if(e===""||typeof e!="string"&&!r)throw new TypeError("Expected pattern to be a non-empty string");let i=t||{},s=Fs.isWindows(t),a=r?oe.compileRe(e,t):oe.makeRe(e,t,!1,!0),o=a.state;delete a.state;let u=()=>!1;if(i.ignore){let f={...t,ignore:null,onMatch:null,onResult:null};u=oe(i.ignore,f,n)}let l=(f,d=!1)=>{let{isMatch:h,match:y,output:p}=oe.test(f,a,t,{glob:e,posix:s}),S={glob:e,state:o,regex:a,posix:s,input:f,output:p,match:y,isMatch:h};return typeof i.onResult=="function"&&i.onResult(S),h===!1?(S.isMatch=!1,d?S:!1):u(f)?(typeof i.onIgnore=="function"&&i.onIgnore(S),S.isMatch=!1,d?S:!1):(typeof i.onMatch=="function"&&i.onMatch(S),d?S:!0)};return n&&(l.state=o),l};oe.test=(e,t,n,{glob:r,posix:i}={})=>{if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e==="")return{isMatch:!1,output:""};let s=n||{},a=s.format||(i?Fs.toPosixSlashes:null),o=e===r,u=o&&a?a(e):e;return o===!1&&(u=a?a(e):e,o=u===r),(o===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?o=oe.matchBase(e,t,n,i):o=t.exec(u)),{isMatch:Boolean(o),match:o,output:u}};oe.matchBase=(e,t,n,r=Fs.isWindows(n))=>(t instanceof RegExp?t:oe.makeRe(t,n)).test(vm.basename(e));oe.isMatch=(e,t,n)=>oe(t,n)(e);oe.parse=(e,t)=>Array.isArray(e)?e.map(n=>oe.parse(n,t)):Ls(e,{...t,fastpaths:!1});oe.scan=(e,t)=>bm(e,t);oe.compileRe=(e,t,n=!1,r=!1)=>{if(n===!0)return e.output;let i=t||{},s=i.contains?"":"^",a=i.contains?"":"$",o=`${s}(?:${e.output})${a}`;e&&e.negated===!0&&(o=`^(?!${o}).*$`);let u=oe.toRegex(o,t);return r===!0&&(u.state=e),u};oe.makeRe=(e,t={},n=!1,r=!1)=>{if(!e||typeof e!="string")throw new TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return t.fastpaths!==!1&&(e[0]==="."||e[0]==="*")&&(i.output=Ls.fastpaths(e,t)),i.output||(i=Ls(e,t)),oe.compileRe(i,t,n,r)};oe.toRegex=(e,t)=>{try{let n=t||{};return new RegExp(e,n.flags||(n.nocase?"i":""))}catch(n){if(t&&t.debug===!0)throw n;return/$^/}};oe.constants=Em;Ec.exports=oe});var wc=m((Pv,Ac)=>{"use strict";Ac.exports=Sc()});var Tc=m((Cv,Cc)=>{"use strict";var Nc=require("util"),Pc=ic(),st=wc(),Ds=nr(),Ic=e=>e===""||e==="./",ie=(e,t,n)=>{t=[].concat(t),e=[].concat(e);let r=new Set,i=new Set,s=new Set,a=0,o=f=>{s.add(f.output),n&&n.onResult&&n.onResult(f)};for(let f=0;f<t.length;f++){let d=st(String(t[f]),{...n,onResult:o},!0),h=d.state.negated||d.state.negatedExtglob;h&&a++;for(let y of e){let p=d(y,!0);!(h?!p.isMatch:p.isMatch)||(h?r.add(p.output):(r.delete(p.output),i.add(p.output)))}}let l=(a===t.length?[...s]:[...i]).filter(f=>!r.has(f));if(n&&l.length===0){if(n.failglob===!0)throw new Error(`No matches found for "${t.join(", ")}"`);if(n.nonull===!0||n.nullglob===!0)return n.unescape?t.map(f=>f.replace(/\\/g,"")):t}return l};ie.match=ie;ie.matcher=(e,t)=>st(e,t);ie.isMatch=(e,t,n)=>st(t,n)(e);ie.any=ie.isMatch;ie.not=(e,t,n={})=>{t=[].concat(t).map(String);let r=new Set,i=[],s=o=>{n.onResult&&n.onResult(o),i.push(o.output)},a=new Set(ie(e,t,{...n,onResult:s}));for(let o of i)a.has(o)||r.add(o);return[...r]};ie.contains=(e,t,n)=>{if(typeof e!="string")throw new TypeError(`Expected a string: "${Nc.inspect(e)}"`);if(Array.isArray(t))return t.some(r=>ie.contains(e,r,n));if(typeof t=="string"){if(Ic(e)||Ic(t))return!1;if(e.includes(t)||e.startsWith("./")&&e.slice(2).includes(t))return!0}return ie.isMatch(e,t,{...n,contains:!0})};ie.matchKeys=(e,t,n)=>{if(!Ds.isObject(e))throw new TypeError("Expected the first argument to be an object");let r=ie(Object.keys(e),t,n),i={};for(let s of r)i[s]=e[s];return i};ie.some=(e,t,n)=>{let r=[].concat(e);for(let i of[].concat(t)){let s=st(String(i),n);if(r.some(a=>s(a)))return!0}return!1};ie.every=(e,t,n)=>{let r=[].concat(e);for(let i of[].concat(t)){let s=st(String(i),n);if(!r.every(a=>s(a)))return!1}return!0};ie.all=(e,t,n)=>{if(typeof e!="string")throw new TypeError(`Expected a string: "${Nc.inspect(e)}"`);return[].concat(t).every(r=>st(r,n)(e))};ie.capture=(e,t,n)=>{let r=Ds.isWindows(n),s=st.makeRe(String(e),{...n,capture:!0}).exec(r?Ds.toPosixSlashes(t):t);if(s)return s.slice(1).map(a=>a===void 0?"":a)};ie.makeRe=(...e)=>st.makeRe(...e);ie.scan=(...e)=>st.scan(...e);ie.parse=(e,t)=>{let n=[];for(let r of[].concat(e||[]))for(let i of Pc(String(r),t))n.push(st.parse(i,t));return n};ie.braces=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");return t&&t.nobrace===!0||!/\{.*\}/.test(e)?[e]:Pc(e,t)};ie.braceExpand=(e,t)=>{if(typeof e!="string")throw new TypeError("Expected a string");return ie.braces(e,{...t,expand:!0})};Cc.exports=ie});var Dc=m(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.matchAny=D.convertPatternsToRe=D.makeRe=D.getPatternParts=D.expandBraceExpansion=D.expandPatternsWithBraceExpansion=D.isAffectDepthOfReadingPattern=D.endsWithSlashGlobStar=D.hasGlobStar=D.getBaseDirectory=D.isPatternRelatedToParentDirectory=D.getPatternsOutsideCurrentDirectory=D.getPatternsInsideCurrentDirectory=D.getPositivePatterns=D.getNegativePatterns=D.isPositivePattern=D.isNegativePattern=D.convertToNegativePattern=D.convertToPositivePattern=D.isDynamicPattern=D.isStaticPattern=void 0;var Am=require("path"),wm=El(),$s=Tc(),Rc="**",Im="\\",Nm=/[*?]|^!/,Pm=/\[[^[]*]/,Cm=/(?:^|[^!*+?@])\([^(]*\|[^|]*\)/,Tm=/[!*+?@]\([^(]*\)/,Rm=/,|\.\./;function kc(e,t={}){return!Oc(e,t)}D.isStaticPattern=kc;function Oc(e,t={}){return e===""?!1:!!(t.caseSensitiveMatch===!1||e.includes(Im)||Nm.test(e)||Pm.test(e)||Cm.test(e)||t.extglob!==!1&&Tm.test(e)||t.braceExpansion!==!1&&km(e))}D.isDynamicPattern=Oc;function km(e){let t=e.indexOf("{");if(t===-1)return!1;let n=e.indexOf("}",t+1);if(n===-1)return!1;let r=e.slice(t,n);return Rm.test(r)}function Om(e){return si(e)?e.slice(1):e}D.convertToPositivePattern=Om;function xm(e){return"!"+e}D.convertToNegativePattern=xm;function si(e){return e.startsWith("!")&&e[1]!=="("}D.isNegativePattern=si;function xc(e){return!si(e)}D.isPositivePattern=xc;function Mm(e){return e.filter(si)}D.getNegativePatterns=Mm;function Lm(e){return e.filter(xc)}D.getPositivePatterns=Lm;function Fm(e){return e.filter(t=>!qs(t))}D.getPatternsInsideCurrentDirectory=Fm;function Dm(e){return e.filter(qs)}D.getPatternsOutsideCurrentDirectory=Dm;function qs(e){return e.startsWith("..")||e.startsWith("./..")}D.isPatternRelatedToParentDirectory=qs;function $m(e){return wm(e,{flipBackslashes:!1})}D.getBaseDirectory=$m;function qm(e){return e.includes(Rc)}D.hasGlobStar=qm;function Mc(e){return e.endsWith("/"+Rc)}D.endsWithSlashGlobStar=Mc;function Vm(e){let t=Am.basename(e);return Mc(e)||kc(t)}D.isAffectDepthOfReadingPattern=Vm;function Gm(e){return e.reduce((t,n)=>t.concat(Lc(n)),[])}D.expandPatternsWithBraceExpansion=Gm;function Lc(e){return $s.braces(e,{expand:!0,nodupes:!0})}D.expandBraceExpansion=Lc;function Bm(e,t){let{parts:n}=$s.scan(e,Object.assign(Object.assign({},t),{parts:!0}));return n.length===0&&(n=[e]),n[0].startsWith("/")&&(n[0]=n[0].slice(1),n.unshift("")),n}D.getPatternParts=Bm;function Fc(e,t){return $s.makeRe(e,t)}D.makeRe=Fc;function Hm(e,t){return e.map(n=>Fc(n,t))}D.convertPatternsToRe=Hm;function Um(e,t){return t.some(n=>n.test(e))}D.matchAny=Um});var qc=m(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.merge=void 0;var jm=vs();function Wm(e){let t=jm(e);return e.forEach(n=>{n.once("error",r=>t.emit("error",r))}),t.once("close",()=>$c(e)),t.once("end",()=>$c(e)),t}ai.merge=Wm;function $c(e){e.forEach(t=>t.emit("close"))}});var Vc=m(Cn=>{"use strict";Object.defineProperty(Cn,"__esModule",{value:!0});Cn.isEmpty=Cn.isString=void 0;function Km(e){return typeof e=="string"}Cn.isString=Km;function Ym(e){return e===""}Cn.isEmpty=Ym});var pt=m(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.string=ve.stream=ve.pattern=ve.path=ve.fs=ve.errno=ve.array=void 0;var Xm=fl();ve.array=Xm;var Qm=hl();ve.errno=Qm;var zm=dl();ve.fs=zm;var Zm=gl();ve.path=Zm;var Jm=Dc();ve.pattern=Jm;var e0=qc();ve.stream=e0;var t0=Vc();ve.string=t0});var Hc=m(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.convertPatternGroupToTask=be.convertPatternGroupsToTasks=be.groupPatternsByBaseDirectory=be.getNegativePatternsAsPositive=be.getPositivePatterns=be.convertPatternsToTasks=be.generate=void 0;var mt=pt();function n0(e,t){let n=Gc(e),r=Bc(e,t.ignore),i=n.filter(u=>mt.pattern.isStaticPattern(u,t)),s=n.filter(u=>mt.pattern.isDynamicPattern(u,t)),a=Vs(i,r,!1),o=Vs(s,r,!0);return a.concat(o)}be.generate=n0;function Vs(e,t,n){let r=[],i=mt.pattern.getPatternsOutsideCurrentDirectory(e),s=mt.pattern.getPatternsInsideCurrentDirectory(e),a=Gs(i),o=Gs(s);return r.push(...Bs(a,t,n)),"."in o?r.push(Hs(".",s,t,n)):r.push(...Bs(o,t,n)),r}be.convertPatternsToTasks=Vs;function Gc(e){return mt.pattern.getPositivePatterns(e)}be.getPositivePatterns=Gc;function Bc(e,t){return mt.pattern.getNegativePatterns(e).concat(t).map(mt.pattern.convertToPositivePattern)}be.getNegativePatternsAsPositive=Bc;function Gs(e){let t={};return e.reduce((n,r)=>{let i=mt.pattern.getBaseDirectory(r);return i in n?n[i].push(r):n[i]=[r],n},t)}be.groupPatternsByBaseDirectory=Gs;function Bs(e,t,n){return Object.keys(e).map(r=>Hs(r,e[r],t,n))}be.convertPatternGroupsToTasks=Bs;function Hs(e,t,n,r){return{dynamic:r,positive:t,negative:n,base:e,patterns:[].concat(t,n.map(mt.pattern.convertToNegativePattern))}}be.convertPatternGroupToTask=Hs});var jc=m(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.removeDuplicateSlashes=Tn.transform=void 0;var r0=/(?!^)\/{2,}/g;function i0(e){return e.map(t=>Uc(t))}Tn.transform=i0;function Uc(e){return e.replace(r0,"/")}Tn.removeDuplicateSlashes=Uc});var Kc=m(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.read=void 0;function s0(e,t,n){t.fs.lstat(e,(r,i)=>{if(r!==null){Wc(n,r);return}if(!i.isSymbolicLink()||!t.followSymbolicLink){Us(n,i);return}t.fs.stat(e,(s,a)=>{if(s!==null){if(t.throwErrorOnBrokenSymbolicLink){Wc(n,s);return}Us(n,i);return}t.markSymbolicLink&&(a.isSymbolicLink=()=>!0),Us(n,a)})})}oi.read=s0;function Wc(e,t){e(t)}function Us(e,t){e(null,t)}});var Yc=m(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.read=void 0;function a0(e,t){let n=t.fs.lstatSync(e);if(!n.isSymbolicLink()||!t.followSymbolicLink)return n;try{let r=t.fs.statSync(e);return t.markSymbolicLink&&(r.isSymbolicLink=()=>!0),r}catch(r){if(!t.throwErrorOnBrokenSymbolicLink)return n;throw r}}ui.read=a0});var Xc=m(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.createFileSystemAdapter=Rt.FILE_SYSTEM_ADAPTER=void 0;var li=require("fs");Rt.FILE_SYSTEM_ADAPTER={lstat:li.lstat,stat:li.stat,lstatSync:li.lstatSync,statSync:li.statSync};function o0(e){return e===void 0?Rt.FILE_SYSTEM_ADAPTER:Object.assign(Object.assign({},Rt.FILE_SYSTEM_ADAPTER),e)}Rt.createFileSystemAdapter=o0});var Qc=m(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});var u0=Xc(),js=class{constructor(t={}){this._options=t,this.followSymbolicLink=this._getValue(this._options.followSymbolicLink,!0),this.fs=u0.createFileSystemAdapter(this._options.fs),this.markSymbolicLink=this._getValue(this._options.markSymbolicLink,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!0)}_getValue(t,n){return t??n}};Ws.default=js});var Qt=m(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.statSync=kt.stat=kt.Settings=void 0;var zc=Kc(),l0=Yc(),Ks=Qc();kt.Settings=Ks.default;function c0(e,t,n){if(typeof t=="function"){zc.read(e,Ys(),t);return}zc.read(e,Ys(t),n)}kt.stat=c0;function f0(e,t){let n=Ys(t);return l0.read(e,n)}kt.statSync=f0;function Ys(e={}){return e instanceof Ks.default?e:new Ks.default(e)}});var ef=m((Vv,Jc)=>{var Zc;Jc.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:global):e=>(Zc||(Zc=Promise.resolve())).then(e).catch(t=>setTimeout(()=>{throw t},0))});var nf=m((Gv,tf)=>{tf.exports=d0;var h0=ef();function d0(e,t){let n,r,i,s=!0;Array.isArray(e)?(n=[],r=e.length):(i=Object.keys(e),n={},r=i.length);function a(u){function l(){t&&t(u,n),t=null}s?h0(l):l()}function o(u,l,f){n[u]=f,(--r===0||l)&&a(l)}r?i?i.forEach(function(u){e[u](function(l,f){o(u,l,f)})}):e.forEach(function(u,l){u(function(f,d){o(l,f,d)})}):a(null),s=!1}});var Xs=m(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.IS_SUPPORT_READDIR_WITH_FILE_TYPES=void 0;var ci=process.versions.node.split(".");if(ci[0]===void 0||ci[1]===void 0)throw new Error(`Unexpected behavior. The 'process.versions.node' variable has invalid value: ${process.versions.node}`);var rf=Number.parseInt(ci[0],10),g0=Number.parseInt(ci[1],10),sf=10,_0=10,p0=rf>sf,m0=rf===sf&&g0>=_0;fi.IS_SUPPORT_READDIR_WITH_FILE_TYPES=p0||m0});var af=m(hi=>{"use strict";Object.defineProperty(hi,"__esModule",{value:!0});hi.createDirentFromStats=void 0;var Qs=class{constructor(t,n){this.name=t,this.isBlockDevice=n.isBlockDevice.bind(n),this.isCharacterDevice=n.isCharacterDevice.bind(n),this.isDirectory=n.isDirectory.bind(n),this.isFIFO=n.isFIFO.bind(n),this.isFile=n.isFile.bind(n),this.isSocket=n.isSocket.bind(n),this.isSymbolicLink=n.isSymbolicLink.bind(n)}};function y0(e,t){return new Qs(e,t)}hi.createDirentFromStats=y0});var zs=m(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.fs=void 0;var v0=af();di.fs=v0});var Zs=m(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.joinPathSegments=void 0;function b0(e,t,n){return e.endsWith(n)?e+t:e+n+t}gi.joinPathSegments=b0});var hf=m(Ot=>{"use strict";Object.defineProperty(Ot,"__esModule",{value:!0});Ot.readdir=Ot.readdirWithFileTypes=Ot.read=void 0;var E0=Qt(),of=nf(),S0=Xs(),uf=zs(),lf=Zs();function A0(e,t,n){if(!t.stats&&S0.IS_SUPPORT_READDIR_WITH_FILE_TYPES){cf(e,t,n);return}ff(e,t,n)}Ot.read=A0;function cf(e,t,n){t.fs.readdir(e,{withFileTypes:!0},(r,i)=>{if(r!==null){_i(n,r);return}let s=i.map(o=>({dirent:o,name:o.name,path:lf.joinPathSegments(e,o.name,t.pathSegmentSeparator)}));if(!t.followSymbolicLinks){Js(n,s);return}let a=s.map(o=>w0(o,t));of(a,(o,u)=>{if(o!==null){_i(n,o);return}Js(n,u)})})}Ot.readdirWithFileTypes=cf;function w0(e,t){return n=>{if(!e.dirent.isSymbolicLink()){n(null,e);return}t.fs.stat(e.path,(r,i)=>{if(r!==null){if(t.throwErrorOnBrokenSymbolicLink){n(r);return}n(null,e);return}e.dirent=uf.fs.createDirentFromStats(e.name,i),n(null,e)})}}function ff(e,t,n){t.fs.readdir(e,(r,i)=>{if(r!==null){_i(n,r);return}let s=i.map(a=>{let o=lf.joinPathSegments(e,a,t.pathSegmentSeparator);return u=>{E0.stat(o,t.fsStatSettings,(l,f)=>{if(l!==null){u(l);return}let d={name:a,path:o,dirent:uf.fs.createDirentFromStats(a,f)};t.stats&&(d.stats=f),u(null,d)})}});of(s,(a,o)=>{if(a!==null){_i(n,a);return}Js(n,o)})})}Ot.readdir=ff;function _i(e,t){e(t)}function Js(e,t){e(null,t)}});var mf=m(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.readdir=xt.readdirWithFileTypes=xt.read=void 0;var I0=Qt(),N0=Xs(),df=zs(),gf=Zs();function P0(e,t){return!t.stats&&N0.IS_SUPPORT_READDIR_WITH_FILE_TYPES?_f(e,t):pf(e,t)}xt.read=P0;function _f(e,t){return t.fs.readdirSync(e,{withFileTypes:!0}).map(r=>{let i={dirent:r,name:r.name,path:gf.joinPathSegments(e,r.name,t.pathSegmentSeparator)};if(i.dirent.isSymbolicLink()&&t.followSymbolicLinks)try{let s=t.fs.statSync(i.path);i.dirent=df.fs.createDirentFromStats(i.name,s)}catch(s){if(t.throwErrorOnBrokenSymbolicLink)throw s}return i})}xt.readdirWithFileTypes=_f;function pf(e,t){return t.fs.readdirSync(e).map(r=>{let i=gf.joinPathSegments(e,r,t.pathSegmentSeparator),s=I0.statSync(i,t.fsStatSettings),a={name:r,path:i,dirent:df.fs.createDirentFromStats(r,s)};return t.stats&&(a.stats=s),a})}xt.readdir=pf});var yf=m(Mt=>{"use strict";Object.defineProperty(Mt,"__esModule",{value:!0});Mt.createFileSystemAdapter=Mt.FILE_SYSTEM_ADAPTER=void 0;var Rn=require("fs");Mt.FILE_SYSTEM_ADAPTER={lstat:Rn.lstat,stat:Rn.stat,lstatSync:Rn.lstatSync,statSync:Rn.statSync,readdir:Rn.readdir,readdirSync:Rn.readdirSync};function C0(e){return e===void 0?Mt.FILE_SYSTEM_ADAPTER:Object.assign(Object.assign({},Mt.FILE_SYSTEM_ADAPTER),e)}Mt.createFileSystemAdapter=C0});var vf=m(ta=>{"use strict";Object.defineProperty(ta,"__esModule",{value:!0});var T0=require("path"),R0=Qt(),k0=yf(),ea=class{constructor(t={}){this._options=t,this.followSymbolicLinks=this._getValue(this._options.followSymbolicLinks,!1),this.fs=k0.createFileSystemAdapter(this._options.fs),this.pathSegmentSeparator=this._getValue(this._options.pathSegmentSeparator,T0.sep),this.stats=this._getValue(this._options.stats,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!0),this.fsStatSettings=new R0.Settings({followSymbolicLink:this.followSymbolicLinks,fs:this.fs,throwErrorOnBrokenSymbolicLink:this.throwErrorOnBrokenSymbolicLink})}_getValue(t,n){return t??n}};ta.default=ea});var pi=m(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.Settings=Lt.scandirSync=Lt.scandir=void 0;var bf=hf(),O0=mf(),na=vf();Lt.Settings=na.default;function x0(e,t,n){if(typeof t=="function"){bf.read(e,ra(),t);return}bf.read(e,ra(t),n)}Lt.scandir=x0;function M0(e,t){let n=ra(t);return O0.read(e,n)}Lt.scandirSync=M0;function ra(e={}){return e instanceof na.default?e:new na.default(e)}});var Sf=m((zv,Ef)=>{"use strict";function L0(e){var t=new e,n=t;function r(){var s=t;return s.next?t=s.next:(t=new e,n=t),s.next=null,s}function i(s){n.next=s,n=s}return{get:r,release:i}}Ef.exports=L0});var wf=m((Zv,ia)=>{"use strict";var F0=Sf();function Af(e,t,n){if(typeof e=="function"&&(n=t,t=e,e=null),n<1)throw new Error("fastqueue concurrency must be greater than 1");var r=F0(D0),i=null,s=null,a=0,o=null,u={push:S,drain:Ve,saturated:Ve,pause:f,paused:!1,concurrency:n,running:l,resume:y,idle:p,length:d,getQueue:h,unshift:C,empty:Ve,kill:W,killAndDrain:T,error:he};return u;function l(){return a}function f(){u.paused=!0}function d(){for(var x=i,G=0;x;)x=x.next,G++;return G}function h(){for(var x=i,G=[];x;)G.push(x.value),x=x.next;return G}function y(){if(!!u.paused){u.paused=!1;for(var x=0;x<u.concurrency;x++)a++,M()}}function p(){return a===0&&u.length()===0}function S(x,G){var O=r.get();O.context=e,O.release=M,O.value=x,O.callback=G||Ve,O.errorHandler=o,a===u.concurrency||u.paused?s?(s.next=O,s=O):(i=O,s=O,u.saturated()):(a++,t.call(e,O.value,O.worked))}function C(x,G){var O=r.get();O.context=e,O.release=M,O.value=x,O.callback=G||Ve,a===u.concurrency||u.paused?i?(O.next=i,i=O):(i=O,s=O,u.saturated()):(a++,t.call(e,O.value,O.worked))}function M(x){x&&r.release(x);var G=i;G?u.paused?a--:(s===i&&(s=null),i=G.next,G.next=null,t.call(e,G.value,G.worked),s===null&&u.empty()):--a===0&&u.drain()}function W(){i=null,s=null,u.drain=Ve}function T(){i=null,s=null,u.drain(),u.drain=Ve}function he(x){o=x}}function Ve(){}function D0(){this.value=null,this.callback=Ve,this.next=null,this.release=Ve,this.context=null,this.errorHandler=null;var e=this;this.worked=function(n,r){var i=e.callback,s=e.errorHandler,a=e.value;e.value=null,e.callback=Ve,e.errorHandler&&s(n,a),i.call(e.context,n,r),e.release(e)}}function $0(e,t,n){typeof e=="function"&&(n=t,t=e,e=null);function r(f,d){t.call(this,f).then(function(h){d(null,h)},d)}var i=Af(e,r,n),s=i.push,a=i.unshift;return i.push=o,i.unshift=u,i.drained=l,i;function o(f){var d=new Promise(function(h,y){s(f,function(p,S){if(p){y(p);return}h(S)})});return d.catch(Ve),d}function u(f){var d=new Promise(function(h,y){a(f,function(p,S){if(p){y(p);return}h(S)})});return d.catch(Ve),d}function l(){var f=i.drain,d=new Promise(function(h){i.drain=function(){f(),h()}});return d}}ia.exports=Af;ia.exports.promise=$0});var mi=m(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.joinPathSegments=at.replacePathSegmentSeparator=at.isAppliedFilter=at.isFatalError=void 0;function q0(e,t){return e.errorFilter===null?!0:!e.errorFilter(t)}at.isFatalError=q0;function V0(e,t){return e===null||e(t)}at.isAppliedFilter=V0;function G0(e,t){return e.split(/[/\\]/).join(t)}at.replacePathSegmentSeparator=G0;function B0(e,t,n){return e===""?t:e.endsWith(n)?e+t:e+n+t}at.joinPathSegments=B0});var oa=m(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});var H0=mi(),sa=class{constructor(t,n){this._root=t,this._settings=n,this._root=H0.replacePathSegmentSeparator(t,n.pathSegmentSeparator)}};aa.default=sa});var ca=m(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});var U0=require("events"),j0=pi(),W0=wf(),yi=mi(),K0=oa(),ua=class extends K0.default{constructor(t,n){super(t,n),this._settings=n,this._scandir=j0.scandir,this._emitter=new U0.EventEmitter,this._queue=W0(this._worker.bind(this),this._settings.concurrency),this._isFatalError=!1,this._isDestroyed=!1,this._queue.drain=()=>{this._isFatalError||this._emitter.emit("end")}}read(){return this._isFatalError=!1,this._isDestroyed=!1,setImmediate(()=>{this._pushToQueue(this._root,this._settings.basePath)}),this._emitter}get isDestroyed(){return this._isDestroyed}destroy(){if(this._isDestroyed)throw new Error("The reader is already destroyed");this._isDestroyed=!0,this._queue.killAndDrain()}onEntry(t){this._emitter.on("entry",t)}onError(t){this._emitter.once("error",t)}onEnd(t){this._emitter.once("end",t)}_pushToQueue(t,n){let r={directory:t,base:n};this._queue.push(r,i=>{i!==null&&this._handleError(i)})}_worker(t,n){this._scandir(t.directory,this._settings.fsScandirSettings,(r,i)=>{if(r!==null){n(r,void 0);return}for(let s of i)this._handleEntry(s,t.base);n(null,void 0)})}_handleError(t){this._isDestroyed||!yi.isFatalError(this._settings,t)||(this._isFatalError=!0,this._isDestroyed=!0,this._emitter.emit("error",t))}_handleEntry(t,n){if(this._isDestroyed||this._isFatalError)return;let r=t.path;n!==void 0&&(t.path=yi.joinPathSegments(n,t.name,this._settings.pathSegmentSeparator)),yi.isAppliedFilter(this._settings.entryFilter,t)&&this._emitEntry(t),t.dirent.isDirectory()&&yi.isAppliedFilter(this._settings.deepFilter,t)&&this._pushToQueue(r,n===void 0?void 0:t.path)}_emitEntry(t){this._emitter.emit("entry",t)}};la.default=ua});var If=m(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});var Y0=ca(),fa=class{constructor(t,n){this._root=t,this._settings=n,this._reader=new Y0.default(this._root,this._settings),this._storage=[]}read(t){this._reader.onError(n=>{X0(t,n)}),this._reader.onEntry(n=>{this._storage.push(n)}),this._reader.onEnd(()=>{Q0(t,this._storage)}),this._reader.read()}};ha.default=fa;function X0(e,t){e(t)}function Q0(e,t){e(null,t)}});var Nf=m(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});var z0=require("stream"),Z0=ca(),da=class{constructor(t,n){this._root=t,this._settings=n,this._reader=new Z0.default(this._root,this._settings),this._stream=new z0.Readable({objectMode:!0,read:()=>{},destroy:()=>{this._reader.isDestroyed||this._reader.destroy()}})}read(){return this._reader.onError(t=>{this._stream.emit("error",t)}),this._reader.onEntry(t=>{this._stream.push(t)}),this._reader.onEnd(()=>{this._stream.push(null)}),this._reader.read(),this._stream}};ga.default=da});var Pf=m(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});var J0=pi(),vi=mi(),e1=oa(),_a=class extends e1.default{constructor(){super(...arguments),this._scandir=J0.scandirSync,this._storage=[],this._queue=new Set}read(){return this._pushToQueue(this._root,this._settings.basePath),this._handleQueue(),this._storage}_pushToQueue(t,n){this._queue.add({directory:t,base:n})}_handleQueue(){for(let t of this._queue.values())this._handleDirectory(t.directory,t.base)}_handleDirectory(t,n){try{let r=this._scandir(t,this._settings.fsScandirSettings);for(let i of r)this._handleEntry(i,n)}catch(r){this._handleError(r)}}_handleError(t){if(!!vi.isFatalError(this._settings,t))throw t}_handleEntry(t,n){let r=t.path;n!==void 0&&(t.path=vi.joinPathSegments(n,t.name,this._settings.pathSegmentSeparator)),vi.isAppliedFilter(this._settings.entryFilter,t)&&this._pushToStorage(t),t.dirent.isDirectory()&&vi.isAppliedFilter(this._settings.deepFilter,t)&&this._pushToQueue(r,n===void 0?void 0:t.path)}_pushToStorage(t){this._storage.push(t)}};pa.default=_a});var Cf=m(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});var t1=Pf(),ma=class{constructor(t,n){this._root=t,this._settings=n,this._reader=new t1.default(this._root,this._settings)}read(){return this._reader.read()}};ya.default=ma});var Tf=m(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});var n1=require("path"),r1=pi(),va=class{constructor(t={}){this._options=t,this.basePath=this._getValue(this._options.basePath,void 0),this.concurrency=this._getValue(this._options.concurrency,Number.POSITIVE_INFINITY),this.deepFilter=this._getValue(this._options.deepFilter,null),this.entryFilter=this._getValue(this._options.entryFilter,null),this.errorFilter=this._getValue(this._options.errorFilter,null),this.pathSegmentSeparator=this._getValue(this._options.pathSegmentSeparator,n1.sep),this.fsScandirSettings=new r1.Settings({followSymbolicLinks:this._options.followSymbolicLinks,fs:this._options.fs,pathSegmentSeparator:this._options.pathSegmentSeparator,stats:this._options.stats,throwErrorOnBrokenSymbolicLink:this._options.throwErrorOnBrokenSymbolicLink})}_getValue(t,n){return t??n}};ba.default=va});var Ei=m(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.Settings=ot.walkStream=ot.walkSync=ot.walk=void 0;var Rf=If(),i1=Nf(),s1=Cf(),Ea=Tf();ot.Settings=Ea.default;function a1(e,t,n){if(typeof t=="function"){new Rf.default(e,bi()).read(t);return}new Rf.default(e,bi(t)).read(n)}ot.walk=a1;function o1(e,t){let n=bi(t);return new s1.default(e,n).read()}ot.walkSync=o1;function u1(e,t){let n=bi(t);return new i1.default(e,n).read()}ot.walkStream=u1;function bi(e={}){return e instanceof Ea.default?e:new Ea.default(e)}});var Si=m(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});var l1=require("path"),c1=Qt(),kf=pt(),Sa=class{constructor(t){this._settings=t,this._fsStatSettings=new c1.Settings({followSymbolicLink:this._settings.followSymbolicLinks,fs:this._settings.fs,throwErrorOnBrokenSymbolicLink:this._settings.followSymbolicLinks})}_getFullEntryPath(t){return l1.resolve(this._settings.cwd,t)}_makeEntry(t,n){let r={name:n,path:n,dirent:kf.fs.createDirentFromStats(n,t)};return this._settings.stats&&(r.stats=t),r}_isFatalError(t){return!kf.errno.isEnoentCodeError(t)&&!this._settings.suppressErrors}};Aa.default=Sa});var Na=m(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});var f1=require("stream"),h1=Qt(),d1=Ei(),g1=Si(),wa=class extends g1.default{constructor(){super(...arguments),this._walkStream=d1.walkStream,this._stat=h1.stat}dynamic(t,n){return this._walkStream(t,n)}static(t,n){let r=t.map(this._getFullEntryPath,this),i=new f1.PassThrough({objectMode:!0});i._write=(s,a,o)=>this._getEntry(r[s],t[s],n).then(u=>{u!==null&&n.entryFilter(u)&&i.push(u),s===r.length-1&&i.end(),o()}).catch(o);for(let s=0;s<r.length;s++)i.write(s);return i}_getEntry(t,n,r){return this._getStat(t).then(i=>this._makeEntry(i,n)).catch(i=>{if(r.errorFilter(i))return null;throw i})}_getStat(t){return new Promise((n,r)=>{this._stat(t,this._fsStatSettings,(i,s)=>i===null?n(s):r(i))})}};Ia.default=wa});var Of=m(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});var _1=Ei(),p1=Si(),m1=Na(),Pa=class extends p1.default{constructor(){super(...arguments),this._walkAsync=_1.walk,this._readerStream=new m1.default(this._settings)}dynamic(t,n){return new Promise((r,i)=>{this._walkAsync(t,n,(s,a)=>{s===null?r(a):i(s)})})}async static(t,n){let r=[],i=this._readerStream.static(t,n);return new Promise((s,a)=>{i.once("error",a),i.on("data",o=>r.push(o)),i.once("end",()=>s(r))})}};Ca.default=Pa});var xf=m(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});var kn=pt(),Ta=class{constructor(t,n,r){this._patterns=t,this._settings=n,this._micromatchOptions=r,this._storage=[],this._fillStorage()}_fillStorage(){let t=kn.pattern.expandPatternsWithBraceExpansion(this._patterns);for(let n of t){let r=this._getPatternSegments(n),i=this._splitSegmentsIntoSections(r);this._storage.push({complete:i.length<=1,pattern:n,segments:r,sections:i})}}_getPatternSegments(t){return kn.pattern.getPatternParts(t,this._micromatchOptions).map(r=>kn.pattern.isDynamicPattern(r,this._settings)?{dynamic:!0,pattern:r,patternRe:kn.pattern.makeRe(r,this._micromatchOptions)}:{dynamic:!1,pattern:r})}_splitSegmentsIntoSections(t){return kn.array.splitWhen(t,n=>n.dynamic&&kn.pattern.hasGlobStar(n.pattern))}};Ra.default=Ta});var Mf=m(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});var y1=xf(),ka=class extends y1.default{match(t){let n=t.split("/"),r=n.length,i=this._storage.filter(s=>!s.complete||s.segments.length>r);for(let s of i){let a=s.sections[0];if(!s.complete&&r>a.length||n.every((u,l)=>{let f=s.segments[l];return!!(f.dynamic&&f.patternRe.test(u)||!f.dynamic&&f.pattern===u)}))return!0}return!1}};Oa.default=ka});var Lf=m(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});var Ai=pt(),v1=Mf(),xa=class{constructor(t,n){this._settings=t,this._micromatchOptions=n}getFilter(t,n,r){let i=this._getMatcher(n),s=this._getNegativePatternsRe(r);return a=>this._filter(t,a,i,s)}_getMatcher(t){return new v1.default(t,this._settings,this._micromatchOptions)}_getNegativePatternsRe(t){let n=t.filter(Ai.pattern.isAffectDepthOfReadingPattern);return Ai.pattern.convertPatternsToRe(n,this._micromatchOptions)}_filter(t,n,r,i){if(this._isSkippedByDeep(t,n.path)||this._isSkippedSymbolicLink(n))return!1;let s=Ai.path.removeLeadingDotSegment(n.path);return this._isSkippedByPositivePatterns(s,r)?!1:this._isSkippedByNegativePatterns(s,i)}_isSkippedByDeep(t,n){return this._settings.deep===1/0?!1:this._getEntryLevel(t,n)>=this._settings.deep}_getEntryLevel(t,n){let r=n.split("/").length;if(t==="")return r;let i=t.split("/").length;return r-i}_isSkippedSymbolicLink(t){return!this._settings.followSymbolicLinks&&t.dirent.isSymbolicLink()}_isSkippedByPositivePatterns(t,n){return!this._settings.baseNameMatch&&!n.match(t)}_isSkippedByNegativePatterns(t,n){return!Ai.pattern.matchAny(t,n)}};Ma.default=xa});var Ff=m(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});var zt=pt(),La=class{constructor(t,n){this._settings=t,this._micromatchOptions=n,this.index=new Map}getFilter(t,n){let r=zt.pattern.convertPatternsToRe(t,this._micromatchOptions),i=zt.pattern.convertPatternsToRe(n,this._micromatchOptions);return s=>this._filter(s,r,i)}_filter(t,n,r){if(this._settings.unique&&this._isDuplicateEntry(t)||this._onlyFileFilter(t)||this._onlyDirectoryFilter(t)||this._isSkippedByAbsoluteNegativePatterns(t.path,r))return!1;let i=this._settings.baseNameMatch?t.name:t.path,s=t.dirent.isDirectory(),a=this._isMatchToPatterns(i,n,s)&&!this._isMatchToPatterns(t.path,r,s);return this._settings.unique&&a&&this._createIndexRecord(t),a}_isDuplicateEntry(t){return this.index.has(t.path)}_createIndexRecord(t){this.index.set(t.path,void 0)}_onlyFileFilter(t){return this._settings.onlyFiles&&!t.dirent.isFile()}_onlyDirectoryFilter(t){return this._settings.onlyDirectories&&!t.dirent.isDirectory()}_isSkippedByAbsoluteNegativePatterns(t,n){if(!this._settings.absolute)return!1;let r=zt.path.makeAbsolute(this._settings.cwd,t);return zt.pattern.matchAny(r,n)}_isMatchToPatterns(t,n,r){let i=zt.path.removeLeadingDotSegment(t),s=zt.pattern.matchAny(i,n);return!s&&r?zt.pattern.matchAny(i+"/",n):s}};Fa.default=La});var Df=m($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});var b1=pt(),Da=class{constructor(t){this._settings=t}getFilter(){return t=>this._isNonFatalError(t)}_isNonFatalError(t){return b1.errno.isEnoentCodeError(t)||this._settings.suppressErrors}};$a.default=Da});var qf=m(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});var $f=pt(),qa=class{constructor(t){this._settings=t}getTransformer(){return t=>this._transform(t)}_transform(t){let n=t.path;return this._settings.absolute&&(n=$f.path.makeAbsolute(this._settings.cwd,n),n=$f.path.unixify(n)),this._settings.markDirectories&&t.dirent.isDirectory()&&(n+="/"),this._settings.objectMode?Object.assign(Object.assign({},t),{path:n}):n}};Va.default=qa});var wi=m(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});var E1=require("path"),S1=Lf(),A1=Ff(),w1=Df(),I1=qf(),Ga=class{constructor(t){this._settings=t,this.errorFilter=new w1.default(this._settings),this.entryFilter=new A1.default(this._settings,this._getMicromatchOptions()),this.deepFilter=new S1.default(this._settings,this._getMicromatchOptions()),this.entryTransformer=new I1.default(this._settings)}_getRootDirectory(t){return E1.resolve(this._settings.cwd,t.base)}_getReaderOptions(t){let n=t.base==="."?"":t.base;return{basePath:n,pathSegmentSeparator:"/",concurrency:this._settings.concurrency,deepFilter:this.deepFilter.getFilter(n,t.positive,t.negative),entryFilter:this.entryFilter.getFilter(t.positive,t.negative),errorFilter:this.errorFilter.getFilter(),followSymbolicLinks:this._settings.followSymbolicLinks,fs:this._settings.fs,stats:this._settings.stats,throwErrorOnBrokenSymbolicLink:this._settings.throwErrorOnBrokenSymbolicLink,transform:this.entryTransformer.getTransformer()}}_getMicromatchOptions(){return{dot:this._settings.dot,matchBase:this._settings.baseNameMatch,nobrace:!this._settings.braceExpansion,nocase:!this._settings.caseSensitiveMatch,noext:!this._settings.extglob,noglobstar:!this._settings.globstar,posix:!0,strictSlashes:!1}}};Ba.default=Ga});var Vf=m(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});var N1=Of(),P1=wi(),Ha=class extends P1.default{constructor(){super(...arguments),this._reader=new N1.default(this._settings)}async read(t){let n=this._getRootDirectory(t),r=this._getReaderOptions(t);return(await this.api(n,t,r)).map(s=>r.transform(s))}api(t,n,r){return n.dynamic?this._reader.dynamic(t,r):this._reader.static(n.patterns,r)}};Ua.default=Ha});var Gf=m(Wa=>{"use strict";Object.defineProperty(Wa,"__esModule",{value:!0});var C1=require("stream"),T1=Na(),R1=wi(),ja=class extends R1.default{constructor(){super(...arguments),this._reader=new T1.default(this._settings)}read(t){let n=this._getRootDirectory(t),r=this._getReaderOptions(t),i=this.api(n,t,r),s=new C1.Readable({objectMode:!0,read:()=>{}});return i.once("error",a=>s.emit("error",a)).on("data",a=>s.emit("data",r.transform(a))).once("end",()=>s.emit("end")),s.once("close",()=>i.destroy()),s}api(t,n,r){return n.dynamic?this._reader.dynamic(t,r):this._reader.static(n.patterns,r)}};Wa.default=ja});var Bf=m(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});var k1=Qt(),O1=Ei(),x1=Si(),Ka=class extends x1.default{constructor(){super(...arguments),this._walkSync=O1.walkSync,this._statSync=k1.statSync}dynamic(t,n){return this._walkSync(t,n)}static(t,n){let r=[];for(let i of t){let s=this._getFullEntryPath(i),a=this._getEntry(s,i,n);a===null||!n.entryFilter(a)||r.push(a)}return r}_getEntry(t,n,r){try{let i=this._getStat(t);return this._makeEntry(i,n)}catch(i){if(r.errorFilter(i))return null;throw i}}_getStat(t){return this._statSync(t,this._fsStatSettings)}};Ya.default=Ka});var Hf=m(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});var M1=Bf(),L1=wi(),Xa=class extends L1.default{constructor(){super(...arguments),this._reader=new M1.default(this._settings)}read(t){let n=this._getRootDirectory(t),r=this._getReaderOptions(t);return this.api(n,t,r).map(r.transform)}api(t,n,r){return n.dynamic?this._reader.dynamic(t,r):this._reader.static(n.patterns,r)}};Qa.default=Xa});var Uf=m(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.DEFAULT_FILE_SYSTEM_ADAPTER=void 0;var On=require("fs"),F1=require("os"),D1=Math.max(F1.cpus().length,1);xn.DEFAULT_FILE_SYSTEM_ADAPTER={lstat:On.lstat,lstatSync:On.lstatSync,stat:On.stat,statSync:On.statSync,readdir:On.readdir,readdirSync:On.readdirSync};var za=class{constructor(t={}){this._options=t,this.absolute=this._getValue(this._options.absolute,!1),this.baseNameMatch=this._getValue(this._options.baseNameMatch,!1),this.braceExpansion=this._getValue(this._options.braceExpansion,!0),this.caseSensitiveMatch=this._getValue(this._options.caseSensitiveMatch,!0),this.concurrency=this._getValue(this._options.concurrency,D1),this.cwd=this._getValue(this._options.cwd,process.cwd()),this.deep=this._getValue(this._options.deep,1/0),this.dot=this._getValue(this._options.dot,!1),this.extglob=this._getValue(this._options.extglob,!0),this.followSymbolicLinks=this._getValue(this._options.followSymbolicLinks,!0),this.fs=this._getFileSystemMethods(this._options.fs),this.globstar=this._getValue(this._options.globstar,!0),this.ignore=this._getValue(this._options.ignore,[]),this.markDirectories=this._getValue(this._options.markDirectories,!1),this.objectMode=this._getValue(this._options.objectMode,!1),this.onlyDirectories=this._getValue(this._options.onlyDirectories,!1),this.onlyFiles=this._getValue(this._options.onlyFiles,!0),this.stats=this._getValue(this._options.stats,!1),this.suppressErrors=this._getValue(this._options.suppressErrors,!1),this.throwErrorOnBrokenSymbolicLink=this._getValue(this._options.throwErrorOnBrokenSymbolicLink,!1),this.unique=this._getValue(this._options.unique,!0),this.onlyDirectories&&(this.onlyFiles=!1),this.stats&&(this.objectMode=!0)}_getValue(t,n){return t===void 0?n:t}_getFileSystemMethods(t={}){return Object.assign(Object.assign({},xn.DEFAULT_FILE_SYSTEM_ADAPTER),t)}};xn.default=za});var to=m((Ab,Kf)=>{"use strict";var jf=Hc(),Wf=jc(),$1=Vf(),q1=Gf(),V1=Hf(),Za=Uf(),Zt=pt();async function Ja(e,t){Mn(e);let n=eo(e,$1.default,t),r=await Promise.all(n);return Zt.array.flatten(r)}(function(e){function t(a,o){Mn(a);let u=eo(a,V1.default,o);return Zt.array.flatten(u)}e.sync=t;function n(a,o){Mn(a);let u=eo(a,q1.default,o);return Zt.stream.merge(u)}e.stream=n;function r(a,o){Mn(a);let u=Wf.transform([].concat(a)),l=new Za.default(o);return jf.generate(u,l)}e.generateTasks=r;function i(a,o){Mn(a);let u=new Za.default(o);return Zt.pattern.isDynamicPattern(a,u)}e.isDynamicPattern=i;function s(a){return Mn(a),Zt.path.escape(a)}e.escapePath=s})(Ja||(Ja={}));function eo(e,t,n){let r=Wf.transform([].concat(e)),i=new Za.default(n),s=jf.generate(r,i),a=new t(i);return s.map(a.read,a)}function Mn(e){if(![].concat(e).every(r=>Zt.string.isString(r)&&!Zt.string.isEmpty(r)))throw new TypeError("Patterns must be a string (non empty) or an array of strings")}Kf.exports=Ja});var Xf=m(Jt=>{"use strict";var{promisify:G1}=require("util"),Yf=require("fs");async function no(e,t,n){if(typeof n!="string")throw new TypeError(`Expected a string, got ${typeof n}`);try{return(await G1(Yf[e])(n))[t]()}catch(r){if(r.code==="ENOENT")return!1;throw r}}function ro(e,t,n){if(typeof n!="string")throw new TypeError(`Expected a string, got ${typeof n}`);try{return Yf[e](n)[t]()}catch(r){if(r.code==="ENOENT")return!1;throw r}}Jt.isFile=no.bind(null,"stat","isFile");Jt.isDirectory=no.bind(null,"stat","isDirectory");Jt.isSymlink=no.bind(null,"lstat","isSymbolicLink");Jt.isFileSync=ro.bind(null,"statSync","isFile");Jt.isDirectorySync=ro.bind(null,"statSync","isDirectory");Jt.isSymlinkSync=ro.bind(null,"lstatSync","isSymbolicLink")});var eh=m((Ib,io)=>{"use strict";var en=require("path"),Qf=Xf(),zf=e=>e.length>1?`{${e.join(",")}}`:e[0],Zf=(e,t)=>{let n=e[0]==="!"?e.slice(1):e;return en.isAbsolute(n)?n:en.join(t,n)},B1=(e,t)=>en.extname(e)?`**/${e}`:`**/${e}.${zf(t)}`,Jf=(e,t)=>{if(t.files&&!Array.isArray(t.files))throw new TypeError(`Expected \`files\` to be of type \`Array\` but received type \`${typeof t.files}\``);if(t.extensions&&!Array.isArray(t.extensions))throw new TypeError(`Expected \`extensions\` to be of type \`Array\` but received type \`${typeof t.extensions}\``);return t.files&&t.extensions?t.files.map(n=>en.posix.join(e,B1(n,t.extensions))):t.files?t.files.map(n=>en.posix.join(e,`**/${n}`)):t.extensions?[en.posix.join(e,`**/*.${zf(t.extensions)}`)]:[en.posix.join(e,"**")]};io.exports=async(e,t)=>{if(t={cwd:process.cwd(),...t},typeof t.cwd!="string")throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof t.cwd}\``);let n=await Promise.all([].concat(e).map(async r=>await Qf.isDirectory(Zf(r,t.cwd))?Jf(r,t):r));return[].concat.apply([],n)};io.exports.sync=(e,t)=>{if(t={cwd:process.cwd(),...t},typeof t.cwd!="string")throw new TypeError(`Expected \`cwd\` to be of type \`string\` but received type \`${typeof t.cwd}\``);let n=[].concat(e).map(r=>Qf.isDirectorySync(Zf(r,t.cwd))?Jf(r,t):r);return[].concat.apply([],n)}});var lh=m((Nb,uh)=>{function th(e){return Array.isArray(e)?e:[e]}var sh="",nh=" ",so="\\",H1=/^\s+$/,U1=/^\\!/,j1=/^\\#/,W1=/\r?\n/g,K1=/^\.*\/|^\.+$/,ao="/",rh=typeof Symbol<"u"?Symbol.for("node-ignore"):"node-ignore",Y1=(e,t,n)=>Object.defineProperty(e,t,{value:n}),X1=/([0-z])-([0-z])/g,ah=()=>!1,Q1=e=>e.replace(X1,(t,n,r)=>n.charCodeAt(0)<=r.charCodeAt(0)?t:sh),z1=e=>{let{length:t}=e;return e.slice(0,t-t%2)},Z1=[[/\\?\s+$/,e=>e.indexOf("\\")===0?nh:sh],[/\\\s/g,()=>nh],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,n)=>t+6<n.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)\\\*(?=.+)/g,(e,t)=>`${t}[^\\/]*`],[/\\\\\\(?=[$.|*+(){^])/g,()=>so],[/\\\\/g,()=>so],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,n,r,i)=>t===so?`\\[${n}${z1(r)}${i}`:i==="]"&&r.length%2===0?`[${Q1(n)}${r}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(e,t)=>`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`]],ih=Object.create(null),J1=(e,t)=>{let n=ih[e];return n||(n=Z1.reduce((r,i)=>r.replace(i[0],i[1].bind(e)),e),ih[e]=n),t?new RegExp(n,"i"):new RegExp(n)},lo=e=>typeof e=="string",ey=e=>e&&lo(e)&&!H1.test(e)&&e.indexOf("#")!==0,ty=e=>e.split(W1),oo=class{constructor(t,n,r,i){this.origin=t,this.pattern=n,this.negative=r,this.regex=i}},ny=(e,t)=>{let n=e,r=!1;e.indexOf("!")===0&&(r=!0,e=e.substr(1)),e=e.replace(U1,"!").replace(j1,"#");let i=J1(e,t);return new oo(n,e,r,i)},ry=(e,t)=>{throw new t(e)},yt=(e,t,n)=>lo(e)?e?yt.isNotRelative(e)?n(`path should be a \`path.relative()\`d string, but got "${t}"`,RangeError):!0:n("path must not be empty",TypeError):n(`path must be a string, but got \`${t}\``,TypeError),oh=e=>K1.test(e);yt.isNotRelative=oh;yt.convert=e=>e;var uo=class{constructor({ignorecase:t=!0,ignoreCase:n=t,allowRelativePaths:r=!1}={}){Y1(this,rh,!0),this._rules=[],this._ignoreCase=n,this._allowRelativePaths=r,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(t){if(t&&t[rh]){this._rules=this._rules.concat(t._rules),this._added=!0;return}if(ey(t)){let n=ny(t,this._ignoreCase);this._added=!0,this._rules.push(n)}}add(t){return this._added=!1,th(lo(t)?ty(t):t).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(t){return this.add(t)}_testOne(t,n){let r=!1,i=!1;return this._rules.forEach(s=>{let{negative:a}=s;if(i===a&&r!==i||a&&!r&&!i&&!n)return;s.regex.test(t)&&(r=!a,i=a)}),{ignored:r,unignored:i}}_test(t,n,r,i){let s=t&&yt.convert(t);return yt(s,t,this._allowRelativePaths?ah:ry),this._t(s,n,r,i)}_t(t,n,r,i){if(t in n)return n[t];if(i||(i=t.split(ao)),i.pop(),!i.length)return n[t]=this._testOne(t,r);let s=this._t(i.join(ao)+ao,n,r,i);return n[t]=s.ignored?s:this._testOne(t,r)}ignores(t){return this._test(t,this._ignoreCache,!1).ignored}createFilter(){return t=>!this.ignores(t)}filter(t){return th(t).filter(this.createFilter())}test(t){return this._test(t,this._testCache,!0)}},Ii=e=>new uo(e),iy=e=>yt(e&&yt.convert(e),e,ah);Ii.isPathValid=iy;Ii.default=Ii;uh.exports=Ii;if(typeof process<"u"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let e=n=>/^\\\\\?\\/.test(n)||/["<>|\u0000-\u001F]+/u.test(n)?n:n.replace(/\\/g,"/");yt.convert=e;let t=/^[a-z]:\//i;yt.isNotRelative=n=>t.test(n)||oh(n)}});function Ln(e){let t=/^\\\\\?\\/.test(e),n=/[^\u0000-\u0080]+/.test(e);return t||n?e:e.replace(/\\/g,"/")}var ch=cr(()=>{});var fh,hh,ir,Ni,Pi,co=cr(()=>{fh=require("url"),hh=require("stream"),ir=e=>e instanceof URL?(0,fh.fileURLToPath)(e):e,Ni=class extends hh.Transform{constructor(t){super({objectMode:!0,transform(n,r,i){i(void 0,t(n)?n:void 0)}})}},Pi=e=>e[0]==="!"});var dh,fo,tn,ho,gh,_h,Ci,sy,ay,oy,ph,mh,go,_o,yh,vh,po=cr(()=>{dh=ue(require("process"),1),fo=ue(require("fs"),1),tn=ue(require("path"),1),ho=ue(to(),1),gh=ue(lh(),1);ch();co();_h={ignore:["**/node_modules","**/flow-typed","**/coverage","**/.git"],absolute:!0,dot:!0},Ci="**/.gitignore",sy=(e,t)=>Pi(e)?"!"+tn.default.posix.join(t,e.slice(1)):tn.default.posix.join(t,e),ay=(e,t)=>{let n=Ln(tn.default.relative(t,tn.default.dirname(e.filePath)));return e.content.split(/\r?\n/).filter(r=>r&&!r.startsWith("#")).map(r=>sy(r,n))},oy=(e,t)=>{if(t=Ln(t),tn.default.isAbsolute(e)){if(Ln(e).startsWith(t))return tn.default.relative(t,e);throw new Error(`Path ${e} is not in cwd ${t}`)}return e},ph=(e,t)=>{let n=e.flatMap(i=>ay(i,t)),r=(0,gh.default)().add(n);return i=>(i=ir(i),i=oy(i,t),r.ignores(Ln(i)))},mh=(e={})=>({cwd:ir(e.cwd)||dh.default.cwd()}),go=async(e,t)=>{let{cwd:n}=mh(t),r=await(0,ho.default)(e,{cwd:n,..._h}),i=await Promise.all(r.map(async s=>({filePath:s,content:await fo.default.promises.readFile(s,"utf8")})));return ph(i,n)},_o=(e,t)=>{let{cwd:n}=mh(t),i=ho.default.sync(e,{cwd:n,..._h}).map(s=>({filePath:s,content:fo.default.readFileSync(s,"utf8")}));return ph(i,n)},yh=e=>go(Ci,e),vh=e=>_o(Ci,e)});var Oh={};Gh(Oh,{generateGlobTasks:()=>py,generateGlobTasksSync:()=>my,globby:()=>hy,globbyStream:()=>gy,globbySync:()=>dy,isDynamicPattern:()=>_y,isGitIgnored:()=>yh,isGitIgnoredSync:()=>vh});var bh,Eh,Sh,ar,sr,uy,mo,ly,Ah,wh,Ti,Ih,cy,Nh,Ph,Ch,fy,Th,Rh,kh,yo,hy,dy,gy,_y,py,my,xh=cr(()=>{bh=ue(require("fs"),1),Eh=ue(require("path"),1),Sh=ue(vs(),1),ar=ue(to(),1),sr=ue(eh(),1);po();co();po();uy=e=>{if(e.some(t=>typeof t!="string"))throw new TypeError("Patterns must be a string or an array of strings")},mo=e=>(e=[...new Set([e].flat())],uy(e),e),ly=e=>{if(!e.cwd)return;let t;try{t=bh.default.statSync(e.cwd)}catch{return}if(!t.isDirectory())throw new Error("The `cwd` option must be a path to a directory")},Ah=(e={})=>(e={ignore:[],expandDirectories:!0,...e,cwd:ir(e.cwd)},ly(e),e),wh=e=>async(t,n)=>e(mo(t),Ah(n)),Ti=e=>(t,n)=>e(mo(t),Ah(n)),Ih=e=>{let{ignoreFiles:t,gitignore:n}=e,r=t?mo(t):[];return n&&r.push(Ci),r},cy=async e=>{let t=Ih(e);return Ph(t.length>0&&await go(t,{cwd:e.cwd}))},Nh=e=>{let t=Ih(e);return Ph(t.length>0&&_o(t,{cwd:e.cwd}))},Ph=e=>{let t=new Set;return n=>{let r=n.path||n,i=Eh.default.normalize(r),s=t.has(i)||e&&e(r);return t.add(i),!s}},Ch=(e,t)=>e.flat().filter(n=>t(n)),fy=(e,t)=>(0,Sh.default)(e).pipe(new Ni(n=>t(n))),Th=(e,t)=>{let n=[];for(;e.length>0;){let r=e.findIndex(s=>Pi(s));if(r===-1){n.push({patterns:e,options:t});break}let i=e[r].slice(1);for(let s of n)s.options.ignore.push(i);r!==0&&n.push({patterns:e.slice(0,r),options:{...t,ignore:[...t.ignore,i]}}),e=e.slice(r+1)}return n},Rh=(e,t)=>({...t?{cwd:t}:{},...Array.isArray(e)?{files:e}:e}),kh=async(e,t)=>{let n=Th(e,t),{cwd:r,expandDirectories:i}=t;if(!i)return n;let s=Rh(i,r),a=r?{cwd:r}:void 0;return Promise.all(n.map(async o=>{let{patterns:u,options:l}=o;return[u,l.ignore]=await Promise.all([(0,sr.default)(u,s),(0,sr.default)(l.ignore,a)]),{patterns:u,options:l}}))},yo=(e,t)=>{let n=Th(e,t),{cwd:r,expandDirectories:i}=t;if(!i)return n;let s=Rh(i,r),a=r?{cwd:r}:void 0;return n.map(o=>{let{patterns:u,options:l}=o;return u=sr.default.sync(u,s),l.ignore=sr.default.sync(l.ignore,a),{patterns:u,options:l}})},hy=wh(async(e,t)=>{let[n,r]=await Promise.all([kh(e,t),cy(t)]),i=await Promise.all(n.map(s=>(0,ar.default)(s.patterns,s.options)));return Ch(i,r)}),dy=Ti((e,t)=>{let n=yo(e,t),r=Nh(t),i=n.map(s=>ar.default.sync(s.patterns,s.options));return Ch(i,r)}),gy=Ti((e,t)=>{let n=yo(e,t),r=Nh(t),i=n.map(s=>ar.default.stream(s.patterns,s.options));return fy(i,r)}),_y=Ti((e,t)=>e.some(n=>ar.default.isDynamicPattern(n,t))),py=wh(kh),my=Ti(yo)});var or=ue(require("fs")),Mh=ue(require("path")),ut=ue(sn());var qt=ue(sn());var vr=ue(require("fs")),Do=require("readline"),$o=require("child_process"),$t=ue(sn());var Vn=e=>{$t.error("uci",e),process.exit(1)},mr=class{constructor(t,n){N(this,"instance");N(this,"callback");N(this,"options");if(this.options=t.options,this.callback=n,vr.existsSync(this.options.engine)||Vn(`engine not found: ${this.options.engine}`),vr.statSync(this.options.engine).isFile()||Vn(`engine not valid: ${this.options.engine}`),this.instance=(0,$o.spawn)(this.options.engine),!this.instance.stdout||!this.instance.stderr)return;(0,Do.createInterface)({input:this.instance.stdout}).on("line",i=>{this.options.debug&&$t.debug("uci receive:",i),this.callback(i,t)})}async init(){this.send("isready")}send(t){this.options.debug&&$t.debug("uci send:",t),this.instance?.stdin?.writable&&!this.instance.exitCode&&this.instance?.stdin?.write(`${t}
`)}exit(){!this.instance||this.instance.exitCode||(this.send("stop"),this.send("quit"),setTimeout(()=>this.instance.kill("SIGTERM"),10),setTimeout(()=>this.instance.kill("SIGKILL"),100))}},yr=class{constructor(t,n){N(this,"instance");N(this,"callback");N(this,"options");N(this,"parent");this.options=t.options,this.callback=n,this.parent=t}async init(){let t=await import(this.options.engine);global.fetch&&delete global.fetch,this.instance=await t.default(),this.instance.addMessageListener(n=>{this.options.debug&&$t.debug("uci receive:",n),this.callback(n,this.parent)}),this.instance.postMessage("isready")}send(t){this.options.debug&&$t.debug("uci send:",t),this.instance&&this.instance.postMessage(t)}exit(){!this.instance||(this.send("stop"),this.send("quit"))}};var an=class{constructor(t,n,r){N(this,"score");N(this,"moves");N(this,"type");this.score=t,(n==="syzygy"||n==="mate")&&(this.score=100-this.score),this.moves=r,this.type=n}toString(){switch(this.type){case"cp":return this.score;case"syzygy":return`solved score ${this.moves}`;case"mate":return`mate in ${this.moves}`;case"lowerbound":return`>= ${this.score}`;case"upperbound":return`<= ${this.score}`;default:return""}}},br=class{constructor(t){N(this,"instance");N(this,"timeout");N(this,"startTime",process.hrtime.bigint());N(this,"noMoves",!1);N(this,"lines",new Map);N(this,"depth",0);N(this,"turn");N(this,"engineOptions",[]);N(this,"duration",0);N(this,"lastFen","");N(this,"lastReady",0n);N(this,"syzygy",{wdl:void 0,dtz:void 0});N(this,"name");N(this,"info",[]);N(this,"options",{lines:1,depth:10,maxTime:0,engine:"",nnue:"",syzygy:"",debug:!1,verbose:!0,maxScore:10,options:[],type:"process"});N(this,"state");this.state="starting",this.options.debug=t?.debug||!1,this.options.depth=t?.depth||10,this.options.engine=t?.engine||"",this.options.lines=t?.lines||1,this.options.maxTime=t?.maxTime||0,this.options.nnue=t?.nnue||"",this.options.options=t?.options||[],this.options.syzygy=t?.syzygy||"",this.options.type=t?.type||"process",this.options.verbose=t?.verbose||!1,this.instance=this.options.type==="process"?new mr(this,this.processLine):new yr(this,this.processLine)}async init(){await this.instance.init(),this.instance.send("compiler"),this.instance.send("uci"),this.instance.send("setoption name UCI_AnalyseMode value true"),this.instance.send("setoption name Ponder value false"),this.options.nnue.length>0?(this.instance.send(`setoption name EvalFile value ${this.options.nnue}`),this.instance.send("setoption name Use NNUE value true")):this.instance.send("setoption name Use NNUE value false"),this.options.syzygy.length>0&&this.instance.send(`setoption name SyzygyPath value ${this.options.syzygy}`),this.options.lines>1&&this.instance.send(`setoption name MultiPV value ${this.options.lines}`);for(let t of this.options.options)this.instance.send(`setoption name ${t}`);this.instance.send("go depth 1"),this.instance.send("stop"),this.reset(),await this.ready()}async reset(){this.startTime=process.hrtime.bigint(),this.duration=0,this.lines=new Map,this.depth=0,this.noMoves=!1,this.state="busy",this.instance.send("stop"),this.instance.send("ucinewgame"),this.instance.send("position startpos"),this.instance.send("isready"),await this.ready()}async ready(){return new Promise(t=>{let n=setInterval(()=>{this.state==="ready"&&this.name&&(this.lastReady=process.hrtime.bigint(),clearInterval(n),t(!0)),this.lastReady>0n&&Number(process.hrtime.bigint()-this.lastReady)/1e3/1e3>2*this.options.maxTime&&(this.options.debug&&qt.warn("uci ready timeout:",Number(process.hrtime.bigint()-this.lastReady)/1e3/1e3),this.instance.send("stop"),this.instance.send("isready")),this.lastReady>0n&&Number(process.hrtime.bigint()-this.lastReady)/1e3/1e3>1e4&&(this.options.debug&&qt.warn("uci ready abort:",Number(process.hrtime.bigint()-this.lastReady)/1e3/1e3),Vn("engine process unresponsive"))},1)})}set fen(t){this.lastFen=t,this.noMoves=!1,this.instance.send(`position fen ${t}`),this.turn=t.split(" ")[1]==="b"?"black":"white"}get fen(){return this.lastFen}get validOptions(){return this.engineOptions}set move(t){this.instance.send(`position startpos moves ${t}`),this.turn=t.split(" ").length%2?"black":"white"}async stop(){this.instance.send("stop"),this.state="stopping",await this.ready()}async play(t){return this.fen=t,this.state="busy",this.startTime=process.hrtime.bigint(),this.lines=new Map,this.depth=0,this.timeout&&clearTimeout(this.timeout),this.options.maxTime&&this.options.maxTime>0&&(this.timeout=setTimeout(()=>this.instance.send("stop"),this.options.maxTime)),this.options.depth>0?this.instance.send(`go depth ${this.options.depth}`):this.instance.send("go infinite"),await this.ready(),this.analysis}async solve(){this.state="busy",this.instance.send("d"),this.instance.send("isready"),await this.ready();let t=this.syzygy.wdl?{wdl:this.syzygy.wdl||""}:void 0;return this.syzygy.dtz&&t&&(t.dtz=this.syzygy.dtz),t}get analysis(){if(this.noMoves)return{depth:0,time:0,lines:[{score:{type:"mate",score:0,moves:0},nodes:0,tb:-1,depth:0,moves:[]}]};let t=[];for(let n=this.depth;n>=this.depth-1;n--){let r=(this.lines.get(n)||[]).filter(i=>i);for(let i=0;i<r.length;i++)t.findIndex(s=>s.moves[0]===r[i].moves[0])===-1&&t.push(r[i])}return t.length>this.options.lines&&(t.length=this.options.lines),t.length>this.depth/2&&(t.length=Math.trunc(this.depth/2)),{depth:this.depth,time:this.duration,lines:t}}terminate(){this.instance&&this.instance.exit()}processSolve(t){let n=t.split(" ").map(u=>u.trim()).filter(u=>u),r=u=>n.findIndex(l=>l===u)+1,i=u=>r(u)>0?n[r(u)]:void 0,s=u=>Number(i(u)),a=i("WDL:"),o=s("DTZ:");this.options.debug&&qt.debug("uci solve:",{wdl:a,dtz:o}),a&&(this.syzygy.wdl=a),o&&(this.syzygy.dtz=o)}processInfo(t){let n=t.replace("info string ","").replace("Compiled by","").trim();n.startsWith("time")||(this.info.includes(n)||this.info.push(n),this.options.debug&&qt.debug("uci info:",{info:n}))}processData(t){if(t.includes("mate 0")&&(this.noMoves=!0),t.includes("currmove")||t.indexOf(" score ")===-1||t.indexOf(" depth ")===-1||this.noMoves)return;let n=t.split(" ").map(C=>C.trim()),r=C=>n.findIndex(M=>M===C)+1,i=C=>n[r(C)],s=C=>Number(i(C)),a=s("depth")||0,o=s("multipv")||1,u=s("tbhits")||0,l=s("nodes")||0,f=i("score"),d=Number(n[r("score")+1])||0,h;switch(f){case"cp":h=new an(d/100,"cp",0);break;case"lowerbound":h=new an(d/100,"lowerbound",0);break;case"upperbound":h=new an(d/100,"upperbound",0);break;case"mate":h=new an(d,"mate",d);break;default:Vn(`engine parse error: ${t}`)}if(!h)return;this.turn==="black"&&(h.score*=-1);let y=n.slice(r("pv")),p={score:h,moves:y,depth:a,nodes:l,tb:u},S=this.lines.get(a)||new Array(this.options.lines);S[o-1]=p,this.lines.set(a,S),a>this.depth&&(this.depth=a),this.options.debug&&qt.debug("uci parse:",{depth:a,score:S[0].score,move:S[0].moves[0],nodes:S[0].nodes,tb:S[0].tb})}processLine(t,n){n||(n=this),t.startsWith("id name")&&(n.name=t.replace("id name ","")),t.startsWith("option")&&n.engineOptions.push(t.replace("option name ","")),t.startsWith("uciok")&&(n.state="started"),t.startsWith("Tablebases")&&n.processSolve(t),(t.startsWith("info string")||t.startsWith("Compiled"))&&n.processInfo(t),t.startsWith("info depth")&&n.processData(t),(t.startsWith("readyok")||t.startsWith("bestmove")||t.startsWith("error"))&&(n.duration=Number((process.hrtime.bigint()-n.startTime)/1000n/1000n),n.lastReady=process.hrtime.bigint(),n.state="ready")}};var Tt=ue(sn()),Qr=ue(nl());var Yr=ue(require("fs")),il=ue(sn()),Ct=[],rl=(e,t)=>{if(t.length<e.length)return!1;let n=!0;for(let r=0;r<e.length;r++)if(e[r]!==t[r]){n=!1;break}return n},L_=(e="src/openings.json")=>{if(!Yr.existsSync(e)){il.warn("openings file cannot be located:",e);return}let t=Yr.readFileSync(e,"utf8");Ct=JSON.parse(t),Ct.forEach(n=>n.uciMoves=n.uci?.split(" ")||[]),Ct.forEach(n=>n.agMoves=n.pgn?.replace(/[0-9]?[0-9]\. /g,"").split(" ")||[]),Ct.forEach(n=>n.depth=n.uciMoves?.length||0)},sl=e=>{let t=e[0].length===4&&e[0][1].match(/[0-9]/)&&e[0][3].match(/[0-9]/);Ct.length===0&&L_();let n=t?Ct.find(r=>r.uciMoves?.length===e.length&&rl(e,r.uciMoves)):Ct.find(r=>r.agMoves?.length===e.length&&rl(e,r.agMoves));if(n)return n},al=e=>{let t=e.split(" ")[0],n=Ct.find(r=>r.epd?.startsWith(t));if(n)return n};var F_=["a1","b1","c1","d1","e1","f1","g1","h1","a2","b2","c2","d2","e2","f2","g2","h2","a3","b3","c3","d3","e3","f3","g3","h3","a4","b4","c4","d4","e4","f4","g4","h4","a5","b5","c5","d5","e5","f5","g5","h5","a6","b6","c6","d6","e6","f6","g6","h6","a7","b7","c7","d7","e7","f7","g7","h7","a8","b8","c8","d8","e8","f8","g8","h8"],Xr=class{constructor(t){N(this,"turn");N(this,"ag");N(this,"move");N(this,"options",{});N(this,"score",0);N(this,"cpl",0);N(this,"color");N(this,"fen");N(this,"flags");N(this,"opening");N(this,"position");N(this,"repeat");N(this,"pieces");N(this,"check");N(this,"capture");N(this,"checkmate");N(this,"insufficient");N(this,"solved");N(this,"stalemate");N(this,"castle");N(this,"promotion");this.turn=t?t?.fullMoveNumber():-1,this.ag=t?.notation()||"",this.move=t?._data.moveDescriptor.from()?`${t?._data.moveDescriptor.from()}${t?._data.moveDescriptor.to()}`:void 0,this.color=t?.moveColor()||"w",this.fen=t?.position().fen()||""}},ys=class{constructor(t){N(this,"file");N(this,"game");N(this,"totalGames");N(this,"moves");N(this,"decidedMove",0);N(this,"date");N(this,"analyzed");N(this,"players");N(this,"result");N(this,"line");N(this,"pgn",[]);N(this,"engine");N(this,"acpl",{white:{},black:{}});N(this,"overview",{white:{},black:{}});N(this,"opening");N(this,"position");this.analyzed=new Date,this.file=t?.file,this.game=t?.game||0,this.totalGames=0,this.moves=t?.moves||0,this.date=t?.date,this.players=t?.players||["",""],this.line=t?.line||[],t?.pgn&&(this.pgn=t.pgn),t?.engine&&(this.engine=t.engine)}},An=(e,t,n)=>{let r=t&&t>0?e.line.findIndex(a=>a.score>=t):e.line.length-1,i=e.line.slice(0,r).filter(a=>n.startsWith(a.color));e.decidedMove=e.line[r].turn;let s=Math.round(100*i.reduce((a,o)=>Math.abs(o.cpl)<100?a+=o.cpl:a,0)/i.length);return Math.abs(s)},D_=e=>e.flags?e.flags:e.cpl>=3?"blunder":e.cpl>=2?"mistake":e.cpl>=1?"inaccurate":e.cpl>=.5?"good":e.cpl>=0?"best":e.cpl<=-1?"great":"ok",wn=(e,t,n)=>{let r=t&&t>0?e.line.findIndex(s=>s.score>=t):e.line.length-1,i=e.line.slice(0,r);return{best:i.filter(s=>s.flags==="best"&&n.startsWith(s.color)).length,blunder:i.filter(s=>s.flags==="blunder"&&n.startsWith(s.color)).length,mistake:i.filter(s=>s.flags==="mistake"&&n.startsWith(s.color)).length,inaccurate:i.filter(s=>s.flags==="inaccurate"&&n.startsWith(s.color)).length,good:i.filter(s=>s.flags==="good"&&n.startsWith(s.color)).length,great:i.filter(s=>s.flags==="great"&&n.startsWith(s.color)).length}};async function ol(e,t,n){let r=Qr.pgnRead(t),i=[];for(let s=0;s<r.gameCount();s++){let a=process.hrtime.bigint(),o;try{o=r.game(s)}catch{Tt.error({error:"cannot process",file:n});continue}let u=[o.playerName("w")||"",o.playerName("b")||""],f=o.mainVariation().nodes(),d=new ys({file:n,game:s+1,totalGames:r.gameCount(),moves:Math.round(f.length/2),date:o.dateAsDate(),players:u,pgn:t.split(`
`),engine:{name:e.name,info:e.info,options:e.options,time:0}});d.result=o.result(),await e.reset();let h=new Xr,y=[],p=[],S=[],C=new Qr.Position;for(let W=0;W<=f.length;W++){let T=new Xr(f[W]);if(p.push(T.ag),T.fen&&S.push(T.fen),T.ag){let A=C.notation(T.ag);T.move=C.uci(A),A.isCastling()&&(T.castle=!0),A.isCapture()&&(T.capture=A.capturedColoredPiece()),A.isPromotion()&&(T.promotion=A.coloredPromotion())}C.play(T.ag);let he="";for(let A of F_){let R=C.square(A);R[0]==="w"?he+=R[1].toUpperCase():R[0]==="b"&&(he+=R[1])}T.pieces=he.length;let x=S.filter(A=>A===T.fen).length;if(x>1&&(T.repeat=x),T.fen&&C.fen(T.fen),C.isCheck()&&(T.check=!0),C.isCheckmate()&&(T.checkmate=!0),C.isStalemate()&&(T.stalemate=!0),C.isDead()&&(T.insufficient=!0),W<24){let A=sl(p);A&&(T.opening=`${A.eco}: ${A.name}`,d.opening={eco:A.eco,name:A.name});let R=al(C.fen());R&&R?.eco!==A?.eco&&(T.position=`${R.eco}: ${R.name}`,d.position={eco:R.eco,name:R.name})}let G;for(G=await e.play(h.fen||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1");(G?.lines?.length||0)<1;)e.options.debug&&Tt.warn("no move found, retrying:",G),G=await e.play(h.fen||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1");let O=G.lines[0];for(let A of G.lines)T.options[A.moves[0]===T.move?`*${A.moves[0]}`:A.moves[0]]=A.score.score;d.line.push(T),O.score.type==="cp"&&y.push(O.score.score),O.score.type==="mate"&&(y.push((T.color==="w"?1:-1)*100),h.flags=`mate in ${O.score.moves}`),O.score.type==="syzygy"&&(y.push(O.score.score),h.solved=!0),h.cpl=(T.color==="w"?-1:1)*Math.round(100*(y[y.length-2]-y[y.length-1]))/100,h.score=y[y.length-1],h.flags=D_(h);for(let A of Object.keys(T))T[A]||delete T[A];if(h.move&&e.options.verbose){let A=JSON.parse(JSON.stringify(h));delete A.turn,delete A.color,Tt.data("move",h.turn,h.color,A)}h=T,e.options.debug&&(O.moves.length=1,Tt.data("move",{move:T,previous:h}),Tt.data("engine",{turn:T.turn,depth:e.analysis.depth,time:e.analysis.time,lines:e.analysis.lines.length,best:O}))}let M=process.hrtime.bigint();d.line.length=Math.min(d.line.length,f.length),e.options.verbose||e.options.debug?(d.acpl={white:{full:An(d,0,"white"),decided:An(d,10,"white")},black:{full:An(d,0,"black"),decided:An(d,10,"black")}},d.overview={white:{full:wn(d,0,"white"),decided:wn(d,10,"white")},black:{full:wn(d,0,"black"),decided:wn(d,10,"black")}}):(d.acpl={white:An(d,10,"white"),black:An(d,10,"black")},d.overview={white:wn(d,10,"white"),black:wn(d,10,"black")}),d.engine&&(d.engine.time=Math.round(Number(M-a)/1e3/1e3)),i.push(d)}return i}async function yy(){ut.configure({inspect:{breakLength:320}}),ut.headerJson();let e=or.readFileSync(Mh.join(__dirname,"../analyze.json"),"utf8"),t=JSON.parse(e),n=new br(t);await n.init(),ut.state("engine",{name:n.name,state:n.state,info:n.info}),n.options.verbose===!0&&ut.state("options",n.options);let r=[],i=process.argv.slice(2),s=[];i.length===1&&or.existsSync(i[0])?s.push(i[0]):s=await(await Promise.resolve().then(()=>(xh(),Oh))).globby(i,{expandDirectories:!0,gitignore:!0,deep:2}),s.length>1&&ut.info("list",{files:s.length});for(let a of s){let o=or.readFileSync(a,"utf8"),u=await ol(n,o,a);r.push(...u);for(let l of u){let f={file:l.file,date:l.date,players:l.players,result:l.result,moves:l.moves,decided:l.decidedMove,time:l.engine?.time,acpl:[l.acpl.white,l.acpl.black]};l.totalGames>1&&(f.game=l.game),ut.state({summary:f,moves:l.overview})}}n.terminate(),process.exit(0)}yy();
//# sourceMappingURL=analyze.js.map
